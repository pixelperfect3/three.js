// ThreeWebGL.js r41/ROME - http://github.com/mrdoob/three.js
var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,e,g){this.r=b;this.g=e;this.b=g;this.updateHex()},setHSV:function(b,e,g){var m,q,B,z,G,H;if(g==0)m=q=B=0;else{z=Math.floor(b*6);G=b*6-z;b=g*(1-e);H=g*(1-e*G);e=g*(1-e*(1-G));switch(z){case 1:m=H;q=g;B=b;break;case 2:m=b;q=g;B=e;break;case 3:m=b;q=H;B=g;break;case 4:m=e;q=b;B=g;break;case 5:m=g;q=b;B=H;break;case 6:case 0:m=g;q=e;B=b}}this.setRGB(m,
q,B)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,e){this.set(b||0,e||0)};
THREE.Vector2.prototype={set:function(b,e){this.x=b;this.y=e;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,e,g){this.set(b||0,e||0,g||0)};
THREE.Vector3.prototype={set:function(b,e,g){this.x=b;this.y=e;this.z=g;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
e){this.set(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x);return this},crossSelf:function(b){var e=this.x,g=this.y,m=this.z;this.set(g*b.z-m*b.y,m*b.x-e*b.z,e*b.y-g*b.x);return this},multiply:function(b,e){this.set(b.x*e.x,b.y*e.y,b.z*e.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var e=this.x-b.x,g=this.y-b.y;b=this.z-b.z;return e*e+g*g+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var e=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(e)>1.0E-5){this.x=Math.atan2(-b.n23/e,b.n33/e);this.z=Math.atan2(-b.n12/e,b.n11/e)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,e,g,m){this.set(b||0,e||0,g||0,m||1)};
THREE.Vector4.prototype={set:function(b,e,g,m){this.x=b;this.y=e;this.z=g;this.w=m;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,e){this.set(b.x+e.x,b.y+e.y,b.z+e.z,b.w+e.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,e){this.set(b.x-e.x,b.y-e.y,b.z-e.z,b.w-e.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,e){this.set(this.x+(b.x-this.x)*e,this.y+(b.y-this.y)*e,this.z+(b.z-this.z)*e,this.w+(b.w-this.w)*e)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,e){this.origin=b||new THREE.Vector3;this.direction=e||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var e,g,m,q=[];e=0;for(g=b.length;e<g;e++){m=b[e];m instanceof THREE.Mesh&&(q=q.concat(this.intersectObject(m)))}q.sort(function(B,z){return B.distance-z.distance});return q},intersectObject:function(b){function e(da,X,Ba,qa){qa=qa.clone().subSelf(X);Ba=Ba.clone().subSelf(X);var ra=da.clone().subSelf(X);da=qa.dot(qa);X=qa.dot(Ba);qa=qa.dot(ra);var ma=Ba.dot(Ba);Ba=Ba.dot(ra);ra=1/
(da*ma-X*X);ma=(ma*qa-X*Ba)*ra;da=(da*Ba-X*qa)*ra;return ma>0&&da>0&&ma+da<1}var g,m,q,B,z,G,H,J,Q,S,W,P=b.geometry,R=P.vertices,aa=[];g=0;for(m=P.faces.length;g<m;g++){q=P.faces[g];S=this.origin.clone();W=this.direction.clone();H=b.matrixWorld;B=H.multiplyVector3(R[q.a].position.clone());z=H.multiplyVector3(R[q.b].position.clone());G=H.multiplyVector3(R[q.c].position.clone());H=q instanceof THREE.Face4?H.multiplyVector3(R[q.d].position.clone()):null;J=b.matrixRotationWorld.multiplyVector3(q.normal.clone());
Q=W.dot(J);if(b.doubleSided||(b.flipSided?Q>0:Q<0)){J=J.dot((new THREE.Vector3).sub(B,S))/Q;S=S.addSelf(W.multiplyScalar(J));if(q instanceof THREE.Face3){if(e(S,B,z,G)){q={distance:this.origin.distanceTo(S),point:S,face:q,object:b};aa.push(q)}}else if(q instanceof THREE.Face4&&(e(S,B,z,H)||e(S,z,G,H))){q={distance:this.origin.distanceTo(S),point:S,face:q,object:b};aa.push(q)}}}return aa}};
THREE.Rectangle=function(){function b(){B=m-e;z=q-g}var e,g,m,q,B,z,G=!0;this.getX=function(){return e};this.getY=function(){return g};this.getWidth=function(){return B};this.getHeight=function(){return z};this.getLeft=function(){return e};this.getTop=function(){return g};this.getRight=function(){return m};this.getBottom=function(){return q};this.set=function(H,J,Q,S){G=!1;e=H;g=J;m=Q;q=S;b()};this.addPoint=function(H,J){if(G){G=!1;e=H;g=J;m=H;q=J}else{e=e<H?e:H;g=g<J?g:J;m=m>H?m:H;q=q>J?q:J}b()};
this.add3Points=function(H,J,Q,S,W,P){if(G){G=!1;e=H<Q?H<W?H:W:Q<W?Q:W;g=J<S?J<P?J:P:S<P?S:P;m=H>Q?H>W?H:W:Q>W?Q:W;q=J>S?J>P?J:P:S>P?S:P}else{e=H<Q?H<W?H<e?H:e:W<e?W:e:Q<W?Q<e?Q:e:W<e?W:e;g=J<S?J<P?J<g?J:g:P<g?P:g:S<P?S<g?S:g:P<g?P:g;m=H>Q?H>W?H>m?H:m:W>m?W:m:Q>W?Q>m?Q:m:W>m?W:m;q=J>S?J>P?J>q?J:q:P>q?P:q:S>P?S>q?S:q:P>q?P:q}b()};this.addRectangle=function(H){if(G){G=!1;e=H.getLeft();g=H.getTop();m=H.getRight();q=H.getBottom()}else{e=e<H.getLeft()?e:H.getLeft();g=g<H.getTop()?g:H.getTop();m=m>H.getRight()?
m:H.getRight();q=q>H.getBottom()?q:H.getBottom()}b()};this.inflate=function(H){e-=H;g-=H;m+=H;q+=H;b()};this.minSelf=function(H){e=e>H.getLeft()?e:H.getLeft();g=g>H.getTop()?g:H.getTop();m=m<H.getRight()?m:H.getRight();q=q<H.getBottom()?q:H.getBottom();b()};this.instersects=function(H){return Math.min(m,H.getRight())-Math.max(e,H.getLeft())>=0&&Math.min(q,H.getBottom())-Math.max(g,H.getTop())>=0};this.empty=function(){G=!0;q=m=g=e=0;b()};this.isEmpty=function(){return G}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,e=this.m;b=e[1];e[1]=e[3];e[3]=b;b=e[2];e[2]=e[6];e[6]=b;b=e[5];e[5]=e[7];e[7]=b;return this},transposeIntoArray:function(b){var e=this.m;b[0]=e[0];b[1]=e[3];b[2]=e[6];b[3]=e[1];b[4]=e[4];b[5]=e[7];b[6]=e[2];b[7]=e[5];b[8]=e[8];return this}};
THREE.Matrix4=function(b,e,g,m,q,B,z,G,H,J,Q,S,W,P,R,aa){this.set(b||1,e||0,g||0,m||0,q||0,B||1,z||0,G||0,H||0,J||0,Q||1,S||0,W||0,P||0,R||0,aa||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,e,g,m,q,B,z,G,H,J,Q,S,W,P,R,aa){this.n11=b;this.n12=e;this.n13=g;this.n14=m;this.n21=q;this.n22=B;this.n23=z;this.n24=G;this.n31=H;this.n32=J;this.n33=Q;this.n34=S;this.n41=W;this.n42=P;this.n43=R;this.n44=aa;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,e,g){var m=
THREE.Matrix4.__v1,q=THREE.Matrix4.__v2,B=THREE.Matrix4.__v3;B.sub(b,e).normalize();if(B.length()===0)B.z=1;m.cross(g,B).normalize();if(m.length()===0){B.x+=1.0E-4;m.cross(g,B).normalize()}q.cross(B,m).normalize();this.n11=m.x;this.n12=q.x;this.n13=B.x;this.n21=m.y;this.n22=q.y;this.n23=B.y;this.n31=m.z;this.n32=q.z;this.n33=B.z;return this},multiplyVector3:function(b){var e=b.x,g=b.y,m=b.z,q=1/(this.n41*e+this.n42*g+this.n43*m+this.n44);b.x=(this.n11*e+this.n12*g+this.n13*m+this.n14)*q;b.y=(this.n21*
e+this.n22*g+this.n23*m+this.n24)*q;b.z=(this.n31*e+this.n32*g+this.n33*m+this.n34)*q;return b},multiplyVector4:function(b){var e=b.x,g=b.y,m=b.z,q=b.w;b.x=this.n11*e+this.n12*g+this.n13*m+this.n14*q;b.y=this.n21*e+this.n22*g+this.n23*m+this.n24*q;b.z=this.n31*e+this.n32*g+this.n33*m+this.n34*q;b.w=this.n41*e+this.n42*g+this.n43*m+this.n44*q;return b},rotateAxis:function(b){var e=b.x,g=b.y,m=b.z;b.x=e*this.n11+g*this.n12+m*this.n13;b.y=e*this.n21+g*this.n22+m*this.n23;b.z=e*this.n31+g*this.n32+m*
this.n33;b.normalize();return b},crossVector:function(b){var e=new THREE.Vector4;e.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;e.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;e.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;e.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return e},multiply:function(b,e){var g=b.n11,m=b.n12,q=b.n13,B=b.n14,z=b.n21,G=b.n22,H=b.n23,J=b.n24,Q=b.n31,S=b.n32,W=b.n33,P=b.n34,R=b.n41,aa=b.n42,da=b.n43,X=b.n44,Ba=e.n11,qa=e.n12,ra=e.n13,
ma=e.n14,Z=e.n21,Za=e.n22,Ca=e.n23,Ja=e.n24,Ma=e.n31,fa=e.n32,d=e.n33,za=e.n34;this.n11=g*Ba+m*Z+q*Ma;this.n12=g*qa+m*Za+q*fa;this.n13=g*ra+m*Ca+q*d;this.n14=g*ma+m*Ja+q*za+B;this.n21=z*Ba+G*Z+H*Ma;this.n22=z*qa+G*Za+H*fa;this.n23=z*ra+G*Ca+H*d;this.n24=z*ma+G*Ja+H*za+J;this.n31=Q*Ba+S*Z+W*Ma;this.n32=Q*qa+S*Za+W*fa;this.n33=Q*ra+S*Ca+W*d;this.n34=Q*ma+S*Ja+W*za+P;this.n41=R*Ba+aa*Z+da*Ma;this.n42=R*qa+aa*Za+da*fa;this.n43=R*ra+aa*Ca+da*d;this.n44=R*ma+aa*Ja+da*za+X;return this},multiplyToArray:function(b,
e,g){this.multiply(b,e);g[0]=this.n11;g[1]=this.n21;g[2]=this.n31;g[3]=this.n41;g[4]=this.n12;g[5]=this.n22;g[6]=this.n32;g[7]=this.n42;g[8]=this.n13;g[9]=this.n23;g[10]=this.n33;g[11]=this.n43;g[12]=this.n14;g[13]=this.n24;g[14]=this.n34;g[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=
b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=this.n11,e=this.n12,g=this.n13,m=this.n14,q=this.n21,B=this.n22,z=this.n23,G=this.n24,H=this.n31,J=this.n32,Q=this.n33,S=this.n34,W=this.n41,P=this.n42,R=this.n43,aa=this.n44;return m*z*J*W-g*G*J*W-m*B*Q*W+e*G*Q*W+g*B*S*W-e*z*S*W-m*z*H*P+g*G*H*P+m*q*Q*P-b*G*Q*P-g*q*S*P+b*z*S*P+m*B*H*R-e*G*H*R-m*q*J*R+b*G*J*R+e*q*S*R-b*B*S*R-g*B*H*aa+e*z*H*aa+g*q*J*aa-b*z*J*aa-e*q*Q*aa+b*B*Q*aa},transpose:function(){var b;b=this.n21;this.n21=
this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=
this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=
this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,e){b[e]=this.n11;b[e+1]=this.n21;b[e+2]=this.n31;b[e+3]=this.n41;b[e+4]=this.n12;b[e+5]=this.n22;b[e+6]=this.n32;b[e+7]=this.n42;b[e+8]=this.n13;b[e+9]=this.n23;b[e+10]=this.n33;b[e+11]=this.n43;b[e+12]=this.n14;b[e+13]=this.n24;b[e+14]=this.n34;b[e+15]=this.n44;return b},setTranslation:function(b,
e,g){this.set(1,0,0,b,0,1,0,e,0,0,1,g,0,0,0,1);return this},setScale:function(b,e,g){this.set(b,0,0,0,0,e,0,0,0,0,g,0,0,0,0,1);return this},setRotationX:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,e,-b,0,0,b,e,0,0,0,0,1);return this},setRotationY:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,0,b,0,0,1,0,0,-b,0,e,0,0,0,0,1);return this},setRotationZ:function(b){var e=Math.cos(b);b=Math.sin(b);this.set(e,-b,0,0,b,e,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,
e){var g=Math.cos(e),m=Math.sin(e),q=1-g,B=b.x,z=b.y,G=b.z,H=q*B,J=q*z;this.set(H*B+g,H*z-m*G,H*G+m*z,0,H*z+m*G,J*z+g,J*G-m*B,0,H*G-m*z,J*G+m*B,q*G*G+g,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);
return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var e=b.x,g=b.y,m=b.z;b=Math.cos(e);e=Math.sin(e);var q=Math.cos(g);g=Math.sin(g);var B=Math.cos(m);m=Math.sin(m);var z=b*g,G=e*g;this.n11=q*B;this.n12=-q*m;this.n13=g;this.n21=
G*B+b*m;this.n22=-G*m+b*B;this.n23=-e*q;this.n31=-z*B+e*m;this.n32=z*m+e*B;this.n33=b*q;return this},setRotationFromQuaternion:function(b){var e=b.x,g=b.y,m=b.z,q=b.w,B=e+e,z=g+g,G=m+m;b=e*B;var H=e*z;e*=G;var J=g*z;g*=G;m*=G;B*=q;z*=q;q*=G;this.n11=1-(J+m);this.n12=H-q;this.n13=e+z;this.n21=H+q;this.n22=1-(b+m);this.n23=g-B;this.n31=e-z;this.n32=g+B;this.n33=1-(b+J);return this},scale:function(b){var e=b.x,g=b.y;b=b.z;this.n11*=e;this.n12*=g;this.n13*=b;this.n21*=e;this.n22*=g;this.n23*=b;this.n31*=
e;this.n32*=g;this.n33*=b;this.n41*=e;this.n42*=g;this.n43*=b;return this},extractPosition:function(b){this.n14=b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,e){var g=1/e.x,m=1/e.y,q=1/e.z;this.n11=b.n11*g;this.n21=b.n21*g;this.n31=b.n31*g;this.n12=b.n12*m;this.n22=b.n22*m;this.n32=b.n32*m;this.n13=b.n13*q;this.n23=b.n23*q;this.n33=b.n33*q}};
THREE.Matrix4.makeInvert=function(b,e){var g=b.n11,m=b.n12,q=b.n13,B=b.n14,z=b.n21,G=b.n22,H=b.n23,J=b.n24,Q=b.n31,S=b.n32,W=b.n33,P=b.n34,R=b.n41,aa=b.n42,da=b.n43,X=b.n44;e===undefined&&(e=new THREE.Matrix4);e.n11=H*P*aa-J*W*aa+J*S*da-G*P*da-H*S*X+G*W*X;e.n12=B*W*aa-q*P*aa-B*S*da+m*P*da+q*S*X-m*W*X;e.n13=q*J*aa-B*H*aa+B*G*da-m*J*da-q*G*X+m*H*X;e.n14=B*H*S-q*J*S-B*G*W+m*J*W+q*G*P-m*H*P;e.n21=J*W*R-H*P*R-J*Q*da+z*P*da+H*Q*X-z*W*X;e.n22=q*P*R-B*W*R+B*Q*da-g*P*da-q*Q*X+g*W*X;e.n23=B*H*R-q*J*R-B*z*da+
g*J*da+q*z*X-g*H*X;e.n24=q*J*Q-B*H*Q+B*z*W-g*J*W-q*z*P+g*H*P;e.n31=G*P*R-J*S*R+J*Q*aa-z*P*aa-G*Q*X+z*S*X;e.n32=B*S*R-m*P*R-B*Q*aa+g*P*aa+m*Q*X-g*S*X;e.n33=q*J*R-B*G*R+B*z*aa-g*J*aa-m*z*X+g*G*X;e.n34=B*G*Q-m*J*Q-B*z*S+g*J*S+m*z*P-g*G*P;e.n41=H*S*R-G*W*R-H*Q*aa+z*W*aa+G*Q*da-z*S*da;e.n42=m*W*R-q*S*R+q*Q*aa-g*W*aa-m*Q*da+g*S*da;e.n43=q*G*R-m*H*R-q*z*aa+g*H*aa+m*z*da-g*G*da;e.n44=m*H*Q-q*G*Q+q*z*S-g*H*S-m*z*W+g*G*W;e.multiplyScalar(1/b.determinant());return e};
THREE.Matrix4.makeInvert3x3=function(b){var e=b.m33,g=e.m,m=b.n33*b.n22-b.n32*b.n23,q=-b.n33*b.n21+b.n31*b.n23,B=b.n32*b.n21-b.n31*b.n22,z=-b.n33*b.n12+b.n32*b.n13,G=b.n33*b.n11-b.n31*b.n13,H=-b.n32*b.n11+b.n31*b.n12,J=b.n23*b.n12-b.n22*b.n13,Q=-b.n23*b.n11+b.n21*b.n13,S=b.n22*b.n11-b.n21*b.n12;b=b.n11*m+b.n21*z+b.n31*J;if(b==0)throw"matrix not invertible";b=1/b;g[0]=b*m;g[1]=b*q;g[2]=b*B;g[3]=b*z;g[4]=b*G;g[5]=b*H;g[6]=b*J;g[7]=b*Q;g[8]=b*S;return e};
THREE.Matrix4.makeFrustum=function(b,e,g,m,q,B){var z;z=new THREE.Matrix4;z.n11=2*q/(e-b);z.n12=0;z.n13=(e+b)/(e-b);z.n14=0;z.n21=0;z.n22=2*q/(m-g);z.n23=(m+g)/(m-g);z.n24=0;z.n31=0;z.n32=0;z.n33=-(B+q)/(B-q);z.n34=-2*B*q/(B-q);z.n41=0;z.n42=0;z.n43=-1;z.n44=0;return z};THREE.Matrix4.makePerspective=function(b,e,g,m){var q;b=g*Math.tan(b*Math.PI/360);q=-b;return THREE.Matrix4.makeFrustum(q*e,b*e,q,b,g,m)};
THREE.Matrix4.makeOrtho=function(b,e,g,m,q,B){var z,G,H,J;z=new THREE.Matrix4;G=e-b;H=g-m;J=B-q;z.n11=2/G;z.n12=0;z.n13=0;z.n14=-((e+b)/G);z.n21=0;z.n22=2/H;z.n23=0;z.n24=-((g+m)/H);z.n31=0;z.n32=0;z.n33=-2/J;z.n34=-((B+q)/J);z.n41=0;z.n42=0;z.n43=0;z.n44=1;return z};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.dynamic=!1;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=
1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var e=this;e.parent!==undefined;)e=e.parent;e!==undefined&&e instanceof THREE.Scene&&e.addChildRecurse(b)}},removeChild:function(b){var e=this.children.indexOf(b);if(e!==-1){b.parent=undefined;this.children.splice(e,1)}},getChildByName:function(b,e){var g,m,q;g=0;for(m=this.children.length;g<m;g++){q=this.children[g];if(q.name===b)return q;if(e){q=q.getChildByName(b,e);if(q!==undefined)return q}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,e,g){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;e=!0}b=0;for(var m=this.children.length;b<m;b++)this.children[b].update(this.matrixWorld,e,g)}};THREE.Quaternion=function(b,e,g,m){this.set(b||0,e||0,g||0,m!==undefined?m:1)};
THREE.Quaternion.prototype={set:function(b,e,g,m){this.x=b;this.y=e;this.z=g;this.w=m;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var e=0.5*Math.PI/360,g=b.x*e,m=b.y*e,q=b.z*e;b=Math.cos(m);m=Math.sin(m);e=Math.cos(-q);q=Math.sin(-q);var B=Math.cos(g);g=Math.sin(g);var z=b*e,G=m*q;this.w=z*B-G*g;this.x=z*g+G*B;this.y=m*e*B+b*q*g;this.z=b*q*B-m*e*g;return this},setFromAxisAngle:function(b,e){var g=e/2,m=Math.sin(g);this.x=b.x*m;this.y=
b.y*m;this.z=b.z*m;this.w=Math.cos(g);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var e=this.x,g=this.y,m=this.z,q=this.w,B=b.x,z=b.y,G=b.z;b=b.w;this.x=e*b+q*B+g*G-m*z;this.y=g*b+q*z+m*B-e*G;this.z=m*b+q*G+e*z-g*B;this.w=q*b-e*B-g*z-m*G;return this},multiply:function(b,e){this.x=b.x*e.w+b.y*e.z-b.z*e.y+b.w*e.x;this.y=-b.x*e.z+b.y*e.w+b.z*e.x+b.w*e.y;this.z=b.x*e.y-b.y*e.x+b.z*e.w+b.w*e.z;this.w=-b.x*e.x-b.y*e.y-b.z*e.z+b.w*e.w;return this},multiplyVector3:function(b,e){e||(e=b);var g=b.x,m=b.y,q=b.z,B=this.x,z=this.y,G=this.z,H=this.w,J=H*g+z*q-G*m,Q=
H*m+G*g-B*q,S=H*q+B*m-z*g;g=-B*g-z*m-G*q;e.x=J*H+g*-B+Q*-G-S*-z;e.y=Q*H+g*-z+S*-B-J*-G;e.z=S*H+g*-G+J*-z-Q*-B;return e}};
THREE.Quaternion.slerp=function(b,e,g,m){var q=b.w*e.w+b.x*e.x+b.y*e.y+b.z*e.z;if(Math.abs(q)>=1){g.w=b.w;g.x=b.x;g.y=b.y;g.z=b.z;return g}var B=Math.acos(q),z=Math.sqrt(1-q*q);if(Math.abs(z)<0.0010){g.w=0.5*(b.w+e.w);g.x=0.5*(b.x+e.x);g.y=0.5*(b.y+e.y);g.z=0.5*(b.z+e.z);return g}q=Math.sin((1-m)*B)/z;m=Math.sin(m*B)/z;g.w=b.w*q+e.w*m;g.x=b.x*q+e.x*m;g.y=b.y*q+e.y*m;g.z=b.z*q+e.z*m;return g};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,e,g,m,q,B){this.a=b;this.b=e;this.c=g;this.normal=m instanceof THREE.Vector3?m:new THREE.Vector3;this.vertexNormals=m instanceof Array?m:[];this.color=q instanceof THREE.Color?q:new THREE.Color;this.vertexColors=q instanceof Array?q:[];this.vertexTangents=[];this.materials=B instanceof Array?B:[B];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,e,g,m,q,B,z){this.a=b;this.b=e;this.c=g;this.d=m;this.normal=q instanceof THREE.Vector3?q:new THREE.Vector3;this.vertexNormals=q instanceof Array?q:[];this.color=B instanceof THREE.Color?B:new THREE.Color;this.vertexColors=B instanceof Array?B:[];this.vertexTangents=[];this.materials=z instanceof Array?z:[z];this.centroid=new THREE.Vector3};THREE.UV=function(b,e){this.set(b||0,e||0)};
THREE.UV.prototype={set:function(b,e){this.u=b;this.v=e;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,e,g;b=0;for(e=this.faces.length;b<e;b++){g=this.faces[b];g.centroid.set(0,0,0);if(g instanceof THREE.Face3){g.centroid.addSelf(this.vertices[g.a].position);g.centroid.addSelf(this.vertices[g.b].position);g.centroid.addSelf(this.vertices[g.c].position);g.centroid.divideScalar(3)}else if(g instanceof THREE.Face4){g.centroid.addSelf(this.vertices[g.a].position);g.centroid.addSelf(this.vertices[g.b].position);g.centroid.addSelf(this.vertices[g.c].position);
g.centroid.addSelf(this.vertices[g.d].position);g.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var e,g,m,q,B,z,G=new THREE.Vector3,H=new THREE.Vector3;m=0;for(q=this.faces.length;m<q;m++){B=this.faces[m];if(b&&B.vertexNormals.length){G.set(0,0,0);e=0;for(g=B.vertexNormals.length;e<g;e++)G.addSelf(B.vertexNormals[e]);G.divideScalar(3)}else{e=this.vertices[B.a];g=this.vertices[B.b];z=this.vertices[B.c];G.sub(z.position,g.position);H.sub(e.position,g.position);G.crossSelf(H)}G.isZero()||
G.normalize();B.normal.copy(G)}},computeVertexNormals:function(){var b,e,g,m;if(this.__tmpVertices==undefined){m=this.__tmpVertices=Array(this.vertices.length);b=0;for(e=this.vertices.length;b<e;b++)m[b]=new THREE.Vector3;b=0;for(e=this.faces.length;b<e;b++){g=this.faces[b];if(g instanceof THREE.Face3)g.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(g instanceof THREE.Face4)g.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{m=
this.__tmpVertices;b=0;for(e=this.vertices.length;b<e;b++)m[b].set(0,0,0)}b=0;for(e=this.faces.length;b<e;b++){g=this.faces[b];if(g instanceof THREE.Face3){m[g.a].addSelf(g.normal);m[g.b].addSelf(g.normal);m[g.c].addSelf(g.normal)}else if(g instanceof THREE.Face4){m[g.a].addSelf(g.normal);m[g.b].addSelf(g.normal);m[g.c].addSelf(g.normal);m[g.d].addSelf(g.normal)}}b=0;for(e=this.vertices.length;b<e;b++)m[b].normalize();b=0;for(e=this.faces.length;b<e;b++){g=this.faces[b];if(g instanceof THREE.Face3){g.vertexNormals[0].copy(m[g.a]);
g.vertexNormals[1].copy(m[g.b]);g.vertexNormals[2].copy(m[g.c])}else if(g instanceof THREE.Face4){g.vertexNormals[0].copy(m[g.a]);g.vertexNormals[1].copy(m[g.b]);g.vertexNormals[2].copy(m[g.c]);g.vertexNormals[3].copy(m[g.d])}}},computeTangents:function(){function b(wa,Pa,Ka,La,xa,Sa,Fa){G=wa.vertices[Pa].position;H=wa.vertices[Ka].position;J=wa.vertices[La].position;Q=z[xa];S=z[Sa];W=z[Fa];P=H.x-G.x;R=J.x-G.x;aa=H.y-G.y;da=J.y-G.y;X=H.z-G.z;Ba=J.z-G.z;qa=S.u-Q.u;ra=W.u-Q.u;ma=S.v-Q.v;Z=W.v-Q.v;Za=
1/(qa*Z-ra*ma);fa.set((Z*P-ma*R)*Za,(Z*aa-ma*da)*Za,(Z*X-ma*Ba)*Za);d.set((qa*R-ra*P)*Za,(qa*da-ra*aa)*Za,(qa*Ba-ra*X)*Za);Ja[Pa].addSelf(fa);Ja[Ka].addSelf(fa);Ja[La].addSelf(fa);Ma[Pa].addSelf(d);Ma[Ka].addSelf(d);Ma[La].addSelf(d)}var e,g,m,q,B,z,G,H,J,Q,S,W,P,R,aa,da,X,Ba,qa,ra,ma,Z,Za,Ca,Ja=[],Ma=[],fa=new THREE.Vector3,d=new THREE.Vector3,za=new THREE.Vector3,c=new THREE.Vector3,Ua=new THREE.Vector3;e=0;for(g=this.vertices.length;e<g;e++){Ja[e]=new THREE.Vector3;Ma[e]=new THREE.Vector3}e=0;
for(g=this.faces.length;e<g;e++){B=this.faces[e];z=this.faceVertexUvs[0][e];if(B instanceof THREE.Face3)b(this,B.a,B.b,B.c,0,1,2);else if(B instanceof THREE.Face4){b(this,B.a,B.b,B.c,0,1,2);b(this,B.a,B.b,B.d,0,1,3)}}var Ga=["a","b","c","d"];e=0;for(g=this.faces.length;e<g;e++){B=this.faces[e];for(m=0;m<B.vertexNormals.length;m++){Ua.copy(B.vertexNormals[m]);q=B[Ga[m]];Ca=Ja[q];za.copy(Ca);za.subSelf(Ua.multiplyScalar(Ua.dot(Ca))).normalize();c.cross(B.vertexNormals[m],Ca);q=c.dot(Ma[q]);q=q<0?-1:
1;B.vertexTangents[m]=new THREE.Vector4(za.x,za.y,za.z,q)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var e=1,g=this.vertices.length;e<g;e++){b=this.vertices[e];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=
b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,e=0,g=this.vertices.length;e<g;e++)b=Math.max(b,this.vertices[e].position.length());
this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(H,J){return Math.min(H,J)+"_"+Math.max(H,J)}function e(H,J,Q){if(H[J]===undefined){H[J]={set:{},array:[]};H[J].set[Q]=1;H[J].array.push(Q)}else if(H[J].set[Q]===undefined){H[J].set[Q]=1;H[J].array.push(Q)}}var g,m,q,B,z,G={};g=0;for(m=this.faces.length;g<m;g++){z=this.faces[g];if(z instanceof THREE.Face3){q=b(z.a,z.b);e(G,q,g);q=b(z.b,z.c);e(G,q,g);q=b(z.a,z.c);e(G,q,g)}else if(z instanceof THREE.Face4){q=b(z.b,z.d);e(G,q,g);q=
b(z.a,z.b);e(G,q,g);q=b(z.a,z.d);e(G,q,g);q=b(z.b,z.c);e(G,q,g);q=b(z.c,z.d);e(G,q,g)}}g=0;for(m=this.edges.length;g<m;g++){z=this.edges[g];q=z.vertexIndices[0];B=z.vertexIndices[1];z.faceIndices=G[b(q,B)].array;for(q=0;q<z.faceIndices.length;q++){B=z.faceIndices[q];z.faces.push(this.faces[B])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function e(P,R,aa,da,X,Ba,qa){P=(aa-P)*0.5;da=(da-R)*0.5;return(2*(R-aa)+P+da)*qa+(-3*(R-aa)-2*P-da)*Ba+P*X+R}this.points=b;var g=[],m={x:0,y:0,z:0},q,B,z,G,H,J,Q,S,W;this.initFromArray=function(P){this.points=[];for(var R=0;R<P.length;R++)this.points[R]={x:P[R][0],y:P[R][1],z:P[R][2]}};this.getPoint=function(P){q=(this.points.length-1)*P;B=Math.floor(q);z=q-B;g[0]=B==0?B:B-1;g[1]=B;g[2]=B>this.points.length-2?B:B+1;g[3]=B>this.points.length-3?B:B+2;J=this.points[g[0]];Q=
this.points[g[1]];S=this.points[g[2]];W=this.points[g[3]];G=z*z;H=z*G;m.x=e(J.x,Q.x,S.x,W.x,z,G,H);m.y=e(J.y,Q.y,S.y,W.y,z,G,H);m.z=e(J.z,Q.z,S.z,W.z,z,G,H);return m};this.getControlPointsArray=function(){var P,R,aa=this.points.length,da=[];for(P=0;P<aa;P++){R=this.points[P];da[P]=[R.x,R.y,R.z]}return da};this.getLength=function(P){var R,aa,da=R=R=0,X=new THREE.Vector3,Ba=new THREE.Vector3,qa=[],ra=0;qa[0]=0;P||(P=100);aa=this.points.length*P;X.copy(this.points[0]);for(P=1;P<aa;P++){R=P/aa;position=
this.getPoint(R);Ba.copy(position);ra+=Ba.distanceTo(X);X.copy(position);R*=this.points.length-1;R=Math.floor(R);if(R!=da){qa[R]=ra;da=R}}qa[qa.length]=ra;return{chunks:qa,total:ra}};this.reparametrizeByArcLength=function(P){var R,aa,da,X,Ba,qa,ra=[],ma=new THREE.Vector3,Z=this.getLength();ra.push(ma.copy(this.points[0]).clone());for(R=1;R<this.points.length;R++){aa=Z.chunks[R]-Z.chunks[R-1];qa=Math.ceil(P*aa/Z.total);X=(R-1)/(this.points.length-1);Ba=R/(this.points.length-1);for(aa=1;aa<qa-1;aa++){da=
X+aa*(1/qa)*(Ba-X);position=this.getPoint(da);ra.push(ma.copy(position).clone())}ra.push(ma.copy(this.points[R]).clone())}this.points=ra}};THREE.Edge=function(b,e,g,m){this.vertices=[b,e];this.vertexIndices=[g,m];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,e,g,m,q){THREE.Object3D.call(this);this.fov=b||50;this.aspect=e||1;this.near=g||0.1;this.far=m||2E3;this.target=q||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};
THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,e){this.matrix.rotateAxis(e);this.position.addSelf(e.multiplyScalar(b));this.target.position.addSelf(e.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,e,g){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);e=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;e=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,g)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,e,g,m){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=e||1;this.distance=g||0;this.castShadow=m!==undefined?m:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,e,g){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=e||1;this.distance=g||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,e,g,m){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,e,g,m)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,e,g,m){e===undefined&&(e=-1);g===undefined&&(g=0);if(m===undefined)m=THREE.BillboardBlending;g=Math.min(g,Math.max(0,g));this.lensFlares.push({texture:b,size:e,distance:g,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:m})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,e=this.lensFlares.length,g,m=-this.positionScreen.x*2,q=-this.positionScreen.y*2;for(b=0;b<e;b++){g=this.lensFlares[b];g.x=this.positionScreen.x+m*g.distance;g.y=this.positionScreen.y+q*g.distance;g.wantedRotation=g.x*Math.PI*0.25;g.rotation+=(g.wantedRotation-g.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(b,e,g,m,q,B){this.image=b;this.mapping=e!==undefined?e:new THREE.UVMapping;this.wrapS=g!==undefined?g:THREE.ClampToEdgeWrapping;this.wrapT=m!==undefined?m:THREE.ClampToEdgeWrapping;this.magFilter=q!==undefined?q:THREE.LinearFilter;this.minFilter=B!==undefined?B:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.ParticleSystem=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,e,g){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.type=g!=undefined?g:THREE.LineStrip};THREE.LineStrip=0;
THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e&&e.length?e:[e];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var g=0;g<this.geometry.morphTargets.length;g++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[g].name]=g}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,e,g){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var m,q=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(m=0;m<q;m++){b=this.children[m];b instanceof THREE.Bone?b.update(this.skinMatrix,e,g):b.update(this.matrixWorld,!0,g)}}else for(m=0;m<q;m++)this.children[m].update(this.skinMatrix,
e,g)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,e){THREE.Mesh.call(this,b,e);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var g,m,q,B,z,G;if(this.geometry.bones!==undefined){for(g=0;g<this.geometry.bones.length;g++){q=this.geometry.bones[g];B=q.pos;z=q.rotq;G=q.scl;m=this.addBone();m.name=q.name;m.position.set(B[0],B[1],B[2]);m.quaternion.set(z[0],z[1],z[2],z[3]);m.useQuaternion=!0;G!==undefined?m.scale.set(G[0],G[1],G[2]):m.scale.set(1,1,1)}for(g=0;g<this.bones.length;g++){q=this.geometry.bones[g];
m=this.bones[g];q.parent===-1?this.addChild(m):this.bones[q.parent].addChild(m)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,e,g){if(this.visible){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var m,q=this.children.length;for(m=0;m<q;m++){b=this.children[m];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,g):b.update(this.matrixWorld,e,g)}g=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(e=0;e<g;e++)ba[e].skinMatrix.flattenToArrayOffset(bm,
e*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,e=[],g=0;g<this.bones.length;g++){b=this.bones[g];e.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,g*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var m;for(b=0;b<this.geometry.skinIndices.length;b++){g=this.geometry.vertices[b].position;var q=this.geometry.skinIndices[b].x,B=this.geometry.skinIndices[b].y;
m=new THREE.Vector3(g.x,g.y,g.z);this.geometry.skinVerticesA.push(e[q].multiplyVector3(m));m=new THREE.Vector3(g.x,g.y,g.z);this.geometry.skinVerticesB.push(e[B].multiplyVector3(m));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){g=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=g;this.geometry.skinWeights[b].y+=g}}}};
THREE.Ribbon=function(b,e){THREE.Object3D.call(this);this.geometry=b;this.materials=e instanceof Array?e:[e];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,e,g,m){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=e!==undefined?Math.abs(e):100;this.volume=Math.min(1,Math.max(0,g!==undefined?g:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=m!==undefined?m:!0;this.sources=b instanceof Array?b:[b];var q;g=this.sources.length;for(b=0;b<g;b++){e=this.sources[b];e.toLowerCase();if(e.indexOf(".mp3")!==-1)q=
"audio/mpeg";else if(e.indexOf(".ogg")!==-1)q="audio/ogg";else e.indexOf(".wav")!==-1&&(q="audio/wav");if(this.domElement.canPlayType(q)){q=document.createElement("source");q.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(q);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,e,g){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);e=!0}if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}var m=this.children.length;for(b=0;b<m;b++)this.children[b].update(this.matrixWorld,e,g)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,e){e===undefined&&(e=0);e=Math.abs(e);for(var g=0;g<this.LODs.length;g++)if(e<this.LODs[g].visibleAtDistance)break;this.LODs.splice(g,0,{visibleAtDistance:e,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,e,g){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;e=!0}if(this.LODs.length>1){b=g.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var m=1;m<this.LODs.length;m++)if(b>=this.LODs[m].visibleAtDistance){this.LODs[m-1].object3D.visible=
!1;this.LODs[m].object3D.visible=!0}else break;for(;m<this.LODs.length;m++)this.LODs[m].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,e,g)};THREE.ShadowVolume=function(b,e){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,e?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,e,g,m,q,B,z,G,H,J,Q,S,W,P,R=new THREE.Geometry;R.vertices=this.geometry.vertices;m=R.faces=this.geometry.faces;var aa=R.egdes=this.geometry.edges,da=R.edgeFaces=[];q=0;var X=[];b=0;for(e=m.length;b<e;b++){g=m[b];X.push(q);q+=g instanceof THREE.Face3?3:4;g.vertexNormals[0]=g.normal;g.vertexNormals[1]=g.normal;g.vertexNormals[2]=g.normal;if(g instanceof THREE.Face4)g.vertexNormals[3]=
g.normal}b=0;for(e=aa.length;b<e;b++){G=aa[b];g=G.faces[0];m=G.faces[1];q=G.faceIndices[0];B=G.faceIndices[1];z=G.vertexIndices[0];G=G.vertexIndices[1];if(g.a===z){H="a";Q=X[q]+0}else if(g.b===z){H="b";Q=X[q]+1}else if(g.c===z){H="c";Q=X[q]+2}else if(g.d===z){H="d";Q=X[q]+3}if(g.a===G){H+="a";S=X[q]+0}else if(g.b===G){H+="b";S=X[q]+1}else if(g.c===G){H+="c";S=X[q]+2}else if(g.d===G){H+="d";S=X[q]+3}if(m.a===z){J="a";W=X[B]+0}else if(m.b===z){J="b";W=X[B]+1}else if(m.c===z){J="c";W=X[B]+2}else if(m.d===
z){J="d";W=X[B]+3}if(m.a===G){J+="a";P=X[B]+0}else if(m.b===G){J+="b";P=X[B]+1}else if(m.c===G){J+="c";P=X[B]+2}else if(m.d===G){J+="d";P=X[B]+3}if(H==="ac"||H==="ad"||H==="ca"||H==="da"){if(Q>S){g=Q;Q=S;S=g}}else if(Q<S){g=Q;Q=S;S=g}if(J==="ac"||J==="ad"||J==="ca"||J==="da"){if(W>P){g=W;W=P;P=g}}else if(W<P){g=W;W=P;P=g}g=new THREE.Face4(Q,S,W,P);g.normal.set(1,0,0);da.push(g)}this.geometry=R}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var e=this.geometry.vertices,g=this.geometry.faces,m=this.geometry.edgeFaces,q=b.faces;b=b.vertices;var B=q.length,z,G,H,J,Q,S=["a","b","c","d"];for(H=0;H<B;H++){G=e.length;z=q[H];if(z instanceof THREE.Face4){J=4;G=new THREE.Face4(G,G+1,G+2,G+3)}else{J=3;G=new THREE.Face3(G,G+1,G+2)}G.normal.copy(z.normal);g.push(G);
for(G=0;G<J;G++){Q=b[z[S[G]]];e.push(new THREE.Vertex(Q.position.clone()))}}for(B=0;B<q.length-1;B++){b=g[B];for(z=B+1;z<q.length;z++){G=g[z];G=this.facesShareEdge(e,b,G);if(G!==undefined){G=new THREE.Face4(G.indices[0],G.indices[3],G.indices[2],G.indices[1]);G.normal.set(1,0,0);m.push(G)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,e,g){var m,q,B,z,G,H,J,Q,S,W,P,R,aa,da=0,X=["a","b","c","d"];m=e instanceof THREE.Face4?4:3;q=g instanceof THREE.Face4?4:3;for(R=0;R<m;R++){B=e[X[R]];G=b[B];for(aa=0;aa<q;aa++){z=g[X[aa]];H=b[z];if(Math.abs(G.position.x-H.position.x)<1.0E-4&&Math.abs(G.position.y-H.position.y)<1.0E-4&&Math.abs(G.position.z-H.position.z)<1.0E-4){da++;if(da===1){J=G;Q=H;S=B;W=z;P=X[R]}if(da===2){P+=X[R];return P==="ad"||P==="ac"?{faces:[e,g],vertices:[J,Q,H,G],
indices:[S,W,z,B],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[e,g],vertices:[J,G,H,Q],indices:[S,B,z,W],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var e=0;e<b.children.length;e++)this.addChildRecurse(b.children[e])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var e=this.lights.indexOf(b);e!==-1&&this.lights.splice(e,1)}else if(b instanceof THREE.Sound){e=this.sounds.indexOf(b);e!==-1&&this.sounds.splice(e,1)}else if(!(b instanceof THREE.Camera)){e=this.objects.indexOf(b);if(e!==-1){this.objects.splice(e,1);this.__objectsRemoved.push(b)}}for(e=0;e<b.children.length;e++)this.removeChildRecurse(b.children[e])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,e,g){this.color=new THREE.Color(b);this.near=e||1;this.far=g||1E3};THREE.FogExp2=function(b,e){this.color=new THREE.Color(b);this.density=e!==undefined?e:2.5E-4};
THREE.Projector=function(){function b(){var fa=H[G]=H[G]||new THREE.RenderableVertex;G++;return fa}function e(fa,d){return d.z-fa.z}function g(fa,d){var za=0,c=1,Ua=fa.z+fa.w,Ga=d.z+d.w,wa=-fa.z+fa.w,Pa=-d.z+d.w;if(Ua>=0&&Ga>=0&&wa>=0&&Pa>=0)return!0;else if(Ua<0&&Ga<0||wa<0&&Pa<0)return!1;else{if(Ua<0)za=Math.max(za,Ua/(Ua-Ga));else Ga<0&&(c=Math.min(c,Ua/(Ua-Ga)));if(wa<0)za=Math.max(za,wa/(wa-Pa));else Pa<0&&(c=Math.min(c,wa/(wa-Pa)));if(c<za)return!1;else{fa.lerpSelf(d,za);d.lerpSelf(fa,1-c);
return!0}}}var m,q,B=[],z,G,H=[],J,Q,S=[],W,P=[],R,aa,da=[],X,Ba,qa=[],ra=new THREE.Vector4,ma=new THREE.Vector4,Z=new THREE.Matrix4,Za=new THREE.Matrix4,Ca=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Ja=new THREE.Vector4,Ma=new THREE.Vector4;this.projectVector=function(fa,d){Z.multiply(d.projectionMatrix,d.matrixWorldInverse);Z.multiplyVector3(fa);return fa};this.unprojectVector=function(fa,d){Z.multiply(d.matrixWorld,THREE.Matrix4.makeInvert(d.projectionMatrix));
Z.multiplyVector3(fa);return fa};this.projectObjects=function(fa,d,za){d=[];var c,Ua,Ga;q=0;Ua=fa.objects;fa=0;for(c=Ua.length;fa<c;fa++){Ga=Ua[fa];var wa;if(!(wa=!Ga.visible))if(wa=Ga instanceof THREE.Mesh){a:{wa=void 0;for(var Pa=Ga.matrixWorld,Ka=-Ga.geometry.boundingSphere.radius*Math.max(Ga.scale.x,Math.max(Ga.scale.y,Ga.scale.z)),La=0;La<6;La++){wa=Ca[La].x*Pa.n14+Ca[La].y*Pa.n24+Ca[La].z*Pa.n34+Ca[La].w;if(wa<=Ka){wa=!1;break a}}wa=!0}wa=!wa}if(!wa){wa=B[q]=B[q]||new THREE.RenderableObject;
q++;m=wa;ra.copy(Ga.position);Z.multiplyVector3(ra);m.object=Ga;m.z=ra.z;d.push(m)}}za&&d.sort(e);return d};this.projectScene=function(fa,d,za){var c=[],Ua=d.near,Ga=d.far,wa,Pa,Ka,La,xa,Sa,Fa,Ha,Ia,va,$a,eb,ib,jb,db,fb,nb;Ba=aa=W=Q=0;d.matrixAutoUpdate&&d.update(undefined,!0);fa.update(undefined,!1,d);Z.multiply(d.projectionMatrix,d.matrixWorldInverse);Ca[0].set(Z.n41-Z.n11,Z.n42-Z.n12,Z.n43-Z.n13,Z.n44-Z.n14);Ca[1].set(Z.n41+Z.n11,Z.n42+Z.n12,Z.n43+Z.n13,Z.n44+Z.n14);Ca[2].set(Z.n41+Z.n21,Z.n42+
Z.n22,Z.n43+Z.n23,Z.n44+Z.n24);Ca[3].set(Z.n41-Z.n21,Z.n42-Z.n22,Z.n43-Z.n23,Z.n44-Z.n24);Ca[4].set(Z.n41-Z.n31,Z.n42-Z.n32,Z.n43-Z.n33,Z.n44-Z.n34);Ca[5].set(Z.n41+Z.n31,Z.n42+Z.n32,Z.n43+Z.n33,Z.n44+Z.n34);for(wa=0;wa<6;wa++){Ia=Ca[wa];Ia.divideScalar(Math.sqrt(Ia.x*Ia.x+Ia.y*Ia.y+Ia.z*Ia.z))}Ia=this.projectObjects(fa,d,!0);fa=0;for(wa=Ia.length;fa<wa;fa++){va=Ia[fa].object;if(va.visible){$a=va.matrixWorld;eb=va.matrixRotationWorld;ib=va.materials;jb=va.overdraw;G=0;if(va instanceof THREE.Mesh){db=
va.geometry;La=db.vertices;fb=db.faces;db=db.faceVertexUvs;Pa=0;for(Ka=La.length;Pa<Ka;Pa++){z=b();z.positionWorld.copy(La[Pa].position);$a.multiplyVector3(z.positionWorld);z.positionScreen.copy(z.positionWorld);Z.multiplyVector4(z.positionScreen);z.positionScreen.x/=z.positionScreen.w;z.positionScreen.y/=z.positionScreen.w;z.visible=z.positionScreen.z>Ua&&z.positionScreen.z<Ga}La=0;for(Pa=fb.length;La<Pa;La++){Ka=fb[La];if(Ka instanceof THREE.Face3){xa=H[Ka.a];Sa=H[Ka.b];Fa=H[Ka.c];if(xa.visible&&
Sa.visible&&Fa.visible&&(va.doubleSided||va.flipSided!=(Fa.positionScreen.x-xa.positionScreen.x)*(Sa.positionScreen.y-xa.positionScreen.y)-(Fa.positionScreen.y-xa.positionScreen.y)*(Sa.positionScreen.x-xa.positionScreen.x)<0)){Ha=S[Q]=S[Q]||new THREE.RenderableFace3;Q++;J=Ha;J.v1.copy(xa);J.v2.copy(Sa);J.v3.copy(Fa)}else continue}else if(Ka instanceof THREE.Face4){xa=H[Ka.a];Sa=H[Ka.b];Fa=H[Ka.c];Ha=H[Ka.d];if(xa.visible&&Sa.visible&&Fa.visible&&Ha.visible&&(va.doubleSided||va.flipSided!=((Ha.positionScreen.x-
xa.positionScreen.x)*(Sa.positionScreen.y-xa.positionScreen.y)-(Ha.positionScreen.y-xa.positionScreen.y)*(Sa.positionScreen.x-xa.positionScreen.x)<0||(Sa.positionScreen.x-Fa.positionScreen.x)*(Ha.positionScreen.y-Fa.positionScreen.y)-(Sa.positionScreen.y-Fa.positionScreen.y)*(Ha.positionScreen.x-Fa.positionScreen.x)<0))){nb=P[W]=P[W]||new THREE.RenderableFace4;W++;J=nb;J.v1.copy(xa);J.v2.copy(Sa);J.v3.copy(Fa);J.v4.copy(Ha)}else continue}J.normalWorld.copy(Ka.normal);eb.multiplyVector3(J.normalWorld);
J.centroidWorld.copy(Ka.centroid);$a.multiplyVector3(J.centroidWorld);J.centroidScreen.copy(J.centroidWorld);Z.multiplyVector3(J.centroidScreen);Fa=Ka.vertexNormals;xa=0;for(Sa=Fa.length;xa<Sa;xa++){Ha=J.vertexNormalsWorld[xa];Ha.copy(Fa[xa]);eb.multiplyVector3(Ha)}xa=0;for(Sa=db.length;xa<Sa;xa++)if(nb=db[xa][La]){Fa=0;for(Ha=nb.length;Fa<Ha;Fa++)J.uvs[xa][Fa]=nb[Fa]}J.meshMaterials=ib;J.faceMaterials=Ka.materials;J.overdraw=jb;J.z=J.centroidScreen.z;c.push(J)}}else if(va instanceof THREE.Line){Za.multiply(Z,
$a);La=va.geometry.vertices;xa=b();xa.positionScreen.copy(La[0].position);Za.multiplyVector4(xa.positionScreen);Pa=1;for(Ka=La.length;Pa<Ka;Pa++){xa=b();xa.positionScreen.copy(La[Pa].position);Za.multiplyVector4(xa.positionScreen);Sa=H[G-2];Ja.copy(xa.positionScreen);Ma.copy(Sa.positionScreen);if(g(Ja,Ma)){Ja.multiplyScalar(1/Ja.w);Ma.multiplyScalar(1/Ma.w);$a=da[aa]=da[aa]||new THREE.RenderableLine;aa++;R=$a;R.v1.positionScreen.copy(Ja);R.v2.positionScreen.copy(Ma);R.z=Math.max(Ja.z,Ma.z);R.materials=
va.materials;c.push(R)}}}else if(va instanceof THREE.Particle){ma.set(va.matrixWorld.n14,va.matrixWorld.n24,va.matrixWorld.n34,1);Z.multiplyVector4(ma);ma.z/=ma.w;if(ma.z>0&&ma.z<1){$a=qa[Ba]=qa[Ba]||new THREE.RenderableParticle;Ba++;X=$a;X.x=ma.x/ma.w;X.y=ma.y/ma.w;X.z=ma.z;X.rotation=va.rotation.z;X.scale.x=va.scale.x*Math.abs(X.x-(ma.x+d.projectionMatrix.n11)/(ma.w+d.projectionMatrix.n14));X.scale.y=va.scale.y*Math.abs(X.y-(ma.y+d.projectionMatrix.n22)/(ma.w+d.projectionMatrix.n24));X.materials=
va.materials;c.push(X)}}}}za&&c.sort(e);return c}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,e,g){g&&b.update(undefined,!1,e);g=b.sounds;var m,q=g.length;for(m=0;m<q;m++){b=g[m];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(e.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var e,g,m,q={};for(e=0;e<b.length;e++){m=this.clone(b[e]);for(g in m)q[g]=m[g]}return q},clone:function(b){var e,g,m,q={};for(e in b){q[e]={};for(g in b[e]){m=b[e][g];q[e][g]=m instanceof THREE.Color||m instanceof THREE.Vector3||m instanceof THREE.Texture?m.clone():m}}return q}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
anaglyph:{vertexShader:"uniform\tmat4\tprojectionMatrix;\nattribute\tvec3\tposition;\nattribute\tvec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform\tsampler2D\ttexture1;\nuniform\tsampler2D\ttexture2;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color1 = texture2D(texture1, vUV);\nvec4 color2 = texture2D(texture2, vUV);\nvec4 actual1 = vec4(0.7 * color1.g + 0.3 * color1.b, 0, 0, 1.0);\nvec4 actual2 = vec4(0, color2.g, color2.b, 1.0);\ngl_FragColor = actual1 + actual2;\n//gl_FragColor = vec4((color1.x + color2.x)/2.0, 0.0, (color1.z + color2.z)/2.0, 1.0);\n//gl_FragColor = vec4((color1.x + color2.x)/2.0, (color1.y + color2.y)/2.0, 0.0, 1.0);\n//gl_FragColor = mix(color1, color2);\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.AnaglyphWebGLRenderer=function(b){function e(f,n,j){var k,r,i,t=f.vertices,s=t.length,w=f.colors,x=w.length,y=f.__vertexArray,F=f.__colorArray,D=f.__sortArray,T=f.__dirtyVertices,U=f.__dirtyColors;if(j.sortParticles){$a.multiplySelf(j.matrixWorld);for(k=0;k<s;k++){r=t[k].position;jb.copy(r);$a.multiplyVector3(jb);D[k]=[jb.z,k]}D.sort(function(V,N){return N[0]-V[0]});for(k=0;k<s;k++){r=t[D[k][1]].position;i=k*3;y[i]=r.x;y[i+1]=r.y;y[i+2]=r.z}for(k=0;k<x;k++){i=k*3;color=w[D[k][1]];F[i]=color.r;
F[i+1]=color.g;F[i+2]=color.b}}else{if(T)for(k=0;k<s;k++){r=t[k].position;i=k*3;y[i]=r.x;y[i+1]=r.y;y[i+2]=r.z}if(U)for(k=0;k<x;k++){color=w[k];i=k*3;F[i]=color.r;F[i+1]=color.g;F[i+2]=color.b}}if(T||j.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,f.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,y,n)}if(U||j.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,f.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,F,n)}}function g(f,n,j,k,r){k.program||za.initMaterial(k,n,j,r);var i=k.program,t=i.uniforms,s=k.uniforms;
if(i!=Ga){c.useProgram(i);Ga=i}c.uniformMatrix4fv(t.projectionMatrix,!1,eb);if(j&&(k instanceof THREE.MeshBasicMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial||k instanceof THREE.LineBasicMaterial||k instanceof THREE.ParticleBasicMaterial||k.fog)){s.fogColor.value=j.color;if(j instanceof THREE.Fog){s.fogNear.value=j.near;s.fogFar.value=j.far}else if(j instanceof THREE.FogExp2)s.fogDensity.value=j.density}if(k instanceof THREE.MeshPhongMaterial||k instanceof THREE.MeshLambertMaterial||
k.lights){var w,x,y=0,F=0,D=0,T,U,V,N,Y=db,la=Y.directional.colors,E=Y.directional.positions,K=Y.point.colors,p=Y.point.positions,ca=Y.point.distances,Aa=0,C=0;j=x=N=0;for(w=n.length;j<w;j++){x=n[j];T=x.color;U=x.position;V=x.intensity;N=x.distance;if(x instanceof THREE.AmbientLight){y+=T.r;F+=T.g;D+=T.b}else if(x instanceof THREE.DirectionalLight){N=Aa*3;la[N]=T.r*V;la[N+1]=T.g*V;la[N+2]=T.b*V;E[N]=U.x;E[N+1]=U.y;E[N+2]=U.z;Aa+=1}else if(x instanceof THREE.PointLight){x=C*3;K[x]=T.r*V;K[x+1]=T.g*
V;K[x+2]=T.b*V;p[x]=U.x;p[x+1]=U.y;p[x+2]=U.z;ca[C]=N;C+=1}}for(j=Aa*3;j<la.length;j++)la[j]=0;for(j=C*3;j<K.length;j++)K[j]=0;Y.point.length=C;Y.directional.length=Aa;Y.ambient[0]=y;Y.ambient[1]=F;Y.ambient[2]=D;j=db;s.enableLighting.value=j.directional.length+j.point.length;s.ambientLightColor.value=j.ambient;s.directionalLightColor.value=j.directional.colors;s.directionalLightDirection.value=j.directional.positions;s.pointLightColor.value=j.point.colors;s.pointLightPosition.value=j.point.positions;
s.pointLightDistance.value=j.point.distances}if(k instanceof THREE.MeshBasicMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial){s.diffuse.value=k.color;s.opacity.value=k.opacity;s.map.texture=k.map;s.lightMap.texture=k.lightMap;s.envMap.texture=k.envMap;s.reflectivity.value=k.reflectivity;s.refractionRatio.value=k.refractionRatio;s.combine.value=k.combine;s.useRefract.value=k.envMap&&k.envMap.mapping instanceof THREE.CubeRefractionMapping}if(k instanceof THREE.LineBasicMaterial){s.diffuse.value=
k.color;s.opacity.value=k.opacity}else if(k instanceof THREE.ParticleBasicMaterial){s.psColor.value=k.color;s.opacity.value=k.opacity;s.size.value=k.size;s.scale.value=fb.height/2;s.map.texture=k.map}else if(k instanceof THREE.MeshPhongMaterial){s.ambient.value=k.ambient;s.specular.value=k.specular;s.shininess.value=k.shininess}else if(k instanceof THREE.MeshDepthMaterial){s.mNear.value=f.near;s.mFar.value=f.far;s.opacity.value=k.opacity}else if(k instanceof THREE.MeshNormalMaterial)s.opacity.value=
k.opacity;for(var O in s)if(F=i.uniforms[O]){w=s[O];y=w.type;j=w.value;if(y=="i")c.uniform1i(F,j);else if(y=="f")c.uniform1f(F,j);else if(y=="fv1")c.uniform1fv(F,j);else if(y=="fv")c.uniform3fv(F,j);else if(y=="v2")c.uniform2f(F,j.x,j.y);else if(y=="v3")c.uniform3f(F,j.x,j.y,j.z);else if(y=="v4")c.uniform4f(F,j.x,j.y,j.z,j.w);else if(y=="c")c.uniform3f(F,j.r,j.g,j.b);else if(y=="t"){c.uniform1i(F,j);if(w=w.texture)if(w.image instanceof Array&&w.image.length==6){if(w.image.length==6){if(w.needsUpdate){if(w.__webglInit){c.bindTexture(c.TEXTURE_CUBE_MAP,
w.image.__webglTextureCube);for(y=0;y<6;++y)c.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,0,0,c.RGBA,c.UNSIGNED_BYTE,w.image[y])}else{w.image.__webglTextureCube=c.createTexture();c.bindTexture(c.TEXTURE_CUBE_MAP,w.image.__webglTextureCube);for(y=0;y<6;++y)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,w.image[y]);w.__webglInit=!0}Z(c.TEXTURE_CUBE_MAP,w,w.image[0]);c.bindTexture(c.TEXTURE_CUBE_MAP,null);w.needsUpdate=!1}c.activeTexture(c.TEXTURE0+j);c.bindTexture(c.TEXTURE_CUBE_MAP,
w.image.__webglTextureCube)}}else Za(w,j)}}c.uniformMatrix4fv(t.modelViewMatrix,!1,r._modelViewMatrixArray);c.uniformMatrix3fv(t.normalMatrix,!1,r._normalMatrixArray);(k instanceof THREE.MeshShaderMaterial||k instanceof THREE.MeshPhongMaterial||k.envMap)&&t.cameraPosition!==null&&c.uniform3f(t.cameraPosition,f.position.x,f.position.y,f.position.z);(k instanceof THREE.MeshShaderMaterial||k.envMap||k.skinning)&&t.objectMatrix!==null&&c.uniformMatrix4fv(t.objectMatrix,!1,r._objectMatrixArray);(k instanceof
THREE.MeshPhongMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshShaderMaterial||k.skinning)&&t.viewMatrix!==null&&c.uniformMatrix4fv(t.viewMatrix,!1,ib);if(k instanceof THREE.ShadowVolumeDynamicMaterial){f=s.directionalLightDirection.value;f[0]=-n[1].position.x;f[1]=-n[1].position.y;f[2]=-n[1].position.z;c.uniform3fv(t.directionalLightDirection,f);c.uniformMatrix4fv(t.objectMatrix,!1,r._objectMatrixArray);c.uniformMatrix4fv(t.viewMatrix,!1,ib)}if(k.skinning){c.uniformMatrix4fv(t.cameraInverseMatrix,
!1,ib);c.uniformMatrix4fv(t.boneGlobalMatrices,!1,r.boneMatrices)}return i}function m(f,n,j,k,r,i){if(k.opacity!=0){var t;f=g(f,n,j,k,i).attributes;if(!k.morphTargets&&f.position>=0){c.bindBuffer(c.ARRAY_BUFFER,r.__webglVertexBuffer);c.vertexAttribPointer(f.position,3,c.FLOAT,!1,0,0)}else{n=k.program.attributes;if(i.morphTargetBase!==-1){c.bindBuffer(c.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[i.morphTargetBase]);c.vertexAttribPointer(n.position,3,c.FLOAT,!1,0,0)}else if(n.position>=0){c.bindBuffer(c.ARRAY_BUFFER,
r.__webglVertexBuffer);c.vertexAttribPointer(n.position,3,c.FLOAT,!1,0,0)}if(i.morphTargetForcedOrder.length){j=0;for(var s=i.morphTargetForcedOrder,w=i.morphTargetInfluences;j<k.numSupportedMorphTargets&&j<s.length;){c.bindBuffer(c.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[s[j]]);c.vertexAttribPointer(n["morphTarget"+j],3,c.FLOAT,!1,0,0);i.__webglMorphTargetInfluences[j]=w[s[j]];j++}}else{s=[];var x=-1,y=0;w=i.morphTargetInfluences;var F,D=w.length;j=0;for(i.morphTargetBase!==-1&&(s[i.morphTargetBase]=
!0);j<k.numSupportedMorphTargets;){for(F=0;F<D;F++)if(!s[F]&&w[F]>x){y=F;x=w[y]}c.bindBuffer(c.ARRAY_BUFFER,r.__webglMorphTargetsBuffers[y]);c.vertexAttribPointer(n["morphTarget"+j],3,c.FLOAT,!1,0,0);i.__webglMorphTargetInfluences[j]=x;s[y]=1;x=-1;j++}}k.program.uniforms.morphTargetInfluences!==null&&c.uniform1fv(k.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}if(k.attributes)for(t in k.attributes)if(f[t]!==undefined&&f[t]>=0){n=k.attributes[t];if(n.buffer){c.bindBuffer(c.ARRAY_BUFFER,
n.buffer);c.vertexAttribPointer(f[t],n.size,c.FLOAT,!1,0,0)}}if(f.color>=0){c.bindBuffer(c.ARRAY_BUFFER,r.__webglColorBuffer);c.vertexAttribPointer(f.color,3,c.FLOAT,!1,0,0)}if(f.normal>=0){c.bindBuffer(c.ARRAY_BUFFER,r.__webglNormalBuffer);c.vertexAttribPointer(f.normal,3,c.FLOAT,!1,0,0)}if(f.tangent>=0){c.bindBuffer(c.ARRAY_BUFFER,r.__webglTangentBuffer);c.vertexAttribPointer(f.tangent,4,c.FLOAT,!1,0,0)}if(f.uv>=0)if(r.__webglUVBuffer){c.bindBuffer(c.ARRAY_BUFFER,r.__webglUVBuffer);c.vertexAttribPointer(f.uv,
2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(f.uv)}else c.disableVertexAttribArray(f.uv);if(f.uv2>=0)if(r.__webglUV2Buffer){c.bindBuffer(c.ARRAY_BUFFER,r.__webglUV2Buffer);c.vertexAttribPointer(f.uv2,2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(f.uv2)}else c.disableVertexAttribArray(f.uv2);if(k.skinning&&f.skinVertexA>=0&&f.skinVertexB>=0&&f.skinIndex>=0&&f.skinWeight>=0){c.bindBuffer(c.ARRAY_BUFFER,r.__webglSkinVertexABuffer);c.vertexAttribPointer(f.skinVertexA,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,
r.__webglSkinVertexBBuffer);c.vertexAttribPointer(f.skinVertexB,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,r.__webglSkinIndicesBuffer);c.vertexAttribPointer(f.skinIndex,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,r.__webglSkinWeightsBuffer);c.vertexAttribPointer(f.skinWeight,4,c.FLOAT,!1,0,0)}if(i instanceof THREE.Mesh){if(k.wireframe){c.lineWidth(k.wireframeLinewidth);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer);c.drawElements(c.LINES,r.__webglLineCount,c.UNSIGNED_SHORT,0)}else{c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
r.__webglFaceBuffer);c.drawElements(c.TRIANGLES,r.__webglFaceCount,c.UNSIGNED_SHORT,0)}za.data.vertices+=r.__webglFaceCount;za.data.faces+=r.__webglFaceCount/3;za.data.drawCalls++}else if(i instanceof THREE.Line){i=i.type==THREE.LineStrip?c.LINE_STRIP:c.LINES;c.lineWidth(k.linewidth);c.drawArrays(i,0,r.__webglLineCount);za.data.drawCalls++}else if(i instanceof THREE.ParticleSystem){c.drawArrays(c.POINTS,0,r.__webglParticleCount);za.data.drawCalls++}else if(i instanceof THREE.Ribbon){c.drawArrays(c.TRIANGLE_STRIP,
0,r.__webglVertexCount);za.data.drawCalls++}}}function q(f,n,j){if(!f.__webglVertexBuffer)f.__webglVertexBuffer=c.createBuffer();if(!f.__webglNormalBuffer)f.__webglNormalBuffer=c.createBuffer();if(f.hasPos){c.bindBuffer(c.ARRAY_BUFFER,f.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,f.positionArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(n.attributes.position);c.vertexAttribPointer(n.attributes.position,3,c.FLOAT,!1,0,0)}if(f.hasNormal){c.bindBuffer(c.ARRAY_BUFFER,f.__webglNormalBuffer);if(j==
THREE.FlatShading){var k,r,i,t,s,w,x,y,F,D,T=f.count*3;for(D=0;D<T;D+=9){j=f.normalArray;k=j[D];r=j[D+1];i=j[D+2];t=j[D+3];w=j[D+4];y=j[D+5];s=j[D+6];x=j[D+7];F=j[D+8];k=(k+t+s)/3;r=(r+w+x)/3;i=(i+y+F)/3;j[D]=k;j[D+1]=r;j[D+2]=i;j[D+3]=k;j[D+4]=r;j[D+5]=i;j[D+6]=k;j[D+7]=r;j[D+8]=i}}c.bufferData(c.ARRAY_BUFFER,f.normalArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(n.attributes.normal);c.vertexAttribPointer(n.attributes.normal,3,c.FLOAT,!1,0,0)}c.drawArrays(c.TRIANGLES,0,f.count);f.count=0}function B(f){if(Pa!=
f.doubleSided){f.doubleSided?c.disable(c.CULL_FACE):c.enable(c.CULL_FACE);Pa=f.doubleSided}if(Ka!=f.flipSided){f.flipSided?c.frontFace(c.CW):c.frontFace(c.CCW);Ka=f.flipSided}}function z(f){if(xa!=f){f?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST);xa=f}}function G(f){va[0].set(f.n41-f.n11,f.n42-f.n12,f.n43-f.n13,f.n44-f.n14);va[1].set(f.n41+f.n11,f.n42+f.n12,f.n43+f.n13,f.n44+f.n14);va[2].set(f.n41+f.n21,f.n42+f.n22,f.n43+f.n23,f.n44+f.n24);va[3].set(f.n41-f.n21,f.n42-f.n22,f.n43-f.n23,f.n44-f.n24);
va[4].set(f.n41-f.n31,f.n42-f.n32,f.n43-f.n33,f.n44-f.n34);va[5].set(f.n41+f.n31,f.n42+f.n32,f.n43+f.n33,f.n44+f.n34);var n;for(f=0;f<6;f++){n=va[f];n.divideScalar(Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z))}}function H(f){for(var n=f.matrixWorld,j=-f.geometry.boundingSphere.radius*Math.max(f.scale.x,Math.max(f.scale.y,f.scale.z)),k=0;k<6;k++){f=va[k].x*n.n14+va[k].y*n.n24+va[k].z*n.n34+va[k].w;if(f<=j)return!1}return!0}function J(f,n){f.list[f.count]=n;f.count+=1}function Q(f){var n,j,k=f.object,r=f.opaque,
i=f.transparent;i.count=0;f=r.count=0;for(n=k.materials.length;f<n;f++){j=k.materials[f];j.transparent?J(i,j):J(r,j)}}function S(f){var n,j,k,r,i=f.object,t=f.buffer,s=f.opaque,w=f.transparent;w.count=0;f=s.count=0;for(k=i.materials.length;f<k;f++){n=i.materials[f];if(n instanceof THREE.MeshFaceMaterial){n=0;for(j=t.materials.length;n<j;n++)(r=t.materials[n])&&(r.transparent?J(w,r):J(s,r))}else(r=n)&&(r.transparent?J(w,r):J(s,r))}}function W(f,n){return n.z-f.z}function P(f){c.enable(c.POLYGON_OFFSET_FILL);
c.polygonOffset(0.1,1);c.enable(c.STENCIL_TEST);c.enable(c.DEPTH_TEST);c.depthMask(!1);c.colorMask(!1,!1,!1,!1);c.stencilFunc(c.ALWAYS,1,255);c.stencilOpSeparate(c.BACK,c.KEEP,c.INCR,c.KEEP);c.stencilOpSeparate(c.FRONT,c.KEEP,c.DECR,c.KEEP);var n,j=f.lights.length,k,r=f.lights,i=[],t,s,w,x,y,F=f.__webglShadowVolumes.length;for(n=0;n<j;n++){k=f.lights[n];if(k instanceof THREE.DirectionalLight&&k.castShadow){i[0]=-k.position.x;i[1]=-k.position.y;i[2]=-k.position.z;for(y=0;y<F;y++){k=f.__webglShadowVolumes[y].object;
t=f.__webglShadowVolumes[y].buffer;s=k.materials[0];s.program||za.initMaterial(s,r,undefined,k);s=s.program;w=s.uniforms;x=s.attributes;if(Ga!==s){c.useProgram(s);Ga=s;c.uniformMatrix4fv(w.projectionMatrix,!1,eb);c.uniformMatrix4fv(w.viewMatrix,!1,ib);c.uniform3fv(w.directionalLightDirection,i)}k.matrixWorld.flattenToArray(k._objectMatrixArray);c.uniformMatrix4fv(w.objectMatrix,!1,k._objectMatrixArray);c.bindBuffer(c.ARRAY_BUFFER,t.__webglVertexBuffer);c.vertexAttribPointer(x.position,3,c.FLOAT,!1,
0,0);c.bindBuffer(c.ARRAY_BUFFER,t.__webglNormalBuffer);c.vertexAttribPointer(x.normal,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer);c.cullFace(c.FRONT);c.drawElements(c.TRIANGLES,t.__webglFaceCount,c.UNSIGNED_SHORT,0);c.cullFace(c.BACK);c.drawElements(c.TRIANGLES,t.__webglFaceCount,c.UNSIGNED_SHORT,0)}}}c.disable(c.POLYGON_OFFSET_FILL);c.colorMask(!0,!0,!0,!0);c.stencilFunc(c.NOTEQUAL,0,255);c.stencilOp(c.KEEP,c.KEEP,c.KEEP);c.disable(c.DEPTH_TEST);La=-1;Ga=ka.program;
c.useProgram(ka.program);c.uniformMatrix4fv(ka.projectionLocation,!1,eb);c.uniform1f(ka.darknessLocation,ka.darkness);c.bindBuffer(c.ARRAY_BUFFER,ka.vertexBuffer);c.vertexAttribPointer(ka.vertexLocation,3,c.FLOAT,!1,0,0);c.enableVertexAttribArray(ka.vertexLocation);c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.blendEquation(c.FUNC_ADD);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,ka.elementBuffer);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);c.disable(c.STENCIL_TEST);c.enable(c.DEPTH_TEST);c.depthMask(wa)}
function R(f,n){var j,k,r;j=_sprite.attributes;var i=_sprite.uniforms,t=Ia/Ha,s,w=[],x=Ha*0.5,y=Ia*0.5,F=!0;c.useProgram(_sprite.program);Ga=_sprite.program;La=-1;if(!A){c.enableVertexAttribArray(_sprite.attributes.position);c.enableVertexAttribArray(_sprite.attributes.uv);A=!0}c.disable(c.CULL_FACE);c.enable(c.BLEND);c.depthMask(!0);c.bindBuffer(c.ARRAY_BUFFER,_sprite.vertexBuffer);c.vertexAttribPointer(j.position,2,c.FLOAT,!1,16,0);c.vertexAttribPointer(j.uv,2,c.FLOAT,!1,16,8);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);c.uniformMatrix4fv(i.projectionMatrix,!1,eb);c.activeTexture(c.TEXTURE0);c.uniform1i(i.map,0);j=0;for(k=f.__webglSprites.length;j<k;j++){r=f.__webglSprites[j];if(r.useScreenCoordinates)r.z=-r.position.z;else{r._modelViewMatrix.multiplyToArray(n.matrixWorldInverse,r.matrixWorld,r._modelViewMatrixArray);r.z=-r._modelViewMatrix.n34}}f.__webglSprites.sort(W);j=0;for(k=f.__webglSprites.length;j<k;j++){r=f.__webglSprites[j];if(r.material===undefined&&r.map&&r.map.image&&r.map.image.width){if(r.useScreenCoordinates){c.uniform1i(i.useScreenCoordinates,
1);c.uniform3f(i.screenPosition,(r.position.x-x)/x,(y-r.position.y)/y,Math.max(0,Math.min(1,r.position.z)))}else{c.uniform1i(i.useScreenCoordinates,0);c.uniform1i(i.affectedByDistance,r.affectedByDistance?1:0);c.uniformMatrix4fv(i.modelViewMatrix,!1,r._modelViewMatrixArray)}s=r.map.image.width/(r.affectedByDistance?1:Ia);w[0]=s*t*r.scale.x;w[1]=s*r.scale.y;c.uniform2f(i.uvScale,r.uvScale.x,r.uvScale.y);c.uniform2f(i.uvOffset,r.uvOffset.x,r.uvOffset.y);c.uniform2f(i.alignment,r.alignment.x,r.alignment.y);
c.uniform1f(i.opacity,r.opacity);c.uniform1f(i.rotation,r.rotation);c.uniform2fv(i.scale,w);if(r.mergeWith3D&&!F){c.enable(c.DEPTH_TEST);F=!0}else if(!r.mergeWith3D&&F){c.disable(c.DEPTH_TEST);F=!1}ma(r.blending);Za(r.map,0);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(wa)}function aa(f,n,j){c.useProgram(h.program);Ga=h.program;La=-1;if(!I){c.enableVertexAttribArray(h.vertexLocation);c.enableVertexAttribArray(h.uv);I=!0}c.uniformMatrix4fv(h.projectionLocation,
!1,eb);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,n.__webglTexture);c.uniform1i(h.texture1,0);c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,j.__webglTexture);c.uniform1i(h.texture2,1);c.bindBuffer(c.ARRAY_BUFFER,h.vertexBuffer);c.vertexAttribPointer(h.vertexLocation,3,c.FLOAT,!1,20,0);c.vertexAttribPointer(h.uv,2,c.FLOAT,!1,20,12);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.elementBuffer);c.disable(c.CULL_FACE);c.colorMask(!0,!0,!0,!0);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,
0);c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(wa)}function da(f,n){var j,k,r=f.__webglLensFlares.length,i,t,s,w=new THREE.Vector3,x=Ia/Ha,y=Ha*0.5,F=Ia*0.5,D=16/Ia,T=[D*x,D],U=[1,1,0],V=[1,1],N=o.uniforms;j=o.attributes;c.useProgram(o.program);Ga=o.program;La=-1;if(!v){c.enableVertexAttribArray(o.attributes.vertex);c.enableVertexAttribArray(o.attributes.uv);v=!0}c.uniform1i(N.occlusionMap,0);c.uniform1i(N.map,1);c.bindBuffer(c.ARRAY_BUFFER,o.vertexBuffer);c.vertexAttribPointer(j.vertex,
2,c.FLOAT,!1,16,0);c.vertexAttribPointer(j.uv,2,c.FLOAT,!1,16,8);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o.elementBuffer);c.disable(c.CULL_FACE);c.depthMask(!1);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,o.occlusionTexture);c.activeTexture(c.TEXTURE1);for(k=0;k<r;k++){j=f.__webglLensFlares[k].object;w.set(j.matrixWorld.n14,j.matrixWorld.n24,j.matrixWorld.n34);n.matrixWorldInverse.multiplyVector3(w);n.projectionMatrix.multiplyVector3(w);U[0]=w.x;U[1]=w.y;U[2]=w.z;V[0]=U[0]*y+y;V[1]=U[1]*F+
F;if(o.hasVertexTexture||V[0]>0&&V[0]<Ha&&V[1]>0&&V[1]<Ia){c.bindTexture(c.TEXTURE_2D,o.tempTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,V[0]-8,V[1]-8,16,16,0);c.uniform1i(N.renderType,0);c.uniform2fv(N.scale,T);c.uniform3fv(N.screenPosition,U);c.disable(c.BLEND);c.enable(c.DEPTH_TEST);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);c.bindTexture(c.TEXTURE_2D,o.occlusionTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,V[0]-8,V[1]-8,16,16,0);c.uniform1i(N.renderType,1);c.disable(c.DEPTH_TEST);c.bindTexture(c.TEXTURE_2D,
o.tempTexture);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);j.positionScreen.x=U[0];j.positionScreen.y=U[1];j.positionScreen.z=U[2];j.customUpdateCallback?j.customUpdateCallback(j):j.updateLensFlares();c.uniform1i(N.renderType,2);c.enable(c.BLEND);i=0;for(t=j.lensFlares.length;i<t;i++){s=j.lensFlares[i];if(s.opacity>0.0010&&s.scale>0.0010){U[0]=s.x;U[1]=s.y;U[2]=s.z;D=s.size*s.scale/Ia;T[0]=D*x;T[1]=D;c.uniform3fv(N.screenPosition,U);c.uniform2fv(N.scale,T);c.uniform1f(N.rotation,s.rotation);
c.uniform1f(N.opacity,s.opacity);ma(s.blending);Za(s.texture,1);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}}}c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(wa)}function X(f,n){f._modelViewMatrix.multiplyToArray(n.matrixWorldInverse,f.matrixWorld,f._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(f._modelViewMatrix).transposeIntoArray(f._normalMatrixArray)}function Ba(f){var n,j,k,r,i;if(f instanceof THREE.Mesh){j=f.geometry;for(n in j.geometryGroups){k=j.geometryGroups[n];i=!1;
for(r in k.__webglCustomAttributes)if(k.__webglCustomAttributes[r].needsUpdate){i=!0;break}if(j.__dirtyVertices||j.__dirtyMorphTargets||j.__dirtyElements||j.__dirtyUvs||j.__dirtyNormals||j.__dirtyColors||j.__dirtyTangents||i){i=f;var t=c.DYNAMIC_DRAW;if(k.__inittedArrays){var s=void 0,w=void 0,x=void 0,y=void 0;x=void 0;var F=void 0,D=void 0,T=void 0,U=void 0,V=void 0,N=void 0,Y=void 0,la=void 0,E=void 0,K=void 0,p=void 0,ca=void 0,Aa=void 0;D=void 0;T=void 0;y=void 0;U=void 0;y=void 0;var C=void 0,
O=void 0;D=void 0;C=void 0;O=void 0;var u=void 0,Va=void 0;C=void 0;O=void 0;u=void 0;Va=void 0;C=void 0;O=void 0;u=void 0;Va=void 0;C=void 0;O=void 0;u=void 0;y=void 0;U=void 0;F=void 0;x=void 0;x=void 0;C=void 0;O=void 0;u=void 0;var Ra=void 0,ua=0,ga=0,Wa=0,Na=0,L=0,ya=0,ha=0,ab=0,Qa=0,M=0,ia=0;O=C=0;var oa=k.__vertexArray,Da=k.__uvArray,Ea=k.__uv2Array,sa=k.__normalArray,ea=k.__tangentArray,Ta=k.__colorArray,ta=k.__skinVertexAArray,na=k.__skinVertexBArray,pa=k.__skinIndexArray,Oa=k.__skinWeightArray,
Xa=k.__morphTargetsArrays,gb=k.__webglCustomAttributes;u=void 0;var cb=k.__faceArray,bb=k.__lineArray,Ab=k.__needsSmoothNormals;N=k.__vertexColorType;V=k.__uvType;Y=k.__normalType;var Ya=i.geometry,ub=Ya.__dirtyVertices,vb=Ya.__dirtyElements,lb=Ya.__dirtyUvs,Bb=Ya.__dirtyNormals,Fb=Ya.__dirtyTangents,Cb=Ya.__dirtyColors,Db=Ya.__dirtyMorphTargets,kb=Ya.vertices,qb=k.faces,rb=Ya.faces,ob=Ya.faceVertexUvs[0],pb=Ya.faceVertexUvs[1],wb=Ya.skinVerticesA,xb=Ya.skinVerticesB,yb=Ya.skinIndices,sb=Ya.skinWeights,
tb=i instanceof THREE.ShadowVolume?Ya.edgeFaces:undefined;morphTargets=Ya.morphTargets;if(gb)for(Ra in gb){gb[Ra].offset=0;gb[Ra].offsetSrc=0}s=0;for(w=qb.length;s<w;s++){x=qb[s];y=rb[x];ob&&(la=ob[x]);pb&&(E=pb[x]);x=y.vertexNormals;F=y.normal;D=y.vertexColors;T=y.color;U=y.vertexTangents;if(y instanceof THREE.Face3){if(ub){K=kb[y.a].position;p=kb[y.b].position;ca=kb[y.c].position;oa[ga]=K.x;oa[ga+1]=K.y;oa[ga+2]=K.z;oa[ga+3]=p.x;oa[ga+4]=p.y;oa[ga+5]=p.z;oa[ga+6]=ca.x;oa[ga+7]=ca.y;oa[ga+8]=ca.z;
ga+=9}if(gb)for(Ra in gb){u=gb[Ra];if(u.needsUpdate){C=u.offset;O=u.offsetSrc;if(u.size===1){if(u.boundTo===undefined||u.boundTo==="vertices"){u.array[C+0]=u.value[y.a];u.array[C+1]=u.value[y.b];u.array[C+2]=u.value[y.c]}else if(u.boundTo==="faces"){u.array[C+0]=u.value[O];u.array[C+1]=u.value[O];u.array[C+2]=u.value[O];u.offsetSrc++}else if(u.boundTo==="faceVertices"){u.array[C+0]=u.value[O+0];u.array[C+1]=u.value[O+1];u.array[C+2]=u.value[O+2];u.offsetSrc+=3}u.offset+=3}else{if(u.boundTo===undefined||
u.boundTo==="vertices"){K=u.value[y.a];p=u.value[y.b];ca=u.value[y.c]}else if(u.boundTo==="faces"){K=u.value[O];p=u.value[O];ca=u.value[O];u.offsetSrc++}else if(u.boundTo==="faceVertices"){K=u.value[O+0];p=u.value[O+1];ca=u.value[O+2];u.offsetSrc+=3}if(u.size===2){u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+2]=p.x;u.array[C+3]=p.y;u.array[C+4]=ca.x;u.array[C+5]=ca.y;u.offset+=6}else if(u.size===3){if(u.type==="c"){u.array[C+0]=K.r;u.array[C+1]=K.g;u.array[C+2]=K.b;u.array[C+3]=p.r;u.array[C+4]=p.g;
u.array[C+5]=p.b;u.array[C+6]=ca.r;u.array[C+7]=ca.g;u.array[C+8]=ca.b}else{u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+2]=K.z;u.array[C+3]=p.x;u.array[C+4]=p.y;u.array[C+5]=p.z;u.array[C+6]=ca.x;u.array[C+7]=ca.y;u.array[C+8]=ca.z}u.offset+=9}else{u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+2]=K.z;u.array[C+3]=K.w;u.array[C+4]=p.x;u.array[C+5]=p.y;u.array[C+6]=p.z;u.array[C+7]=p.w;u.array[C+8]=ca.x;u.array[C+9]=ca.y;u.array[C+10]=ca.z;u.array[C+11]=ca.w;u.offset+=12}}}}if(Db){C=0;for(O=morphTargets.length;C<
O;C++){K=morphTargets[C].vertices[y.a].position;p=morphTargets[C].vertices[y.b].position;ca=morphTargets[C].vertices[y.c].position;u=Xa[C];u[ia+0]=K.x;u[ia+1]=K.y;u[ia+2]=K.z;u[ia+3]=p.x;u[ia+4]=p.y;u[ia+5]=p.z;u[ia+6]=ca.x;u[ia+7]=ca.y;u[ia+8]=ca.z}ia+=9}if(sb.length){C=sb[y.a];O=sb[y.b];u=sb[y.c];Oa[M]=C.x;Oa[M+1]=C.y;Oa[M+2]=C.z;Oa[M+3]=C.w;Oa[M+4]=O.x;Oa[M+5]=O.y;Oa[M+6]=O.z;Oa[M+7]=O.w;Oa[M+8]=u.x;Oa[M+9]=u.y;Oa[M+10]=u.z;Oa[M+11]=u.w;C=yb[y.a];O=yb[y.b];u=yb[y.c];pa[M]=C.x;pa[M+1]=C.y;pa[M+
2]=C.z;pa[M+3]=C.w;pa[M+4]=O.x;pa[M+5]=O.y;pa[M+6]=O.z;pa[M+7]=O.w;pa[M+8]=u.x;pa[M+9]=u.y;pa[M+10]=u.z;pa[M+11]=u.w;C=wb[y.a];O=wb[y.b];u=wb[y.c];ta[M]=C.x;ta[M+1]=C.y;ta[M+2]=C.z;ta[M+3]=1;ta[M+4]=O.x;ta[M+5]=O.y;ta[M+6]=O.z;ta[M+7]=1;ta[M+8]=u.x;ta[M+9]=u.y;ta[M+10]=u.z;ta[M+11]=1;C=xb[y.a];O=xb[y.b];u=xb[y.c];na[M]=C.x;na[M+1]=C.y;na[M+2]=C.z;na[M+3]=1;na[M+4]=O.x;na[M+5]=O.y;na[M+6]=O.z;na[M+7]=1;na[M+8]=u.x;na[M+9]=u.y;na[M+10]=u.z;na[M+11]=1;M+=12}if(Cb&&N){if(D.length==3&&N==THREE.VertexColors){y=
D[0];C=D[1];O=D[2]}else O=C=y=T;Ta[Qa]=y.r;Ta[Qa+1]=y.g;Ta[Qa+2]=y.b;Ta[Qa+3]=C.r;Ta[Qa+4]=C.g;Ta[Qa+5]=C.b;Ta[Qa+6]=O.r;Ta[Qa+7]=O.g;Ta[Qa+8]=O.b;Qa+=9}if(Fb&&Ya.hasTangents){D=U[0];T=U[1];y=U[2];ea[ha]=D.x;ea[ha+1]=D.y;ea[ha+2]=D.z;ea[ha+3]=D.w;ea[ha+4]=T.x;ea[ha+5]=T.y;ea[ha+6]=T.z;ea[ha+7]=T.w;ea[ha+8]=y.x;ea[ha+9]=y.y;ea[ha+10]=y.z;ea[ha+11]=y.w;ha+=12}if(Bb&&Y)if(x.length==3&&Ab)for(U=0;U<3;U++){F=x[U];sa[ya]=F.x;sa[ya+1]=F.y;sa[ya+2]=F.z;ya+=3}else for(U=0;U<3;U++){sa[ya]=F.x;sa[ya+1]=F.y;
sa[ya+2]=F.z;ya+=3}if(lb&&la!==undefined&&V)for(U=0;U<3;U++){x=la[U];Da[Wa]=x.u;Da[Wa+1]=x.v;Wa+=2}if(lb&&E!==undefined&&V)for(U=0;U<3;U++){x=E[U];Ea[Na]=x.u;Ea[Na+1]=x.v;Na+=2}if(vb){cb[L]=ua;cb[L+1]=ua+1;cb[L+2]=ua+2;L+=3;bb[ab]=ua;bb[ab+1]=ua+1;bb[ab+2]=ua;bb[ab+3]=ua+2;bb[ab+4]=ua+1;bb[ab+5]=ua+2;ab+=6;ua+=3}}else if(y instanceof THREE.Face4){if(ub){K=kb[y.a].position;p=kb[y.b].position;ca=kb[y.c].position;Aa=kb[y.d].position;oa[ga]=K.x;oa[ga+1]=K.y;oa[ga+2]=K.z;oa[ga+3]=p.x;oa[ga+4]=p.y;oa[ga+
5]=p.z;oa[ga+6]=ca.x;oa[ga+7]=ca.y;oa[ga+8]=ca.z;oa[ga+9]=Aa.x;oa[ga+10]=Aa.y;oa[ga+11]=Aa.z;ga+=12}if(gb)for(Ra in gb){u=gb[Ra];if(u.needsUpdate){C=u.offset;O=u.offsetSrc;if(u.size===1){if(u.boundTo===undefined||u.boundTo==="vertices"){u.array[C+0]=u.value[y.a];u.array[C+1]=u.value[y.b];u.array[C+2]=u.value[y.c];u.array[C+3]=u.value[y.d]}else if(u.boundTo==="faces"){u.array[C+0]=u.value[O];u.array[C+1]=u.value[O];u.array[C+2]=u.value[O];u.array[C+3]=u.value[O];u.offsetSrc++}else if(u.boundTo==="faceVertices"){u.array[C+
0]=u.value[O+0];u.array[C+1]=u.value[O+1];u.array[C+2]=u.value[O+2];u.array[C+3]=u.value[O+3];u.offsetSrc+=4}u.offset+=4}else{if(u.boundTo===undefined||u.boundTo==="vertices"){K=u.value[y.a];p=u.value[y.b];ca=u.value[y.c];Aa=u.value[y.d]}else if(u.boundTo==="faces"){K=u.value[O];p=u.value[O];ca=u.value[O];Aa=u.value[O];u.offsetSrc++}else if(u.boundTo==="faceVertices"){K=u.value[O+0];p=u.value[O+1];ca=u.value[O+2];Aa=u.value[O+3];u.offsetSrc+=4}if(u.size===2){u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+
2]=p.x;u.array[C+3]=p.y;u.array[C+4]=ca.x;u.array[C+5]=ca.y;u.array[C+6]=Aa.x;u.array[C+7]=Aa.y;u.offset+=8}else if(u.size===3){if(u.type==="c"){u.array[C+0]=K.r;u.array[C+1]=K.g;u.array[C+2]=K.b;u.array[C+3]=p.r;u.array[C+4]=p.g;u.array[C+5]=p.b;u.array[C+6]=ca.r;u.array[C+7]=ca.g;u.array[C+8]=ca.b;u.array[C+9]=Aa.r;u.array[C+10]=Aa.g;u.array[C+11]=Aa.b}else{u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+2]=K.z;u.array[C+3]=p.x;u.array[C+4]=p.y;u.array[C+5]=p.z;u.array[C+6]=ca.x;u.array[C+7]=ca.y;u.array[C+
8]=ca.z;u.array[C+9]=Aa.x;u.array[C+10]=Aa.y;u.array[C+11]=Aa.z}u.offset+=12}else{u.array[C+0]=K.x;u.array[C+1]=K.y;u.array[C+2]=K.z;u.array[C+3]=K.w;u.array[C+4]=p.x;u.array[C+5]=p.y;u.array[C+6]=p.z;u.array[C+7]=p.w;u.array[C+8]=ca.x;u.array[C+9]=ca.y;u.array[C+10]=ca.z;u.array[C+11]=ca.w;u.array[C+12]=Aa.x;u.array[C+13]=Aa.y;u.array[C+14]=Aa.z;u.array[C+15]=Aa.w;u.offset+=16}}}}if(Db){C=0;for(O=morphTargets.length;C<O;C++){K=morphTargets[C].vertices[y.a].position;p=morphTargets[C].vertices[y.b].position;
ca=morphTargets[C].vertices[y.c].position;Aa=morphTargets[C].vertices[y.d].position;u=Xa[C];u[ia+0]=K.x;u[ia+1]=K.y;u[ia+2]=K.z;u[ia+3]=p.x;u[ia+4]=p.y;u[ia+5]=p.z;u[ia+6]=ca.x;u[ia+7]=ca.y;u[ia+8]=ca.z;u[ia+9]=Aa.x;u[ia+10]=Aa.y;u[ia+11]=Aa.z}ia+=12}if(sb.length){C=sb[y.a];O=sb[y.b];u=sb[y.c];Va=sb[y.d];Oa[M]=C.x;Oa[M+1]=C.y;Oa[M+2]=C.z;Oa[M+3]=C.w;Oa[M+4]=O.x;Oa[M+5]=O.y;Oa[M+6]=O.z;Oa[M+7]=O.w;Oa[M+8]=u.x;Oa[M+9]=u.y;Oa[M+10]=u.z;Oa[M+11]=u.w;Oa[M+12]=Va.x;Oa[M+13]=Va.y;Oa[M+14]=Va.z;Oa[M+15]=
Va.w;C=yb[y.a];O=yb[y.b];u=yb[y.c];Va=yb[y.d];pa[M]=C.x;pa[M+1]=C.y;pa[M+2]=C.z;pa[M+3]=C.w;pa[M+4]=O.x;pa[M+5]=O.y;pa[M+6]=O.z;pa[M+7]=O.w;pa[M+8]=u.x;pa[M+9]=u.y;pa[M+10]=u.z;pa[M+11]=u.w;pa[M+12]=Va.x;pa[M+13]=Va.y;pa[M+14]=Va.z;pa[M+15]=Va.w;C=wb[y.a];O=wb[y.b];u=wb[y.c];Va=wb[y.d];ta[M]=C.x;ta[M+1]=C.y;ta[M+2]=C.z;ta[M+3]=1;ta[M+4]=O.x;ta[M+5]=O.y;ta[M+6]=O.z;ta[M+7]=1;ta[M+8]=u.x;ta[M+9]=u.y;ta[M+10]=u.z;ta[M+11]=1;ta[M+12]=Va.x;ta[M+13]=Va.y;ta[M+14]=Va.z;ta[M+15]=1;C=xb[y.a];O=xb[y.b];u=xb[y.c];
y=xb[y.d];na[M]=C.x;na[M+1]=C.y;na[M+2]=C.z;na[M+3]=1;na[M+4]=O.x;na[M+5]=O.y;na[M+6]=O.z;na[M+7]=1;na[M+8]=u.x;na[M+9]=u.y;na[M+10]=u.z;na[M+11]=1;na[M+12]=y.x;na[M+13]=y.y;na[M+14]=y.z;na[M+15]=1;M+=16}if(Cb&&N){if(D.length==4&&N==THREE.VertexColors){y=D[0];C=D[1];O=D[2];D=D[3]}else D=O=C=y=T;Ta[Qa]=y.r;Ta[Qa+1]=y.g;Ta[Qa+2]=y.b;Ta[Qa+3]=C.r;Ta[Qa+4]=C.g;Ta[Qa+5]=C.b;Ta[Qa+6]=O.r;Ta[Qa+7]=O.g;Ta[Qa+8]=O.b;Ta[Qa+9]=D.r;Ta[Qa+10]=D.g;Ta[Qa+11]=D.b;Qa+=12}if(Fb&&Ya.hasTangents){D=U[0];T=U[1];y=U[2];
U=U[3];ea[ha]=D.x;ea[ha+1]=D.y;ea[ha+2]=D.z;ea[ha+3]=D.w;ea[ha+4]=T.x;ea[ha+5]=T.y;ea[ha+6]=T.z;ea[ha+7]=T.w;ea[ha+8]=y.x;ea[ha+9]=y.y;ea[ha+10]=y.z;ea[ha+11]=y.w;ea[ha+12]=U.x;ea[ha+13]=U.y;ea[ha+14]=U.z;ea[ha+15]=U.w;ha+=16}if(Bb&&Y)if(x.length==4&&Ab)for(U=0;U<4;U++){F=x[U];sa[ya]=F.x;sa[ya+1]=F.y;sa[ya+2]=F.z;ya+=3}else for(U=0;U<4;U++){sa[ya]=F.x;sa[ya+1]=F.y;sa[ya+2]=F.z;ya+=3}if(lb&&la!==undefined&&V)for(U=0;U<4;U++){x=la[U];Da[Wa]=x.u;Da[Wa+1]=x.v;Wa+=2}if(lb&&E!==undefined&&V)for(U=0;U<4;U++){x=
E[U];Ea[Na]=x.u;Ea[Na+1]=x.v;Na+=2}if(vb){cb[L]=ua;cb[L+1]=ua+1;cb[L+2]=ua+3;cb[L+3]=ua+1;cb[L+4]=ua+2;cb[L+5]=ua+3;L+=6;bb[ab]=ua;bb[ab+1]=ua+1;bb[ab+2]=ua;bb[ab+3]=ua+3;bb[ab+4]=ua+1;bb[ab+5]=ua+2;bb[ab+6]=ua+2;bb[ab+7]=ua+3;ab+=8;ua+=4}}}if(tb){s=0;for(w=tb.length;s<w;s++){cb[L]=tb[s].a;cb[L+1]=tb[s].b;cb[L+2]=tb[s].c;cb[L+3]=tb[s].a;cb[L+4]=tb[s].c;cb[L+5]=tb[s].d;L+=6}}if(ub){c.bindBuffer(c.ARRAY_BUFFER,k.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,oa,t)}if(gb)for(Ra in gb){u=gb[Ra];if(u.needsUpdate){c.bindBuffer(c.ARRAY_BUFFER,
u.buffer);c.bufferData(c.ARRAY_BUFFER,u.array,t);u.needsUpdate=!1}}if(Db){C=0;for(O=morphTargets.length;C<O;C++){c.bindBuffer(c.ARRAY_BUFFER,k.__webglMorphTargetsBuffers[C]);c.bufferData(c.ARRAY_BUFFER,Xa[C],t)}}if(Cb&&Qa>0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,Ta,t)}if(Bb){c.bindBuffer(c.ARRAY_BUFFER,k.__webglNormalBuffer);c.bufferData(c.ARRAY_BUFFER,sa,t)}if(Fb&&Ya.hasTangents){c.bindBuffer(c.ARRAY_BUFFER,k.__webglTangentBuffer);c.bufferData(c.ARRAY_BUFFER,
ea,t)}if(lb&&Wa>0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglUVBuffer);c.bufferData(c.ARRAY_BUFFER,Da,t)}if(lb&&Na>0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglUV2Buffer);c.bufferData(c.ARRAY_BUFFER,Ea,t)}if(vb){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k.__webglFaceBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,cb,t);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k.__webglLineBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,bb,t)}if(M>0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinVertexABuffer);c.bufferData(c.ARRAY_BUFFER,ta,t);c.bindBuffer(c.ARRAY_BUFFER,
k.__webglSkinVertexBBuffer);c.bufferData(c.ARRAY_BUFFER,na,t);c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinIndicesBuffer);c.bufferData(c.ARRAY_BUFFER,pa,t);c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinWeightsBuffer);c.bufferData(c.ARRAY_BUFFER,Oa,t)}if(!i.dynamic){delete k.__inittedArrays;delete k.__colorArray;delete k.__normalArray;delete k.__tangentArray;delete k.__uvArray;delete k.__uv2Array;delete k.__faceArray;delete k.__vertexArray;delete k.__lineArray;delete k.__skinVertexAArray;delete k.__skinVertexBArray;
delete k.__skinIndexArray;delete k.__skinWeightArray}}}}j.__dirtyVertices=!1;j.__dirtyMorphTargets=!1;j.__dirtyElements=!1;j.__dirtyUvs=!1;j.__dirtyNormals=!1;j.__dirtyTangents=!1;j.__dirtyColors=!1}else if(f instanceof THREE.Ribbon){j=f.geometry;if(j.__dirtyVertices||j.__dirtyColors){f=j;n=c.DYNAMIC_DRAW;V=f.vertices;k=f.colors;N=V.length;i=k.length;Y=f.__vertexArray;t=f.__colorArray;la=f.__dirtyColors;if(f.__dirtyVertices){for(s=0;s<N;s++){w=V[s].position;r=s*3;Y[r]=w.x;Y[r+1]=w.y;Y[r+2]=w.z}c.bindBuffer(c.ARRAY_BUFFER,
f.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,Y,n)}if(la){for(s=0;s<i;s++){color=k[s];r=s*3;t[r]=color.r;t[r+1]=color.g;t[r+2]=color.b}c.bindBuffer(c.ARRAY_BUFFER,f.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,t,n)}}j.__dirtyVertices=!1;j.__dirtyColors=!1}else if(f instanceof THREE.Line){j=f.geometry;if(j.__dirtyVertices||j.__dirtyColors){f=j;n=c.DYNAMIC_DRAW;V=f.vertices;k=f.colors;N=V.length;i=k.length;Y=f.__vertexArray;t=f.__colorArray;la=f.__dirtyColors;if(f.__dirtyVertices){for(s=0;s<
N;s++){w=V[s].position;r=s*3;Y[r]=w.x;Y[r+1]=w.y;Y[r+2]=w.z}c.bindBuffer(c.ARRAY_BUFFER,f.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,Y,n)}if(la){for(s=0;s<i;s++){color=k[s];r=s*3;t[r]=color.r;t[r+1]=color.g;t[r+2]=color.b}c.bindBuffer(c.ARRAY_BUFFER,f.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,t,n)}}j.__dirtyVertices=!1;j.__dirtyColors=!1}else if(f instanceof THREE.ParticleSystem){j=f.geometry;(j.__dirtyVertices||j.__dirtyColors||f.sortParticles)&&e(j,c.DYNAMIC_DRAW,f);j.__dirtyVertices=
!1;j.__dirtyColors=!1}}function qa(f){function n(D){var T=[];j=0;for(k=D.length;j<k;j++)D[j]==undefined?T.push("undefined"):T.push(D[j].id);return T.join("_")}var j,k,r,i,t,s,w,x,y={},F=f.morphTargets!==undefined?f.morphTargets.length:0;f.geometryGroups={};r=0;for(i=f.faces.length;r<i;r++){t=f.faces[r];s=t.materials;w=n(s);y[w]==undefined&&(y[w]={hash:w,counter:0});x=y[w].hash+"_"+y[w].counter;f.geometryGroups[x]==undefined&&(f.geometryGroups[x]={faces:[],materials:s,vertices:0,numMorphTargets:F});
t=t instanceof THREE.Face3?3:4;if(f.geometryGroups[x].vertices+t>65535){y[w].counter+=1;x=y[w].hash+"_"+y[w].counter;f.geometryGroups[x]==undefined&&(f.geometryGroups[x]={faces:[],materials:s,vertices:0,numMorphTargets:F})}f.geometryGroups[x].faces.push(r);f.geometryGroups[x].vertices+=t}}function ra(f,n,j){f.push({buffer:n,object:j,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function ma(f){if(f!=La){switch(f){case THREE.AdditiveBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.SRC_ALPHA,
c.ONE);break;case THREE.SubtractiveBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD);c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}La=f}}function Z(f,n,j){if((j.width&j.width-1)==0&&(j.height&j.height-1)==0){c.texParameteri(f,c.TEXTURE_WRAP_S,fa(n.wrapS));c.texParameteri(f,c.TEXTURE_WRAP_T,
fa(n.wrapT));c.texParameteri(f,c.TEXTURE_MAG_FILTER,fa(n.magFilter));c.texParameteri(f,c.TEXTURE_MIN_FILTER,fa(n.minFilter));c.generateMipmap(f)}else{c.texParameteri(f,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(f,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(f,c.TEXTURE_MAG_FILTER,Ma(n.magFilter));c.texParameteri(f,c.TEXTURE_MIN_FILTER,Ma(n.minFilter))}}function Za(f,n){if(f.needsUpdate){if(f.__webglTexture)f.__webglTexture=c.deleteTexture(f.__webglTexture);f.__webglTexture=c.createTexture();
c.bindTexture(c.TEXTURE_2D,f.__webglTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,f.image);Z(c.TEXTURE_2D,f,f.image);c.bindTexture(c.TEXTURE_2D,null);f.needsUpdate=!1}c.activeTexture(c.TEXTURE0+n);c.bindTexture(c.TEXTURE_2D,f.__webglTexture)}function Ca(f){c.bindTexture(c.TEXTURE_2D,f.__webglTexture);c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null)}function Ja(f,n){var j;if(f=="fragment")j=c.createShader(c.FRAGMENT_SHADER);else f=="vertex"&&(j=c.createShader(c.VERTEX_SHADER));
c.shaderSource(j,n);c.compileShader(j);if(!c.getShaderParameter(j,c.COMPILE_STATUS)){console.error(c.getShaderInfoLog(j));console.error(n);return null}return j}function Ma(f){switch(f){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return c.NEAREST;default:return c.LINEAR}}function fa(f){switch(f){case THREE.RepeatWrapping:return c.REPEAT;case THREE.ClampToEdgeWrapping:return c.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return c.MIRRORED_REPEAT;
case THREE.NearestFilter:return c.NEAREST;case THREE.NearestMipMapNearestFilter:return c.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return c.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return c.LINEAR;case THREE.LinearMipMapNearestFilter:return c.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return c.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return c.BYTE;case THREE.UnsignedByteType:return c.UNSIGNED_BYTE;case THREE.ShortType:return c.SHORT;case THREE.UnsignedShortType:return c.UNSIGNED_SHORT;
case THREE.IntType:return c.INT;case THREE.UnsignedShortType:return c.UNSIGNED_INT;case THREE.FloatType:return c.FLOAT;case THREE.AlphaFormat:return c.ALPHA;case THREE.RGBFormat:return c.RGB;case THREE.RGBAFormat:return c.RGBA;case THREE.LuminanceFormat:return c.LUMINANCE;case THREE.LuminanceAlphaFormat:return c.LUMINANCE_ALPHA}return 0}function d(){var f={};if(f.depthBuffer===undefined)f.depthBuffer=!0;if(f.stencilBuffer===undefined)f.stencilBuffer=!0;f.__webglFramebuffer=c.createFramebuffer();f.__webglRenderbuffer=
c.createRenderbuffer();f.__webglTexture=c.createTexture();f.width=fb.width;f.height=fb.height;c.bindTexture(c.TEXTURE_2D,f.__webglTexture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f.width,f.height,0,c.RGBA,c.UNSIGNED_BYTE,null);c.bindRenderbuffer(c.RENDERBUFFER,
f.__webglRenderbuffer);c.bindFramebuffer(c.FRAMEBUFFER,f.__webglFramebuffer);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f.__webglTexture,0);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,f.width,f.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,f.__webglRenderbuffer);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null);return f}var za=this,c,Ua=[],Ga=null,wa=!0,Pa=null,
Ka=null,La=null,xa=null,Sa=0,Fa=0,Ha=0,Ia=0,va=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],$a=new THREE.Matrix4,eb=new Float32Array(16),ib=new Float32Array(16),jb=new THREE.Vector4,db={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};var fb=b.canvas!==undefined?b.canvas:document.createElement("canvas"),nb=b.stencil!==undefined?b.stencil:!0,mb=b.antialias!==undefined?
b.antialias:!1,hb=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0),zb=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};var Eb={},ja={};this.maxMorphTargets=8;this.domElement=fb;this.autoClear=!0;this.sortObjects=!0;try{if(!(c=fb.getContext("experimental-webgl",{antialias:mb,stencil:nb})))throw"Error creating WebGL context.";}catch($){console.error($)}console.log(navigator.userAgent+" | "+c.getParameter(c.VERSION)+" | "+c.getParameter(c.VENDOR)+
" | "+c.getParameter(c.RENDERER)+" | "+c.getParameter(c.SHADING_LANGUAGE_VERSION));c.clearColor(0,0,0,1);c.clearDepth(1);c.enable(c.DEPTH_TEST);c.depthFunc(c.LEQUAL);c.frontFace(c.CCW);c.cullFace(c.BACK);c.enable(c.CULL_FACE);c.clearColor(hb.r,hb.g,hb.b,zb);this.context=c;var Gb=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(nb){var ka={};ka.vertices=new Float32Array(12);ka.faces=new Uint16Array(6);ka.darkness=0.5;ka.vertices[0]=-500;ka.vertices[1]=-500;ka.vertices[2]=-1;ka.vertices[3]=500;
ka.vertices[4]=-500;ka.vertices[5]=-1;ka.vertices[6]=500;ka.vertices[7]=500;ka.vertices[8]=-1;ka.vertices[9]=-500;ka.vertices[10]=500;ka.vertices[11]=-1;ka.faces[0]=0;ka.faces[1]=1;ka.faces[2]=2;ka.faces[3]=0;ka.faces[4]=2;ka.faces[5]=3;ka.vertexBuffer=c.createBuffer();ka.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,ka.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,ka.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,ka.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,ka.faces,
c.STATIC_DRAW);ka.program=c.createProgram();c.attachShader(ka.program,Ja("fragment",THREE.ShaderLib.shadowPost.fragmentShader));c.attachShader(ka.program,Ja("vertex",THREE.ShaderLib.shadowPost.vertexShader));c.linkProgram(ka.program);ka.vertexLocation=c.getAttribLocation(ka.program,"position");ka.projectionLocation=c.getUniformLocation(ka.program,"projectionMatrix");ka.darknessLocation=c.getUniformLocation(ka.program,"darkness")}var h={};h.vertices=new Float32Array(20);h.faces=new Uint16Array(6);
h.vertices[0]=-24;h.vertices[1]=-15;h.vertices[2]=-15;h.vertices[3]=0;h.vertices[4]=0;h.vertices[5]=24;h.vertices[6]=-15;h.vertices[7]=-15;h.vertices[8]=1;h.vertices[9]=0;h.vertices[10]=24;h.vertices[11]=15;h.vertices[12]=-15;h.vertices[13]=1;h.vertices[14]=1;h.vertices[15]=-24;h.vertices[16]=15;h.vertices[17]=-15;h.vertices[18]=0;h.vertices[19]=1;h.faces[0]=0;h.faces[1]=1;h.faces[2]=2;h.faces[3]=0;h.faces[4]=2;h.faces[5]=3;h.vertexBuffer=c.createBuffer();h.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,
h.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,h.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,h.faces,c.STATIC_DRAW);h.program=c.createProgram();c.attachShader(h.program,Ja("vertex",THREE.ShaderLib.anaglyph.vertexShader));c.attachShader(h.program,Ja("fragment",THREE.ShaderLib.anaglyph.fragmentShader));c.linkProgram(h.program);h.vertexLocation=c.getAttribLocation(h.program,"position");h.uv=c.getAttribLocation(h.program,"UV");h.projectionLocation=
c.getUniformLocation(h.program,"projectionMatrix");h.texture1=c.getUniformLocation(h.program,"texture1");h.texture2=c.getUniformLocation(h.program,"texture2");var I=!1,o={};o.vertices=new Float32Array(16);o.faces=new Uint16Array(6);b=0;o.vertices[b++]=-1;o.vertices[b++]=-1;o.vertices[b++]=0;o.vertices[b++]=0;o.vertices[b++]=1;o.vertices[b++]=-1;o.vertices[b++]=1;o.vertices[b++]=0;o.vertices[b++]=1;o.vertices[b++]=1;o.vertices[b++]=1;o.vertices[b++]=1;o.vertices[b++]=-1;o.vertices[b++]=1;o.vertices[b++]=
0;o.vertices[b++]=1;b=0;o.faces[b++]=0;o.faces[b++]=1;o.faces[b++]=2;o.faces[b++]=0;o.faces[b++]=2;o.faces[b++]=3;o.vertexBuffer=c.createBuffer();o.elementBuffer=c.createBuffer();o.tempTexture=c.createTexture();o.occlusionTexture=c.createTexture();c.bindBuffer(c.ARRAY_BUFFER,o.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,o.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,o.faces,c.STATIC_DRAW);c.bindTexture(c.TEXTURE_2D,o.tempTexture);c.texImage2D(c.TEXTURE_2D,
0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,o.occlusionTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);if(c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){o.hasVertexTexture=!1;o.program=c.createProgram();c.attachShader(o.program,Ja("fragment",THREE.ShaderLib.lensFlare.fragmentShader));c.attachShader(o.program,Ja("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{o.hasVertexTexture=!0;o.program=c.createProgram();c.attachShader(o.program,
Ja("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));c.attachShader(o.program,Ja("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}c.linkProgram(o.program);o.attributes={};o.uniforms={};o.attributes.vertex=c.getAttribLocation(o.program,"position");o.attributes.uv=c.getAttribLocation(o.program,"UV");o.uniforms.renderType=c.getUniformLocation(o.program,"renderType");o.uniforms.map=c.getUniformLocation(o.program,"map");o.uniforms.occlusionMap=c.getUniformLocation(o.program,
"occlusionMap");o.uniforms.opacity=c.getUniformLocation(o.program,"opacity");o.uniforms.scale=c.getUniformLocation(o.program,"scale");o.uniforms.rotation=c.getUniformLocation(o.program,"rotation");o.uniforms.screenPosition=c.getUniformLocation(o.program,"screenPosition");var v=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=c.createBuffer();_sprite.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,_sprite.vertexBuffer);
c.bufferData(c.ARRAY_BUFFER,_sprite.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,_sprite.faces,c.STATIC_DRAW);_sprite.program=c.createProgram();c.attachShader(_sprite.program,Ja("fragment",THREE.ShaderLib.sprite.fragmentShader));c.attachShader(_sprite.program,Ja("vertex",THREE.ShaderLib.sprite.vertexShader));c.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=c.getAttribLocation(_sprite.program,
"position");_sprite.attributes.uv=c.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=c.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=c.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=c.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=c.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=c.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=c.getUniformLocation(_sprite.program,
"map");_sprite.uniforms.opacity=c.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=c.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=c.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=c.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=c.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=c.getUniformLocation(_sprite.program,
"projectionMatrix");var A=!1;this.setSize=function(f,n){fb.width=f;fb.height=n;this.setViewport(0,0,fb.width,fb.height);Eb=d();ja=d();d()};this.setViewport=function(f,n,j,k){Sa=f;Fa=n;Ha=j;Ia=k;c.viewport(Sa,Fa,Ha,Ia)};this.setScissor=function(f,n,j,k){c.scissor(f,n,j,k)};this.enableScissorTest=function(f){f?c.enable(c.SCISSOR_TEST):c.disable(c.SCISSOR_TEST)};this.enableDepthBufferWrite=function(f){wa=f;c.depthMask(f)};this.setClearColorHex=function(f,n){hb.setHex(f);zb=n;c.clearColor(hb.r,hb.g,hb.b,
zb)};this.setClearColor=function(f,n){hb.copy(f);zb=n;c.clearColor(hb.r,hb.g,hb.b,zb)};this.clear=function(){c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(f){ka.darkness=f};this.getContext=function(){return c};this.initMaterial=function(f,n,j,k){var r,i,t;if(f instanceof THREE.MeshDepthMaterial)t="depth";else if(f instanceof THREE.ShadowVolumeDynamicMaterial)t="shadowVolumeDynamic";else if(f instanceof THREE.MeshNormalMaterial)t="normal";
else if(f instanceof THREE.MeshBasicMaterial)t="basic";else if(f instanceof THREE.MeshLambertMaterial)t="lambert";else if(f instanceof THREE.MeshPhongMaterial)t="phong";else if(f instanceof THREE.LineBasicMaterial)t="basic";else f instanceof THREE.ParticleBasicMaterial&&(t="particle_basic");if(t){var s=THREE.ShaderLib[t];f.uniforms=THREE.UniformsUtils.clone(s.uniforms);f.vertexShader=s.vertexShader;f.fragmentShader=s.fragmentShader}var w,x,y;w=y=s=0;for(x=n.length;w<x;w++){i=n[w];i instanceof THREE.DirectionalLight&&
y++;i instanceof THREE.PointLight&&s++}if(s+y<=4)n=y;else{n=Math.ceil(4*y/(s+y));s=4-n}i={directional:n,point:s};y=50;if(k!==undefined&&k instanceof THREE.SkinnedMesh)y=k.bones.length;var F;a:{w=f.fragmentShader;x=f.vertexShader;s=f.uniforms;n=f.attributes;j={map:!!f.map,envMap:!!f.envMap,lightMap:!!f.lightMap,vertexColors:f.vertexColors,fog:j,sizeAttenuation:f.sizeAttenuation,skinning:f.skinning,morphTargets:f.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:i.directional,maxPointLights:i.point,
maxBones:y};var D;i=[];if(t)i.push(t);else{i.push(w);i.push(x)}for(D in j){i.push(D);i.push(j[D])}t=i.join();D=0;for(i=Ua.length;D<i;D++)if(Ua[D].code==t){F=Ua[D].program;break a}D=c.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+j.maxDirLights,"#define MAX_POINT_LIGHTS "+j.maxPointLights,j.fog?"#define USE_FOG":"",j.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",j.map?"#define USE_MAP":"",j.envMap?"#define USE_ENVMAP":"",j.lightMap?"#define USE_LIGHTMAP":
"",j.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[Gb?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+j.maxDirLights,"#define MAX_POINT_LIGHTS "+j.maxPointLights,"#define MAX_BONES "+j.maxBones,j.map?"#define USE_MAP":"",j.envMap?"#define USE_ENVMAP":"",j.lightMap?"#define USE_LIGHTMAP":"",j.vertexColors?"#define USE_COLOR":"",j.skinning?"#define USE_SKINNING":"",j.morphTargets?"#define USE_MORPHTARGETS":"",j.sizeAttenuation?
"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
c.attachShader(D,Ja("fragment",prefix_fragment+w));c.attachShader(D,Ja("vertex",prefix_vertex+x));c.linkProgram(D);c.getProgramParameter(D,c.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+c.getProgramParameter(D,c.VALIDATE_STATUS)+", gl error ["+c.getError()+"]");D.uniforms={};D.attributes={};var T;w=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(T in s)w.push(T);
T=w;s=0;for(w=T.length;s<w;s++){x=T[s];D.uniforms[x]=c.getUniformLocation(D,x)}w=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(T=0;T<j.maxMorphTargets;T++)w.push("morphTarget"+T);for(F in n)w.push(F);F=w;T=0;for(n=F.length;T<n;T++){j=F[T];D.attributes[j]=c.getAttribLocation(D,j)}Ua.push({program:D,code:t});F=D}f.program=F;F=f.program.attributes;F.position>=0&&c.enableVertexAttribArray(F.position);F.color>=0&&c.enableVertexAttribArray(F.color);
F.normal>=0&&c.enableVertexAttribArray(F.normal);F.tangent>=0&&c.enableVertexAttribArray(F.tangent);if(f.skinning&&F.skinVertexA>=0&&F.skinVertexB>=0&&F.skinIndex>=0&&F.skinWeight>=0){c.enableVertexAttribArray(F.skinVertexA);c.enableVertexAttribArray(F.skinVertexB);c.enableVertexAttribArray(F.skinIndex);c.enableVertexAttribArray(F.skinWeight)}if(f.attributes)for(r in f.attributes)F[r]!==undefined&&F[r]>=0&&c.enableVertexAttribArray(F[r]);if(f.morphTargets){f.numSupportedMorphTargets=0;if(F.morphTarget0>=
0){c.enableVertexAttribArray(F.morphTarget0);f.numSupportedMorphTargets++}if(F.morphTarget1>=0){c.enableVertexAttribArray(F.morphTarget1);f.numSupportedMorphTargets++}if(F.morphTarget2>=0){c.enableVertexAttribArray(F.morphTarget2);f.numSupportedMorphTargets++}if(F.morphTarget3>=0){c.enableVertexAttribArray(F.morphTarget3);f.numSupportedMorphTargets++}if(F.morphTarget4>=0){c.enableVertexAttribArray(F.morphTarget4);f.numSupportedMorphTargets++}if(F.morphTarget5>=0){c.enableVertexAttribArray(F.morphTarget5);
f.numSupportedMorphTargets++}if(F.morphTarget6>=0){c.enableVertexAttribArray(F.morphTarget6);f.numSupportedMorphTargets++}if(F.morphTarget7>=0){c.enableVertexAttribArray(F.morphTarget7);f.numSupportedMorphTargets++}k.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);f=0;for(r=this.maxMorphTargets;f<r;f++)k.__webglMorphTargetInfluences[f]=0}};this.render=function(f,n,j,k,r){var i,t,s,w,x,y,F,D,T,U=f.lights,V=f.fog;za.data.vertices=0;za.data.faces=0;za.data.drawCalls=0;c.bindFramebuffer(c.FRAMEBUFFER,
Eb.__webglFramebuffer);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);c.clearColor(0,0,0,1);n.matrixAutoUpdate&&n.update(undefined,!0);f.update(undefined,!1,n);n.matrixWorldInverse.flattenToArray(ib);n.projectionMatrix.flattenToArray(eb);$a.multiply(n.projectionMatrix,n.matrixWorldInverse);G($a);this.initWebGLObjects(f);(this.autoClear||r)&&this.clear();y=f.__webglObjects.length;for(x=0;x<y;x++){i=f.__webglObjects[x];D=i.object;if(D.visible)if(!(D instanceof THREE.Mesh)||H(D)){D.matrixWorld.flattenToArray(D._objectMatrixArray);
X(D,n);S(i);i.render=!0;if(this.sortObjects){jb.copy(D.position);$a.multiplyVector3(jb);i.z=jb.z}}else i.render=!1;else i.render=!1}this.sortObjects&&f.__webglObjects.sort(W);F=f.__webglObjectsImmediate.length;for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){D.matrixAutoUpdate&&D.matrixWorld.flattenToArray(D._objectMatrixArray);X(D,n);Q(i)}}ma(THREE.NormalBlending);for(x=0;x<y;x++){i=f.__webglObjects[x];if(i.render){D=i.object;T=i.buffer;s=i.opaque;B(D);for(i=0;i<s.count;i++){w=
s.list[i];z(w.depthTest);m(n,U,V,w,T,D)}}}for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){s=i.opaque;B(D);for(i=0;i<s.count;i++){w=s.list[i];z(w.depthTest);t=g(n,U,V,w,D);D.render(function(N){q(N,t,w.shading)})}}}for(x=0;x<y;x++){i=f.__webglObjects[x];if(i.render){D=i.object;T=i.buffer;s=i.transparent;B(D);for(i=0;i<s.count;i++){w=s.list[i];ma(w.blending);z(w.depthTest);m(n,U,V,w,T,D)}}}for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){s=i.transparent;
B(D);for(i=0;i<s.count;i++){w=s.list[i];ma(w.blending);z(w.depthTest);t=g(n,U,V,w,D);D.render(function(N){q(N,t,w.shading)})}}}f.__webglSprites.length&&R(f,n);nb&&f.__webglShadowVolumes.length&&f.lights.length&&P(f);f.__webglLensFlares.length&&da(f,n);k&&k.minFilter!==THREE.NearestFilter&&k.minFilter!==THREE.LinearFilter&&Ca(k);c.bindFramebuffer(c.FRAMEBUFFER,ja.__webglFramebuffer);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);c.clearColor(0,0,0,1);j.matrixAutoUpdate&&j.update(undefined,
!0);f.update(undefined,!1,j);j.matrixWorldInverse.flattenToArray(ib);j.projectionMatrix.flattenToArray(eb);$a.multiply(j.projectionMatrix,j.matrixWorldInverse);(this.autoClear||r)&&this.clear();y=f.__webglObjects.length;for(x=0;x<y;x++){i=f.__webglObjects[x];D=i.object;if(D.visible)if(!(D instanceof THREE.Mesh)||H(D)){D.matrixWorld.flattenToArray(D._objectMatrixArray);X(D,j);S(i);i.render=!0;if(this.sortObjects){jb.copy(D.position);$a.multiplyVector3(jb);i.z=jb.z}}else i.render=!1;else i.render=!1}F=
f.__webglObjectsImmediate.length;for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){D.matrixAutoUpdate&&D.matrixWorld.flattenToArray(D._objectMatrixArray);X(D,j);Q(i)}}ma(THREE.NormalBlending);for(x=0;x<y;x++){i=f.__webglObjects[x];if(i.render){D=i.object;T=i.buffer;s=i.opaque;B(D);for(i=0;i<s.count;i++){w=s.list[i];z(w.depthTest);m(j,U,V,w,T,D)}}}for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){s=i.opaque;B(D);for(i=0;i<s.count;i++){w=s.list[i];z(w.depthTest);
t=g(j,U,V,w,D);D.render(function(N){q(N,t,w.shading)})}}}for(x=0;x<y;x++){i=f.__webglObjects[x];if(i.render){D=i.object;T=i.buffer;s=i.transparent;B(D);for(i=0;i<s.count;i++){w=s.list[i];ma(w.blending);z(w.depthTest);m(j,U,V,w,T,D)}}}for(x=0;x<F;x++){i=f.__webglObjectsImmediate[x];D=i.object;if(D.visible){s=i.transparent;B(D);for(i=0;i<s.count;i++){w=s.list[i];ma(w.blending);z(w.depthTest);t=g(j,U,V,w,D);D.render(function(N){q(N,t,w.shading)})}}}f.__webglSprites.length&&R(f,j);nb&&f.__webglShadowVolumes.length&&
f.lights.length&&P(f);f.__webglLensFlares.length&&da(f,j);k&&k.minFilter!==THREE.NearestFilter&&k.minFilter!==THREE.LinearFilter&&Ca(k);c.bindFramebuffer(c.FRAMEBUFFER,null);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);c.clearColor(0,0,0,1);aa(f,Eb,ja);c.finish()};this.initWebGLObjects=function(f){if(!f.__webglObjects){f.__webglObjects=[];f.__webglObjectsImmediate=[];f.__webglShadowVolumes=[];f.__webglLensFlares=[];f.__webglSprites=[]}for(;f.__objectsAdded.length;){var n=f.__objectsAdded[0],
j=f,k=void 0,r=void 0,i=void 0;if(n._modelViewMatrix==undefined){n._modelViewMatrix=new THREE.Matrix4;n._normalMatrixArray=new Float32Array(9);n._modelViewMatrixArray=new Float32Array(16);n._objectMatrixArray=new Float32Array(16);n.matrixWorld.flattenToArray(n._objectMatrixArray)}if(n instanceof THREE.Mesh){r=n.geometry;r.geometryGroups==undefined&&qa(r);for(k in r.geometryGroups){i=r.geometryGroups[k];if(!i.__webglVertexBuffer){var t=i;t.__webglVertexBuffer=c.createBuffer();t.__webglNormalBuffer=
c.createBuffer();t.__webglTangentBuffer=c.createBuffer();t.__webglColorBuffer=c.createBuffer();t.__webglUVBuffer=c.createBuffer();t.__webglUV2Buffer=c.createBuffer();t.__webglSkinVertexABuffer=c.createBuffer();t.__webglSkinVertexBBuffer=c.createBuffer();t.__webglSkinIndicesBuffer=c.createBuffer();t.__webglSkinWeightsBuffer=c.createBuffer();t.__webglFaceBuffer=c.createBuffer();t.__webglLineBuffer=c.createBuffer();if(t.numMorphTargets){var s=void 0,w=void 0;t.__webglMorphTargetsBuffers=[];s=0;for(w=
t.numMorphTargets;s<w;s++)t.__webglMorphTargetsBuffers.push(c.createBuffer())}t=i;s=n;var x=void 0,y=void 0,F=void 0;F=void 0;var D=void 0,T=void 0,U=void 0,V=U=w=0;y=void 0;F=void 0;var N=void 0;x=void 0;y=void 0;D=s.geometry;N=D.faces;T=t.faces;x=0;for(y=T.length;x<y;x++){F=T[x];F=N[F];if(F instanceof THREE.Face3){w+=3;U+=1;V+=3}else if(F instanceof THREE.Face4){w+=4;U+=2;V+=4}}x=t;y=s;N=void 0;T=void 0;var Y=void 0,la=void 0;Y=void 0;F=[];N=0;for(T=y.materials.length;N<T;N++){Y=y.materials[N];
if(Y instanceof THREE.MeshFaceMaterial){Y=0;for(l=x.materials.length;Y<l;Y++)(la=x.materials[Y])&&F.push(la)}else(la=Y)&&F.push(la)}x=F;a:{y=void 0;N=void 0;T=x.length;for(y=0;y<T;y++){N=x[y];if(N.map||N.lightMap||N instanceof THREE.MeshShaderMaterial){y=!0;break a}}y=!1}a:{N=void 0;T=void 0;F=x.length;for(N=0;N<F;N++){T=x[N];if(!(T instanceof THREE.MeshBasicMaterial&&!T.envMap||T instanceof THREE.MeshDepthMaterial)){N=T&&T.shading!=undefined&&T.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;
break a}}N=!1}a:{T=void 0;F=void 0;Y=x.length;for(T=0;T<Y;T++){F=x[T];if(F.vertexColors){F=F.vertexColors;break a}}F=!1}t.__vertexArray=new Float32Array(w*3);if(N)t.__normalArray=new Float32Array(w*3);if(D.hasTangents)t.__tangentArray=new Float32Array(w*4);if(F)t.__colorArray=new Float32Array(w*3);if(y){if(D.faceUvs.length>0||D.faceVertexUvs.length>0)t.__uvArray=new Float32Array(w*2);if(D.faceUvs.length>1||D.faceVertexUvs.length>1)t.__uv2Array=new Float32Array(w*2)}if(s.geometry.skinWeights.length&&
s.geometry.skinIndices.length){t.__skinVertexAArray=new Float32Array(w*4);t.__skinVertexBArray=new Float32Array(w*4);t.__skinIndexArray=new Float32Array(w*4);t.__skinWeightArray=new Float32Array(w*4)}t.__faceArray=new Uint16Array(U*3+(s.geometry.edgeFaces?s.geometry.edgeFaces.length*6:0));t.__lineArray=new Uint16Array(V*2);if(t.numMorphTargets){t.__morphTargetsArrays=[];D=0;for(T=t.numMorphTargets;D<T;D++)t.__morphTargetsArrays.push(new Float32Array(w*3))}t.__needsSmoothNormals=N==THREE.SmoothShading;
t.__uvType=y;t.__vertexColorType=F;t.__normalType=N;t.__webglFaceCount=U*3+(s.geometry.edgeFaces?s.geometry.edgeFaces.length*6:0);t.__webglLineCount=V*2;D=0;for(T=x.length;D<T;D++)if(x[D].attributes){t.__webglCustomAttributes={};for(a in x[D].attributes){y=x[D].attributes[a];if(!y.__webglInitialized||y.createUniqueBuffers){y.__webglInitialized=!0;U=1;if(y.type==="v2")U=2;else if(y.type==="v3")U=3;else if(y.type==="v4")U=4;else y.type==="c"&&(U=3);y.size=U;y.needsUpdate=!0;y.array=new Float32Array(w*
U);y.buffer=c.createBuffer();y.buffer.belongsToAttribute=a}t.__webglCustomAttributes[a]=y}}t.__inittedArrays=!0;r.__dirtyVertices=!0;r.__dirtyMorphTargets=!0;r.__dirtyElements=!0;r.__dirtyUvs=!0;r.__dirtyNormals=!0;r.__dirtyTangents=!0;r.__dirtyColors=!0}n instanceof THREE.ShadowVolume?ra(j.__webglShadowVolumes,i,n):ra(j.__webglObjects,i,n)}}else if(n instanceof THREE.LensFlare)ra(j.__webglLensFlares,undefined,n);else if(n instanceof THREE.Ribbon){r=n.geometry;if(!r.__webglVertexBuffer){k=r;k.__webglVertexBuffer=
c.createBuffer();k.__webglColorBuffer=c.createBuffer();k=r;i=k.vertices.length;k.__vertexArray=new Float32Array(i*3);k.__colorArray=new Float32Array(i*3);k.__webglVertexCount=i;r.__dirtyVertices=!0;r.__dirtyColors=!0}ra(j.__webglObjects,r,n)}else if(n instanceof THREE.Line){r=n.geometry;if(!r.__webglVertexBuffer){k=r;k.__webglVertexBuffer=c.createBuffer();k.__webglColorBuffer=c.createBuffer();k=r;i=k.vertices.length;k.__vertexArray=new Float32Array(i*3);k.__colorArray=new Float32Array(i*3);k.__webglLineCount=
i;r.__dirtyVertices=!0;r.__dirtyColors=!0}ra(j.__webglObjects,r,n)}else if(n instanceof THREE.ParticleSystem){r=n.geometry;if(!r.__webglVertexBuffer){k=r;k.__webglVertexBuffer=c.createBuffer();k.__webglColorBuffer=c.createBuffer();k=r;i=k.vertices.length;k.__vertexArray=new Float32Array(i*3);k.__colorArray=new Float32Array(i*3);k.__sortArray=[];k.__webglParticleCount=i;r.__dirtyVertices=!0;r.__dirtyColors=!0}ra(j.__webglObjects,r,n)}else if(THREE.MarchingCubes!==undefined&&n instanceof THREE.MarchingCubes)j.__webglObjectsImmediate.push({object:n,
opaque:{list:[],count:0},transparent:{list:[],count:0}});else n instanceof THREE.Sprite&&j.__webglSprites.push(n);f.__objectsAdded.splice(0,1)}for(;f.__objectsRemoved.length;){n=f.__objectsRemoved[0];j=f;r=void 0;k=void 0;if(n instanceof THREE.Mesh)for(r=j.__webglObjects.length-1;r>=0;r--){k=j.__webglObjects[r].object;if(n==k){j.__webglObjects.splice(r,1);break}}else if(n instanceof THREE.Sprite)for(r=j.__webglSprites.length-1;r>=0;r--){k=j.__webglSprites[r];if(n==k){j.__webglSprites.splice(r,1);
break}}f.__objectsRemoved.splice(0,1)}n=0;for(j=f.__webglObjects.length;n<j;n++)Ba(f.__webglObjects[n].object,f);n=0;for(j=f.__webglShadowVolumes.length;n<j;n++)Ba(f.__webglShadowVolumes[n].object,f);n=0;for(j=f.__webglLensFlares.length;n<j;n++)Ba(f.__webglLensFlares[n].object,f)};this.setFaceCulling=function(f,n){if(f){!n||n=="ccw"?c.frontFace(c.CCW):c.frontFace(c.CW);if(f=="back")c.cullFace(c.BACK);else f=="front"?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK);c.enable(c.CULL_FACE)}else c.disable(c.CULL_FACE)};
this.supportsVertexTextures=function(){return Gb}};
THREE.WebGLRenderer=function(b){function e(h,I,o){var v,A,f,n=h.vertices,j=n.length,k=h.colors,r=k.length,i=h.__vertexArray,t=h.__colorArray,s=h.__sortArray,w=h.__dirtyVertices,x=h.__dirtyColors;if(o.sortParticles){va.multiplySelf(o.matrixWorld);for(v=0;v<j;v++){A=n[v].position;ib.copy(A);va.multiplyVector3(ib);s[v]=[ib.z,v]}s.sort(function(y,F){return F[0]-y[0]});for(v=0;v<j;v++){A=n[s[v][1]].position;f=v*3;i[f]=A.x;i[f+1]=A.y;i[f+2]=A.z}for(v=0;v<r;v++){f=v*3;color=k[s[v][1]];t[f]=color.r;t[f+1]=
color.g;t[f+2]=color.b}}else{if(w)for(v=0;v<j;v++){A=n[v].position;f=v*3;i[f]=A.x;i[f+1]=A.y;i[f+2]=A.z}if(x)for(v=0;v<r;v++){color=k[v];f=v*3;t[f]=color.r;t[f+1]=color.g;t[f+2]=color.b}}if(w||o.sortParticles){d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,i,I)}if(x||o.sortParticles){d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,t,I)}}function g(h,I,o,v,A){v.program||fa.initMaterial(v,I,o,A);var f=v.program,n=f.uniforms,j=v.uniforms;
if(f!=c){d.useProgram(f);c=f}d.uniformMatrix4fv(n.projectionMatrix,!1,$a);if(o&&(v instanceof THREE.MeshBasicMaterial||v instanceof THREE.MeshLambertMaterial||v instanceof THREE.MeshPhongMaterial||v instanceof THREE.LineBasicMaterial||v instanceof THREE.ParticleBasicMaterial||v.fog)){j.fogColor.value=o.color;if(o instanceof THREE.Fog){j.fogNear.value=o.near;j.fogFar.value=o.far}else if(o instanceof THREE.FogExp2)j.fogDensity.value=o.density}if(v instanceof THREE.MeshPhongMaterial||v instanceof THREE.MeshLambertMaterial||
v.lights){var k,r,i=0,t=0,s=0,w,x,y,F,D=jb,T=D.directional.colors,U=D.directional.positions,V=D.point.colors,N=D.point.positions,Y=D.point.distances,la=0,E=0;o=r=F=0;for(k=I.length;o<k;o++){r=I[o];w=r.color;x=r.position;y=r.intensity;F=r.distance;if(r instanceof THREE.AmbientLight){i+=w.r;t+=w.g;s+=w.b}else if(r instanceof THREE.DirectionalLight){F=la*3;T[F]=w.r*y;T[F+1]=w.g*y;T[F+2]=w.b*y;U[F]=x.x;U[F+1]=x.y;U[F+2]=x.z;la+=1}else if(r instanceof THREE.PointLight){r=E*3;V[r]=w.r*y;V[r+1]=w.g*y;V[r+
2]=w.b*y;N[r]=x.x;N[r+1]=x.y;N[r+2]=x.z;Y[E]=F;E+=1}}for(o=la*3;o<T.length;o++)T[o]=0;for(o=E*3;o<V.length;o++)V[o]=0;D.point.length=E;D.directional.length=la;D.ambient[0]=i;D.ambient[1]=t;D.ambient[2]=s;o=jb;j.enableLighting.value=o.directional.length+o.point.length;j.ambientLightColor.value=o.ambient;j.directionalLightColor.value=o.directional.colors;j.directionalLightDirection.value=o.directional.positions;j.pointLightColor.value=o.point.colors;j.pointLightPosition.value=o.point.positions;j.pointLightDistance.value=
o.point.distances}if(v instanceof THREE.MeshBasicMaterial||v instanceof THREE.MeshLambertMaterial||v instanceof THREE.MeshPhongMaterial){j.diffuse.value=v.color;j.opacity.value=v.opacity;j.map.texture=v.map;j.lightMap.texture=v.lightMap;j.envMap.texture=v.envMap;j.reflectivity.value=v.reflectivity;j.refractionRatio.value=v.refractionRatio;j.combine.value=v.combine;j.useRefract.value=v.envMap&&v.envMap.mapping instanceof THREE.CubeRefractionMapping}if(v instanceof THREE.LineBasicMaterial){j.diffuse.value=
v.color;j.opacity.value=v.opacity}else if(v instanceof THREE.ParticleBasicMaterial){j.psColor.value=v.color;j.opacity.value=v.opacity;j.size.value=v.size;j.scale.value=db.height/2;j.map.texture=v.map}else if(v instanceof THREE.MeshPhongMaterial){j.ambient.value=v.ambient;j.specular.value=v.specular;j.shininess.value=v.shininess}else if(v instanceof THREE.MeshDepthMaterial){j.mNear.value=h.near;j.mFar.value=h.far;j.opacity.value=v.opacity}else if(v instanceof THREE.MeshNormalMaterial)j.opacity.value=
v.opacity;for(var K in j)if(t=f.uniforms[K]){k=j[K];i=k.type;o=k.value;if(i=="i")d.uniform1i(t,o);else if(i=="f")d.uniform1f(t,o);else if(i=="fv1")d.uniform1fv(t,o);else if(i=="fv")d.uniform3fv(t,o);else if(i=="v2")d.uniform2f(t,o.x,o.y);else if(i=="v3")d.uniform3f(t,o.x,o.y,o.z);else if(i=="v4")d.uniform4f(t,o.x,o.y,o.z,o.w);else if(i=="c")d.uniform3f(t,o.r,o.g,o.b);else if(i=="t"){d.uniform1i(t,o);if(k=k.texture)if(k.image instanceof Array&&k.image.length==6){if(k.image.length==6){if(k.needsUpdate){if(k.__webglInit){d.bindTexture(d.TEXTURE_CUBE_MAP,
k.image.__webglTextureCube);for(i=0;i<6;++i)d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,d.RGBA,d.UNSIGNED_BYTE,k.image[i])}else{k.image.__webglTextureCube=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,k.image.__webglTextureCube);for(i=0;i<6;++i)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,k.image[i]);k.__webglInit=!0}ma(d.TEXTURE_CUBE_MAP,k,k.image[0]);d.bindTexture(d.TEXTURE_CUBE_MAP,null);k.needsUpdate=!1}d.activeTexture(d.TEXTURE0+o);d.bindTexture(d.TEXTURE_CUBE_MAP,
k.image.__webglTextureCube)}}else Z(k,o)}}d.uniformMatrix4fv(n.modelViewMatrix,!1,A._modelViewMatrixArray);d.uniformMatrix3fv(n.normalMatrix,!1,A._normalMatrixArray);(v instanceof THREE.MeshShaderMaterial||v instanceof THREE.MeshPhongMaterial||v.envMap)&&n.cameraPosition!==null&&d.uniform3f(n.cameraPosition,h.position.x,h.position.y,h.position.z);(v instanceof THREE.MeshShaderMaterial||v.envMap||v.skinning)&&n.objectMatrix!==null&&d.uniformMatrix4fv(n.objectMatrix,!1,A._objectMatrixArray);(v instanceof
THREE.MeshPhongMaterial||v instanceof THREE.MeshLambertMaterial||v instanceof THREE.MeshShaderMaterial||v.skinning)&&n.viewMatrix!==null&&d.uniformMatrix4fv(n.viewMatrix,!1,eb);if(v instanceof THREE.ShadowVolumeDynamicMaterial){h=j.directionalLightDirection.value;h[0]=-I[1].position.x;h[1]=-I[1].position.y;h[2]=-I[1].position.z;d.uniform3fv(n.directionalLightDirection,h);d.uniformMatrix4fv(n.objectMatrix,!1,A._objectMatrixArray);d.uniformMatrix4fv(n.viewMatrix,!1,eb)}if(v.skinning){d.uniformMatrix4fv(n.cameraInverseMatrix,
!1,eb);d.uniformMatrix4fv(n.boneGlobalMatrices,!1,A.boneMatrices)}return f}function m(h,I,o,v,A,f){if(v.opacity!=0){var n;h=g(h,I,o,v,f).attributes;if(!v.morphTargets&&h.position>=0){d.bindBuffer(d.ARRAY_BUFFER,A.__webglVertexBuffer);d.vertexAttribPointer(h.position,3,d.FLOAT,!1,0,0)}else{I=v.program.attributes;if(f.morphTargetBase!==-1){d.bindBuffer(d.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[f.morphTargetBase]);d.vertexAttribPointer(I.position,3,d.FLOAT,!1,0,0)}else if(I.position>=0){d.bindBuffer(d.ARRAY_BUFFER,
A.__webglVertexBuffer);d.vertexAttribPointer(I.position,3,d.FLOAT,!1,0,0)}if(f.morphTargetForcedOrder.length){o=0;for(var j=f.morphTargetForcedOrder,k=f.morphTargetInfluences;o<v.numSupportedMorphTargets&&o<j.length;){d.bindBuffer(d.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[j[o]]);d.vertexAttribPointer(I["morphTarget"+o],3,d.FLOAT,!1,0,0);f.__webglMorphTargetInfluences[o]=k[j[o]];o++}}else{j=[];var r=-1,i=0;k=f.morphTargetInfluences;var t,s=k.length;o=0;for(f.morphTargetBase!==-1&&(j[f.morphTargetBase]=
!0);o<v.numSupportedMorphTargets;){for(t=0;t<s;t++)if(!j[t]&&k[t]>r){i=t;r=k[i]}d.bindBuffer(d.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[i]);d.vertexAttribPointer(I["morphTarget"+o],3,d.FLOAT,!1,0,0);f.__webglMorphTargetInfluences[o]=r;j[i]=1;r=-1;o++}}v.program.uniforms.morphTargetInfluences!==null&&d.uniform1fv(v.program.uniforms.morphTargetInfluences,f.__webglMorphTargetInfluences)}if(v.attributes)for(n in v.attributes)if(h[n]!==undefined&&h[n]>=0){I=v.attributes[n];if(I.buffer){d.bindBuffer(d.ARRAY_BUFFER,
I.buffer);d.vertexAttribPointer(h[n],I.size,d.FLOAT,!1,0,0)}}if(h.color>=0){d.bindBuffer(d.ARRAY_BUFFER,A.__webglColorBuffer);d.vertexAttribPointer(h.color,3,d.FLOAT,!1,0,0)}if(h.normal>=0){d.bindBuffer(d.ARRAY_BUFFER,A.__webglNormalBuffer);d.vertexAttribPointer(h.normal,3,d.FLOAT,!1,0,0)}if(h.tangent>=0){d.bindBuffer(d.ARRAY_BUFFER,A.__webglTangentBuffer);d.vertexAttribPointer(h.tangent,4,d.FLOAT,!1,0,0)}if(h.uv>=0)if(A.__webglUVBuffer){d.bindBuffer(d.ARRAY_BUFFER,A.__webglUVBuffer);d.vertexAttribPointer(h.uv,
2,d.FLOAT,!1,0,0);d.enableVertexAttribArray(h.uv)}else d.disableVertexAttribArray(h.uv);if(h.uv2>=0)if(A.__webglUV2Buffer){d.bindBuffer(d.ARRAY_BUFFER,A.__webglUV2Buffer);d.vertexAttribPointer(h.uv2,2,d.FLOAT,!1,0,0);d.enableVertexAttribArray(h.uv2)}else d.disableVertexAttribArray(h.uv2);if(v.skinning&&h.skinVertexA>=0&&h.skinVertexB>=0&&h.skinIndex>=0&&h.skinWeight>=0){d.bindBuffer(d.ARRAY_BUFFER,A.__webglSkinVertexABuffer);d.vertexAttribPointer(h.skinVertexA,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
A.__webglSkinVertexBBuffer);d.vertexAttribPointer(h.skinVertexB,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,A.__webglSkinIndicesBuffer);d.vertexAttribPointer(h.skinIndex,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,A.__webglSkinWeightsBuffer);d.vertexAttribPointer(h.skinWeight,4,d.FLOAT,!1,0,0)}if(f instanceof THREE.Mesh){if(v.wireframe){d.lineWidth(v.wireframeLinewidth);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,A.__webglLineBuffer);d.drawElements(d.LINES,A.__webglLineCount,d.UNSIGNED_SHORT,0)}else{d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
A.__webglFaceBuffer);d.drawElements(d.TRIANGLES,A.__webglFaceCount,d.UNSIGNED_SHORT,0)}fa.data.vertices+=A.__webglFaceCount;fa.data.faces+=A.__webglFaceCount/3;fa.data.drawCalls++}else if(f instanceof THREE.Line){f=f.type==THREE.LineStrip?d.LINE_STRIP:d.LINES;d.lineWidth(v.linewidth);d.drawArrays(f,0,A.__webglLineCount);fa.data.drawCalls++}else if(f instanceof THREE.ParticleSystem){d.drawArrays(d.POINTS,0,A.__webglParticleCount);fa.data.drawCalls++}else if(f instanceof THREE.Ribbon){d.drawArrays(d.TRIANGLE_STRIP,
0,A.__webglVertexCount);fa.data.drawCalls++}}}function q(h,I,o){if(!h.__webglVertexBuffer)h.__webglVertexBuffer=d.createBuffer();if(!h.__webglNormalBuffer)h.__webglNormalBuffer=d.createBuffer();if(h.hasPos){d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,h.positionArray,d.DYNAMIC_DRAW);d.enableVertexAttribArray(I.attributes.position);d.vertexAttribPointer(I.attributes.position,3,d.FLOAT,!1,0,0)}if(h.hasNormal){d.bindBuffer(d.ARRAY_BUFFER,h.__webglNormalBuffer);if(o==
THREE.FlatShading){var v,A,f,n,j,k,r,i,t,s,w=h.count*3;for(s=0;s<w;s+=9){o=h.normalArray;v=o[s];A=o[s+1];f=o[s+2];n=o[s+3];k=o[s+4];i=o[s+5];j=o[s+6];r=o[s+7];t=o[s+8];v=(v+n+j)/3;A=(A+k+r)/3;f=(f+i+t)/3;o[s]=v;o[s+1]=A;o[s+2]=f;o[s+3]=v;o[s+4]=A;o[s+5]=f;o[s+6]=v;o[s+7]=A;o[s+8]=f}}d.bufferData(d.ARRAY_BUFFER,h.normalArray,d.DYNAMIC_DRAW);d.enableVertexAttribArray(I.attributes.normal);d.vertexAttribPointer(I.attributes.normal,3,d.FLOAT,!1,0,0)}d.drawArrays(d.TRIANGLES,0,h.count);h.count=0}function B(h){if(wa!=
h.doubleSided){h.doubleSided?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE);wa=h.doubleSided}if(Pa!=h.flipSided){h.flipSided?d.frontFace(d.CW):d.frontFace(d.CCW);Pa=h.flipSided}}function z(h){if(La!=h){h?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);La=h}}function G(h){Ia[0].set(h.n41-h.n11,h.n42-h.n12,h.n43-h.n13,h.n44-h.n14);Ia[1].set(h.n41+h.n11,h.n42+h.n12,h.n43+h.n13,h.n44+h.n14);Ia[2].set(h.n41+h.n21,h.n42+h.n22,h.n43+h.n23,h.n44+h.n24);Ia[3].set(h.n41-h.n21,h.n42-h.n22,h.n43-h.n23,h.n44-h.n24);
Ia[4].set(h.n41-h.n31,h.n42-h.n32,h.n43-h.n33,h.n44-h.n34);Ia[5].set(h.n41+h.n31,h.n42+h.n32,h.n43+h.n33,h.n44+h.n34);var I;for(h=0;h<6;h++){I=Ia[h];I.divideScalar(Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z))}}function H(h){for(var I=h.matrixWorld,o=-h.geometry.boundingSphere.radius*Math.max(h.scale.x,Math.max(h.scale.y,h.scale.z)),v=0;v<6;v++){h=Ia[v].x*I.n14+Ia[v].y*I.n24+Ia[v].z*I.n34+Ia[v].w;if(h<=o)return!1}return!0}function J(h,I){h.list[h.count]=I;h.count+=1}function Q(h){var I,o,v=h.object,A=h.opaque,
f=h.transparent;f.count=0;h=A.count=0;for(I=v.materials.length;h<I;h++){o=v.materials[h];o.transparent?J(f,o):J(A,o)}}function S(h){var I,o,v,A,f=h.object,n=h.buffer,j=h.opaque,k=h.transparent;k.count=0;h=j.count=0;for(v=f.materials.length;h<v;h++){I=f.materials[h];if(I instanceof THREE.MeshFaceMaterial){I=0;for(o=n.materials.length;I<o;I++)(A=n.materials[I])&&(A.transparent?J(k,A):J(j,A))}else(A=I)&&(A.transparent?J(k,A):J(j,A))}}function W(h,I){return I.z-h.z}function P(h){d.enable(d.POLYGON_OFFSET_FILL);
d.polygonOffset(0.1,1);d.enable(d.STENCIL_TEST);d.enable(d.DEPTH_TEST);d.depthMask(!1);d.colorMask(!1,!1,!1,!1);d.stencilFunc(d.ALWAYS,1,255);d.stencilOpSeparate(d.BACK,d.KEEP,d.INCR,d.KEEP);d.stencilOpSeparate(d.FRONT,d.KEEP,d.DECR,d.KEEP);var I,o=h.lights.length,v,A=h.lights,f=[],n,j,k,r,i,t=h.__webglShadowVolumes.length;for(I=0;I<o;I++){v=h.lights[I];if(v instanceof THREE.DirectionalLight&&v.castShadow){f[0]=-v.position.x;f[1]=-v.position.y;f[2]=-v.position.z;for(i=0;i<t;i++){v=h.__webglShadowVolumes[i].object;
n=h.__webglShadowVolumes[i].buffer;j=v.materials[0];j.program||fa.initMaterial(j,A,undefined,v);j=j.program;k=j.uniforms;r=j.attributes;if(c!==j){d.useProgram(j);c=j;d.uniformMatrix4fv(k.projectionMatrix,!1,$a);d.uniformMatrix4fv(k.viewMatrix,!1,eb);d.uniform3fv(k.directionalLightDirection,f)}v.matrixWorld.flattenToArray(v._objectMatrixArray);d.uniformMatrix4fv(k.objectMatrix,!1,v._objectMatrixArray);d.bindBuffer(d.ARRAY_BUFFER,n.__webglVertexBuffer);d.vertexAttribPointer(r.position,3,d.FLOAT,!1,
0,0);d.bindBuffer(d.ARRAY_BUFFER,n.__webglNormalBuffer);d.vertexAttribPointer(r.normal,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer);d.cullFace(d.FRONT);d.drawElements(d.TRIANGLES,n.__webglFaceCount,d.UNSIGNED_SHORT,0);d.cullFace(d.BACK);d.drawElements(d.TRIANGLES,n.__webglFaceCount,d.UNSIGNED_SHORT,0)}}}d.disable(d.POLYGON_OFFSET_FILL);d.colorMask(!0,!0,!0,!0);d.stencilFunc(d.NOTEQUAL,0,255);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);d.disable(d.DEPTH_TEST);Ka=-1;c=ja.program;
d.useProgram(ja.program);d.uniformMatrix4fv(ja.projectionLocation,!1,$a);d.uniform1f(ja.darknessLocation,ja.darkness);d.bindBuffer(d.ARRAY_BUFFER,ja.vertexBuffer);d.vertexAttribPointer(ja.vertexLocation,3,d.FLOAT,!1,0,0);d.enableVertexAttribArray(ja.vertexLocation);d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA);d.blendEquation(d.FUNC_ADD);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,ja.elementBuffer);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);d.disable(d.STENCIL_TEST);d.enable(d.DEPTH_TEST);d.depthMask(Ga)}
function R(h,I){var o,v,A;o=_sprite.attributes;var f=_sprite.uniforms,n=Ha/Fa,j,k=[],r=Fa*0.5,i=Ha*0.5,t=!0;d.useProgram(_sprite.program);c=_sprite.program;Ka=-1;if(!ka){d.enableVertexAttribArray(_sprite.attributes.position);d.enableVertexAttribArray(_sprite.attributes.uv);ka=!0}d.disable(d.CULL_FACE);d.enable(d.BLEND);d.depthMask(!0);d.bindBuffer(d.ARRAY_BUFFER,_sprite.vertexBuffer);d.vertexAttribPointer(o.position,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(o.uv,2,d.FLOAT,!1,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);d.uniformMatrix4fv(f.projectionMatrix,!1,$a);d.activeTexture(d.TEXTURE0);d.uniform1i(f.map,0);o=0;for(v=h.__webglSprites.length;o<v;o++){A=h.__webglSprites[o];if(A.useScreenCoordinates)A.z=-A.position.z;else{A._modelViewMatrix.multiplyToArray(I.matrixWorldInverse,A.matrixWorld,A._modelViewMatrixArray);A.z=-A._modelViewMatrix.n34}}h.__webglSprites.sort(W);o=0;for(v=h.__webglSprites.length;o<v;o++){A=h.__webglSprites[o];if(A.material===undefined&&A.map&&A.map.image&&A.map.image.width){if(A.useScreenCoordinates){d.uniform1i(f.useScreenCoordinates,
1);d.uniform3f(f.screenPosition,(A.position.x-r)/r,(i-A.position.y)/i,Math.max(0,Math.min(1,A.position.z)))}else{d.uniform1i(f.useScreenCoordinates,0);d.uniform1i(f.affectedByDistance,A.affectedByDistance?1:0);d.uniformMatrix4fv(f.modelViewMatrix,!1,A._modelViewMatrixArray)}j=A.map.image.width/(A.affectedByDistance?1:Ha);k[0]=j*n*A.scale.x;k[1]=j*A.scale.y;d.uniform2f(f.uvScale,A.uvScale.x,A.uvScale.y);d.uniform2f(f.uvOffset,A.uvOffset.x,A.uvOffset.y);d.uniform2f(f.alignment,A.alignment.x,A.alignment.y);
d.uniform1f(f.opacity,A.opacity);d.uniform1f(f.rotation,A.rotation);d.uniform2fv(f.scale,k);if(A.mergeWith3D&&!t){d.enable(d.DEPTH_TEST);t=!0}else if(!A.mergeWith3D&&t){d.disable(d.DEPTH_TEST);t=!1}ra(A.blending);Z(A.map,0);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(Ga)}function aa(h,I){var o,v,A=h.__webglLensFlares.length,f,n,j,k=new THREE.Vector3,r=Ha/Fa,i=Fa*0.5,t=Ha*0.5,s=16/Ha,w=[s*r,s],x=[1,1,0],y=[1,1],F=$.uniforms;o=$.attributes;
d.useProgram($.program);c=$.program;Ka=-1;if(!Gb){d.enableVertexAttribArray($.attributes.vertex);d.enableVertexAttribArray($.attributes.uv);Gb=!0}d.uniform1i(F.occlusionMap,0);d.uniform1i(F.map,1);d.bindBuffer(d.ARRAY_BUFFER,$.vertexBuffer);d.vertexAttribPointer(o.vertex,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(o.uv,2,d.FLOAT,!1,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,$.elementBuffer);d.disable(d.CULL_FACE);d.depthMask(!1);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,$.occlusionTexture);
d.activeTexture(d.TEXTURE1);for(v=0;v<A;v++){o=h.__webglLensFlares[v].object;k.set(o.matrixWorld.n14,o.matrixWorld.n24,o.matrixWorld.n34);I.matrixWorldInverse.multiplyVector3(k);I.projectionMatrix.multiplyVector3(k);x[0]=k.x;x[1]=k.y;x[2]=k.z;y[0]=x[0]*i+i;y[1]=x[1]*t+t;if($.hasVertexTexture||y[0]>0&&y[0]<Fa&&y[1]>0&&y[1]<Ha){d.bindTexture(d.TEXTURE_2D,$.tempTexture);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,y[0]-8,y[1]-8,16,16,0);d.uniform1i(F.renderType,0);d.uniform2fv(F.scale,w);d.uniform3fv(F.screenPosition,
x);d.disable(d.BLEND);d.enable(d.DEPTH_TEST);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);d.bindTexture(d.TEXTURE_2D,$.occlusionTexture);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,y[0]-8,y[1]-8,16,16,0);d.uniform1i(F.renderType,1);d.disable(d.DEPTH_TEST);d.bindTexture(d.TEXTURE_2D,$.tempTexture);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);o.positionScreen.x=x[0];o.positionScreen.y=x[1];o.positionScreen.z=x[2];o.customUpdateCallback?o.customUpdateCallback(o):o.updateLensFlares();d.uniform1i(F.renderType,
2);d.enable(d.BLEND);f=0;for(n=o.lensFlares.length;f<n;f++){j=o.lensFlares[f];if(j.opacity>0.0010&&j.scale>0.0010){x[0]=j.x;x[1]=j.y;x[2]=j.z;s=j.size*j.scale/Ha;w[0]=s*r;w[1]=s;d.uniform3fv(F.screenPosition,x);d.uniform2fv(F.scale,w);d.uniform1f(F.rotation,j.rotation);d.uniform1f(F.opacity,j.opacity);ra(j.blending);Z(j.texture,1);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(Ga)}function da(h,I){h._modelViewMatrix.multiplyToArray(I.matrixWorldInverse,
h.matrixWorld,h._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(h._modelViewMatrix).transposeIntoArray(h._normalMatrixArray)}function X(h){var I,o,v,A,f;if(h instanceof THREE.Mesh){o=h.geometry;for(I in o.geometryGroups){v=o.geometryGroups[I];f=!1;for(A in v.__webglCustomAttributes)if(v.__webglCustomAttributes[A].needsUpdate){f=!0;break}if(o.__dirtyVertices||o.__dirtyMorphTargets||o.__dirtyElements||o.__dirtyUvs||o.__dirtyNormals||o.__dirtyColors||o.__dirtyTangents||f){f=h;var n=d.DYNAMIC_DRAW;
if(v.__inittedArrays){var j=void 0,k=void 0,r=void 0,i=void 0;r=void 0;var t=void 0,s=void 0,w=void 0,x=void 0,y=void 0,F=void 0,D=void 0,T=void 0,U=void 0,V=void 0,N=void 0,Y=void 0,la=void 0;s=void 0;w=void 0;i=void 0;x=void 0;i=void 0;var E=void 0,K=void 0;s=void 0;E=void 0;K=void 0;var p=void 0,ca=void 0;E=void 0;K=void 0;p=void 0;ca=void 0;E=void 0;K=void 0;p=void 0;ca=void 0;E=void 0;K=void 0;p=void 0;i=void 0;x=void 0;t=void 0;r=void 0;r=void 0;E=void 0;K=void 0;p=void 0;var Aa=void 0,C=0,
O=0,u=0,Va=0,Ra=0,ua=0,ga=0,Wa=0,Na=0,L=0,ya=0;K=E=0;var ha=v.__vertexArray,ab=v.__uvArray,Qa=v.__uv2Array,M=v.__normalArray,ia=v.__tangentArray,oa=v.__colorArray,Da=v.__skinVertexAArray,Ea=v.__skinVertexBArray,sa=v.__skinIndexArray,ea=v.__skinWeightArray,Ta=v.__morphTargetsArrays,ta=v.__webglCustomAttributes;p=void 0;var na=v.__faceArray,pa=v.__lineArray,Oa=v.__needsSmoothNormals;F=v.__vertexColorType;y=v.__uvType;D=v.__normalType;var Xa=f.geometry,gb=Xa.__dirtyVertices,cb=Xa.__dirtyElements,bb=
Xa.__dirtyUvs,Ab=Xa.__dirtyNormals,Ya=Xa.__dirtyTangents,ub=Xa.__dirtyColors,vb=Xa.__dirtyMorphTargets,lb=Xa.vertices,Bb=v.faces,Fb=Xa.faces,Cb=Xa.faceVertexUvs[0],Db=Xa.faceVertexUvs[1],kb=Xa.skinVerticesA,qb=Xa.skinVerticesB,rb=Xa.skinIndices,ob=Xa.skinWeights,pb=f instanceof THREE.ShadowVolume?Xa.edgeFaces:undefined;morphTargets=Xa.morphTargets;if(ta)for(Aa in ta){ta[Aa].offset=0;ta[Aa].offsetSrc=0}j=0;for(k=Bb.length;j<k;j++){r=Bb[j];i=Fb[r];Cb&&(T=Cb[r]);Db&&(U=Db[r]);r=i.vertexNormals;t=i.normal;
s=i.vertexColors;w=i.color;x=i.vertexTangents;if(i instanceof THREE.Face3){if(gb){V=lb[i.a].position;N=lb[i.b].position;Y=lb[i.c].position;ha[O]=V.x;ha[O+1]=V.y;ha[O+2]=V.z;ha[O+3]=N.x;ha[O+4]=N.y;ha[O+5]=N.z;ha[O+6]=Y.x;ha[O+7]=Y.y;ha[O+8]=Y.z;O+=9}if(ta)for(Aa in ta){p=ta[Aa];if(p.needsUpdate){E=p.offset;K=p.offsetSrc;if(p.size===1){if(p.boundTo===undefined||p.boundTo==="vertices"){p.array[E+0]=p.value[i.a];p.array[E+1]=p.value[i.b];p.array[E+2]=p.value[i.c]}else if(p.boundTo==="faces"){p.array[E+
0]=p.value[K];p.array[E+1]=p.value[K];p.array[E+2]=p.value[K];p.offsetSrc++}else if(p.boundTo==="faceVertices"){p.array[E+0]=p.value[K+0];p.array[E+1]=p.value[K+1];p.array[E+2]=p.value[K+2];p.offsetSrc+=3}p.offset+=3}else{if(p.boundTo===undefined||p.boundTo==="vertices"){V=p.value[i.a];N=p.value[i.b];Y=p.value[i.c]}else if(p.boundTo==="faces"){V=p.value[K];N=p.value[K];Y=p.value[K];p.offsetSrc++}else if(p.boundTo==="faceVertices"){V=p.value[K+0];N=p.value[K+1];Y=p.value[K+2];p.offsetSrc+=3}if(p.size===
2){p.array[E+0]=V.x;p.array[E+1]=V.y;p.array[E+2]=N.x;p.array[E+3]=N.y;p.array[E+4]=Y.x;p.array[E+5]=Y.y;p.offset+=6}else if(p.size===3){if(p.type==="c"){p.array[E+0]=V.r;p.array[E+1]=V.g;p.array[E+2]=V.b;p.array[E+3]=N.r;p.array[E+4]=N.g;p.array[E+5]=N.b;p.array[E+6]=Y.r;p.array[E+7]=Y.g;p.array[E+8]=Y.b}else{p.array[E+0]=V.x;p.array[E+1]=V.y;p.array[E+2]=V.z;p.array[E+3]=N.x;p.array[E+4]=N.y;p.array[E+5]=N.z;p.array[E+6]=Y.x;p.array[E+7]=Y.y;p.array[E+8]=Y.z}p.offset+=9}else{p.array[E+0]=V.x;p.array[E+
1]=V.y;p.array[E+2]=V.z;p.array[E+3]=V.w;p.array[E+4]=N.x;p.array[E+5]=N.y;p.array[E+6]=N.z;p.array[E+7]=N.w;p.array[E+8]=Y.x;p.array[E+9]=Y.y;p.array[E+10]=Y.z;p.array[E+11]=Y.w;p.offset+=12}}}}if(vb){E=0;for(K=morphTargets.length;E<K;E++){V=morphTargets[E].vertices[i.a].position;N=morphTargets[E].vertices[i.b].position;Y=morphTargets[E].vertices[i.c].position;p=Ta[E];p[ya+0]=V.x;p[ya+1]=V.y;p[ya+2]=V.z;p[ya+3]=N.x;p[ya+4]=N.y;p[ya+5]=N.z;p[ya+6]=Y.x;p[ya+7]=Y.y;p[ya+8]=Y.z}ya+=9}if(ob.length){E=
ob[i.a];K=ob[i.b];p=ob[i.c];ea[L]=E.x;ea[L+1]=E.y;ea[L+2]=E.z;ea[L+3]=E.w;ea[L+4]=K.x;ea[L+5]=K.y;ea[L+6]=K.z;ea[L+7]=K.w;ea[L+8]=p.x;ea[L+9]=p.y;ea[L+10]=p.z;ea[L+11]=p.w;E=rb[i.a];K=rb[i.b];p=rb[i.c];sa[L]=E.x;sa[L+1]=E.y;sa[L+2]=E.z;sa[L+3]=E.w;sa[L+4]=K.x;sa[L+5]=K.y;sa[L+6]=K.z;sa[L+7]=K.w;sa[L+8]=p.x;sa[L+9]=p.y;sa[L+10]=p.z;sa[L+11]=p.w;E=kb[i.a];K=kb[i.b];p=kb[i.c];Da[L]=E.x;Da[L+1]=E.y;Da[L+2]=E.z;Da[L+3]=1;Da[L+4]=K.x;Da[L+5]=K.y;Da[L+6]=K.z;Da[L+7]=1;Da[L+8]=p.x;Da[L+9]=p.y;Da[L+10]=p.z;
Da[L+11]=1;E=qb[i.a];K=qb[i.b];p=qb[i.c];Ea[L]=E.x;Ea[L+1]=E.y;Ea[L+2]=E.z;Ea[L+3]=1;Ea[L+4]=K.x;Ea[L+5]=K.y;Ea[L+6]=K.z;Ea[L+7]=1;Ea[L+8]=p.x;Ea[L+9]=p.y;Ea[L+10]=p.z;Ea[L+11]=1;L+=12}if(ub&&F){if(s.length==3&&F==THREE.VertexColors){i=s[0];E=s[1];K=s[2]}else K=E=i=w;oa[Na]=i.r;oa[Na+1]=i.g;oa[Na+2]=i.b;oa[Na+3]=E.r;oa[Na+4]=E.g;oa[Na+5]=E.b;oa[Na+6]=K.r;oa[Na+7]=K.g;oa[Na+8]=K.b;Na+=9}if(Ya&&Xa.hasTangents){s=x[0];w=x[1];i=x[2];ia[ga]=s.x;ia[ga+1]=s.y;ia[ga+2]=s.z;ia[ga+3]=s.w;ia[ga+4]=w.x;ia[ga+
5]=w.y;ia[ga+6]=w.z;ia[ga+7]=w.w;ia[ga+8]=i.x;ia[ga+9]=i.y;ia[ga+10]=i.z;ia[ga+11]=i.w;ga+=12}if(Ab&&D)if(r.length==3&&Oa)for(x=0;x<3;x++){t=r[x];M[ua]=t.x;M[ua+1]=t.y;M[ua+2]=t.z;ua+=3}else for(x=0;x<3;x++){M[ua]=t.x;M[ua+1]=t.y;M[ua+2]=t.z;ua+=3}if(bb&&T!==undefined&&y)for(x=0;x<3;x++){r=T[x];ab[u]=r.u;ab[u+1]=r.v;u+=2}if(bb&&U!==undefined&&y)for(x=0;x<3;x++){r=U[x];Qa[Va]=r.u;Qa[Va+1]=r.v;Va+=2}if(cb){na[Ra]=C;na[Ra+1]=C+1;na[Ra+2]=C+2;Ra+=3;pa[Wa]=C;pa[Wa+1]=C+1;pa[Wa+2]=C;pa[Wa+3]=C+2;pa[Wa+
4]=C+1;pa[Wa+5]=C+2;Wa+=6;C+=3}}else if(i instanceof THREE.Face4){if(gb){V=lb[i.a].position;N=lb[i.b].position;Y=lb[i.c].position;la=lb[i.d].position;ha[O]=V.x;ha[O+1]=V.y;ha[O+2]=V.z;ha[O+3]=N.x;ha[O+4]=N.y;ha[O+5]=N.z;ha[O+6]=Y.x;ha[O+7]=Y.y;ha[O+8]=Y.z;ha[O+9]=la.x;ha[O+10]=la.y;ha[O+11]=la.z;O+=12}if(ta)for(Aa in ta){p=ta[Aa];if(p.needsUpdate){E=p.offset;K=p.offsetSrc;if(p.size===1){if(p.boundTo===undefined||p.boundTo==="vertices"){p.array[E+0]=p.value[i.a];p.array[E+1]=p.value[i.b];p.array[E+
2]=p.value[i.c];p.array[E+3]=p.value[i.d]}else if(p.boundTo==="faces"){p.array[E+0]=p.value[K];p.array[E+1]=p.value[K];p.array[E+2]=p.value[K];p.array[E+3]=p.value[K];p.offsetSrc++}else if(p.boundTo==="faceVertices"){p.array[E+0]=p.value[K+0];p.array[E+1]=p.value[K+1];p.array[E+2]=p.value[K+2];p.array[E+3]=p.value[K+3];p.offsetSrc+=4}p.offset+=4}else{if(p.boundTo===undefined||p.boundTo==="vertices"){V=p.value[i.a];N=p.value[i.b];Y=p.value[i.c];la=p.value[i.d]}else if(p.boundTo==="faces"){V=p.value[K];
N=p.value[K];Y=p.value[K];la=p.value[K];p.offsetSrc++}else if(p.boundTo==="faceVertices"){V=p.value[K+0];N=p.value[K+1];Y=p.value[K+2];la=p.value[K+3];p.offsetSrc+=4}if(p.size===2){p.array[E+0]=V.x;p.array[E+1]=V.y;p.array[E+2]=N.x;p.array[E+3]=N.y;p.array[E+4]=Y.x;p.array[E+5]=Y.y;p.array[E+6]=la.x;p.array[E+7]=la.y;p.offset+=8}else if(p.size===3){if(p.type==="c"){p.array[E+0]=V.r;p.array[E+1]=V.g;p.array[E+2]=V.b;p.array[E+3]=N.r;p.array[E+4]=N.g;p.array[E+5]=N.b;p.array[E+6]=Y.r;p.array[E+7]=Y.g;
p.array[E+8]=Y.b;p.array[E+9]=la.r;p.array[E+10]=la.g;p.array[E+11]=la.b}else{p.array[E+0]=V.x;p.array[E+1]=V.y;p.array[E+2]=V.z;p.array[E+3]=N.x;p.array[E+4]=N.y;p.array[E+5]=N.z;p.array[E+6]=Y.x;p.array[E+7]=Y.y;p.array[E+8]=Y.z;p.array[E+9]=la.x;p.array[E+10]=la.y;p.array[E+11]=la.z}p.offset+=12}else{p.array[E+0]=V.x;p.array[E+1]=V.y;p.array[E+2]=V.z;p.array[E+3]=V.w;p.array[E+4]=N.x;p.array[E+5]=N.y;p.array[E+6]=N.z;p.array[E+7]=N.w;p.array[E+8]=Y.x;p.array[E+9]=Y.y;p.array[E+10]=Y.z;p.array[E+
11]=Y.w;p.array[E+12]=la.x;p.array[E+13]=la.y;p.array[E+14]=la.z;p.array[E+15]=la.w;p.offset+=16}}}}if(vb){E=0;for(K=morphTargets.length;E<K;E++){V=morphTargets[E].vertices[i.a].position;N=morphTargets[E].vertices[i.b].position;Y=morphTargets[E].vertices[i.c].position;la=morphTargets[E].vertices[i.d].position;p=Ta[E];p[ya+0]=V.x;p[ya+1]=V.y;p[ya+2]=V.z;p[ya+3]=N.x;p[ya+4]=N.y;p[ya+5]=N.z;p[ya+6]=Y.x;p[ya+7]=Y.y;p[ya+8]=Y.z;p[ya+9]=la.x;p[ya+10]=la.y;p[ya+11]=la.z}ya+=12}if(ob.length){E=ob[i.a];K=
ob[i.b];p=ob[i.c];ca=ob[i.d];ea[L]=E.x;ea[L+1]=E.y;ea[L+2]=E.z;ea[L+3]=E.w;ea[L+4]=K.x;ea[L+5]=K.y;ea[L+6]=K.z;ea[L+7]=K.w;ea[L+8]=p.x;ea[L+9]=p.y;ea[L+10]=p.z;ea[L+11]=p.w;ea[L+12]=ca.x;ea[L+13]=ca.y;ea[L+14]=ca.z;ea[L+15]=ca.w;E=rb[i.a];K=rb[i.b];p=rb[i.c];ca=rb[i.d];sa[L]=E.x;sa[L+1]=E.y;sa[L+2]=E.z;sa[L+3]=E.w;sa[L+4]=K.x;sa[L+5]=K.y;sa[L+6]=K.z;sa[L+7]=K.w;sa[L+8]=p.x;sa[L+9]=p.y;sa[L+10]=p.z;sa[L+11]=p.w;sa[L+12]=ca.x;sa[L+13]=ca.y;sa[L+14]=ca.z;sa[L+15]=ca.w;E=kb[i.a];K=kb[i.b];p=kb[i.c];ca=
kb[i.d];Da[L]=E.x;Da[L+1]=E.y;Da[L+2]=E.z;Da[L+3]=1;Da[L+4]=K.x;Da[L+5]=K.y;Da[L+6]=K.z;Da[L+7]=1;Da[L+8]=p.x;Da[L+9]=p.y;Da[L+10]=p.z;Da[L+11]=1;Da[L+12]=ca.x;Da[L+13]=ca.y;Da[L+14]=ca.z;Da[L+15]=1;E=qb[i.a];K=qb[i.b];p=qb[i.c];i=qb[i.d];Ea[L]=E.x;Ea[L+1]=E.y;Ea[L+2]=E.z;Ea[L+3]=1;Ea[L+4]=K.x;Ea[L+5]=K.y;Ea[L+6]=K.z;Ea[L+7]=1;Ea[L+8]=p.x;Ea[L+9]=p.y;Ea[L+10]=p.z;Ea[L+11]=1;Ea[L+12]=i.x;Ea[L+13]=i.y;Ea[L+14]=i.z;Ea[L+15]=1;L+=16}if(ub&&F){if(s.length==4&&F==THREE.VertexColors){i=s[0];E=s[1];K=s[2];
s=s[3]}else s=K=E=i=w;oa[Na]=i.r;oa[Na+1]=i.g;oa[Na+2]=i.b;oa[Na+3]=E.r;oa[Na+4]=E.g;oa[Na+5]=E.b;oa[Na+6]=K.r;oa[Na+7]=K.g;oa[Na+8]=K.b;oa[Na+9]=s.r;oa[Na+10]=s.g;oa[Na+11]=s.b;Na+=12}if(Ya&&Xa.hasTangents){s=x[0];w=x[1];i=x[2];x=x[3];ia[ga]=s.x;ia[ga+1]=s.y;ia[ga+2]=s.z;ia[ga+3]=s.w;ia[ga+4]=w.x;ia[ga+5]=w.y;ia[ga+6]=w.z;ia[ga+7]=w.w;ia[ga+8]=i.x;ia[ga+9]=i.y;ia[ga+10]=i.z;ia[ga+11]=i.w;ia[ga+12]=x.x;ia[ga+13]=x.y;ia[ga+14]=x.z;ia[ga+15]=x.w;ga+=16}if(Ab&&D)if(r.length==4&&Oa)for(x=0;x<4;x++){t=
r[x];M[ua]=t.x;M[ua+1]=t.y;M[ua+2]=t.z;ua+=3}else for(x=0;x<4;x++){M[ua]=t.x;M[ua+1]=t.y;M[ua+2]=t.z;ua+=3}if(bb&&T!==undefined&&y)for(x=0;x<4;x++){r=T[x];ab[u]=r.u;ab[u+1]=r.v;u+=2}if(bb&&U!==undefined&&y)for(x=0;x<4;x++){r=U[x];Qa[Va]=r.u;Qa[Va+1]=r.v;Va+=2}if(cb){na[Ra]=C;na[Ra+1]=C+1;na[Ra+2]=C+3;na[Ra+3]=C+1;na[Ra+4]=C+2;na[Ra+5]=C+3;Ra+=6;pa[Wa]=C;pa[Wa+1]=C+1;pa[Wa+2]=C;pa[Wa+3]=C+3;pa[Wa+4]=C+1;pa[Wa+5]=C+2;pa[Wa+6]=C+2;pa[Wa+7]=C+3;Wa+=8;C+=4}}}if(pb){j=0;for(k=pb.length;j<k;j++){na[Ra]=
pb[j].a;na[Ra+1]=pb[j].b;na[Ra+2]=pb[j].c;na[Ra+3]=pb[j].a;na[Ra+4]=pb[j].c;na[Ra+5]=pb[j].d;Ra+=6}}if(gb){d.bindBuffer(d.ARRAY_BUFFER,v.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,ha,n)}if(ta)for(Aa in ta){p=ta[Aa];if(p.needsUpdate){d.bindBuffer(d.ARRAY_BUFFER,p.buffer);d.bufferData(d.ARRAY_BUFFER,p.array,n);p.needsUpdate=!1}}if(vb){E=0;for(K=morphTargets.length;E<K;E++){d.bindBuffer(d.ARRAY_BUFFER,v.__webglMorphTargetsBuffers[E]);d.bufferData(d.ARRAY_BUFFER,Ta[E],n)}}if(ub&&Na>0){d.bindBuffer(d.ARRAY_BUFFER,
v.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,oa,n)}if(Ab){d.bindBuffer(d.ARRAY_BUFFER,v.__webglNormalBuffer);d.bufferData(d.ARRAY_BUFFER,M,n)}if(Ya&&Xa.hasTangents){d.bindBuffer(d.ARRAY_BUFFER,v.__webglTangentBuffer);d.bufferData(d.ARRAY_BUFFER,ia,n)}if(bb&&u>0){d.bindBuffer(d.ARRAY_BUFFER,v.__webglUVBuffer);d.bufferData(d.ARRAY_BUFFER,ab,n)}if(bb&&Va>0){d.bindBuffer(d.ARRAY_BUFFER,v.__webglUV2Buffer);d.bufferData(d.ARRAY_BUFFER,Qa,n)}if(cb){d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,v.__webglFaceBuffer);
d.bufferData(d.ELEMENT_ARRAY_BUFFER,na,n);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,v.__webglLineBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,pa,n)}if(L>0){d.bindBuffer(d.ARRAY_BUFFER,v.__webglSkinVertexABuffer);d.bufferData(d.ARRAY_BUFFER,Da,n);d.bindBuffer(d.ARRAY_BUFFER,v.__webglSkinVertexBBuffer);d.bufferData(d.ARRAY_BUFFER,Ea,n);d.bindBuffer(d.ARRAY_BUFFER,v.__webglSkinIndicesBuffer);d.bufferData(d.ARRAY_BUFFER,sa,n);d.bindBuffer(d.ARRAY_BUFFER,v.__webglSkinWeightsBuffer);d.bufferData(d.ARRAY_BUFFER,
ea,n)}if(!f.dynamic){delete v.__inittedArrays;delete v.__colorArray;delete v.__normalArray;delete v.__tangentArray;delete v.__uvArray;delete v.__uv2Array;delete v.__faceArray;delete v.__vertexArray;delete v.__lineArray;delete v.__skinVertexAArray;delete v.__skinVertexBArray;delete v.__skinIndexArray;delete v.__skinWeightArray}}}}o.__dirtyVertices=!1;o.__dirtyMorphTargets=!1;o.__dirtyElements=!1;o.__dirtyUvs=!1;o.__dirtyNormals=!1;o.__dirtyTangents=!1;o.__dirtyColors=!1}else if(h instanceof THREE.Ribbon){o=
h.geometry;if(o.__dirtyVertices||o.__dirtyColors){h=o;I=d.DYNAMIC_DRAW;y=h.vertices;v=h.colors;F=y.length;f=v.length;D=h.__vertexArray;n=h.__colorArray;T=h.__dirtyColors;if(h.__dirtyVertices){for(j=0;j<F;j++){k=y[j].position;A=j*3;D[A]=k.x;D[A+1]=k.y;D[A+2]=k.z}d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,D,I)}if(T){for(j=0;j<f;j++){color=v[j];A=j*3;n[A]=color.r;n[A+1]=color.g;n[A+2]=color.b}d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,
n,I)}}o.__dirtyVertices=!1;o.__dirtyColors=!1}else if(h instanceof THREE.Line){o=h.geometry;if(o.__dirtyVertices||o.__dirtyColors){h=o;I=d.DYNAMIC_DRAW;y=h.vertices;v=h.colors;F=y.length;f=v.length;D=h.__vertexArray;n=h.__colorArray;T=h.__dirtyColors;if(h.__dirtyVertices){for(j=0;j<F;j++){k=y[j].position;A=j*3;D[A]=k.x;D[A+1]=k.y;D[A+2]=k.z}d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,D,I)}if(T){for(j=0;j<f;j++){color=v[j];A=j*3;n[A]=color.r;n[A+1]=color.g;n[A+2]=
color.b}d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,n,I)}}o.__dirtyVertices=!1;o.__dirtyColors=!1}else if(h instanceof THREE.ParticleSystem){o=h.geometry;(o.__dirtyVertices||o.__dirtyColors||h.sortParticles)&&e(o,d.DYNAMIC_DRAW,h);o.__dirtyVertices=!1;o.__dirtyColors=!1}}function Ba(h){function I(s){var w=[];o=0;for(v=s.length;o<v;o++)s[o]==undefined?w.push("undefined"):w.push(s[o].id);return w.join("_")}var o,v,A,f,n,j,k,r,i={},t=h.morphTargets!==undefined?h.morphTargets.length:
0;h.geometryGroups={};A=0;for(f=h.faces.length;A<f;A++){n=h.faces[A];j=n.materials;k=I(j);i[k]==undefined&&(i[k]={hash:k,counter:0});r=i[k].hash+"_"+i[k].counter;h.geometryGroups[r]==undefined&&(h.geometryGroups[r]={faces:[],materials:j,vertices:0,numMorphTargets:t});n=n instanceof THREE.Face3?3:4;if(h.geometryGroups[r].vertices+n>65535){i[k].counter+=1;r=i[k].hash+"_"+i[k].counter;h.geometryGroups[r]==undefined&&(h.geometryGroups[r]={faces:[],materials:j,vertices:0,numMorphTargets:t})}h.geometryGroups[r].faces.push(A);
h.geometryGroups[r].vertices+=n}}function qa(h,I,o){h.push({buffer:I,object:o,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function ra(h){if(h!=Ka){switch(h){case THREE.AdditiveBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE);break;case THREE.SubtractiveBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.ZERO,d.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:d.blendEquationSeparate(d.FUNC_ADD,
d.FUNC_ADD);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)}Ka=h}}function ma(h,I,o){if((o.width&o.width-1)==0&&(o.height&o.height-1)==0){d.texParameteri(h,d.TEXTURE_WRAP_S,Ma(I.wrapS));d.texParameteri(h,d.TEXTURE_WRAP_T,Ma(I.wrapT));d.texParameteri(h,d.TEXTURE_MAG_FILTER,Ma(I.magFilter));d.texParameteri(h,d.TEXTURE_MIN_FILTER,Ma(I.minFilter));d.generateMipmap(h)}else{d.texParameteri(h,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(h,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);
d.texParameteri(h,d.TEXTURE_MAG_FILTER,Ja(I.magFilter));d.texParameteri(h,d.TEXTURE_MIN_FILTER,Ja(I.minFilter))}}function Z(h,I){if(h.needsUpdate){if(h.__webglTexture)h.__webglTexture=d.deleteTexture(h.__webglTexture);h.__webglTexture=d.createTexture();d.bindTexture(d.TEXTURE_2D,h.__webglTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,h.image);ma(d.TEXTURE_2D,h,h.image);d.bindTexture(d.TEXTURE_2D,null);h.needsUpdate=!1}d.activeTexture(d.TEXTURE0+I);d.bindTexture(d.TEXTURE_2D,h.__webglTexture)}
function Za(h){if(h&&!h.__webglFramebuffer){if(h.depthBuffer===undefined)h.depthBuffer=!0;if(h.stencilBuffer===undefined)h.stencilBuffer=!0;h.__webglFramebuffer=d.createFramebuffer();h.__webglRenderbuffer=d.createRenderbuffer();h.__webglTexture=d.createTexture();d.bindTexture(d.TEXTURE_2D,h.__webglTexture);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,Ma(h.wrapS));d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,Ma(h.wrapT));d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,Ma(h.magFilter));d.texParameteri(d.TEXTURE_2D,
d.TEXTURE_MIN_FILTER,Ma(h.minFilter));d.texImage2D(d.TEXTURE_2D,0,Ma(h.format),h.width,h.height,0,Ma(h.format),Ma(h.type),null);d.bindRenderbuffer(d.RENDERBUFFER,h.__webglRenderbuffer);d.bindFramebuffer(d.FRAMEBUFFER,h.__webglFramebuffer);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,h.__webglTexture,0);if(h.depthBuffer&&!h.stencilBuffer){d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,h.width,h.height);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,
h.__webglRenderbuffer)}else if(h.depthBuffer&&h.stencilBuffer){d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,h.width,h.height);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,h.__webglRenderbuffer)}else d.renderbufferStorage(d.RENDERBUFFER,d.RGBA4,h.width,h.height);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)}var I,o;if(h){I=h.__webglFramebuffer;o=h.width;h=h.height}else{I=null;o=Fa;h=Ha}if(I!=
Ua){d.bindFramebuffer(d.FRAMEBUFFER,I);d.viewport(xa,Sa,o,h);Ua=I}}function Ca(h,I){var o;if(h=="fragment")o=d.createShader(d.FRAGMENT_SHADER);else h=="vertex"&&(o=d.createShader(d.VERTEX_SHADER));d.shaderSource(o,I);d.compileShader(o);if(!d.getShaderParameter(o,d.COMPILE_STATUS)){console.error(d.getShaderInfoLog(o));console.error(I);return null}return o}function Ja(h){switch(h){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return d.NEAREST;default:return d.LINEAR}}
function Ma(h){switch(h){case THREE.RepeatWrapping:return d.REPEAT;case THREE.ClampToEdgeWrapping:return d.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return d.MIRRORED_REPEAT;case THREE.NearestFilter:return d.NEAREST;case THREE.NearestMipMapNearestFilter:return d.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return d.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return d.LINEAR;case THREE.LinearMipMapNearestFilter:return d.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return d.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return d.BYTE;case THREE.UnsignedByteType:return d.UNSIGNED_BYTE;case THREE.ShortType:return d.SHORT;case THREE.UnsignedShortType:return d.UNSIGNED_SHORT;case THREE.IntType:return d.INT;case THREE.UnsignedShortType:return d.UNSIGNED_INT;case THREE.FloatType:return d.FLOAT;case THREE.AlphaFormat:return d.ALPHA;case THREE.RGBFormat:return d.RGB;case THREE.RGBAFormat:return d.RGBA;case THREE.LuminanceFormat:return d.LUMINANCE;case THREE.LuminanceAlphaFormat:return d.LUMINANCE_ALPHA}return 0}
var fa=this,d,za=[],c=null,Ua=null,Ga=!0,wa=null,Pa=null,Ka=null,La=null,xa=0,Sa=0,Fa=0,Ha=0,Ia=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],va=new THREE.Matrix4,$a=new Float32Array(16),eb=new Float32Array(16),ib=new THREE.Vector4,jb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};var db=b.canvas!==undefined?b.canvas:document.createElement("canvas"),fb=b.stencil!==
undefined?b.stencil:!0,nb=b.antialias!==undefined?b.antialias:!1,mb=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0),hb=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=db;this.autoClear=!0;this.sortObjects=!0;try{if(!(d=db.getContext("experimental-webgl",{antialias:nb,stencil:fb})))throw"Error creating WebGL context.";}catch(zb){console.error(zb)}console.log(navigator.userAgent+" | "+d.getParameter(d.VERSION)+
" | "+d.getParameter(d.VENDOR)+" | "+d.getParameter(d.RENDERER)+" | "+d.getParameter(d.SHADING_LANGUAGE_VERSION));d.clearColor(0,0,0,1);d.clearDepth(1);d.enable(d.DEPTH_TEST);d.depthFunc(d.LEQUAL);d.frontFace(d.CCW);d.cullFace(d.BACK);d.enable(d.CULL_FACE);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.clearColor(mb.r,mb.g,mb.b,hb);this.context=d;var Eb=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(fb){var ja={};ja.vertices=new Float32Array(12);
ja.faces=new Uint16Array(6);ja.darkness=0.5;ja.vertices[0]=-20;ja.vertices[1]=-20;ja.vertices[2]=-1;ja.vertices[3]=20;ja.vertices[4]=-20;ja.vertices[5]=-1;ja.vertices[6]=20;ja.vertices[7]=20;ja.vertices[8]=-1;ja.vertices[9]=-20;ja.vertices[10]=20;ja.vertices[11]=-1;ja.faces[0]=0;ja.faces[1]=1;ja.faces[2]=2;ja.faces[3]=0;ja.faces[4]=2;ja.faces[5]=3;ja.vertexBuffer=d.createBuffer();ja.elementBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,ja.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,ja.vertices,
d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,ja.elementBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,ja.faces,d.STATIC_DRAW);ja.program=d.createProgram();d.attachShader(ja.program,Ca("fragment",THREE.ShaderLib.shadowPost.fragmentShader));d.attachShader(ja.program,Ca("vertex",THREE.ShaderLib.shadowPost.vertexShader));d.linkProgram(ja.program);ja.vertexLocation=d.getAttribLocation(ja.program,"position");ja.projectionLocation=d.getUniformLocation(ja.program,"projectionMatrix");ja.darknessLocation=
d.getUniformLocation(ja.program,"darkness")}var $={};$.vertices=new Float32Array(16);$.faces=new Uint16Array(6);b=0;$.vertices[b++]=-1;$.vertices[b++]=-1;$.vertices[b++]=0;$.vertices[b++]=0;$.vertices[b++]=1;$.vertices[b++]=-1;$.vertices[b++]=1;$.vertices[b++]=0;$.vertices[b++]=1;$.vertices[b++]=1;$.vertices[b++]=1;$.vertices[b++]=1;$.vertices[b++]=-1;$.vertices[b++]=1;$.vertices[b++]=0;$.vertices[b++]=1;b=0;$.faces[b++]=0;$.faces[b++]=1;$.faces[b++]=2;$.faces[b++]=0;$.faces[b++]=2;$.faces[b++]=3;
$.vertexBuffer=d.createBuffer();$.elementBuffer=d.createBuffer();$.tempTexture=d.createTexture();$.occlusionTexture=d.createTexture();d.bindBuffer(d.ARRAY_BUFFER,$.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,$.vertices,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,$.elementBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,$.faces,d.STATIC_DRAW);d.bindTexture(d.TEXTURE_2D,$.tempTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,
d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.bindTexture(d.TEXTURE_2D,$.occlusionTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);if(d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){$.hasVertexTexture=!1;$.program=d.createProgram();d.attachShader($.program,Ca("fragment",THREE.ShaderLib.lensFlare.fragmentShader));d.attachShader($.program,Ca("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{$.hasVertexTexture=!0;$.program=d.createProgram();d.attachShader($.program,Ca("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));d.attachShader($.program,
Ca("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}d.linkProgram($.program);$.attributes={};$.uniforms={};$.attributes.vertex=d.getAttribLocation($.program,"position");$.attributes.uv=d.getAttribLocation($.program,"UV");$.uniforms.renderType=d.getUniformLocation($.program,"renderType");$.uniforms.map=d.getUniformLocation($.program,"map");$.uniforms.occlusionMap=d.getUniformLocation($.program,"occlusionMap");$.uniforms.opacity=d.getUniformLocation($.program,"opacity");$.uniforms.scale=
d.getUniformLocation($.program,"scale");$.uniforms.rotation=d.getUniformLocation($.program,"rotation");$.uniforms.screenPosition=d.getUniformLocation($.program,"screenPosition");var Gb=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=d.createBuffer();_sprite.elementBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,_sprite.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,_sprite.vertices,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);
d.bufferData(d.ELEMENT_ARRAY_BUFFER,_sprite.faces,d.STATIC_DRAW);_sprite.program=d.createProgram();d.attachShader(_sprite.program,Ca("fragment",THREE.ShaderLib.sprite.fragmentShader));d.attachShader(_sprite.program,Ca("vertex",THREE.ShaderLib.sprite.vertexShader));d.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=d.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=d.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=
d.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=d.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=d.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=d.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=d.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=d.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=d.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=
d.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=d.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=d.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=d.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=d.getUniformLocation(_sprite.program,"projectionMatrix");var ka=!1;this.setSize=function(h,I){db.width=h;db.height=I;this.setViewport(0,
0,db.width,db.height)};this.setViewport=function(h,I,o,v){xa=h;Sa=I;Fa=o;Ha=v;d.viewport(xa,Sa,Fa,Ha)};this.setScissor=function(h,I,o,v){d.scissor(h,I,o,v)};this.enableScissorTest=function(h){h?d.enable(d.SCISSOR_TEST):d.disable(d.SCISSOR_TEST)};this.enableDepthBufferWrite=function(h){Ga=h;d.depthMask(h)};this.setClearColorHex=function(h,I){mb.setHex(h);hb=I;d.clearColor(mb.r,mb.g,mb.b,hb)};this.setClearColor=function(h,I){mb.copy(h);hb=I;d.clearColor(mb.r,mb.g,mb.b,hb)};this.clear=function(){d.clear(d.COLOR_BUFFER_BIT|
d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(h){ja.darkness=h};this.getContext=function(){return d};this.initMaterial=function(h,I,o,v){var A,f,n;if(h instanceof THREE.MeshDepthMaterial)n="depth";else if(h instanceof THREE.ShadowVolumeDynamicMaterial)n="shadowVolumeDynamic";else if(h instanceof THREE.MeshNormalMaterial)n="normal";else if(h instanceof THREE.MeshBasicMaterial)n="basic";else if(h instanceof THREE.MeshLambertMaterial)n="lambert";else if(h instanceof
THREE.MeshPhongMaterial)n="phong";else if(h instanceof THREE.LineBasicMaterial)n="basic";else h instanceof THREE.ParticleBasicMaterial&&(n="particle_basic");if(n){var j=THREE.ShaderLib[n];h.uniforms=THREE.UniformsUtils.clone(j.uniforms);h.vertexShader=j.vertexShader;h.fragmentShader=j.fragmentShader}var k,r,i;k=i=j=0;for(r=I.length;k<r;k++){f=I[k];f instanceof THREE.DirectionalLight&&i++;f instanceof THREE.PointLight&&j++}if(j+i<=4)I=i;else{I=Math.ceil(4*i/(j+i));j=4-I}f={directional:I,point:j};i=
50;if(v!==undefined&&v instanceof THREE.SkinnedMesh)i=v.bones.length;var t;a:{k=h.fragmentShader;r=h.vertexShader;j=h.uniforms;I=h.attributes;o={map:!!h.map,envMap:!!h.envMap,lightMap:!!h.lightMap,vertexColors:h.vertexColors,fog:o,sizeAttenuation:h.sizeAttenuation,skinning:h.skinning,morphTargets:h.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:f.directional,maxPointLights:f.point,maxBones:i};var s;f=[];if(n)f.push(n);else{f.push(k);f.push(r)}for(s in o){f.push(s);f.push(o[s])}n=f.join();
s=0;for(f=za.length;s<f;s++)if(za[s].code==n){t=za[s].program;break a}s=d.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,o.fog?"#define USE_FOG":"",o.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
prefix_vertex=[Eb?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_BONES "+o.maxBones,o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.vertexColors?"#define USE_COLOR":"",o.skinning?"#define USE_SKINNING":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
d.attachShader(s,Ca("fragment",prefix_fragment+k));d.attachShader(s,Ca("vertex",prefix_vertex+r));d.linkProgram(s);d.getProgramParameter(s,d.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+d.getProgramParameter(s,d.VALIDATE_STATUS)+", gl error ["+d.getError()+"]");s.uniforms={};s.attributes={};var w;k=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(w in j)k.push(w);
w=k;j=0;for(k=w.length;j<k;j++){r=w[j];s.uniforms[r]=d.getUniformLocation(s,r)}k=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(w=0;w<o.maxMorphTargets;w++)k.push("morphTarget"+w);for(t in I)k.push(t);t=k;w=0;for(I=t.length;w<I;w++){o=t[w];s.attributes[o]=d.getAttribLocation(s,o)}za.push({program:s,code:n});t=s}h.program=t;t=h.program.attributes;t.position>=0&&d.enableVertexAttribArray(t.position);t.color>=0&&d.enableVertexAttribArray(t.color);
t.normal>=0&&d.enableVertexAttribArray(t.normal);t.tangent>=0&&d.enableVertexAttribArray(t.tangent);if(h.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0){d.enableVertexAttribArray(t.skinVertexA);d.enableVertexAttribArray(t.skinVertexB);d.enableVertexAttribArray(t.skinIndex);d.enableVertexAttribArray(t.skinWeight)}if(h.attributes)for(A in h.attributes)t[A]!==undefined&&t[A]>=0&&d.enableVertexAttribArray(t[A]);if(h.morphTargets){h.numSupportedMorphTargets=0;if(t.morphTarget0>=
0){d.enableVertexAttribArray(t.morphTarget0);h.numSupportedMorphTargets++}if(t.morphTarget1>=0){d.enableVertexAttribArray(t.morphTarget1);h.numSupportedMorphTargets++}if(t.morphTarget2>=0){d.enableVertexAttribArray(t.morphTarget2);h.numSupportedMorphTargets++}if(t.morphTarget3>=0){d.enableVertexAttribArray(t.morphTarget3);h.numSupportedMorphTargets++}if(t.morphTarget4>=0){d.enableVertexAttribArray(t.morphTarget4);h.numSupportedMorphTargets++}if(t.morphTarget5>=0){d.enableVertexAttribArray(t.morphTarget5);
h.numSupportedMorphTargets++}if(t.morphTarget6>=0){d.enableVertexAttribArray(t.morphTarget6);h.numSupportedMorphTargets++}if(t.morphTarget7>=0){d.enableVertexAttribArray(t.morphTarget7);h.numSupportedMorphTargets++}v.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);h=0;for(A=this.maxMorphTargets;h<A;h++)v.__webglMorphTargetInfluences[h]=0}};this.render=function(h,I,o,v){var A,f,n,j,k,r,i,t,s=h.lights,w=h.fog;fa.data.vertices=0;fa.data.faces=0;fa.data.drawCalls=0;I.matrixAutoUpdate&&
I.update(undefined,!0);h.update(undefined,!1,I);I.matrixWorldInverse.flattenToArray(eb);I.projectionMatrix.flattenToArray($a);va.multiply(I.projectionMatrix,I.matrixWorldInverse);G(va);this.initWebGLObjects(h);Za(o);(this.autoClear||v)&&this.clear();k=h.__webglObjects.length;for(v=0;v<k;v++){A=h.__webglObjects[v];i=A.object;if(i.visible)if(!(i instanceof THREE.Mesh)||H(i)){i.matrixWorld.flattenToArray(i._objectMatrixArray);da(i,I);S(A);A.render=!0;if(this.sortObjects){ib.copy(i.position);va.multiplyVector3(ib);
A.z=ib.z}}else A.render=!1;else A.render=!1}this.sortObjects&&h.__webglObjects.sort(W);r=h.__webglObjectsImmediate.length;for(v=0;v<r;v++){A=h.__webglObjectsImmediate[v];i=A.object;if(i.visible){i.matrixAutoUpdate&&i.matrixWorld.flattenToArray(i._objectMatrixArray);da(i,I);Q(A)}}ra(THREE.NormalBlending);for(v=0;v<k;v++){A=h.__webglObjects[v];if(A.render){i=A.object;t=A.buffer;n=A.opaque;B(i);for(A=0;A<n.count;A++){j=n.list[A];z(j.depthTest);m(I,s,w,j,t,i)}}}for(v=0;v<r;v++){A=h.__webglObjectsImmediate[v];
i=A.object;if(i.visible){n=A.opaque;B(i);for(A=0;A<n.count;A++){j=n.list[A];z(j.depthTest);f=g(I,s,w,j,i);i.render(function(x){q(x,f,j.shading)})}}}for(v=0;v<k;v++){A=h.__webglObjects[v];if(A.render){i=A.object;t=A.buffer;n=A.transparent;B(i);for(A=0;A<n.count;A++){j=n.list[A];ra(j.blending);z(j.depthTest);m(I,s,w,j,t,i)}}}for(v=0;v<r;v++){A=h.__webglObjectsImmediate[v];i=A.object;if(i.visible){n=A.transparent;B(i);for(A=0;A<n.count;A++){j=n.list[A];ra(j.blending);z(j.depthTest);f=g(I,s,w,j,i);i.render(function(x){q(x,
f,j.shading)})}}}h.__webglSprites.length&&R(h,I);fb&&h.__webglShadowVolumes.length&&h.lights.length&&P(h);h.__webglLensFlares.length&&aa(h,I);if(o&&o.minFilter!==THREE.NearestFilter&&o.minFilter!==THREE.LinearFilter){d.bindTexture(d.TEXTURE_2D,o.__webglTexture);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null)}d.finish()};this.initWebGLObjects=function(h){if(!h.__webglObjects){h.__webglObjects=[];h.__webglObjectsImmediate=[];h.__webglShadowVolumes=[];h.__webglLensFlares=[];h.__webglSprites=
[]}for(;h.__objectsAdded.length;){var I=h.__objectsAdded[0],o=h,v=void 0,A=void 0,f=void 0;if(I._modelViewMatrix==undefined){I._modelViewMatrix=new THREE.Matrix4;I._normalMatrixArray=new Float32Array(9);I._modelViewMatrixArray=new Float32Array(16);I._objectMatrixArray=new Float32Array(16);I.matrixWorld.flattenToArray(I._objectMatrixArray)}if(I instanceof THREE.Mesh){A=I.geometry;A.geometryGroups==undefined&&Ba(A);for(v in A.geometryGroups){f=A.geometryGroups[v];if(!f.__webglVertexBuffer){var n=f;
n.__webglVertexBuffer=d.createBuffer();n.__webglNormalBuffer=d.createBuffer();n.__webglTangentBuffer=d.createBuffer();n.__webglColorBuffer=d.createBuffer();n.__webglUVBuffer=d.createBuffer();n.__webglUV2Buffer=d.createBuffer();n.__webglSkinVertexABuffer=d.createBuffer();n.__webglSkinVertexBBuffer=d.createBuffer();n.__webglSkinIndicesBuffer=d.createBuffer();n.__webglSkinWeightsBuffer=d.createBuffer();n.__webglFaceBuffer=d.createBuffer();n.__webglLineBuffer=d.createBuffer();if(n.numMorphTargets){var j=
void 0,k=void 0;n.__webglMorphTargetsBuffers=[];j=0;for(k=n.numMorphTargets;j<k;j++)n.__webglMorphTargetsBuffers.push(d.createBuffer())}n=f;j=I;var r=void 0,i=void 0,t=void 0;t=void 0;var s=void 0,w=void 0,x=void 0,y=x=k=0;i=void 0;t=void 0;var F=void 0;r=void 0;i=void 0;s=j.geometry;F=s.faces;w=n.faces;r=0;for(i=w.length;r<i;r++){t=w[r];t=F[t];if(t instanceof THREE.Face3){k+=3;x+=1;y+=3}else if(t instanceof THREE.Face4){k+=4;x+=2;y+=4}}r=void 0;i=void 0;w=void 0;t=void 0;w=void 0;F=[];r=0;for(i=
j.materials.length;r<i;r++){w=j.materials[r];if(w instanceof THREE.MeshFaceMaterial){w=0;for(l=n.materials.length;w<l;w++)(t=n.materials[w])&&F.push(t)}else(t=w)&&F.push(t)}r=F;a:{i=void 0;F=void 0;w=r.length;for(i=0;i<w;i++){F=r[i];if(F.map||F.lightMap||F instanceof THREE.MeshShaderMaterial){i=!0;break a}}i=!1}a:{F=void 0;w=void 0;t=r.length;for(F=0;F<t;F++){w=r[F];if(!(w instanceof THREE.MeshBasicMaterial&&!w.envMap||w instanceof THREE.MeshDepthMaterial)){F=w&&w.shading!=undefined&&w.shading==THREE.SmoothShading?
THREE.SmoothShading:THREE.FlatShading;break a}}F=!1}a:{w=void 0;t=void 0;var D=r.length;for(w=0;w<D;w++){t=r[w];if(t.vertexColors){t=t.vertexColors;break a}}t=!1}n.__vertexArray=new Float32Array(k*3);if(F)n.__normalArray=new Float32Array(k*3);if(s.hasTangents)n.__tangentArray=new Float32Array(k*4);if(t)n.__colorArray=new Float32Array(k*3);if(i){if(s.faceUvs.length>0||s.faceVertexUvs.length>0)n.__uvArray=new Float32Array(k*2);if(s.faceUvs.length>1||s.faceVertexUvs.length>1)n.__uv2Array=new Float32Array(k*
2)}if(j.geometry.skinWeights.length&&j.geometry.skinIndices.length){n.__skinVertexAArray=new Float32Array(k*4);n.__skinVertexBArray=new Float32Array(k*4);n.__skinIndexArray=new Float32Array(k*4);n.__skinWeightArray=new Float32Array(k*4)}n.__faceArray=new Uint16Array(x*3+(j.geometry.edgeFaces?j.geometry.edgeFaces.length*6:0));n.__lineArray=new Uint16Array(y*2);if(n.numMorphTargets){n.__morphTargetsArrays=[];s=0;for(w=n.numMorphTargets;s<w;s++)n.__morphTargetsArrays.push(new Float32Array(k*3))}n.__needsSmoothNormals=
F==THREE.SmoothShading;n.__uvType=i;n.__vertexColorType=t;n.__normalType=F;n.__webglFaceCount=x*3+(j.geometry.edgeFaces?j.geometry.edgeFaces.length*6:0);n.__webglLineCount=y*2;s=0;for(w=r.length;s<w;s++)if(r[s].attributes){n.__webglCustomAttributes={};for(a in r[s].attributes){i=r[s].attributes[a];if(!i.__webglInitialized||i.createUniqueBuffers){i.__webglInitialized=!0;x=1;if(i.type==="v2")x=2;else if(i.type==="v3")x=3;else if(i.type==="v4")x=4;else i.type==="c"&&(x=3);i.size=x;i.needsUpdate=!0;i.array=
new Float32Array(k*x);i.buffer=d.createBuffer();i.buffer.belongsToAttribute=a}n.__webglCustomAttributes[a]=i}}n.__inittedArrays=!0;A.__dirtyVertices=!0;A.__dirtyMorphTargets=!0;A.__dirtyElements=!0;A.__dirtyUvs=!0;A.__dirtyNormals=!0;A.__dirtyTangents=!0;A.__dirtyColors=!0}I instanceof THREE.ShadowVolume?qa(o.__webglShadowVolumes,f,I):qa(o.__webglObjects,f,I)}}else if(I instanceof THREE.LensFlare)qa(o.__webglLensFlares,undefined,I);else if(I instanceof THREE.Ribbon){A=I.geometry;if(!A.__webglVertexBuffer){v=
A;v.__webglVertexBuffer=d.createBuffer();v.__webglColorBuffer=d.createBuffer();v=A;f=v.vertices.length;v.__vertexArray=new Float32Array(f*3);v.__colorArray=new Float32Array(f*3);v.__webglVertexCount=f;A.__dirtyVertices=!0;A.__dirtyColors=!0}qa(o.__webglObjects,A,I)}else if(I instanceof THREE.Line){A=I.geometry;if(!A.__webglVertexBuffer){v=A;v.__webglVertexBuffer=d.createBuffer();v.__webglColorBuffer=d.createBuffer();v=A;f=v.vertices.length;v.__vertexArray=new Float32Array(f*3);v.__colorArray=new Float32Array(f*
3);v.__webglLineCount=f;A.__dirtyVertices=!0;A.__dirtyColors=!0}qa(o.__webglObjects,A,I)}else if(I instanceof THREE.ParticleSystem){A=I.geometry;if(!A.__webglVertexBuffer){v=A;v.__webglVertexBuffer=d.createBuffer();v.__webglColorBuffer=d.createBuffer();v=A;f=v.vertices.length;v.__vertexArray=new Float32Array(f*3);v.__colorArray=new Float32Array(f*3);v.__sortArray=[];v.__webglParticleCount=f;A.__dirtyVertices=!0;A.__dirtyColors=!0}qa(o.__webglObjects,A,I)}else if(THREE.MarchingCubes!==undefined&&I instanceof
THREE.MarchingCubes)o.__webglObjectsImmediate.push({object:I,opaque:{list:[],count:0},transparent:{list:[],count:0}});else I instanceof THREE.Sprite&&o.__webglSprites.push(I);h.__objectsAdded.splice(0,1)}for(;h.__objectsRemoved.length;){I=h.__objectsRemoved[0];o=h;A=void 0;v=void 0;if(I instanceof THREE.Mesh)for(A=o.__webglObjects.length-1;A>=0;A--){v=o.__webglObjects[A].object;if(I==v){o.__webglObjects.splice(A,1);break}}else if(I instanceof THREE.Sprite)for(A=o.__webglSprites.length-1;A>=0;A--){v=
o.__webglSprites[A];if(I==v){o.__webglSprites.splice(A,1);break}}h.__objectsRemoved.splice(0,1)}I=0;for(o=h.__webglObjects.length;I<o;I++)X(h.__webglObjects[I].object,h);I=0;for(o=h.__webglShadowVolumes.length;I<o;I++)X(h.__webglShadowVolumes[I].object,h);I=0;for(o=h.__webglLensFlares.length;I<o;I++)X(h.__webglLensFlares[I].object,h)};this.setFaceCulling=function(h,I){if(h){!I||I=="ccw"?d.frontFace(d.CCW):d.frontFace(d.CW);if(h=="back")d.cullFace(d.BACK);else h=="front"?d.cullFace(d.FRONT):d.cullFace(d.FRONT_AND_BACK);
d.enable(d.CULL_FACE)}else d.disable(d.CULL_FACE)};this.supportsVertexTextures=function(){return Eb}};
THREE.WebGLRenderTarget=function(b,e,g){this.width=b;this.height=e;g=g||{};this.wrapS=g.wrapS!==undefined?g.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=g.wrapT!==undefined?g.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=g.magFilter!==undefined?g.magFilter:THREE.LinearFilter;this.minFilter=g.minFilter!==undefined?g.minFilter:THREE.LinearMipMapLinearFilter;this.format=g.format!==undefined?g.format:THREE.RGBAFormat;this.type=g.type!==undefined?g.type:THREE.UnsignedByteType;this.depthBuffer=g.depthBuffer!==
undefined?g.depthBuffer:!0;this.stencilBuffer=g.stencilBuffer!==undefined?g.stencilBuffer:!0};
