// ThreeWebGL.js r41/ROME - http://github.com/mrdoob/three.js
var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,f,g){this.r=b;this.g=f;this.b=g;this.updateHex()},setHSV:function(b,f,g){var o,q,B,y,D,E;if(g==0)o=q=B=0;else{y=Math.floor(b*6);D=b*6-y;b=g*(1-f);E=g*(1-f*D);f=g*(1-f*(1-D));switch(y){case 1:o=E;q=g;B=b;break;case 2:o=b;q=g;B=f;break;case 3:o=b;q=E;B=g;break;case 4:o=f;q=b;B=g;break;case 5:o=g;q=b;B=E;break;case 6:case 0:o=g;q=f;B=b}}this.setRGB(o,
q,B)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,f){this.set(b||0,f||0)};
THREE.Vector2.prototype={set:function(b,f){this.x=b;this.y=f;return this},copy:function(b){this.set(b.x,b.y);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,f,g){this.set(b||0,f||0,g||0)};
THREE.Vector3.prototype={set:function(b,f,g){this.x=b;this.y=f;this.z=g;return this},copy:function(b){this.set(b.x,b.y,b.z);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y,b.z+f.z);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z);return this},addScalar:function(b){this.set(this.x+b,this.y+b,this.z+b);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y,b.z-f.z);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z);return this},cross:function(b,
f){this.set(b.y*f.z-b.z*f.y,b.z*f.x-b.x*f.z,b.x*f.y-b.y*f.x);return this},crossSelf:function(b){var f=this.x,g=this.y,o=this.z;this.set(g*b.z-o*b.y,o*b.x-f*b.z,f*b.y-g*b.x);return this},multiply:function(b,f){this.set(b.x*f.x,b.y*f.y,b.z*f.z);return this},multiplySelf:function(b){this.set(this.x*b.x,this.y*b.y,this.z*b.z);return this},multiplyScalar:function(b){this.set(this.x*b,this.y*b,this.z*b);return this},divideSelf:function(b){this.set(this.x/b.x,this.y/b.y,this.z/b.z);return this},divideScalar:function(b){this.set(this.x/
b,this.y/b,this.z/b);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var f=this.x-b.x,g=this.y-b.y;b=this.z-b.z;return f*f+g*g+b*b},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var b=
this.length();b>0?this.multiplyScalar(1/b):this.set(0,0,0);return this},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var f=Math.cos(this.y);this.y=Math.asin(b.n13);if(Math.abs(f)>1.0E-5){this.x=Math.atan2(-b.n23/f,b.n33/f);this.z=Math.atan2(-b.n12/f,b.n11/f)}else{this.x=0;this.z=Math.atan2(b.n21,b.n22)}},setLength:function(b){return this.normalize().multiplyScalar(b)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,f,g,o){this.set(b||0,f||0,g||0,o||1)};
THREE.Vector4.prototype={set:function(b,f,g,o){this.x=b;this.y=f;this.z=g;this.w=o;return this},copy:function(b){this.set(b.x,b.y,b.z,b.w||1);return this},add:function(b,f){this.set(b.x+f.x,b.y+f.y,b.z+f.z,b.w+f.w);return this},addSelf:function(b){this.set(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w);return this},sub:function(b,f){this.set(b.x-f.x,b.y-f.y,b.z-f.z,b.w-f.w);return this},subSelf:function(b){this.set(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w);return this},multiplyScalar:function(b){this.set(this.x*
b,this.y*b,this.z*b,this.w*b);return this},divideScalar:function(b){this.set(this.x/b,this.y/b,this.z/b,this.w/b);return this},lerpSelf:function(b,f){this.set(this.x+(b.x-this.x)*f,this.y+(b.y-this.y)*f,this.z+(b.z-this.z)*f,this.w+(b.w-this.w)*f)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(b,f){this.origin=b||new THREE.Vector3;this.direction=f||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var f,g,o,q=[];f=0;for(g=b.length;f<g;f++){o=b[f];o instanceof THREE.Mesh&&(q=q.concat(this.intersectObject(o)))}q.sort(function(B,y){return B.distance-y.distance});return q},intersectObject:function(b){function f(ca,V,za,oa){oa=oa.clone().subSelf(V);za=za.clone().subSelf(V);var pa=ca.clone().subSelf(V);ca=oa.dot(oa);V=oa.dot(za);oa=oa.dot(pa);var ma=za.dot(za);za=za.dot(pa);pa=1/
(ca*ma-V*V);ma=(ma*oa-V*za)*pa;ca=(ca*za-V*oa)*pa;return ma>0&&ca>0&&ma+ca<1}var g,o,q,B,y,D,E,G,P,R,T,O=b.geometry,Q=O.vertices,Y=[];g=0;for(o=O.faces.length;g<o;g++){q=O.faces[g];R=this.origin.clone();T=this.direction.clone();E=b.matrixWorld;B=E.multiplyVector3(Q[q.a].position.clone());y=E.multiplyVector3(Q[q.b].position.clone());D=E.multiplyVector3(Q[q.c].position.clone());E=q instanceof THREE.Face4?E.multiplyVector3(Q[q.d].position.clone()):null;G=b.matrixRotationWorld.multiplyVector3(q.normal.clone());
P=T.dot(G);if(b.doubleSided||(b.flipSided?P>0:P<0)){G=G.dot((new THREE.Vector3).sub(B,R))/P;R=R.addSelf(T.multiplyScalar(G));if(q instanceof THREE.Face3){if(f(R,B,y,D)){q={distance:this.origin.distanceTo(R),point:R,face:q,object:b};Y.push(q)}}else if(q instanceof THREE.Face4&&(f(R,B,y,E)||f(R,y,D,E))){q={distance:this.origin.distanceTo(R),point:R,face:q,object:b};Y.push(q)}}}return Y}};
THREE.Rectangle=function(){function b(){B=o-f;y=q-g}var f,g,o,q,B,y,D=!0;this.getX=function(){return f};this.getY=function(){return g};this.getWidth=function(){return B};this.getHeight=function(){return y};this.getLeft=function(){return f};this.getTop=function(){return g};this.getRight=function(){return o};this.getBottom=function(){return q};this.set=function(E,G,P,R){D=!1;f=E;g=G;o=P;q=R;b()};this.addPoint=function(E,G){if(D){D=!1;f=E;g=G;o=E;q=G}else{f=f<E?f:E;g=g<G?g:G;o=o>E?o:E;q=q>G?q:G}b()};
this.add3Points=function(E,G,P,R,T,O){if(D){D=!1;f=E<P?E<T?E:T:P<T?P:T;g=G<R?G<O?G:O:R<O?R:O;o=E>P?E>T?E:T:P>T?P:T;q=G>R?G>O?G:O:R>O?R:O}else{f=E<P?E<T?E<f?E:f:T<f?T:f:P<T?P<f?P:f:T<f?T:f;g=G<R?G<O?G<g?G:g:O<g?O:g:R<O?R<g?R:g:O<g?O:g;o=E>P?E>T?E>o?E:o:T>o?T:o:P>T?P>o?P:o:T>o?T:o;q=G>R?G>O?G>q?G:q:O>q?O:q:R>O?R>q?R:q:O>q?O:q}b()};this.addRectangle=function(E){if(D){D=!1;f=E.getLeft();g=E.getTop();o=E.getRight();q=E.getBottom()}else{f=f<E.getLeft()?f:E.getLeft();g=g<E.getTop()?g:E.getTop();o=o>E.getRight()?
o:E.getRight();q=q>E.getBottom()?q:E.getBottom()}b()};this.inflate=function(E){f-=E;g-=E;o+=E;q+=E;b()};this.minSelf=function(E){f=f>E.getLeft()?f:E.getLeft();g=g>E.getTop()?g:E.getTop();o=o<E.getRight()?o:E.getRight();q=q<E.getBottom()?q:E.getBottom();b()};this.instersects=function(E){return Math.min(o,E.getRight())-Math.max(f,E.getLeft())>=0&&Math.min(q,E.getBottom())-Math.max(g,E.getTop())>=0};this.empty=function(){D=!0;q=o=g=f=0;b()};this.isEmpty=function(){return D}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var b,f=this.m;b=f[1];f[1]=f[3];f[3]=b;b=f[2];f[2]=f[6];f[6]=b;b=f[5];f[5]=f[7];f[7]=b;return this},transposeIntoArray:function(b){var f=this.m;b[0]=f[0];b[1]=f[3];b[2]=f[6];b[3]=f[1];b[4]=f[4];b[5]=f[7];b[6]=f[2];b[7]=f[5];b[8]=f[8];return this}};
THREE.Matrix4=function(b,f,g,o,q,B,y,D,E,G,P,R,T,O,Q,Y){this.set(b||1,f||0,g||0,o||0,q||0,B||1,y||0,D||0,E||0,G||0,P||1,R||0,T||0,O||0,Q||0,Y||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,f,g,o,q,B,y,D,E,G,P,R,T,O,Q,Y){this.n11=b;this.n12=f;this.n13=g;this.n14=o;this.n21=q;this.n22=B;this.n23=y;this.n24=D;this.n31=E;this.n32=G;this.n33=P;this.n34=R;this.n41=T;this.n42=O;this.n43=Q;this.n44=Y;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,f,g){var o=THREE.Matrix4.__v1,
q=THREE.Matrix4.__v2,B=THREE.Matrix4.__v3;B.sub(b,f).normalize();if(B.length()===0)B.z=1;o.cross(g,B).normalize();if(o.length()===0){B.x+=1.0E-4;o.cross(g,B).normalize()}q.cross(B,o).normalize();this.n11=o.x;this.n12=q.x;this.n13=B.x;this.n21=o.y;this.n22=q.y;this.n23=B.y;this.n31=o.z;this.n32=q.z;this.n33=B.z;return this},multiplyVector3:function(b){var f=b.x,g=b.y,o=b.z,q=1/(this.n41*f+this.n42*g+this.n43*o+this.n44);b.x=(this.n11*f+this.n12*g+this.n13*o+this.n14)*q;b.y=(this.n21*f+this.n22*g+this.n23*
o+this.n24)*q;b.z=(this.n31*f+this.n32*g+this.n33*o+this.n34)*q;return b},multiplyVector4:function(b){var f=b.x,g=b.y,o=b.z,q=b.w;b.x=this.n11*f+this.n12*g+this.n13*o+this.n14*q;b.y=this.n21*f+this.n22*g+this.n23*o+this.n24*q;b.z=this.n31*f+this.n32*g+this.n33*o+this.n34*q;b.w=this.n41*f+this.n42*g+this.n43*o+this.n44*q;return b},rotateAxis:function(b){var f=b.x,g=b.y,o=b.z;b.x=f*this.n11+g*this.n12+o*this.n13;b.y=f*this.n21+g*this.n22+o*this.n23;b.z=f*this.n31+g*this.n32+o*this.n33;b.normalize();
return b},crossVector:function(b){var f=new THREE.Vector4;f.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;f.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;f.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;f.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return f},multiply:function(b,f){var g=b.n11,o=b.n12,q=b.n13,B=b.n14,y=b.n21,D=b.n22,E=b.n23,G=b.n24,P=b.n31,R=b.n32,T=b.n33,O=b.n34,Q=b.n41,Y=b.n42,ca=b.n43,V=b.n44,za=f.n11,oa=f.n12,pa=f.n13,ma=f.n14,X=f.n21,Za=
f.n22,na=f.n23,Xa=f.n24,Ja=f.n31,ga=f.n32,d=f.n33,c=f.n34;this.n11=g*za+o*X+q*Ja;this.n12=g*oa+o*Za+q*ga;this.n13=g*pa+o*na+q*d;this.n14=g*ma+o*Xa+q*c+B;this.n21=y*za+D*X+E*Ja;this.n22=y*oa+D*Za+E*ga;this.n23=y*pa+D*na+E*d;this.n24=y*ma+D*Xa+E*c+G;this.n31=P*za+R*X+T*Ja;this.n32=P*oa+R*Za+T*ga;this.n33=P*pa+R*na+T*d;this.n34=P*ma+R*Xa+T*c+O;this.n41=Q*za+Y*X+ca*Ja;this.n42=Q*oa+Y*Za+ca*ga;this.n43=Q*pa+Y*na+ca*d;this.n44=Q*ma+Y*Xa+ca*c+V;return this},multiplyToArray:function(b,f,g){this.multiply(b,
f);g[0]=this.n11;g[1]=this.n21;g[2]=this.n31;g[3]=this.n41;g[4]=this.n12;g[5]=this.n22;g[6]=this.n32;g[7]=this.n42;g[8]=this.n13;g[9]=this.n23;g[10]=this.n33;g[11]=this.n43;g[12]=this.n14;g[13]=this.n24;g[14]=this.n34;g[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;
this.n43*=b;this.n44*=b;return this},determinant:function(){var b=this.n11,f=this.n12,g=this.n13,o=this.n14,q=this.n21,B=this.n22,y=this.n23,D=this.n24,E=this.n31,G=this.n32,P=this.n33,R=this.n34,T=this.n41,O=this.n42,Q=this.n43,Y=this.n44;return o*y*G*T-g*D*G*T-o*B*P*T+f*D*P*T+g*B*R*T-f*y*R*T-o*y*E*O+g*D*E*O+o*q*P*O-b*D*P*O-g*q*R*O+b*y*R*O+o*B*E*Q-f*D*E*Q-o*q*G*Q+b*D*G*Q+f*q*R*Q-b*B*R*Q-g*B*E*Y+f*y*E*Y+g*q*G*Y-b*y*G*Y-f*q*P*Y+b*B*P*Y},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=
b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},
flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;
b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,f){b[f]=this.n11;b[f+1]=this.n21;b[f+2]=this.n31;b[f+3]=this.n41;b[f+4]=this.n12;b[f+5]=this.n22;b[f+6]=this.n32;b[f+7]=this.n42;b[f+8]=this.n13;b[f+9]=this.n23;b[f+10]=this.n33;b[f+11]=this.n43;b[f+12]=this.n14;b[f+13]=this.n24;b[f+14]=this.n34;b[f+15]=this.n44;return b},setTranslation:function(b,f,g){this.set(1,
0,0,b,0,1,0,f,0,0,1,g,0,0,0,1);return this},setScale:function(b,f,g){this.set(b,0,0,0,0,f,0,0,0,0,g,0,0,0,0,1);return this},setRotationX:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,f,-b,0,0,b,f,0,0,0,0,1);return this},setRotationY:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,0,b,0,0,1,0,0,-b,0,f,0,0,0,0,1);return this},setRotationZ:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,-b,0,0,b,f,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,f){var g=Math.cos(f),
o=Math.sin(f),q=1-g,B=b.x,y=b.y,D=b.z,E=q*B,G=q*y;this.set(E*B+g,E*y-o*D,E*D+o*y,0,E*y+o*D,G*y+g,G*D-o*B,0,E*D-o*y,G*D+o*B,q*D*D+g,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},
getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var f=b.x,g=b.y,o=b.z;b=Math.cos(f);f=Math.sin(f);var q=Math.cos(g);g=Math.sin(g);var B=Math.cos(o);o=Math.sin(o);var y=b*g,D=f*g;this.n11=q*B;this.n12=-q*o;this.n13=g;this.n21=D*B+b*o;this.n22=-D*
o+b*B;this.n23=-f*q;this.n31=-y*B+f*o;this.n32=y*o+f*B;this.n33=b*q;return this},setRotationFromQuaternion:function(b){var f=b.x,g=b.y,o=b.z,q=b.w,B=f+f,y=g+g,D=o+o;b=f*B;var E=f*y;f*=D;var G=g*y;g*=D;o*=D;B*=q;y*=q;q*=D;this.n11=1-(G+o);this.n12=E-q;this.n13=f+y;this.n21=E+q;this.n22=1-(b+o);this.n23=g-B;this.n31=f-y;this.n32=g+B;this.n33=1-(b+G);return this},scale:function(b){var f=b.x,g=b.y;b=b.z;this.n11*=f;this.n12*=g;this.n13*=b;this.n21*=f;this.n22*=g;this.n23*=b;this.n31*=f;this.n32*=g;this.n33*=
b;this.n41*=f;this.n42*=g;this.n43*=b;return this},extractPosition:function(b){this.n14=b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,f){var g=1/f.x,o=1/f.y,q=1/f.z;this.n11=b.n11*g;this.n21=b.n21*g;this.n31=b.n31*g;this.n12=b.n12*o;this.n22=b.n22*o;this.n32=b.n32*o;this.n13=b.n13*q;this.n23=b.n23*q;this.n33=b.n33*q}};
THREE.Matrix4.makeInvert=function(b,f){var g=b.n11,o=b.n12,q=b.n13,B=b.n14,y=b.n21,D=b.n22,E=b.n23,G=b.n24,P=b.n31,R=b.n32,T=b.n33,O=b.n34,Q=b.n41,Y=b.n42,ca=b.n43,V=b.n44;f===undefined&&(f=new THREE.Matrix4);f.n11=E*O*Y-G*T*Y+G*R*ca-D*O*ca-E*R*V+D*T*V;f.n12=B*T*Y-q*O*Y-B*R*ca+o*O*ca+q*R*V-o*T*V;f.n13=q*G*Y-B*E*Y+B*D*ca-o*G*ca-q*D*V+o*E*V;f.n14=B*E*R-q*G*R-B*D*T+o*G*T+q*D*O-o*E*O;f.n21=G*T*Q-E*O*Q-G*P*ca+y*O*ca+E*P*V-y*T*V;f.n22=q*O*Q-B*T*Q+B*P*ca-g*O*ca-q*P*V+g*T*V;f.n23=B*E*Q-q*G*Q-B*y*ca+g*G*ca+
q*y*V-g*E*V;f.n24=q*G*P-B*E*P+B*y*T-g*G*T-q*y*O+g*E*O;f.n31=D*O*Q-G*R*Q+G*P*Y-y*O*Y-D*P*V+y*R*V;f.n32=B*R*Q-o*O*Q-B*P*Y+g*O*Y+o*P*V-g*R*V;f.n33=q*G*Q-B*D*Q+B*y*Y-g*G*Y-o*y*V+g*D*V;f.n34=B*D*P-o*G*P-B*y*R+g*G*R+o*y*O-g*D*O;f.n41=E*R*Q-D*T*Q-E*P*Y+y*T*Y+D*P*ca-y*R*ca;f.n42=o*T*Q-q*R*Q+q*P*Y-g*T*Y-o*P*ca+g*R*ca;f.n43=q*D*Q-o*E*Q-q*y*Y+g*E*Y+o*y*ca-g*D*ca;f.n44=o*E*P-q*D*P+q*y*R-g*E*R-o*y*T+g*D*T;f.multiplyScalar(1/b.determinant());return f};
THREE.Matrix4.makeInvert3x3=function(b){var f=b.m33,g=f.m,o=b.n33*b.n22-b.n32*b.n23,q=-b.n33*b.n21+b.n31*b.n23,B=b.n32*b.n21-b.n31*b.n22,y=-b.n33*b.n12+b.n32*b.n13,D=b.n33*b.n11-b.n31*b.n13,E=-b.n32*b.n11+b.n31*b.n12,G=b.n23*b.n12-b.n22*b.n13,P=-b.n23*b.n11+b.n21*b.n13,R=b.n22*b.n11-b.n21*b.n12;b=b.n11*o+b.n21*y+b.n31*G;if(b==0)throw"matrix not invertible";b=1/b;g[0]=b*o;g[1]=b*q;g[2]=b*B;g[3]=b*y;g[4]=b*D;g[5]=b*E;g[6]=b*G;g[7]=b*P;g[8]=b*R;return f};
THREE.Matrix4.makeFrustum=function(b,f,g,o,q,B){var y;y=new THREE.Matrix4;y.n11=2*q/(f-b);y.n12=0;y.n13=(f+b)/(f-b);y.n14=0;y.n21=0;y.n22=2*q/(o-g);y.n23=(o+g)/(o-g);y.n24=0;y.n31=0;y.n32=0;y.n33=-(B+q)/(B-q);y.n34=-2*B*q/(B-q);y.n41=0;y.n42=0;y.n43=-1;y.n44=0;return y};THREE.Matrix4.makePerspective=function(b,f,g,o){var q;b=g*Math.tan(b*Math.PI/360);q=-b;return THREE.Matrix4.makeFrustum(q*f,b*f,q,b,g,o)};
THREE.Matrix4.makeOrtho=function(b,f,g,o,q,B){var y,D,E,G;y=new THREE.Matrix4;D=f-b;E=g-o;G=B-q;y.n11=2/D;y.n12=0;y.n13=0;y.n14=-((f+b)/D);y.n21=0;y.n22=2/E;y.n23=0;y.n24=-((g+o)/E);y.n31=0;y.n32=0;y.n33=-2/G;y.n34=-((B+q)/G);y.n41=0;y.n42=0;y.n43=0;y.n44=1;return y};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.dynamic=!1;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=
1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var f=this;f.parent!==undefined;)f=f.parent;f!==undefined&&f instanceof THREE.Scene&&f.addChildRecurse(b)}},removeChild:function(b){var f=this.children.indexOf(b);if(f!==-1){b.parent=undefined;this.children.splice(f,1)}},getChildByName:function(b,f){var g,o,q;g=0;for(o=this.children.length;g<o;g++){q=this.children[g];if(q.name===b)return q;if(f){q=q.getChildByName(b,f);if(q!==undefined)return q}}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,f,g){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;f=!0}b=0;for(var o=this.children.length;b<o;b++)this.children[b].update(this.matrixWorld,f,g)}};THREE.Quaternion=function(b,f,g,o){this.set(b||0,f||0,g||0,o!==undefined?o:1)};
THREE.Quaternion.prototype={set:function(b,f,g,o){this.x=b;this.y=f;this.z=g;this.w=o;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var f=0.5*Math.PI/360,g=b.x*f,o=b.y*f,q=b.z*f;b=Math.cos(o);o=Math.sin(o);f=Math.cos(-q);q=Math.sin(-q);var B=Math.cos(g);g=Math.sin(g);var y=b*f,D=o*q;this.w=y*B-D*g;this.x=y*g+D*B;this.y=o*f*B+b*q*g;this.z=b*q*B-o*f*g;return this},setFromAxisAngle:function(b,f){var g=f/2,o=Math.sin(g);this.x=b.x*o;this.y=
b.y*o;this.z=b.z*o;this.w=Math.cos(g);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(b==0)this.w=this.z=this.y=this.x=0;else{b=1/b;this.x*=b;this.y*=b;this.z*=b;this.w*=b}return this},
multiplySelf:function(b){var f=this.x,g=this.y,o=this.z,q=this.w,B=b.x,y=b.y,D=b.z;b=b.w;this.x=f*b+q*B+g*D-o*y;this.y=g*b+q*y+o*B-f*D;this.z=o*b+q*D+f*y-g*B;this.w=q*b-f*B-g*y-o*D;return this},multiply:function(b,f){this.x=b.x*f.w+b.y*f.z-b.z*f.y+b.w*f.x;this.y=-b.x*f.z+b.y*f.w+b.z*f.x+b.w*f.y;this.z=b.x*f.y-b.y*f.x+b.z*f.w+b.w*f.z;this.w=-b.x*f.x-b.y*f.y-b.z*f.z+b.w*f.w;return this},multiplyVector3:function(b,f){f||(f=b);var g=b.x,o=b.y,q=b.z,B=this.x,y=this.y,D=this.z,E=this.w,G=E*g+y*q-D*o,P=
E*o+D*g-B*q,R=E*q+B*o-y*g;g=-B*g-y*o-D*q;f.x=G*E+g*-B+P*-D-R*-y;f.y=P*E+g*-y+R*-B-G*-D;f.z=R*E+g*-D+G*-y-P*-B;return f}};
THREE.Quaternion.slerp=function(b,f,g,o){var q=b.w*f.w+b.x*f.x+b.y*f.y+b.z*f.z;if(Math.abs(q)>=1){g.w=b.w;g.x=b.x;g.y=b.y;g.z=b.z;return g}var B=Math.acos(q),y=Math.sqrt(1-q*q);if(Math.abs(y)<0.0010){g.w=0.5*(b.w+f.w);g.x=0.5*(b.x+f.x);g.y=0.5*(b.y+f.y);g.z=0.5*(b.z+f.z);return g}q=Math.sin((1-o)*B)/y;o=Math.sin(o*B)/y;g.w=b.w*q+f.w*o;g.x=b.x*q+f.x*o;g.y=b.y*q+f.y*o;g.z=b.z*q+f.z*o;return g};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,f,g,o,q,B){this.a=b;this.b=f;this.c=g;this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3;this.vertexNormals=o instanceof Array?o:[];this.color=q instanceof THREE.Color?q:new THREE.Color;this.vertexColors=q instanceof Array?q:[];this.vertexTangents=[];this.materials=B instanceof Array?B:[B];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,f,g,o,q,B,y){this.a=b;this.b=f;this.c=g;this.d=o;this.normal=q instanceof THREE.Vector3?q:new THREE.Vector3;this.vertexNormals=q instanceof Array?q:[];this.color=B instanceof THREE.Color?B:new THREE.Color;this.vertexColors=B instanceof Array?B:[];this.vertexTangents=[];this.materials=y instanceof Array?y:[y];this.centroid=new THREE.Vector3};THREE.UV=function(b,f){this.set(b||0,f||0)};
THREE.UV.prototype={set:function(b,f){this.u=b;this.v=f;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,f,g;b=0;for(f=this.faces.length;b<f;b++){g=this.faces[b];g.centroid.set(0,0,0);if(g instanceof THREE.Face3){g.centroid.addSelf(this.vertices[g.a].position);g.centroid.addSelf(this.vertices[g.b].position);g.centroid.addSelf(this.vertices[g.c].position);g.centroid.divideScalar(3)}else if(g instanceof THREE.Face4){g.centroid.addSelf(this.vertices[g.a].position);g.centroid.addSelf(this.vertices[g.b].position);g.centroid.addSelf(this.vertices[g.c].position);
g.centroid.addSelf(this.vertices[g.d].position);g.centroid.divideScalar(4)}}},computeFaceNormals:function(b){var f,g,o,q,B,y,D=new THREE.Vector3,E=new THREE.Vector3;o=0;for(q=this.faces.length;o<q;o++){B=this.faces[o];if(b&&B.vertexNormals.length){D.set(0,0,0);f=0;for(g=B.vertexNormals.length;f<g;f++)D.addSelf(B.vertexNormals[f]);D.divideScalar(3)}else{f=this.vertices[B.a];g=this.vertices[B.b];y=this.vertices[B.c];D.sub(y.position,g.position);E.sub(f.position,g.position);D.crossSelf(E)}D.isZero()||
D.normalize();B.normal.copy(D)}},computeVertexNormals:function(){var b,f,g,o;if(this.__tmpVertices==undefined){o=this.__tmpVertices=Array(this.vertices.length);b=0;for(f=this.vertices.length;b<f;b++)o[b]=new THREE.Vector3;b=0;for(f=this.faces.length;b<f;b++){g=this.faces[b];if(g instanceof THREE.Face3)g.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(g instanceof THREE.Face4)g.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{o=
this.__tmpVertices;b=0;for(f=this.vertices.length;b<f;b++)o[b].set(0,0,0)}b=0;for(f=this.faces.length;b<f;b++){g=this.faces[b];if(g instanceof THREE.Face3){o[g.a].addSelf(g.normal);o[g.b].addSelf(g.normal);o[g.c].addSelf(g.normal)}else if(g instanceof THREE.Face4){o[g.a].addSelf(g.normal);o[g.b].addSelf(g.normal);o[g.c].addSelf(g.normal);o[g.d].addSelf(g.normal)}}b=0;for(f=this.vertices.length;b<f;b++)o[b].normalize();b=0;for(f=this.faces.length;b<f;b++){g=this.faces[b];if(g instanceof THREE.Face3){g.vertexNormals[0].copy(o[g.a]);
g.vertexNormals[1].copy(o[g.b]);g.vertexNormals[2].copy(o[g.c])}else if(g instanceof THREE.Face4){g.vertexNormals[0].copy(o[g.a]);g.vertexNormals[1].copy(o[g.b]);g.vertexNormals[2].copy(o[g.c]);g.vertexNormals[3].copy(o[g.d])}}},computeTangents:function(){function b(Aa,Oa,Ba,Pa,ua,Ta,xa){D=Aa.vertices[Oa].position;E=Aa.vertices[Ba].position;G=Aa.vertices[Pa].position;P=y[ua];R=y[Ta];T=y[xa];O=E.x-D.x;Q=G.x-D.x;Y=E.y-D.y;ca=G.y-D.y;V=E.z-D.z;za=G.z-D.z;oa=R.u-P.u;pa=T.u-P.u;ma=R.v-P.v;X=T.v-P.v;Za=
1/(oa*X-pa*ma);ga.set((X*O-ma*Q)*Za,(X*Y-ma*ca)*Za,(X*V-ma*za)*Za);d.set((oa*Q-pa*O)*Za,(oa*ca-pa*Y)*Za,(oa*za-pa*V)*Za);Xa[Oa].addSelf(ga);Xa[Ba].addSelf(ga);Xa[Pa].addSelf(ga);Ja[Oa].addSelf(d);Ja[Ba].addSelf(d);Ja[Pa].addSelf(d)}var f,g,o,q,B,y,D,E,G,P,R,T,O,Q,Y,ca,V,za,oa,pa,ma,X,Za,na,Xa=[],Ja=[],ga=new THREE.Vector3,d=new THREE.Vector3,c=new THREE.Vector3,Ma=new THREE.Vector3,Qa=new THREE.Vector3;f=0;for(g=this.vertices.length;f<g;f++){Xa[f]=new THREE.Vector3;Ja[f]=new THREE.Vector3}f=0;for(g=
this.faces.length;f<g;f++){B=this.faces[f];y=this.faceVertexUvs[0][f];if(B instanceof THREE.Face3)b(this,B.a,B.b,B.c,0,1,2);else if(B instanceof THREE.Face4){b(this,B.a,B.b,B.c,0,1,2);b(this,B.a,B.b,B.d,0,1,3)}}var Na=["a","b","c","d"];f=0;for(g=this.faces.length;f<g;f++){B=this.faces[f];for(o=0;o<B.vertexNormals.length;o++){Qa.copy(B.vertexNormals[o]);q=B[Na[o]];na=Xa[q];c.copy(na);c.subSelf(Qa.multiplyScalar(Qa.dot(na))).normalize();Ma.cross(B.vertexNormals[o],na);q=Ma.dot(Ja[q]);q=q<0?-1:1;B.vertexTangents[o]=
new THREE.Vector4(c.x,c.y,c.z,q)}}this.hasTangents=!0},computeBoundingBox:function(){var b;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var f=1,g=this.vertices.length;f<g;f++){b=this.vertices[f];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=
b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=this.boundingSphere===null?0:this.boundingSphere.radius,f=0,g=this.vertices.length;f<g;f++)b=Math.max(b,this.vertices[f].position.length());
this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(E,G){return Math.min(E,G)+"_"+Math.max(E,G)}function f(E,G,P){if(E[G]===undefined){E[G]={set:{},array:[]};E[G].set[P]=1;E[G].array.push(P)}else if(E[G].set[P]===undefined){E[G].set[P]=1;E[G].array.push(P)}}var g,o,q,B,y,D={};g=0;for(o=this.faces.length;g<o;g++){y=this.faces[g];if(y instanceof THREE.Face3){q=b(y.a,y.b);f(D,q,g);q=b(y.b,y.c);f(D,q,g);q=b(y.a,y.c);f(D,q,g)}else if(y instanceof THREE.Face4){q=b(y.b,y.d);f(D,q,g);q=
b(y.a,y.b);f(D,q,g);q=b(y.a,y.d);f(D,q,g);q=b(y.b,y.c);f(D,q,g);q=b(y.c,y.d);f(D,q,g)}}g=0;for(o=this.edges.length;g<o;g++){y=this.edges[g];q=y.vertexIndices[0];B=y.vertexIndices[1];y.faceIndices=D[b(q,B)].array;for(q=0;q<y.faceIndices.length;q++){B=y.faceIndices[q];y.faces.push(this.faces[B])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function f(O,Q,Y,ca,V,za,oa){O=(Y-O)*0.5;ca=(ca-Q)*0.5;return(2*(Q-Y)+O+ca)*oa+(-3*(Q-Y)-2*O-ca)*za+O*V+Q}this.points=b;var g=[],o={x:0,y:0,z:0},q,B,y,D,E,G,P,R,T;this.initFromArray=function(O){this.points=[];for(var Q=0;Q<O.length;Q++)this.points[Q]={x:O[Q][0],y:O[Q][1],z:O[Q][2]}};this.getPoint=function(O){q=(this.points.length-1)*O;B=Math.floor(q);y=q-B;g[0]=B==0?B:B-1;g[1]=B;g[2]=B>this.points.length-2?B:B+1;g[3]=B>this.points.length-3?B:B+2;G=this.points[g[0]];P=this.points[g[1]];
R=this.points[g[2]];T=this.points[g[3]];D=y*y;E=y*D;o.x=f(G.x,P.x,R.x,T.x,y,D,E);o.y=f(G.y,P.y,R.y,T.y,y,D,E);o.z=f(G.z,P.z,R.z,T.z,y,D,E);return o};this.getControlPointsArray=function(){var O,Q,Y=this.points.length,ca=[];for(O=0;O<Y;O++){Q=this.points[O];ca[O]=[Q.x,Q.y,Q.z]}return ca};this.getLength=function(O){var Q,Y,ca=Q=Q=0,V=new THREE.Vector3,za=new THREE.Vector3,oa=[],pa=0;oa[0]=0;O||(O=100);Y=this.points.length*O;V.copy(this.points[0]);for(O=1;O<Y;O++){Q=O/Y;position=this.getPoint(Q);za.copy(position);
pa+=za.distanceTo(V);V.copy(position);Q*=this.points.length-1;Q=Math.floor(Q);if(Q!=ca){oa[Q]=pa;ca=Q}}oa[oa.length]=pa;return{chunks:oa,total:pa}};this.reparametrizeByArcLength=function(O){var Q,Y,ca,V,za,oa,pa=[],ma=new THREE.Vector3,X=this.getLength();pa.push(ma.copy(this.points[0]).clone());for(Q=1;Q<this.points.length;Q++){Y=X.chunks[Q]-X.chunks[Q-1];oa=Math.ceil(O*Y/X.total);V=(Q-1)/(this.points.length-1);za=Q/(this.points.length-1);for(Y=1;Y<oa-1;Y++){ca=V+Y*(1/oa)*(za-V);position=this.getPoint(ca);
pa.push(ma.copy(position).clone())}pa.push(ma.copy(this.points[Q]).clone())}this.points=pa}};THREE.Edge=function(b,f,g,o){this.vertices=[b,f];this.vertexIndices=[g,o];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,f,g,o,q){THREE.Object3D.call(this);this.fov=b||50;this.aspect=f||1;this.near=g||0.1;this.far=o||2E3;this.target=q||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};
THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b));this.target.position.addSelf(f.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,f,g){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);f=!0}else{this.matrixAutoUpdate&&this.updateMatrix();if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;f=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,g)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,f,g,o){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=f||1;this.distance=g||0;this.castShadow=o!==undefined?o:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,f,g){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=f||1;this.distance=g||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,f,g,o){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=undefined;b!==undefined&&this.add(b,f,g,o)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,f,g,o){f===undefined&&(f=-1);g===undefined&&(g=0);if(o===undefined)o=THREE.BillboardBlending;g=Math.min(g,Math.max(0,g));this.lensFlares.push({texture:b,size:f,distance:g,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:o})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,f=this.lensFlares.length,g,o=-this.positionScreen.x*2,q=-this.positionScreen.y*2;for(b=0;b<f;b++){g=this.lensFlares[b];g.x=this.positionScreen.x+o*g.distance;g.y=this.positionScreen.y+q*g.distance;g.wantedRotation=g.x*Math.PI*0.25;g.rotation+=(g.wantedRotation-g.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==undefined?b.opacity:1;this.transparent=b.transparent!==undefined?b.transparent:!1;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==undefined?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==undefined?b.linewidth:1;this.linecap=b.linecap!==undefined?b.linecap:"round";this.linejoin=b.linejoin!==undefined?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=
b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?
b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==undefined?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==undefined?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==undefined?b.shininess:30;this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?
b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=
b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==undefined?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==undefined?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==undefined?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:
1;this.fog=b.fog!==undefined?b.fog:!1;this.lights=b.lights!==undefined?b.lights:!1;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==undefined?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.size=b.size!==undefined?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==undefined?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==undefined?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==undefined?b.map:null;this.lightMap=b.lightMap!==undefined?b.lightMap:null;this.envMap=b.envMap!==undefined?b.envMap:null;this.combine=b.combine!==undefined?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==undefined?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==undefined?b.refractionRatio:
0.98;this.shading=b.shading!==undefined?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==undefined?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==undefined?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==undefined?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==undefined?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==undefined?b.vertexColors:!1;this.skinning=b.skinning!==undefined?b.skinning:!1;this.morphTargets=b.morphTargets!==
undefined?b.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(b,f,g,o,q,B){this.image=b;this.mapping=f!==undefined?f:new THREE.UVMapping;this.wrapS=g!==undefined?g:THREE.ClampToEdgeWrapping;this.wrapT=o!==undefined?o:THREE.ClampToEdgeWrapping;this.magFilter=q!==undefined?q:THREE.LinearFilter;this.minFilter=B!==undefined?B:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.ParticleSystem=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,f,g){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.type=g!=undefined?g:THREE.LineStrip};THREE.LineStrip=0;
THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f&&f.length?f:[f];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var g=0;g<this.geometry.morphTargets.length;g++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[g].name]=g}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==undefined)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,f,g){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var o,q=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(o=0;o<q;o++){b=this.children[o];b instanceof THREE.Bone?b.update(this.skinMatrix,f,g):b.update(this.matrixWorld,!0,g)}}else for(o=0;o<q;o++)this.children[o].update(this.skinMatrix,
f,g)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1){b.parent!==undefined&&b.parent.removeChild(b);b.parent=this;this.children.push(b);if(!(b instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};
THREE.SkinnedMesh=function(b,f){THREE.Mesh.call(this,b,f);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var g,o,q,B,y,D;if(this.geometry.bones!==undefined){for(g=0;g<this.geometry.bones.length;g++){q=this.geometry.bones[g];B=q.pos;y=q.rotq;D=q.scl;o=this.addBone();o.name=q.name;o.position.set(B[0],B[1],B[2]);o.quaternion.set(y[0],y[1],y[2],y[3]);o.useQuaternion=!0;D!==undefined?o.scale.set(D[0],D[1],D[2]):o.scale.set(1,1,1)}for(g=0;g<this.bones.length;g++){q=this.geometry.bones[g];
o=this.bones[g];q.parent===-1?this.addChild(o):this.bones[q.parent].addChild(o)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,f,g){if(this.visible){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var o,q=this.children.length;for(o=0;o<q;o++){b=this.children[o];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,g):b.update(this.matrixWorld,f,g)}g=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(f=0;f<g;f++)ba[f].skinMatrix.flattenToArrayOffset(bm,
f*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===undefined&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var b,f=[],g=0;g<this.bones.length;g++){b=this.bones[g];f.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,g*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var o;for(b=0;b<this.geometry.skinIndices.length;b++){g=this.geometry.vertices[b].position;var q=this.geometry.skinIndices[b].x,B=this.geometry.skinIndices[b].y;
o=new THREE.Vector3(g.x,g.y,g.z);this.geometry.skinVerticesA.push(f[q].multiplyVector3(o));o=new THREE.Vector3(g.x,g.y,g.z);this.geometry.skinVerticesB.push(f[B].multiplyVector3(o));if(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1){g=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5;this.geometry.skinWeights[b].x+=g;this.geometry.skinWeights[b].y+=g}}}};
THREE.Ribbon=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,f,g,o){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=f!==undefined?Math.abs(f):100;this.volume=Math.min(1,Math.max(0,g!==undefined?g:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=o!==undefined?o:!0;this.sources=b instanceof Array?b:[b];var q;g=this.sources.length;for(b=0;b<g;b++){f=this.sources[b];f.toLowerCase();if(f.indexOf(".mp3")!==-1)q=
"audio/mpeg";else if(f.indexOf(".ogg")!==-1)q="audio/ogg";else f.indexOf(".wav")!==-1&&(q="audio/wav");if(this.domElement.canPlayType(q)){q=document.createElement("source");q.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(q);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(b)this.domElement.currentTime=b%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,f,g){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);f=!0}if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var o=this.children.length;for(b=0;b<o;b++)this.children[b].update(this.matrixWorld,f,g)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,f){f===undefined&&(f=0);f=Math.abs(f);for(var g=0;g<this.LODs.length;g++)if(f<this.LODs[g].visibleAtDistance)break;this.LODs.splice(g,0,{visibleAtDistance:f,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,f,g){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}if(this.LODs.length>1){b=g.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var o=1;o<this.LODs.length;o++)if(b>=this.LODs[o].visibleAtDistance){this.LODs[o-1].object3D.visible=
!1;this.LODs[o].object3D.visible=!0}else break;for(;o<this.LODs.length;o++)this.LODs[o].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,g)};THREE.ShadowVolume=function(b,f){if(b instanceof THREE.Mesh){THREE.Mesh.call(this,b.geometry,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);b.addChild(this)}else THREE.Mesh.call(this,b,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,f,g,o,q,B,y,D,E,G,P,R,T,O,Q=new THREE.Geometry;Q.vertices=this.geometry.vertices;o=Q.faces=this.geometry.faces;var Y=Q.egdes=this.geometry.edges,ca=Q.edgeFaces=[];q=0;var V=[];b=0;for(f=o.length;b<f;b++){g=o[b];V.push(q);q+=g instanceof THREE.Face3?3:4;g.vertexNormals[0]=g.normal;g.vertexNormals[1]=g.normal;g.vertexNormals[2]=g.normal;if(g instanceof THREE.Face4)g.vertexNormals[3]=
g.normal}b=0;for(f=Y.length;b<f;b++){D=Y[b];g=D.faces[0];o=D.faces[1];q=D.faceIndices[0];B=D.faceIndices[1];y=D.vertexIndices[0];D=D.vertexIndices[1];if(g.a===y){E="a";P=V[q]+0}else if(g.b===y){E="b";P=V[q]+1}else if(g.c===y){E="c";P=V[q]+2}else if(g.d===y){E="d";P=V[q]+3}if(g.a===D){E+="a";R=V[q]+0}else if(g.b===D){E+="b";R=V[q]+1}else if(g.c===D){E+="c";R=V[q]+2}else if(g.d===D){E+="d";R=V[q]+3}if(o.a===y){G="a";T=V[B]+0}else if(o.b===y){G="b";T=V[B]+1}else if(o.c===y){G="c";T=V[B]+2}else if(o.d===
y){G="d";T=V[B]+3}if(o.a===D){G+="a";O=V[B]+0}else if(o.b===D){G+="b";O=V[B]+1}else if(o.c===D){G+="c";O=V[B]+2}else if(o.d===D){G+="d";O=V[B]+3}if(E==="ac"||E==="ad"||E==="ca"||E==="da"){if(P>R){g=P;P=R;R=g}}else if(P<R){g=P;P=R;R=g}if(G==="ac"||G==="ad"||G==="ca"||G==="da"){if(T>O){g=T;T=O;O=g}}else if(T<O){g=T;T=O;O=g}g=new THREE.Face4(P,R,T,O);g.normal.set(1,0,0);ca.push(g)}this.geometry=Q}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var f=this.geometry.vertices,g=this.geometry.faces,o=this.geometry.edgeFaces,q=b.faces;b=b.vertices;var B=q.length,y,D,E,G,P,R=["a","b","c","d"];for(E=0;E<B;E++){D=f.length;y=q[E];if(y instanceof THREE.Face4){G=4;D=new THREE.Face4(D,D+1,D+2,D+3)}else{G=3;D=new THREE.Face3(D,D+1,D+2)}D.normal.copy(y.normal);g.push(D);
for(D=0;D<G;D++){P=b[y[R[D]]];f.push(new THREE.Vertex(P.position.clone()))}}for(B=0;B<q.length-1;B++){b=g[B];for(y=B+1;y<q.length;y++){D=g[y];D=this.facesShareEdge(f,b,D);if(D!==undefined){D=new THREE.Face4(D.indices[0],D.indices[3],D.indices[2],D.indices[1]);D.normal.set(1,0,0);o.push(D)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,f,g){var o,q,B,y,D,E,G,P,R,T,O,Q,Y,ca=0,V=["a","b","c","d"];o=f instanceof THREE.Face4?4:3;q=g instanceof THREE.Face4?4:3;for(Q=0;Q<o;Q++){B=f[V[Q]];D=b[B];for(Y=0;Y<q;Y++){y=g[V[Y]];E=b[y];if(Math.abs(D.position.x-E.position.x)<1.0E-4&&Math.abs(D.position.y-E.position.y)<1.0E-4&&Math.abs(D.position.z-E.position.z)<1.0E-4){ca++;if(ca===1){G=D;P=E;R=B;T=y;O=V[Q]}if(ca===2){O+=V[Q];return O==="ad"||O==="ac"?{faces:[f,g],vertices:[G,P,E,D],indices:[R,
T,y,B],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[f,g],vertices:[G,D,E,P],indices:[R,B,y,T],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==undefined){this.material=b.material;this.map=undefined;this.blending=material.blending}else if(b.map!==undefined){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=undefined;this.blending=b.blending!==undefined?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==undefined?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==undefined?b.mergeWith3D:!this.useScreenCoordinates;
this.affectedByDistance=b.affectedByDistance!==undefined?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var f=0;f<b.children.length;f++)this.addChildRecurse(b.children[f])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var f=this.lights.indexOf(b);f!==-1&&this.lights.splice(f,1)}else if(b instanceof THREE.Sound){f=this.sounds.indexOf(b);f!==-1&&this.sounds.splice(f,1)}else if(!(b instanceof THREE.Camera)){f=this.objects.indexOf(b);if(f!==-1){this.objects.splice(f,1);this.__objectsRemoved.push(b)}}for(f=0;f<b.children.length;f++)this.removeChildRecurse(b.children[f])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,f,g){this.color=new THREE.Color(b);this.near=f||1;this.far=g||1E3};THREE.FogExp2=function(b,f){this.color=new THREE.Color(b);this.density=f!==undefined?f:2.5E-4};
THREE.Projector=function(){function b(){var ga=E[D]=E[D]||new THREE.RenderableVertex;D++;return ga}function f(ga,d){return d.z-ga.z}function g(ga,d){var c=0,Ma=1,Qa=ga.z+ga.w,Na=d.z+d.w,Aa=-ga.z+ga.w,Oa=-d.z+d.w;if(Qa>=0&&Na>=0&&Aa>=0&&Oa>=0)return!0;else if(Qa<0&&Na<0||Aa<0&&Oa<0)return!1;else{if(Qa<0)c=Math.max(c,Qa/(Qa-Na));else Na<0&&(Ma=Math.min(Ma,Qa/(Qa-Na)));if(Aa<0)c=Math.max(c,Aa/(Aa-Oa));else Oa<0&&(Ma=Math.min(Ma,Aa/(Aa-Oa)));if(Ma<c)return!1;else{ga.lerpSelf(d,c);d.lerpSelf(ga,1-Ma);
return!0}}}var o,q,B=[],y,D,E=[],G,P,R=[],T,O=[],Q,Y,ca=[],V,za,oa=[],pa=new THREE.Vector4,ma=new THREE.Vector4,X=new THREE.Matrix4,Za=new THREE.Matrix4,na=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Xa=new THREE.Vector4,Ja=new THREE.Vector4;this.projectVector=function(ga,d){X.multiply(d.projectionMatrix,d.matrixWorldInverse);X.multiplyVector3(ga);return ga};this.unprojectVector=function(ga,d){X.multiply(d.matrixWorld,THREE.Matrix4.makeInvert(d.projectionMatrix));
X.multiplyVector3(ga);return ga};this.projectObjects=function(ga,d,c){d=[];var Ma,Qa,Na;q=0;Qa=ga.objects;ga=0;for(Ma=Qa.length;ga<Ma;ga++){Na=Qa[ga];var Aa;if(!(Aa=!Na.visible))if(Aa=Na instanceof THREE.Mesh){a:{Aa=void 0;for(var Oa=Na.matrixWorld,Ba=-Na.geometry.boundingSphere.radius*Math.max(Na.scale.x,Math.max(Na.scale.y,Na.scale.z)),Pa=0;Pa<6;Pa++){Aa=na[Pa].x*Oa.n14+na[Pa].y*Oa.n24+na[Pa].z*Oa.n34+na[Pa].w;if(Aa<=Ba){Aa=!1;break a}}Aa=!0}Aa=!Aa}if(!Aa){Aa=B[q]=B[q]||new THREE.RenderableObject;
q++;o=Aa;pa.copy(Na.position);X.multiplyVector3(pa);o.object=Na;o.z=pa.z;d.push(o)}}c&&d.sort(f);return d};this.projectScene=function(ga,d,c){var Ma=[],Qa=d.near,Na=d.far,Aa,Oa,Ba,Pa,ua,Ta,xa,Ca,Fa,Ga,$a,hb,eb,sb,Va,ib,pb;za=Y=T=P=0;d.matrixAutoUpdate&&d.update(undefined,!0);ga.update(undefined,!1,d);X.multiply(d.projectionMatrix,d.matrixWorldInverse);na[0].set(X.n41-X.n11,X.n42-X.n12,X.n43-X.n13,X.n44-X.n14);na[1].set(X.n41+X.n11,X.n42+X.n12,X.n43+X.n13,X.n44+X.n14);na[2].set(X.n41+X.n21,X.n42+X.n22,
X.n43+X.n23,X.n44+X.n24);na[3].set(X.n41-X.n21,X.n42-X.n22,X.n43-X.n23,X.n44-X.n24);na[4].set(X.n41-X.n31,X.n42-X.n32,X.n43-X.n33,X.n44-X.n34);na[5].set(X.n41+X.n31,X.n42+X.n32,X.n43+X.n33,X.n44+X.n34);for(Aa=0;Aa<6;Aa++){Fa=na[Aa];Fa.divideScalar(Math.sqrt(Fa.x*Fa.x+Fa.y*Fa.y+Fa.z*Fa.z))}Fa=this.projectObjects(ga,d,!0);ga=0;for(Aa=Fa.length;ga<Aa;ga++){Ga=Fa[ga].object;if(Ga.visible){$a=Ga.matrixWorld;hb=Ga.matrixRotationWorld;eb=Ga.materials;sb=Ga.overdraw;D=0;if(Ga instanceof THREE.Mesh){Va=Ga.geometry;
Pa=Va.vertices;ib=Va.faces;Va=Va.faceVertexUvs;Oa=0;for(Ba=Pa.length;Oa<Ba;Oa++){y=b();y.positionWorld.copy(Pa[Oa].position);$a.multiplyVector3(y.positionWorld);y.positionScreen.copy(y.positionWorld);X.multiplyVector4(y.positionScreen);y.positionScreen.x/=y.positionScreen.w;y.positionScreen.y/=y.positionScreen.w;y.visible=y.positionScreen.z>Qa&&y.positionScreen.z<Na}Pa=0;for(Oa=ib.length;Pa<Oa;Pa++){Ba=ib[Pa];if(Ba instanceof THREE.Face3){ua=E[Ba.a];Ta=E[Ba.b];xa=E[Ba.c];if(ua.visible&&Ta.visible&&
xa.visible&&(Ga.doubleSided||Ga.flipSided!=(xa.positionScreen.x-ua.positionScreen.x)*(Ta.positionScreen.y-ua.positionScreen.y)-(xa.positionScreen.y-ua.positionScreen.y)*(Ta.positionScreen.x-ua.positionScreen.x)<0)){Ca=R[P]=R[P]||new THREE.RenderableFace3;P++;G=Ca;G.v1.copy(ua);G.v2.copy(Ta);G.v3.copy(xa)}else continue}else if(Ba instanceof THREE.Face4){ua=E[Ba.a];Ta=E[Ba.b];xa=E[Ba.c];Ca=E[Ba.d];if(ua.visible&&Ta.visible&&xa.visible&&Ca.visible&&(Ga.doubleSided||Ga.flipSided!=((Ca.positionScreen.x-
ua.positionScreen.x)*(Ta.positionScreen.y-ua.positionScreen.y)-(Ca.positionScreen.y-ua.positionScreen.y)*(Ta.positionScreen.x-ua.positionScreen.x)<0||(Ta.positionScreen.x-xa.positionScreen.x)*(Ca.positionScreen.y-xa.positionScreen.y)-(Ta.positionScreen.y-xa.positionScreen.y)*(Ca.positionScreen.x-xa.positionScreen.x)<0))){pb=O[T]=O[T]||new THREE.RenderableFace4;T++;G=pb;G.v1.copy(ua);G.v2.copy(Ta);G.v3.copy(xa);G.v4.copy(Ca)}else continue}G.normalWorld.copy(Ba.normal);hb.multiplyVector3(G.normalWorld);
G.centroidWorld.copy(Ba.centroid);$a.multiplyVector3(G.centroidWorld);G.centroidScreen.copy(G.centroidWorld);X.multiplyVector3(G.centroidScreen);xa=Ba.vertexNormals;ua=0;for(Ta=xa.length;ua<Ta;ua++){Ca=G.vertexNormalsWorld[ua];Ca.copy(xa[ua]);hb.multiplyVector3(Ca)}ua=0;for(Ta=Va.length;ua<Ta;ua++)if(pb=Va[ua][Pa]){xa=0;for(Ca=pb.length;xa<Ca;xa++)G.uvs[ua][xa]=pb[xa]}G.meshMaterials=eb;G.faceMaterials=Ba.materials;G.overdraw=sb;G.z=G.centroidScreen.z;Ma.push(G)}}else if(Ga instanceof THREE.Line){Za.multiply(X,
$a);Pa=Ga.geometry.vertices;ua=b();ua.positionScreen.copy(Pa[0].position);Za.multiplyVector4(ua.positionScreen);Oa=1;for(Ba=Pa.length;Oa<Ba;Oa++){ua=b();ua.positionScreen.copy(Pa[Oa].position);Za.multiplyVector4(ua.positionScreen);Ta=E[D-2];Xa.copy(ua.positionScreen);Ja.copy(Ta.positionScreen);if(g(Xa,Ja)){Xa.multiplyScalar(1/Xa.w);Ja.multiplyScalar(1/Ja.w);$a=ca[Y]=ca[Y]||new THREE.RenderableLine;Y++;Q=$a;Q.v1.positionScreen.copy(Xa);Q.v2.positionScreen.copy(Ja);Q.z=Math.max(Xa.z,Ja.z);Q.materials=
Ga.materials;Ma.push(Q)}}}else if(Ga instanceof THREE.Particle){ma.set(Ga.matrixWorld.n14,Ga.matrixWorld.n24,Ga.matrixWorld.n34,1);X.multiplyVector4(ma);ma.z/=ma.w;if(ma.z>0&&ma.z<1){$a=oa[za]=oa[za]||new THREE.RenderableParticle;za++;V=$a;V.x=ma.x/ma.w;V.y=ma.y/ma.w;V.z=ma.z;V.rotation=Ga.rotation.z;V.scale.x=Ga.scale.x*Math.abs(V.x-(ma.x+d.projectionMatrix.n11)/(ma.w+d.projectionMatrix.n14));V.scale.y=Ga.scale.y*Math.abs(V.y-(ma.y+d.projectionMatrix.n22)/(ma.w+d.projectionMatrix.n24));V.materials=
Ga.materials;Ma.push(V)}}}}c&&Ma.sort(f);return Ma}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,f,g){g&&b.update(undefined,!1,f);g=b.sounds;var o,q=g.length;for(o=0;o<q;o++){b=g[o];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(f.position);if(b.isPlaying&&b.isLoaded){b.isAddedToDOM||b.addToDOM(this.domElement);b.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var f,g,o,q={};for(f=0;f<b.length;f++){o=this.clone(b[f]);for(g in o)q[g]=o[g]}return q},clone:function(b){var f,g,o,q={};for(f in b){q[f]={};for(g in b[f]){o=b[f][g];q[f][g]=o instanceof THREE.Color||o instanceof THREE.Vector3||o instanceof THREE.Texture?o.clone():o}}return q}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
anaglyph:{vertexShader:"uniform\tmat4\tprojectionMatrix;\nattribute\tvec3\tposition;\nattribute\tvec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform\tsampler2D\ttexture1;\nuniform\tsampler2D\ttexture2;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color1 = texture2D(texture1, vUV);\nvec4 color2 = texture2D(texture2, vUV);\ngl_FragColor = vec4((color1.x + color2.x)/2.0, 0.0, (color1.z + color2.z)/2.0, 1.0);\n//gl_FragColor = mix(color1, color2);\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.AnaglyphWebGLRenderer=function(b){function f(e,j,n){var i,k,u,t=e.vertices,m=t.length,v=e.colors,z=v.length,p=e.__vertexArray,A=e.__colorArray,H=e.__sortArray,J=e.__dirtyVertices,N=e.__dirtyColors;if(n.sortParticles){Ga.multiplySelf(n.matrixWorld);for(i=0;i<m;i++){k=t[i].position;eb.copy(k);Ga.multiplyVector3(eb);H[i]=[eb.z,i]}H.sort(function(ha,$){return $[0]-ha[0]});for(i=0;i<m;i++){k=t[H[i][1]].position;u=i*3;p[u]=k.x;p[u+1]=k.y;p[u+2]=k.z}for(i=0;i<z;i++){u=i*3;color=v[H[i][1]];A[u]=color.r;
A[u+1]=color.g;A[u+2]=color.b}}else{if(J)for(i=0;i<m;i++){k=t[i].position;u=i*3;p[u]=k.x;p[u+1]=k.y;p[u+2]=k.z}if(N)for(i=0;i<z;i++){color=v[i];u=i*3;A[u]=color.r;A[u+1]=color.g;A[u+2]=color.b}}if(J||n.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,e.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,p,j)}if(N||n.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,e.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,A,j)}}function g(e,j,n,i,k){i.program||d.initMaterial(i,j,n,k);var u=i.program,t=u.uniforms,m=i.uniforms;
if(u!=Qa){c.useProgram(u);Qa=u}c.uniformMatrix4fv(t.projectionMatrix,!1,$a);if(n&&(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial||i instanceof THREE.LineBasicMaterial||i instanceof THREE.ParticleBasicMaterial||i.fog)){m.fogColor.value=n.color;if(n instanceof THREE.Fog){m.fogNear.value=n.near;m.fogFar.value=n.far}else if(n instanceof THREE.FogExp2)m.fogDensity.value=n.density}if(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||
i.lights){var v,z,p=0,A=0,H=0,J,N,ha,$,U=sb,Z=U.directional.colors,fa=U.directional.positions,W=U.point.colors,x=U.point.positions,K=U.point.distances,r=0,C=0;n=z=$=0;for(v=j.length;n<v;n++){z=j[n];J=z.color;N=z.position;ha=z.intensity;$=z.distance;if(z instanceof THREE.AmbientLight){p+=J.r;A+=J.g;H+=J.b}else if(z instanceof THREE.DirectionalLight){$=r*3;Z[$]=J.r*ha;Z[$+1]=J.g*ha;Z[$+2]=J.b*ha;fa[$]=N.x;fa[$+1]=N.y;fa[$+2]=N.z;r+=1}else if(z instanceof THREE.PointLight){z=C*3;W[z]=J.r*ha;W[z+1]=J.g*
ha;W[z+2]=J.b*ha;x[z]=N.x;x[z+1]=N.y;x[z+2]=N.z;K[C]=$;C+=1}}for(n=r*3;n<Z.length;n++)Z[n]=0;for(n=C*3;n<W.length;n++)W[n]=0;U.point.length=C;U.directional.length=r;U.ambient[0]=p;U.ambient[1]=A;U.ambient[2]=H;n=sb;m.enableLighting.value=n.directional.length+n.point.length;m.ambientLightColor.value=n.ambient;m.directionalLightColor.value=n.directional.colors;m.directionalLightDirection.value=n.directional.positions;m.pointLightColor.value=n.point.colors;m.pointLightPosition.value=n.point.positions;
m.pointLightDistance.value=n.point.distances}if(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial){m.diffuse.value=i.color;m.opacity.value=i.opacity;m.map.texture=i.map;m.lightMap.texture=i.lightMap;m.envMap.texture=i.envMap;m.reflectivity.value=i.reflectivity;m.refractionRatio.value=i.refractionRatio;m.combine.value=i.combine;m.useRefract.value=i.envMap&&i.envMap.mapping instanceof THREE.CubeRefractionMapping}if(i instanceof THREE.LineBasicMaterial){m.diffuse.value=
i.color;m.opacity.value=i.opacity}else if(i instanceof THREE.ParticleBasicMaterial){m.psColor.value=i.color;m.opacity.value=i.opacity;m.size.value=i.size;m.scale.value=Va.height/2;m.map.texture=i.map}else if(i instanceof THREE.MeshPhongMaterial){m.ambient.value=i.ambient;m.specular.value=i.specular;m.shininess.value=i.shininess}else if(i instanceof THREE.MeshDepthMaterial){m.mNear.value=e.near;m.mFar.value=e.far;m.opacity.value=i.opacity}else if(i instanceof THREE.MeshNormalMaterial)m.opacity.value=
i.opacity;for(var S in m)if(A=u.uniforms[S]){v=m[S];p=v.type;n=v.value;if(p=="i")c.uniform1i(A,n);else if(p=="f")c.uniform1f(A,n);else if(p=="fv1")c.uniform1fv(A,n);else if(p=="fv")c.uniform3fv(A,n);else if(p=="v2")c.uniform2f(A,n.x,n.y);else if(p=="v3")c.uniform3f(A,n.x,n.y,n.z);else if(p=="v4")c.uniform4f(A,n.x,n.y,n.z,n.w);else if(p=="c")c.uniform3f(A,n.r,n.g,n.b);else if(p=="t"){c.uniform1i(A,n);if(v=v.texture)if(v.image instanceof Array&&v.image.length==6){if(v.image.length==6){if(v.needsUpdate){if(v.__webglInit){c.bindTexture(c.TEXTURE_CUBE_MAP,
v.image.__webglTextureCube);for(p=0;p<6;++p)c.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,0,0,c.RGBA,c.UNSIGNED_BYTE,v.image[p])}else{v.image.__webglTextureCube=c.createTexture();c.bindTexture(c.TEXTURE_CUBE_MAP,v.image.__webglTextureCube);for(p=0;p<6;++p)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,v.image[p]);v.__webglInit=!0}X(c.TEXTURE_CUBE_MAP,v,v.image[0]);c.bindTexture(c.TEXTURE_CUBE_MAP,null);v.needsUpdate=!1}c.activeTexture(c.TEXTURE0+n);c.bindTexture(c.TEXTURE_CUBE_MAP,
v.image.__webglTextureCube)}}else Za(v,n)}}c.uniformMatrix4fv(t.modelViewMatrix,!1,k._modelViewMatrixArray);c.uniformMatrix3fv(t.normalMatrix,!1,k._normalMatrixArray);(i instanceof THREE.MeshShaderMaterial||i instanceof THREE.MeshPhongMaterial||i.envMap)&&t.cameraPosition!==null&&c.uniform3f(t.cameraPosition,e.position.x,e.position.y,e.position.z);(i instanceof THREE.MeshShaderMaterial||i.envMap||i.skinning)&&t.objectMatrix!==null&&c.uniformMatrix4fv(t.objectMatrix,!1,k._objectMatrixArray);(i instanceof
THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshShaderMaterial||i.skinning)&&t.viewMatrix!==null&&c.uniformMatrix4fv(t.viewMatrix,!1,hb);if(i instanceof THREE.ShadowVolumeDynamicMaterial){e=m.directionalLightDirection.value;e[0]=-j[1].position.x;e[1]=-j[1].position.y;e[2]=-j[1].position.z;c.uniform3fv(t.directionalLightDirection,e);c.uniformMatrix4fv(t.objectMatrix,!1,k._objectMatrixArray);c.uniformMatrix4fv(t.viewMatrix,!1,hb)}if(i.skinning){c.uniformMatrix4fv(t.cameraInverseMatrix,
!1,hb);c.uniformMatrix4fv(t.boneGlobalMatrices,!1,k.boneMatrices)}return u}function o(e,j,n,i,k,u){if(i.opacity!=0){var t;e=g(e,j,n,i,u).attributes;if(!i.morphTargets&&e.position>=0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglVertexBuffer);c.vertexAttribPointer(e.position,3,c.FLOAT,!1,0,0)}else{j=i.program.attributes;if(u.morphTargetBase!==-1){c.bindBuffer(c.ARRAY_BUFFER,k.__webglMorphTargetsBuffers[u.morphTargetBase]);c.vertexAttribPointer(j.position,3,c.FLOAT,!1,0,0)}else if(j.position>=0){c.bindBuffer(c.ARRAY_BUFFER,
k.__webglVertexBuffer);c.vertexAttribPointer(j.position,3,c.FLOAT,!1,0,0)}if(u.morphTargetForcedOrder.length){n=0;for(var m=u.morphTargetForcedOrder,v=u.morphTargetInfluences;n<i.numSupportedMorphTargets&&n<m.length;){c.bindBuffer(c.ARRAY_BUFFER,k.__webglMorphTargetsBuffers[m[n]]);c.vertexAttribPointer(j["morphTarget"+n],3,c.FLOAT,!1,0,0);u.__webglMorphTargetInfluences[n]=v[m[n]];n++}}else{m=[];var z=-1,p=0;v=u.morphTargetInfluences;var A,H=v.length;n=0;for(u.morphTargetBase!==-1&&(m[u.morphTargetBase]=
!0);n<i.numSupportedMorphTargets;){for(A=0;A<H;A++)if(!m[A]&&v[A]>z){p=A;z=v[p]}c.bindBuffer(c.ARRAY_BUFFER,k.__webglMorphTargetsBuffers[p]);c.vertexAttribPointer(j["morphTarget"+n],3,c.FLOAT,!1,0,0);u.__webglMorphTargetInfluences[n]=z;m[p]=1;z=-1;n++}}i.program.uniforms.morphTargetInfluences!==null&&c.uniform1fv(i.program.uniforms.morphTargetInfluences,u.__webglMorphTargetInfluences)}if(i.attributes)for(t in i.attributes)if(e[t]!==undefined&&e[t]>=0){j=i.attributes[t];if(j.buffer){c.bindBuffer(c.ARRAY_BUFFER,
j.buffer);c.vertexAttribPointer(e[t],j.size,c.FLOAT,!1,0,0)}}if(e.color>=0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglColorBuffer);c.vertexAttribPointer(e.color,3,c.FLOAT,!1,0,0)}if(e.normal>=0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglNormalBuffer);c.vertexAttribPointer(e.normal,3,c.FLOAT,!1,0,0)}if(e.tangent>=0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglTangentBuffer);c.vertexAttribPointer(e.tangent,4,c.FLOAT,!1,0,0)}if(e.uv>=0)if(k.__webglUVBuffer){c.bindBuffer(c.ARRAY_BUFFER,k.__webglUVBuffer);c.vertexAttribPointer(e.uv,
2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(e.uv)}else c.disableVertexAttribArray(e.uv);if(e.uv2>=0)if(k.__webglUV2Buffer){c.bindBuffer(c.ARRAY_BUFFER,k.__webglUV2Buffer);c.vertexAttribPointer(e.uv2,2,c.FLOAT,!1,0,0);c.enableVertexAttribArray(e.uv2)}else c.disableVertexAttribArray(e.uv2);if(i.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0){c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinVertexABuffer);c.vertexAttribPointer(e.skinVertexA,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,
k.__webglSkinVertexBBuffer);c.vertexAttribPointer(e.skinVertexB,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinIndicesBuffer);c.vertexAttribPointer(e.skinIndex,4,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,k.__webglSkinWeightsBuffer);c.vertexAttribPointer(e.skinWeight,4,c.FLOAT,!1,0,0)}if(u instanceof THREE.Mesh){if(i.wireframe){c.lineWidth(i.wireframeLinewidth);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k.__webglLineBuffer);c.drawElements(c.LINES,k.__webglLineCount,c.UNSIGNED_SHORT,0)}else{c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
k.__webglFaceBuffer);c.drawElements(c.TRIANGLES,k.__webglFaceCount,c.UNSIGNED_SHORT,0)}d.data.vertices+=k.__webglFaceCount;d.data.faces+=k.__webglFaceCount/3;d.data.drawCalls++}else if(u instanceof THREE.Line){u=u.type==THREE.LineStrip?c.LINE_STRIP:c.LINES;c.lineWidth(i.linewidth);c.drawArrays(u,0,k.__webglLineCount);d.data.drawCalls++}else if(u instanceof THREE.ParticleSystem){c.drawArrays(c.POINTS,0,k.__webglParticleCount);d.data.drawCalls++}else if(u instanceof THREE.Ribbon){c.drawArrays(c.TRIANGLE_STRIP,
0,k.__webglVertexCount);d.data.drawCalls++}}}function q(e,j,n){if(!e.__webglVertexBuffer)e.__webglVertexBuffer=c.createBuffer();if(!e.__webglNormalBuffer)e.__webglNormalBuffer=c.createBuffer();if(e.hasPos){c.bindBuffer(c.ARRAY_BUFFER,e.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,e.positionArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(j.attributes.position);c.vertexAttribPointer(j.attributes.position,3,c.FLOAT,!1,0,0)}if(e.hasNormal){c.bindBuffer(c.ARRAY_BUFFER,e.__webglNormalBuffer);if(n==
THREE.FlatShading){var i,k,u,t,m,v,z,p,A,H,J=e.count*3;for(H=0;H<J;H+=9){n=e.normalArray;i=n[H];k=n[H+1];u=n[H+2];t=n[H+3];v=n[H+4];p=n[H+5];m=n[H+6];z=n[H+7];A=n[H+8];i=(i+t+m)/3;k=(k+v+z)/3;u=(u+p+A)/3;n[H]=i;n[H+1]=k;n[H+2]=u;n[H+3]=i;n[H+4]=k;n[H+5]=u;n[H+6]=i;n[H+7]=k;n[H+8]=u}}c.bufferData(c.ARRAY_BUFFER,e.normalArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(j.attributes.normal);c.vertexAttribPointer(j.attributes.normal,3,c.FLOAT,!1,0,0)}c.drawArrays(c.TRIANGLES,0,e.count);e.count=0}function B(e){if(Aa!=
e.doubleSided){e.doubleSided?c.disable(c.CULL_FACE):c.enable(c.CULL_FACE);Aa=e.doubleSided}if(Oa!=e.flipSided){e.flipSided?c.frontFace(c.CW):c.frontFace(c.CCW);Oa=e.flipSided}}function y(e){if(Pa!=e){e?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST);Pa=e}}function D(e){Fa[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14);Fa[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14);Fa[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24);Fa[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24);
Fa[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34);Fa[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);var j;for(e=0;e<6;e++){j=Fa[e];j.divideScalar(Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z))}}function E(e){for(var j=e.matrixWorld,n=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),i=0;i<6;i++){e=Fa[i].x*j.n14+Fa[i].y*j.n24+Fa[i].z*j.n34+Fa[i].w;if(e<=n)return!1}return!0}function G(e,j){e.list[e.count]=j;e.count+=1}function P(e){var j,n,i=e.object,k=e.opaque,
u=e.transparent;u.count=0;e=k.count=0;for(j=i.materials.length;e<j;e++){n=i.materials[e];n.transparent?G(u,n):G(k,n)}}function R(e){var j,n,i,k,u=e.object,t=e.buffer,m=e.opaque,v=e.transparent;v.count=0;e=m.count=0;for(i=u.materials.length;e<i;e++){j=u.materials[e];if(j instanceof THREE.MeshFaceMaterial){j=0;for(n=t.materials.length;j<n;j++)(k=t.materials[j])&&(k.transparent?G(v,k):G(m,k))}else(k=j)&&(k.transparent?G(v,k):G(m,k))}}function T(e,j){return j.z-e.z}function O(e){c.enable(c.POLYGON_OFFSET_FILL);
c.polygonOffset(0.1,1);c.enable(c.STENCIL_TEST);c.enable(c.DEPTH_TEST);c.depthMask(!1);c.colorMask(!1,!1,!1,!1);c.stencilFunc(c.ALWAYS,1,255);c.stencilOpSeparate(c.BACK,c.KEEP,c.INCR,c.KEEP);c.stencilOpSeparate(c.FRONT,c.KEEP,c.DECR,c.KEEP);var j,n=e.lights.length,i,k=e.lights,u=[],t,m,v,z,p,A=e.__webglShadowVolumes.length;for(j=0;j<n;j++){i=e.lights[j];if(i instanceof THREE.DirectionalLight&&i.castShadow){u[0]=-i.position.x;u[1]=-i.position.y;u[2]=-i.position.z;for(p=0;p<A;p++){i=e.__webglShadowVolumes[p].object;
t=e.__webglShadowVolumes[p].buffer;m=i.materials[0];m.program||d.initMaterial(m,k,undefined,i);m=m.program;v=m.uniforms;z=m.attributes;if(Qa!==m){c.useProgram(m);Qa=m;c.uniformMatrix4fv(v.projectionMatrix,!1,$a);c.uniformMatrix4fv(v.viewMatrix,!1,hb);c.uniform3fv(v.directionalLightDirection,u)}i.matrixWorld.flattenToArray(i._objectMatrixArray);c.uniformMatrix4fv(v.objectMatrix,!1,i._objectMatrixArray);c.bindBuffer(c.ARRAY_BUFFER,t.__webglVertexBuffer);c.vertexAttribPointer(z.position,3,c.FLOAT,!1,
0,0);c.bindBuffer(c.ARRAY_BUFFER,t.__webglNormalBuffer);c.vertexAttribPointer(z.normal,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer);c.cullFace(c.FRONT);c.drawElements(c.TRIANGLES,t.__webglFaceCount,c.UNSIGNED_SHORT,0);c.cullFace(c.BACK);c.drawElements(c.TRIANGLES,t.__webglFaceCount,c.UNSIGNED_SHORT,0)}}}c.disable(c.POLYGON_OFFSET_FILL);c.colorMask(!0,!0,!0,!0);c.stencilFunc(c.NOTEQUAL,0,255);c.stencilOp(c.KEEP,c.KEEP,c.KEEP);c.disable(c.DEPTH_TEST);Ba=-1;Qa=L.program;
c.useProgram(L.program);c.uniformMatrix4fv(L.projectionLocation,!1,$a);c.uniform1f(L.darknessLocation,L.darkness);c.bindBuffer(c.ARRAY_BUFFER,L.vertexBuffer);c.vertexAttribPointer(L.vertexLocation,3,c.FLOAT,!1,0,0);c.enableVertexAttribArray(L.vertexLocation);c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.blendEquation(c.FUNC_ADD);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,L.elementBuffer);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);c.disable(c.STENCIL_TEST);c.enable(c.DEPTH_TEST);c.depthMask(Na)}function Q(e,
j){var n,i,k;n=_sprite.attributes;var u=_sprite.uniforms,t=Ca/xa,m,v=[],z=xa*0.5,p=Ca*0.5,A=!0;c.useProgram(_sprite.program);Qa=_sprite.program;Ba=-1;if(!w){c.enableVertexAttribArray(_sprite.attributes.position);c.enableVertexAttribArray(_sprite.attributes.uv);w=!0}c.disable(c.CULL_FACE);c.enable(c.BLEND);c.depthMask(!0);c.bindBuffer(c.ARRAY_BUFFER,_sprite.vertexBuffer);c.vertexAttribPointer(n.position,2,c.FLOAT,!1,16,0);c.vertexAttribPointer(n.uv,2,c.FLOAT,!1,16,8);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);c.uniformMatrix4fv(u.projectionMatrix,!1,$a);c.activeTexture(c.TEXTURE0);c.uniform1i(u.map,0);n=0;for(i=e.__webglSprites.length;n<i;n++){k=e.__webglSprites[n];if(k.useScreenCoordinates)k.z=-k.position.z;else{k._modelViewMatrix.multiplyToArray(j.matrixWorldInverse,k.matrixWorld,k._modelViewMatrixArray);k.z=-k._modelViewMatrix.n34}}e.__webglSprites.sort(T);n=0;for(i=e.__webglSprites.length;n<i;n++){k=e.__webglSprites[n];if(k.material===undefined&&k.map&&k.map.image&&k.map.image.width){if(k.useScreenCoordinates){c.uniform1i(u.useScreenCoordinates,
1);c.uniform3f(u.screenPosition,(k.position.x-z)/z,(p-k.position.y)/p,Math.max(0,Math.min(1,k.position.z)))}else{c.uniform1i(u.useScreenCoordinates,0);c.uniform1i(u.affectedByDistance,k.affectedByDistance?1:0);c.uniformMatrix4fv(u.modelViewMatrix,!1,k._modelViewMatrixArray)}m=k.map.image.width/(k.affectedByDistance?1:Ca);v[0]=m*t*k.scale.x;v[1]=m*k.scale.y;c.uniform2f(u.uvScale,k.uvScale.x,k.uvScale.y);c.uniform2f(u.uvOffset,k.uvOffset.x,k.uvOffset.y);c.uniform2f(u.alignment,k.alignment.x,k.alignment.y);
c.uniform1f(u.opacity,k.opacity);c.uniform1f(u.rotation,k.rotation);c.uniform2fv(u.scale,v);if(k.mergeWith3D&&!A){c.enable(c.DEPTH_TEST);A=!0}else if(!k.mergeWith3D&&A){c.disable(c.DEPTH_TEST);A=!1}ma(k.blending);Za(k.map,0);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(Na)}function Y(e,j,n){c.useProgram(aa.program);Qa=aa.program;Ba=-1;if(!Bb){c.enableVertexAttribArray(aa.vertexLocation);c.enableVertexAttribArray(aa.uv);Bb=!0}c.uniformMatrix4fv(aa.projectionLocation,
!1,$a);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,j.__webglTexture);c.uniform1i(aa.texture1,0);c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,n.__webglTexture);c.uniform1i(aa.texture2,1);c.bindBuffer(c.ARRAY_BUFFER,aa.vertexBuffer);c.vertexAttribPointer(aa.vertexLocation,3,c.FLOAT,!1,20,0);c.vertexAttribPointer(aa.uv,2,c.FLOAT,!1,20,12);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,aa.elementBuffer);c.disable(c.CULL_FACE);c.depthMask(!1);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);
c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(Na)}function ca(e,j){var n,i,k=e.__webglLensFlares.length,u,t,m,v=new THREE.Vector3,z=Ca/xa,p=xa*0.5,A=Ca*0.5,H=16/Ca,J=[H*z,H],N=[1,1,0],ha=[1,1],$=h.uniforms;n=h.attributes;c.useProgram(h.program);Qa=h.program;Ba=-1;if(!F){c.enableVertexAttribArray(h.attributes.vertex);c.enableVertexAttribArray(h.attributes.uv);F=!0}c.uniform1i($.occlusionMap,0);c.uniform1i($.map,1);c.bindBuffer(c.ARRAY_BUFFER,h.vertexBuffer);c.vertexAttribPointer(n.vertex,
2,c.FLOAT,!1,16,0);c.vertexAttribPointer(n.uv,2,c.FLOAT,!1,16,8);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.elementBuffer);c.disable(c.CULL_FACE);c.depthMask(!1);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,h.occlusionTexture);c.activeTexture(c.TEXTURE1);for(i=0;i<k;i++){n=e.__webglLensFlares[i].object;v.set(n.matrixWorld.n14,n.matrixWorld.n24,n.matrixWorld.n34);j.matrixWorldInverse.multiplyVector3(v);j.projectionMatrix.multiplyVector3(v);N[0]=v.x;N[1]=v.y;N[2]=v.z;ha[0]=N[0]*p+p;ha[1]=N[1]*
A+A;if(h.hasVertexTexture||ha[0]>0&&ha[0]<xa&&ha[1]>0&&ha[1]<Ca){c.bindTexture(c.TEXTURE_2D,h.tempTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,ha[0]-8,ha[1]-8,16,16,0);c.uniform1i($.renderType,0);c.uniform2fv($.scale,J);c.uniform3fv($.screenPosition,N);c.disable(c.BLEND);c.enable(c.DEPTH_TEST);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);c.bindTexture(c.TEXTURE_2D,h.occlusionTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,ha[0]-8,ha[1]-8,16,16,0);c.uniform1i($.renderType,1);c.disable(c.DEPTH_TEST);
c.bindTexture(c.TEXTURE_2D,h.tempTexture);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);n.positionScreen.x=N[0];n.positionScreen.y=N[1];n.positionScreen.z=N[2];n.customUpdateCallback?n.customUpdateCallback(n):n.updateLensFlares();c.uniform1i($.renderType,2);c.enable(c.BLEND);u=0;for(t=n.lensFlares.length;u<t;u++){m=n.lensFlares[u];if(m.opacity>0.0010&&m.scale>0.0010){N[0]=m.x;N[1]=m.y;N[2]=m.z;H=m.size*m.scale/Ca;J[0]=H*z;J[1]=H;c.uniform3fv($.screenPosition,N);c.uniform2fv($.scale,J);c.uniform1f($.rotation,
m.rotation);c.uniform1f($.opacity,m.opacity);ma(m.blending);Za(m.texture,1);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}}}c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(Na)}function V(e,j){e._modelViewMatrix.multiplyToArray(j.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function za(e){var j,n,i,k,u;if(e instanceof THREE.Mesh){n=e.geometry;for(j in n.geometryGroups){i=n.geometryGroups[j];
u=!1;for(k in i.__webglCustomAttributes)if(i.__webglCustomAttributes[k].needsUpdate){u=!0;break}if(n.__dirtyVertices||n.__dirtyMorphTargets||n.__dirtyElements||n.__dirtyUvs||n.__dirtyNormals||n.__dirtyColors||n.__dirtyTangents||u){u=e;var t=c.DYNAMIC_DRAW;if(i.__inittedArrays){var m=void 0,v=void 0,z=void 0,p=void 0;z=void 0;var A=void 0,H=void 0,J=void 0,N=void 0,ha=void 0,$=void 0,U=void 0,Z=void 0,fa=void 0,W=void 0,x=void 0,K=void 0,r=void 0;H=void 0;J=void 0;p=void 0;N=void 0;p=void 0;var C=
void 0,S=void 0;H=void 0;C=void 0;S=void 0;var s=void 0,va=void 0;C=void 0;S=void 0;s=void 0;va=void 0;C=void 0;S=void 0;s=void 0;va=void 0;C=void 0;S=void 0;s=void 0;p=void 0;N=void 0;A=void 0;z=void 0;z=void 0;C=void 0;S=void 0;s=void 0;var cb=void 0,Ka=0,sa=0,Wa=0,ya=0,Ha=0,ta=0,I=0,wa=0,ka=0,M=0,Ra=0;S=C=0;var Ea=i.__vertexArray,Ia=i.__uvArray,Sa=i.__uv2Array,qa=i.__normalArray,da=i.__tangentArray,ia=i.__colorArray,ea=i.__skinVertexAArray,La=i.__skinVertexBArray,ra=i.__skinIndexArray,la=i.__skinWeightArray,
ab=i.__morphTargetsArrays,fb=i.__webglCustomAttributes;s=void 0;var Da=i.__faceArray,bb=i.__lineArray,yb=i.__needsSmoothNormals;$=i.__vertexColorType;ha=i.__uvType;U=i.__normalType;var Ua=u.geometry,ub=Ua.__dirtyVertices,vb=Ua.__dirtyElements,lb=Ua.__dirtyUvs,wb=Ua.__dirtyNormals,jb=Ua.__dirtyTangents,zb=Ua.__dirtyColors,Cb=Ua.__dirtyMorphTargets,mb=Ua.vertices,Db=i.faces,qb=Ua.faces,nb=Ua.faceVertexUvs[0],ob=Ua.faceVertexUvs[1],db=Ua.skinVerticesA,gb=Ua.skinVerticesB,xb=Ua.skinIndices,rb=Ua.skinWeights,
tb=u instanceof THREE.ShadowVolume?Ua.edgeFaces:undefined;morphTargets=Ua.morphTargets;if(fb)for(cb in fb){fb[cb].offset=0;fb[cb].offsetSrc=0}m=0;for(v=Db.length;m<v;m++){z=Db[m];p=qb[z];nb&&(Z=nb[z]);ob&&(fa=ob[z]);z=p.vertexNormals;A=p.normal;H=p.vertexColors;J=p.color;N=p.vertexTangents;if(p instanceof THREE.Face3){if(ub){W=mb[p.a].position;x=mb[p.b].position;K=mb[p.c].position;Ea[sa]=W.x;Ea[sa+1]=W.y;Ea[sa+2]=W.z;Ea[sa+3]=x.x;Ea[sa+4]=x.y;Ea[sa+5]=x.z;Ea[sa+6]=K.x;Ea[sa+7]=K.y;Ea[sa+8]=K.z;sa+=
9}if(fb)for(cb in fb){s=fb[cb];if(s.needsUpdate){C=s.offset;S=s.offsetSrc;if(s.size===1){if(s.boundTo===undefined||s.boundTo==="vertices"){s.array[C+0]=s.value[p.a];s.array[C+1]=s.value[p.b];s.array[C+2]=s.value[p.c]}else if(s.boundTo==="faces"){s.array[C+0]=s.value[S];s.array[C+1]=s.value[S];s.array[C+2]=s.value[S];s.offsetSrc++}else if(s.boundTo==="faceVertices"){s.array[C+0]=s.value[S+0];s.array[C+1]=s.value[S+1];s.array[C+2]=s.value[S+2];s.offsetSrc+=3}s.offset+=3}else{if(s.boundTo===undefined||
s.boundTo==="vertices"){W=s.value[p.a];x=s.value[p.b];K=s.value[p.c]}else if(s.boundTo==="faces"){W=s.value[S];x=s.value[S];K=s.value[S];s.offsetSrc++}else if(s.boundTo==="faceVertices"){W=s.value[S+0];x=s.value[S+1];K=s.value[S+2];s.offsetSrc+=3}if(s.size===2){s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=x.x;s.array[C+3]=x.y;s.array[C+4]=K.x;s.array[C+5]=K.y;s.offset+=6}else if(s.size===3){if(s.type==="c"){s.array[C+0]=W.r;s.array[C+1]=W.g;s.array[C+2]=W.b;s.array[C+3]=x.r;s.array[C+4]=x.g;s.array[C+
5]=x.b;s.array[C+6]=K.r;s.array[C+7]=K.g;s.array[C+8]=K.b}else{s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=W.z;s.array[C+3]=x.x;s.array[C+4]=x.y;s.array[C+5]=x.z;s.array[C+6]=K.x;s.array[C+7]=K.y;s.array[C+8]=K.z}s.offset+=9}else{s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=W.z;s.array[C+3]=W.w;s.array[C+4]=x.x;s.array[C+5]=x.y;s.array[C+6]=x.z;s.array[C+7]=x.w;s.array[C+8]=K.x;s.array[C+9]=K.y;s.array[C+10]=K.z;s.array[C+11]=K.w;s.offset+=12}}}}if(Cb){C=0;for(S=morphTargets.length;C<S;C++){W=
morphTargets[C].vertices[p.a].position;x=morphTargets[C].vertices[p.b].position;K=morphTargets[C].vertices[p.c].position;s=ab[C];s[Ra+0]=W.x;s[Ra+1]=W.y;s[Ra+2]=W.z;s[Ra+3]=x.x;s[Ra+4]=x.y;s[Ra+5]=x.z;s[Ra+6]=K.x;s[Ra+7]=K.y;s[Ra+8]=K.z}Ra+=9}if(rb.length){C=rb[p.a];S=rb[p.b];s=rb[p.c];la[M]=C.x;la[M+1]=C.y;la[M+2]=C.z;la[M+3]=C.w;la[M+4]=S.x;la[M+5]=S.y;la[M+6]=S.z;la[M+7]=S.w;la[M+8]=s.x;la[M+9]=s.y;la[M+10]=s.z;la[M+11]=s.w;C=xb[p.a];S=xb[p.b];s=xb[p.c];ra[M]=C.x;ra[M+1]=C.y;ra[M+2]=C.z;ra[M+3]=
C.w;ra[M+4]=S.x;ra[M+5]=S.y;ra[M+6]=S.z;ra[M+7]=S.w;ra[M+8]=s.x;ra[M+9]=s.y;ra[M+10]=s.z;ra[M+11]=s.w;C=db[p.a];S=db[p.b];s=db[p.c];ea[M]=C.x;ea[M+1]=C.y;ea[M+2]=C.z;ea[M+3]=1;ea[M+4]=S.x;ea[M+5]=S.y;ea[M+6]=S.z;ea[M+7]=1;ea[M+8]=s.x;ea[M+9]=s.y;ea[M+10]=s.z;ea[M+11]=1;C=gb[p.a];S=gb[p.b];s=gb[p.c];La[M]=C.x;La[M+1]=C.y;La[M+2]=C.z;La[M+3]=1;La[M+4]=S.x;La[M+5]=S.y;La[M+6]=S.z;La[M+7]=1;La[M+8]=s.x;La[M+9]=s.y;La[M+10]=s.z;La[M+11]=1;M+=12}if(zb&&$){if(H.length==3&&$==THREE.VertexColors){p=H[0];C=
H[1];S=H[2]}else S=C=p=J;ia[ka]=p.r;ia[ka+1]=p.g;ia[ka+2]=p.b;ia[ka+3]=C.r;ia[ka+4]=C.g;ia[ka+5]=C.b;ia[ka+6]=S.r;ia[ka+7]=S.g;ia[ka+8]=S.b;ka+=9}if(jb&&Ua.hasTangents){H=N[0];J=N[1];p=N[2];da[I]=H.x;da[I+1]=H.y;da[I+2]=H.z;da[I+3]=H.w;da[I+4]=J.x;da[I+5]=J.y;da[I+6]=J.z;da[I+7]=J.w;da[I+8]=p.x;da[I+9]=p.y;da[I+10]=p.z;da[I+11]=p.w;I+=12}if(wb&&U)if(z.length==3&&yb)for(N=0;N<3;N++){A=z[N];qa[ta]=A.x;qa[ta+1]=A.y;qa[ta+2]=A.z;ta+=3}else for(N=0;N<3;N++){qa[ta]=A.x;qa[ta+1]=A.y;qa[ta+2]=A.z;ta+=3}if(lb&&
Z!==undefined&&ha)for(N=0;N<3;N++){z=Z[N];Ia[Wa]=z.u;Ia[Wa+1]=z.v;Wa+=2}if(lb&&fa!==undefined&&ha)for(N=0;N<3;N++){z=fa[N];Sa[ya]=z.u;Sa[ya+1]=z.v;ya+=2}if(vb){Da[Ha]=Ka;Da[Ha+1]=Ka+1;Da[Ha+2]=Ka+2;Ha+=3;bb[wa]=Ka;bb[wa+1]=Ka+1;bb[wa+2]=Ka;bb[wa+3]=Ka+2;bb[wa+4]=Ka+1;bb[wa+5]=Ka+2;wa+=6;Ka+=3}}else if(p instanceof THREE.Face4){if(ub){W=mb[p.a].position;x=mb[p.b].position;K=mb[p.c].position;r=mb[p.d].position;Ea[sa]=W.x;Ea[sa+1]=W.y;Ea[sa+2]=W.z;Ea[sa+3]=x.x;Ea[sa+4]=x.y;Ea[sa+5]=x.z;Ea[sa+6]=K.x;
Ea[sa+7]=K.y;Ea[sa+8]=K.z;Ea[sa+9]=r.x;Ea[sa+10]=r.y;Ea[sa+11]=r.z;sa+=12}if(fb)for(cb in fb){s=fb[cb];if(s.needsUpdate){C=s.offset;S=s.offsetSrc;if(s.size===1){if(s.boundTo===undefined||s.boundTo==="vertices"){s.array[C+0]=s.value[p.a];s.array[C+1]=s.value[p.b];s.array[C+2]=s.value[p.c];s.array[C+3]=s.value[p.d]}else if(s.boundTo==="faces"){s.array[C+0]=s.value[S];s.array[C+1]=s.value[S];s.array[C+2]=s.value[S];s.array[C+3]=s.value[S];s.offsetSrc++}else if(s.boundTo==="faceVertices"){s.array[C+0]=
s.value[S+0];s.array[C+1]=s.value[S+1];s.array[C+2]=s.value[S+2];s.array[C+3]=s.value[S+3];s.offsetSrc+=4}s.offset+=4}else{if(s.boundTo===undefined||s.boundTo==="vertices"){W=s.value[p.a];x=s.value[p.b];K=s.value[p.c];r=s.value[p.d]}else if(s.boundTo==="faces"){W=s.value[S];x=s.value[S];K=s.value[S];r=s.value[S];s.offsetSrc++}else if(s.boundTo==="faceVertices"){W=s.value[S+0];x=s.value[S+1];K=s.value[S+2];r=s.value[S+3];s.offsetSrc+=4}if(s.size===2){s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=
x.x;s.array[C+3]=x.y;s.array[C+4]=K.x;s.array[C+5]=K.y;s.array[C+6]=r.x;s.array[C+7]=r.y;s.offset+=8}else if(s.size===3){if(s.type==="c"){s.array[C+0]=W.r;s.array[C+1]=W.g;s.array[C+2]=W.b;s.array[C+3]=x.r;s.array[C+4]=x.g;s.array[C+5]=x.b;s.array[C+6]=K.r;s.array[C+7]=K.g;s.array[C+8]=K.b;s.array[C+9]=r.r;s.array[C+10]=r.g;s.array[C+11]=r.b}else{s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=W.z;s.array[C+3]=x.x;s.array[C+4]=x.y;s.array[C+5]=x.z;s.array[C+6]=K.x;s.array[C+7]=K.y;s.array[C+8]=K.z;
s.array[C+9]=r.x;s.array[C+10]=r.y;s.array[C+11]=r.z}s.offset+=12}else{s.array[C+0]=W.x;s.array[C+1]=W.y;s.array[C+2]=W.z;s.array[C+3]=W.w;s.array[C+4]=x.x;s.array[C+5]=x.y;s.array[C+6]=x.z;s.array[C+7]=x.w;s.array[C+8]=K.x;s.array[C+9]=K.y;s.array[C+10]=K.z;s.array[C+11]=K.w;s.array[C+12]=r.x;s.array[C+13]=r.y;s.array[C+14]=r.z;s.array[C+15]=r.w;s.offset+=16}}}}if(Cb){C=0;for(S=morphTargets.length;C<S;C++){W=morphTargets[C].vertices[p.a].position;x=morphTargets[C].vertices[p.b].position;K=morphTargets[C].vertices[p.c].position;
r=morphTargets[C].vertices[p.d].position;s=ab[C];s[Ra+0]=W.x;s[Ra+1]=W.y;s[Ra+2]=W.z;s[Ra+3]=x.x;s[Ra+4]=x.y;s[Ra+5]=x.z;s[Ra+6]=K.x;s[Ra+7]=K.y;s[Ra+8]=K.z;s[Ra+9]=r.x;s[Ra+10]=r.y;s[Ra+11]=r.z}Ra+=12}if(rb.length){C=rb[p.a];S=rb[p.b];s=rb[p.c];va=rb[p.d];la[M]=C.x;la[M+1]=C.y;la[M+2]=C.z;la[M+3]=C.w;la[M+4]=S.x;la[M+5]=S.y;la[M+6]=S.z;la[M+7]=S.w;la[M+8]=s.x;la[M+9]=s.y;la[M+10]=s.z;la[M+11]=s.w;la[M+12]=va.x;la[M+13]=va.y;la[M+14]=va.z;la[M+15]=va.w;C=xb[p.a];S=xb[p.b];s=xb[p.c];va=xb[p.d];ra[M]=
C.x;ra[M+1]=C.y;ra[M+2]=C.z;ra[M+3]=C.w;ra[M+4]=S.x;ra[M+5]=S.y;ra[M+6]=S.z;ra[M+7]=S.w;ra[M+8]=s.x;ra[M+9]=s.y;ra[M+10]=s.z;ra[M+11]=s.w;ra[M+12]=va.x;ra[M+13]=va.y;ra[M+14]=va.z;ra[M+15]=va.w;C=db[p.a];S=db[p.b];s=db[p.c];va=db[p.d];ea[M]=C.x;ea[M+1]=C.y;ea[M+2]=C.z;ea[M+3]=1;ea[M+4]=S.x;ea[M+5]=S.y;ea[M+6]=S.z;ea[M+7]=1;ea[M+8]=s.x;ea[M+9]=s.y;ea[M+10]=s.z;ea[M+11]=1;ea[M+12]=va.x;ea[M+13]=va.y;ea[M+14]=va.z;ea[M+15]=1;C=gb[p.a];S=gb[p.b];s=gb[p.c];p=gb[p.d];La[M]=C.x;La[M+1]=C.y;La[M+2]=C.z;La[M+
3]=1;La[M+4]=S.x;La[M+5]=S.y;La[M+6]=S.z;La[M+7]=1;La[M+8]=s.x;La[M+9]=s.y;La[M+10]=s.z;La[M+11]=1;La[M+12]=p.x;La[M+13]=p.y;La[M+14]=p.z;La[M+15]=1;M+=16}if(zb&&$){if(H.length==4&&$==THREE.VertexColors){p=H[0];C=H[1];S=H[2];H=H[3]}else H=S=C=p=J;ia[ka]=p.r;ia[ka+1]=p.g;ia[ka+2]=p.b;ia[ka+3]=C.r;ia[ka+4]=C.g;ia[ka+5]=C.b;ia[ka+6]=S.r;ia[ka+7]=S.g;ia[ka+8]=S.b;ia[ka+9]=H.r;ia[ka+10]=H.g;ia[ka+11]=H.b;ka+=12}if(jb&&Ua.hasTangents){H=N[0];J=N[1];p=N[2];N=N[3];da[I]=H.x;da[I+1]=H.y;da[I+2]=H.z;da[I+3]=
H.w;da[I+4]=J.x;da[I+5]=J.y;da[I+6]=J.z;da[I+7]=J.w;da[I+8]=p.x;da[I+9]=p.y;da[I+10]=p.z;da[I+11]=p.w;da[I+12]=N.x;da[I+13]=N.y;da[I+14]=N.z;da[I+15]=N.w;I+=16}if(wb&&U)if(z.length==4&&yb)for(N=0;N<4;N++){A=z[N];qa[ta]=A.x;qa[ta+1]=A.y;qa[ta+2]=A.z;ta+=3}else for(N=0;N<4;N++){qa[ta]=A.x;qa[ta+1]=A.y;qa[ta+2]=A.z;ta+=3}if(lb&&Z!==undefined&&ha)for(N=0;N<4;N++){z=Z[N];Ia[Wa]=z.u;Ia[Wa+1]=z.v;Wa+=2}if(lb&&fa!==undefined&&ha)for(N=0;N<4;N++){z=fa[N];Sa[ya]=z.u;Sa[ya+1]=z.v;ya+=2}if(vb){Da[Ha]=Ka;Da[Ha+
1]=Ka+1;Da[Ha+2]=Ka+3;Da[Ha+3]=Ka+1;Da[Ha+4]=Ka+2;Da[Ha+5]=Ka+3;Ha+=6;bb[wa]=Ka;bb[wa+1]=Ka+1;bb[wa+2]=Ka;bb[wa+3]=Ka+3;bb[wa+4]=Ka+1;bb[wa+5]=Ka+2;bb[wa+6]=Ka+2;bb[wa+7]=Ka+3;wa+=8;Ka+=4}}}if(tb){m=0;for(v=tb.length;m<v;m++){Da[Ha]=tb[m].a;Da[Ha+1]=tb[m].b;Da[Ha+2]=tb[m].c;Da[Ha+3]=tb[m].a;Da[Ha+4]=tb[m].c;Da[Ha+5]=tb[m].d;Ha+=6}}if(ub){c.bindBuffer(c.ARRAY_BUFFER,i.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,Ea,t)}if(fb)for(cb in fb){s=fb[cb];if(s.needsUpdate){c.bindBuffer(c.ARRAY_BUFFER,s.buffer);
c.bufferData(c.ARRAY_BUFFER,s.array,t);s.needsUpdate=!1}}if(Cb){C=0;for(S=morphTargets.length;C<S;C++){c.bindBuffer(c.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[C]);c.bufferData(c.ARRAY_BUFFER,ab[C],t)}}if(zb&&ka>0){c.bindBuffer(c.ARRAY_BUFFER,i.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,ia,t)}if(wb){c.bindBuffer(c.ARRAY_BUFFER,i.__webglNormalBuffer);c.bufferData(c.ARRAY_BUFFER,qa,t)}if(jb&&Ua.hasTangents){c.bindBuffer(c.ARRAY_BUFFER,i.__webglTangentBuffer);c.bufferData(c.ARRAY_BUFFER,da,t)}if(lb&&
Wa>0){c.bindBuffer(c.ARRAY_BUFFER,i.__webglUVBuffer);c.bufferData(c.ARRAY_BUFFER,Ia,t)}if(lb&&ya>0){c.bindBuffer(c.ARRAY_BUFFER,i.__webglUV2Buffer);c.bufferData(c.ARRAY_BUFFER,Sa,t)}if(vb){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,Da,t);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,bb,t)}if(M>0){c.bindBuffer(c.ARRAY_BUFFER,i.__webglSkinVertexABuffer);c.bufferData(c.ARRAY_BUFFER,ea,t);c.bindBuffer(c.ARRAY_BUFFER,
i.__webglSkinVertexBBuffer);c.bufferData(c.ARRAY_BUFFER,La,t);c.bindBuffer(c.ARRAY_BUFFER,i.__webglSkinIndicesBuffer);c.bufferData(c.ARRAY_BUFFER,ra,t);c.bindBuffer(c.ARRAY_BUFFER,i.__webglSkinWeightsBuffer);c.bufferData(c.ARRAY_BUFFER,la,t)}if(!u.dynamic){delete i.__inittedArrays;delete i.__colorArray;delete i.__normalArray;delete i.__tangentArray;delete i.__uvArray;delete i.__uv2Array;delete i.__faceArray;delete i.__vertexArray;delete i.__lineArray;delete i.__skinVertexAArray;delete i.__skinVertexBArray;
delete i.__skinIndexArray;delete i.__skinWeightArray}}}}n.__dirtyVertices=!1;n.__dirtyMorphTargets=!1;n.__dirtyElements=!1;n.__dirtyUvs=!1;n.__dirtyNormals=!1;n.__dirtyTangents=!1;n.__dirtyColors=!1}else if(e instanceof THREE.Ribbon){n=e.geometry;if(n.__dirtyVertices||n.__dirtyColors){e=n;j=c.DYNAMIC_DRAW;ha=e.vertices;i=e.colors;$=ha.length;u=i.length;U=e.__vertexArray;t=e.__colorArray;Z=e.__dirtyColors;if(e.__dirtyVertices){for(m=0;m<$;m++){v=ha[m].position;k=m*3;U[k]=v.x;U[k+1]=v.y;U[k+2]=v.z}c.bindBuffer(c.ARRAY_BUFFER,
e.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,U,j)}if(Z){for(m=0;m<u;m++){color=i[m];k=m*3;t[k]=color.r;t[k+1]=color.g;t[k+2]=color.b}c.bindBuffer(c.ARRAY_BUFFER,e.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,t,j)}}n.__dirtyVertices=!1;n.__dirtyColors=!1}else if(e instanceof THREE.Line){n=e.geometry;if(n.__dirtyVertices||n.__dirtyColors){e=n;j=c.DYNAMIC_DRAW;ha=e.vertices;i=e.colors;$=ha.length;u=i.length;U=e.__vertexArray;t=e.__colorArray;Z=e.__dirtyColors;if(e.__dirtyVertices){for(m=0;m<
$;m++){v=ha[m].position;k=m*3;U[k]=v.x;U[k+1]=v.y;U[k+2]=v.z}c.bindBuffer(c.ARRAY_BUFFER,e.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,U,j)}if(Z){for(m=0;m<u;m++){color=i[m];k=m*3;t[k]=color.r;t[k+1]=color.g;t[k+2]=color.b}c.bindBuffer(c.ARRAY_BUFFER,e.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,t,j)}}n.__dirtyVertices=!1;n.__dirtyColors=!1}else if(e instanceof THREE.ParticleSystem){n=e.geometry;(n.__dirtyVertices||n.__dirtyColors||e.sortParticles)&&f(n,c.DYNAMIC_DRAW,e);n.__dirtyVertices=
!1;n.__dirtyColors=!1}}function oa(e){function j(H){var J=[];n=0;for(i=H.length;n<i;n++)H[n]==undefined?J.push("undefined"):J.push(H[n].id);return J.join("_")}var n,i,k,u,t,m,v,z,p={},A=e.morphTargets!==undefined?e.morphTargets.length:0;e.geometryGroups={};k=0;for(u=e.faces.length;k<u;k++){t=e.faces[k];m=t.materials;v=j(m);p[v]==undefined&&(p[v]={hash:v,counter:0});z=p[v].hash+"_"+p[v].counter;e.geometryGroups[z]==undefined&&(e.geometryGroups[z]={faces:[],materials:m,vertices:0,numMorphTargets:A});
t=t instanceof THREE.Face3?3:4;if(e.geometryGroups[z].vertices+t>65535){p[v].counter+=1;z=p[v].hash+"_"+p[v].counter;e.geometryGroups[z]==undefined&&(e.geometryGroups[z]={faces:[],materials:m,vertices:0,numMorphTargets:A})}e.geometryGroups[z].faces.push(k);e.geometryGroups[z].vertices+=t}}function pa(e,j,n){e.push({buffer:j,object:n,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function ma(e){if(e!=Ba){switch(e){case THREE.AdditiveBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.SRC_ALPHA,
c.ONE);break;case THREE.SubtractiveBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD);c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}Ba=e}}function X(e,j,n){if((n.width&n.width-1)==0&&(n.height&n.height-1)==0){c.texParameteri(e,c.TEXTURE_WRAP_S,Ja(j.wrapS));c.texParameteri(e,c.TEXTURE_WRAP_T,
Ja(j.wrapT));c.texParameteri(e,c.TEXTURE_MAG_FILTER,Ja(j.magFilter));c.texParameteri(e,c.TEXTURE_MIN_FILTER,Ja(j.minFilter));c.generateMipmap(e)}else{c.texParameteri(e,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(e,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(e,c.TEXTURE_MAG_FILTER,Xa(j.magFilter));c.texParameteri(e,c.TEXTURE_MIN_FILTER,Xa(j.minFilter))}}function Za(e,j){if(e.needsUpdate){if(e.__webglTexture)e.__webglTexture=c.deleteTexture(e.__webglTexture);e.__webglTexture=c.createTexture();
c.bindTexture(c.TEXTURE_2D,e.__webglTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e.image);X(c.TEXTURE_2D,e,e.image);c.bindTexture(c.TEXTURE_2D,null);e.needsUpdate=!1}c.activeTexture(c.TEXTURE0+j);c.bindTexture(c.TEXTURE_2D,e.__webglTexture)}function na(e,j){var n;if(e=="fragment")n=c.createShader(c.FRAGMENT_SHADER);else e=="vertex"&&(n=c.createShader(c.VERTEX_SHADER));c.shaderSource(n,j);c.compileShader(n);if(!c.getShaderParameter(n,c.COMPILE_STATUS)){console.error(c.getShaderInfoLog(n));
console.error(j);return null}return n}function Xa(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return c.NEAREST;default:return c.LINEAR}}function Ja(e){switch(e){case THREE.RepeatWrapping:return c.REPEAT;case THREE.ClampToEdgeWrapping:return c.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return c.MIRRORED_REPEAT;case THREE.NearestFilter:return c.NEAREST;case THREE.NearestMipMapNearestFilter:return c.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return c.NEAREST_MIPMAP_LINEAR;
case THREE.LinearFilter:return c.LINEAR;case THREE.LinearMipMapNearestFilter:return c.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return c.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return c.BYTE;case THREE.UnsignedByteType:return c.UNSIGNED_BYTE;case THREE.ShortType:return c.SHORT;case THREE.UnsignedShortType:return c.UNSIGNED_SHORT;case THREE.IntType:return c.INT;case THREE.UnsignedShortType:return c.UNSIGNED_INT;case THREE.FloatType:return c.FLOAT;case THREE.AlphaFormat:return c.ALPHA;
case THREE.RGBFormat:return c.RGB;case THREE.RGBAFormat:return c.RGBA;case THREE.LuminanceFormat:return c.LUMINANCE;case THREE.LuminanceAlphaFormat:return c.LUMINANCE_ALPHA}return 0}function ga(){var e={};if(e.depthBuffer===undefined)e.depthBuffer=!0;if(e.stencilBuffer===undefined)e.stencilBuffer=!0;e.__webglFramebuffer=c.createFramebuffer();e.__webglRenderbuffer=c.createRenderbuffer();e.__webglTexture=c.createTexture();e.width=Va.width;e.height=Va.height;c.bindTexture(c.TEXTURE_2D,e.__webglTexture);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e.width,e.height,0,c.RGBA,c.UNSIGNED_BYTE,null);c.bindRenderbuffer(c.RENDERBUFFER,e.__webglRenderbuffer);c.bindFramebuffer(c.FRAMEBUFFER,e.__webglFramebuffer);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,
e.__webglTexture,0);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,e.width,e.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e.__webglRenderbuffer);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null);return e}var d=this,c,Ma=[],Qa=null,Na=!0,Aa=null,Oa=null,Ba=null,Pa=null,ua=0,Ta=0,xa=0,Ca=0,Fa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],
Ga=new THREE.Matrix4,$a=new Float32Array(16),hb=new Float32Array(16),eb=new THREE.Vector4,sb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};var Va=b.canvas!==undefined?b.canvas:document.createElement("canvas"),ib=b.stencil!==undefined?b.stencil:!0,pb=b.antialias!==undefined?b.antialias:!1,Ya=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0),kb=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,
faces:0,drawCalls:0};var Ab={};this.maxMorphTargets=8;this.domElement=Va;this.autoClear=!0;this.sortObjects=!0;try{if(!(c=Va.getContext("experimental-webgl",{antialias:pb,stencil:ib})))throw"Error creating WebGL context.";}catch(Eb){console.error(Eb)}console.log(navigator.userAgent+" | "+c.getParameter(c.VERSION)+" | "+c.getParameter(c.VENDOR)+" | "+c.getParameter(c.RENDERER)+" | "+c.getParameter(c.SHADING_LANGUAGE_VERSION));c.clearColor(0,0,0,1);c.clearDepth(1);c.enable(c.DEPTH_TEST);c.depthFunc(c.LEQUAL);
c.frontFace(c.CCW);c.cullFace(c.BACK);c.enable(c.CULL_FACE);c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);c.clearColor(Ya.r,Ya.g,Ya.b,kb);this.context=c;var ja=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(ib){var L={};L.vertices=new Float32Array(12);L.faces=new Uint16Array(6);L.darkness=0.5;L.vertices[0]=-500;L.vertices[1]=-500;L.vertices[2]=-1;L.vertices[3]=500;L.vertices[4]=-500;L.vertices[5]=-1;L.vertices[6]=500;L.vertices[7]=500;L.vertices[8]=
-1;L.vertices[9]=-500;L.vertices[10]=500;L.vertices[11]=-1;L.faces[0]=0;L.faces[1]=1;L.faces[2]=2;L.faces[3]=0;L.faces[4]=2;L.faces[5]=3;L.vertexBuffer=c.createBuffer();L.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,L.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,L.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,L.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,L.faces,c.STATIC_DRAW);L.program=c.createProgram();c.attachShader(L.program,na("fragment",THREE.ShaderLib.shadowPost.fragmentShader));
c.attachShader(L.program,na("vertex",THREE.ShaderLib.shadowPost.vertexShader));c.linkProgram(L.program);L.vertexLocation=c.getAttribLocation(L.program,"position");L.projectionLocation=c.getUniformLocation(L.program,"projectionMatrix");L.darknessLocation=c.getUniformLocation(L.program,"darkness")}var aa={};aa.vertices=new Float32Array(20);aa.faces=new Uint16Array(6);aa.vertices[0]=-20;aa.vertices[1]=-20;aa.vertices[2]=-1;aa.vertices[3]=0;aa.vertices[4]=0;aa.vertices[5]=20;aa.vertices[6]=-20;aa.vertices[7]=
-1;aa.vertices[8]=1;aa.vertices[9]=0;aa.vertices[10]=20;aa.vertices[11]=20;aa.vertices[12]=-1;aa.vertices[13]=1;aa.vertices[14]=1;aa.vertices[15]=-20;aa.vertices[16]=20;aa.vertices[17]=-1;aa.vertices[18]=0;aa.vertices[19]=1;aa.faces[0]=0;aa.faces[1]=1;aa.faces[2]=2;aa.faces[3]=0;aa.faces[4]=2;aa.faces[5]=3;aa.vertexBuffer=c.createBuffer();aa.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,aa.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,aa.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
aa.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,aa.faces,c.STATIC_DRAW);aa.program=c.createProgram();c.attachShader(aa.program,na("vertex",THREE.ShaderLib.anaglyph.vertexShader));c.attachShader(aa.program,na("fragment",THREE.ShaderLib.anaglyph.fragmentShader));c.linkProgram(aa.program);alert("Anaglyph Program: "+aa.program);aa.vertexLocation=c.getAttribLocation(aa.program,"position");aa.uv=c.getAttribLocation(aa.program,"UV");aa.projectionLocation=c.getUniformLocation(aa.program,"projectionMatrix");
aa.texture1=c.getUniformLocation(aa.program,"texture1");aa.texture2=c.getUniformLocation(aa.program,"texture2");var Bb=!1;alert("Anaglyph Program2: "+aa.vertexLocation+" , "+aa.uv);var h={};h.vertices=new Float32Array(16);h.faces=new Uint16Array(6);b=0;h.vertices[b++]=-1;h.vertices[b++]=-1;h.vertices[b++]=0;h.vertices[b++]=0;h.vertices[b++]=1;h.vertices[b++]=-1;h.vertices[b++]=1;h.vertices[b++]=0;h.vertices[b++]=1;h.vertices[b++]=1;h.vertices[b++]=1;h.vertices[b++]=1;h.vertices[b++]=-1;h.vertices[b++]=
1;h.vertices[b++]=0;h.vertices[b++]=1;b=0;h.faces[b++]=0;h.faces[b++]=1;h.faces[b++]=2;h.faces[b++]=0;h.faces[b++]=2;h.faces[b++]=3;h.vertexBuffer=c.createBuffer();h.elementBuffer=c.createBuffer();h.tempTexture=c.createTexture();h.occlusionTexture=c.createTexture();c.bindBuffer(c.ARRAY_BUFFER,h.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,h.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,h.faces,c.STATIC_DRAW);c.bindTexture(c.TEXTURE_2D,
h.tempTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,h.occlusionTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);if(c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){h.hasVertexTexture=!1;h.program=c.createProgram();c.attachShader(h.program,na("fragment",THREE.ShaderLib.lensFlare.fragmentShader));c.attachShader(h.program,na("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{h.hasVertexTexture=!0;h.program=c.createProgram();
c.attachShader(h.program,na("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));c.attachShader(h.program,na("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}c.linkProgram(h.program);h.attributes={};h.uniforms={};h.attributes.vertex=c.getAttribLocation(h.program,"position");h.attributes.uv=c.getAttribLocation(h.program,"UV");h.uniforms.renderType=c.getUniformLocation(h.program,"renderType");h.uniforms.map=c.getUniformLocation(h.program,"map");h.uniforms.occlusionMap=c.getUniformLocation(h.program,
"occlusionMap");h.uniforms.opacity=c.getUniformLocation(h.program,"opacity");h.uniforms.scale=c.getUniformLocation(h.program,"scale");h.uniforms.rotation=c.getUniformLocation(h.program,"rotation");h.uniforms.screenPosition=c.getUniformLocation(h.program,"screenPosition");var F=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=c.createBuffer();_sprite.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,_sprite.vertexBuffer);
c.bufferData(c.ARRAY_BUFFER,_sprite.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,_sprite.faces,c.STATIC_DRAW);_sprite.program=c.createProgram();c.attachShader(_sprite.program,na("fragment",THREE.ShaderLib.sprite.fragmentShader));c.attachShader(_sprite.program,na("vertex",THREE.ShaderLib.sprite.vertexShader));c.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=c.getAttribLocation(_sprite.program,
"position");_sprite.attributes.uv=c.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=c.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=c.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=c.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=c.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=c.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=c.getUniformLocation(_sprite.program,
"map");_sprite.uniforms.opacity=c.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=c.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=c.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=c.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=c.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=c.getUniformLocation(_sprite.program,
"projectionMatrix");var w=!1;this.setSize=function(e,j){Va.width=e;Va.height=j;this.setViewport(0,0,Va.width,Va.height);Ab=ga();ga();ga()};this.setViewport=function(e,j,n,i){ua=e;Ta=j;xa=n;Ca=i;c.viewport(ua,Ta,xa,Ca)};this.setScissor=function(e,j,n,i){c.scissor(e,j,n,i)};this.enableScissorTest=function(e){e?c.enable(c.SCISSOR_TEST):c.disable(c.SCISSOR_TEST)};this.enableDepthBufferWrite=function(e){Na=e;c.depthMask(e)};this.setClearColorHex=function(e,j){Ya.setHex(e);kb=j;c.clearColor(Ya.r,Ya.g,Ya.b,
kb)};this.setClearColor=function(e,j){Ya.copy(e);kb=j;c.clearColor(Ya.r,Ya.g,Ya.b,kb)};this.clear=function(){c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(e){L.darkness=e};this.getContext=function(){return c};this.initMaterial=function(e,j,n,i){var k,u,t;if(e instanceof THREE.MeshDepthMaterial)t="depth";else if(e instanceof THREE.ShadowVolumeDynamicMaterial)t="shadowVolumeDynamic";else if(e instanceof THREE.MeshNormalMaterial)t="normal";
else if(e instanceof THREE.MeshBasicMaterial)t="basic";else if(e instanceof THREE.MeshLambertMaterial)t="lambert";else if(e instanceof THREE.MeshPhongMaterial)t="phong";else if(e instanceof THREE.LineBasicMaterial)t="basic";else e instanceof THREE.ParticleBasicMaterial&&(t="particle_basic");if(t){var m=THREE.ShaderLib[t];e.uniforms=THREE.UniformsUtils.clone(m.uniforms);e.vertexShader=m.vertexShader;e.fragmentShader=m.fragmentShader}var v,z,p;v=p=m=0;for(z=j.length;v<z;v++){u=j[v];u instanceof THREE.DirectionalLight&&
p++;u instanceof THREE.PointLight&&m++}if(m+p<=4)j=p;else{j=Math.ceil(4*p/(m+p));m=4-j}u={directional:j,point:m};p=50;if(i!==undefined&&i instanceof THREE.SkinnedMesh)p=i.bones.length;var A;a:{v=e.fragmentShader;z=e.vertexShader;m=e.uniforms;j=e.attributes;n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:n,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:u.directional,maxPointLights:u.point,
maxBones:p};var H;u=[];if(t)u.push(t);else{u.push(v);u.push(z)}for(H in n){u.push(H);u.push(n[H])}t=u.join();H=0;for(u=Ma.length;H<u;H++)if(Ma[H].code==t){A=Ma[H].program;break a}H=c.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,n.fog?"#define USE_FOG":"",n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":
"",n.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[ja?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.sizeAttenuation?
"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
c.attachShader(H,na("fragment",prefix_fragment+v));c.attachShader(H,na("vertex",prefix_vertex+z));c.linkProgram(H);c.getProgramParameter(H,c.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+c.getProgramParameter(H,c.VALIDATE_STATUS)+", gl error ["+c.getError()+"]");H.uniforms={};H.attributes={};var J;v=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(J in m)v.push(J);
J=v;m=0;for(v=J.length;m<v;m++){z=J[m];H.uniforms[z]=c.getUniformLocation(H,z)}v=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(J=0;J<n.maxMorphTargets;J++)v.push("morphTarget"+J);for(A in j)v.push(A);A=v;J=0;for(j=A.length;J<j;J++){n=A[J];H.attributes[n]=c.getAttribLocation(H,n)}Ma.push({program:H,code:t});A=H}e.program=A;A=e.program.attributes;A.position>=0&&c.enableVertexAttribArray(A.position);A.color>=0&&c.enableVertexAttribArray(A.color);
A.normal>=0&&c.enableVertexAttribArray(A.normal);A.tangent>=0&&c.enableVertexAttribArray(A.tangent);if(e.skinning&&A.skinVertexA>=0&&A.skinVertexB>=0&&A.skinIndex>=0&&A.skinWeight>=0){c.enableVertexAttribArray(A.skinVertexA);c.enableVertexAttribArray(A.skinVertexB);c.enableVertexAttribArray(A.skinIndex);c.enableVertexAttribArray(A.skinWeight)}if(e.attributes)for(k in e.attributes)A[k]!==undefined&&A[k]>=0&&c.enableVertexAttribArray(A[k]);if(e.morphTargets){e.numSupportedMorphTargets=0;if(A.morphTarget0>=
0){c.enableVertexAttribArray(A.morphTarget0);e.numSupportedMorphTargets++}if(A.morphTarget1>=0){c.enableVertexAttribArray(A.morphTarget1);e.numSupportedMorphTargets++}if(A.morphTarget2>=0){c.enableVertexAttribArray(A.morphTarget2);e.numSupportedMorphTargets++}if(A.morphTarget3>=0){c.enableVertexAttribArray(A.morphTarget3);e.numSupportedMorphTargets++}if(A.morphTarget4>=0){c.enableVertexAttribArray(A.morphTarget4);e.numSupportedMorphTargets++}if(A.morphTarget5>=0){c.enableVertexAttribArray(A.morphTarget5);
e.numSupportedMorphTargets++}if(A.morphTarget6>=0){c.enableVertexAttribArray(A.morphTarget6);e.numSupportedMorphTargets++}if(A.morphTarget7>=0){c.enableVertexAttribArray(A.morphTarget7);e.numSupportedMorphTargets++}i.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);e=0;for(k=this.maxMorphTargets;e<k;e++)i.__webglMorphTargetInfluences[e]=0}};this.render=function(e,j,n,i){var k,u,t,m,v,z,p,A,H=e.lights,J=e.fog;d.data.vertices=0;d.data.faces=0;d.data.drawCalls=0;c.bindFramebuffer(c.FRAMEBUFFER,
Ab.__webglFramebuffer);c.colorMask(!0,!1,!1,!1);j.matrixAutoUpdate&&j.update(undefined,!0);e.update(undefined,!1,j);j.matrixWorldInverse.flattenToArray(hb);j.projectionMatrix.flattenToArray($a);Ga.multiply(j.projectionMatrix,j.matrixWorldInverse);D(Ga);this.initWebGLObjects(e);(this.autoClear||i)&&this.clear();v=e.__webglObjects.length;for(i=0;i<v;i++){k=e.__webglObjects[i];p=k.object;if(p.visible)if(!(p instanceof THREE.Mesh)||E(p)){p.matrixWorld.flattenToArray(p._objectMatrixArray);V(p,j);R(k);
k.render=!0;if(this.sortObjects){eb.copy(p.position);Ga.multiplyVector3(eb);k.z=eb.z}}else k.render=!1;else k.render=!1}this.sortObjects&&e.__webglObjects.sort(T);z=e.__webglObjectsImmediate.length;for(i=0;i<z;i++){k=e.__webglObjectsImmediate[i];p=k.object;if(p.visible){p.matrixAutoUpdate&&p.matrixWorld.flattenToArray(p._objectMatrixArray);V(p,j);P(k)}}ma(THREE.NormalBlending);for(i=0;i<v;i++){k=e.__webglObjects[i];if(k.render){p=k.object;A=k.buffer;t=k.opaque;B(p);for(k=0;k<t.count;k++){m=t.list[k];
y(m.depthTest);o(j,H,J,m,A,p)}}}for(i=0;i<z;i++){k=e.__webglObjectsImmediate[i];p=k.object;if(p.visible){t=k.opaque;B(p);for(k=0;k<t.count;k++){m=t.list[k];y(m.depthTest);u=g(j,H,J,m,p);p.render(function(N){q(N,u,m.shading)})}}}for(i=0;i<v;i++){k=e.__webglObjects[i];if(k.render){p=k.object;A=k.buffer;t=k.transparent;B(p);for(k=0;k<t.count;k++){m=t.list[k];ma(m.blending);y(m.depthTest);o(j,H,J,m,A,p)}}}for(i=0;i<z;i++){k=e.__webglObjectsImmediate[i];p=k.object;if(p.visible){t=k.transparent;B(p);for(k=
0;k<t.count;k++){m=t.list[k];ma(m.blending);y(m.depthTest);u=g(j,H,J,m,p);p.render(function(N){q(N,u,m.shading)})}}}e.__webglSprites.length&&Q(e,j);ib&&e.__webglShadowVolumes.length&&e.lights.length&&O(e);e.__webglLensFlares.length&&ca(e,j);if(n&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter){c.bindTexture(c.TEXTURE_2D,n.__webglTexture);c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null)}c.bindFramebuffer(c.FRAMEBUFFER,null);Y(e,Ab,Ab);c.finish()};this.initWebGLObjects=
function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglShadowVolumes=[];e.__webglLensFlares=[];e.__webglSprites=[]}for(;e.__objectsAdded.length;){var j=e.__objectsAdded[0],n=e,i=void 0,k=void 0,u=void 0;if(j._modelViewMatrix==undefined){j._modelViewMatrix=new THREE.Matrix4;j._normalMatrixArray=new Float32Array(9);j._modelViewMatrixArray=new Float32Array(16);j._objectMatrixArray=new Float32Array(16);j.matrixWorld.flattenToArray(j._objectMatrixArray)}if(j instanceof
THREE.Mesh){k=j.geometry;k.geometryGroups==undefined&&oa(k);for(i in k.geometryGroups){u=k.geometryGroups[i];if(!u.__webglVertexBuffer){var t=u;t.__webglVertexBuffer=c.createBuffer();t.__webglNormalBuffer=c.createBuffer();t.__webglTangentBuffer=c.createBuffer();t.__webglColorBuffer=c.createBuffer();t.__webglUVBuffer=c.createBuffer();t.__webglUV2Buffer=c.createBuffer();t.__webglSkinVertexABuffer=c.createBuffer();t.__webglSkinVertexBBuffer=c.createBuffer();t.__webglSkinIndicesBuffer=c.createBuffer();
t.__webglSkinWeightsBuffer=c.createBuffer();t.__webglFaceBuffer=c.createBuffer();t.__webglLineBuffer=c.createBuffer();if(t.numMorphTargets){var m=void 0,v=void 0;t.__webglMorphTargetsBuffers=[];m=0;for(v=t.numMorphTargets;m<v;m++)t.__webglMorphTargetsBuffers.push(c.createBuffer())}t=u;m=j;var z=void 0,p=void 0,A=void 0;A=void 0;var H=void 0,J=void 0,N=void 0,ha=N=v=0;p=void 0;A=void 0;var $=void 0;z=void 0;p=void 0;H=m.geometry;$=H.faces;J=t.faces;z=0;for(p=J.length;z<p;z++){A=J[z];A=$[A];if(A instanceof
THREE.Face3){v+=3;N+=1;ha+=3}else if(A instanceof THREE.Face4){v+=4;N+=2;ha+=4}}z=t;p=m;$=void 0;J=void 0;var U=void 0,Z=void 0;U=void 0;A=[];$=0;for(J=p.materials.length;$<J;$++){U=p.materials[$];if(U instanceof THREE.MeshFaceMaterial){U=0;for(l=z.materials.length;U<l;U++)(Z=z.materials[U])&&A.push(Z)}else(Z=U)&&A.push(Z)}z=A;a:{p=void 0;$=void 0;J=z.length;for(p=0;p<J;p++){$=z[p];if($.map||$.lightMap||$ instanceof THREE.MeshShaderMaterial){p=!0;break a}}p=!1}a:{$=void 0;J=void 0;A=z.length;for($=
0;$<A;$++){J=z[$];if(!(J instanceof THREE.MeshBasicMaterial&&!J.envMap||J instanceof THREE.MeshDepthMaterial)){$=J&&J.shading!=undefined&&J.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}$=!1}a:{J=void 0;A=void 0;U=z.length;for(J=0;J<U;J++){A=z[J];if(A.vertexColors){A=A.vertexColors;break a}}A=!1}t.__vertexArray=new Float32Array(v*3);if($)t.__normalArray=new Float32Array(v*3);if(H.hasTangents)t.__tangentArray=new Float32Array(v*4);if(A)t.__colorArray=new Float32Array(v*
3);if(p){if(H.faceUvs.length>0||H.faceVertexUvs.length>0)t.__uvArray=new Float32Array(v*2);if(H.faceUvs.length>1||H.faceVertexUvs.length>1)t.__uv2Array=new Float32Array(v*2)}if(m.geometry.skinWeights.length&&m.geometry.skinIndices.length){t.__skinVertexAArray=new Float32Array(v*4);t.__skinVertexBArray=new Float32Array(v*4);t.__skinIndexArray=new Float32Array(v*4);t.__skinWeightArray=new Float32Array(v*4)}t.__faceArray=new Uint16Array(N*3+(m.geometry.edgeFaces?m.geometry.edgeFaces.length*6:0));t.__lineArray=
new Uint16Array(ha*2);if(t.numMorphTargets){t.__morphTargetsArrays=[];H=0;for(J=t.numMorphTargets;H<J;H++)t.__morphTargetsArrays.push(new Float32Array(v*3))}t.__needsSmoothNormals=$==THREE.SmoothShading;t.__uvType=p;t.__vertexColorType=A;t.__normalType=$;t.__webglFaceCount=N*3+(m.geometry.edgeFaces?m.geometry.edgeFaces.length*6:0);t.__webglLineCount=ha*2;H=0;for(J=z.length;H<J;H++)if(z[H].attributes){t.__webglCustomAttributes={};for(a in z[H].attributes){p=z[H].attributes[a];if(!p.__webglInitialized||
p.createUniqueBuffers){p.__webglInitialized=!0;N=1;if(p.type==="v2")N=2;else if(p.type==="v3")N=3;else if(p.type==="v4")N=4;else p.type==="c"&&(N=3);p.size=N;p.needsUpdate=!0;p.array=new Float32Array(v*N);p.buffer=c.createBuffer();p.buffer.belongsToAttribute=a}t.__webglCustomAttributes[a]=p}}t.__inittedArrays=!0;k.__dirtyVertices=!0;k.__dirtyMorphTargets=!0;k.__dirtyElements=!0;k.__dirtyUvs=!0;k.__dirtyNormals=!0;k.__dirtyTangents=!0;k.__dirtyColors=!0}j instanceof THREE.ShadowVolume?pa(n.__webglShadowVolumes,
u,j):pa(n.__webglObjects,u,j)}}else if(j instanceof THREE.LensFlare)pa(n.__webglLensFlares,undefined,j);else if(j instanceof THREE.Ribbon){k=j.geometry;if(!k.__webglVertexBuffer){i=k;i.__webglVertexBuffer=c.createBuffer();i.__webglColorBuffer=c.createBuffer();i=k;u=i.vertices.length;i.__vertexArray=new Float32Array(u*3);i.__colorArray=new Float32Array(u*3);i.__webglVertexCount=u;k.__dirtyVertices=!0;k.__dirtyColors=!0}pa(n.__webglObjects,k,j)}else if(j instanceof THREE.Line){k=j.geometry;if(!k.__webglVertexBuffer){i=
k;i.__webglVertexBuffer=c.createBuffer();i.__webglColorBuffer=c.createBuffer();i=k;u=i.vertices.length;i.__vertexArray=new Float32Array(u*3);i.__colorArray=new Float32Array(u*3);i.__webglLineCount=u;k.__dirtyVertices=!0;k.__dirtyColors=!0}pa(n.__webglObjects,k,j)}else if(j instanceof THREE.ParticleSystem){k=j.geometry;if(!k.__webglVertexBuffer){i=k;i.__webglVertexBuffer=c.createBuffer();i.__webglColorBuffer=c.createBuffer();i=k;u=i.vertices.length;i.__vertexArray=new Float32Array(u*3);i.__colorArray=
new Float32Array(u*3);i.__sortArray=[];i.__webglParticleCount=u;k.__dirtyVertices=!0;k.__dirtyColors=!0}pa(n.__webglObjects,k,j)}else if(THREE.MarchingCubes!==undefined&&j instanceof THREE.MarchingCubes)n.__webglObjectsImmediate.push({object:j,opaque:{list:[],count:0},transparent:{list:[],count:0}});else j instanceof THREE.Sprite&&n.__webglSprites.push(j);e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){j=e.__objectsRemoved[0];n=e;k=void 0;i=void 0;if(j instanceof THREE.Mesh)for(k=n.__webglObjects.length-
1;k>=0;k--){i=n.__webglObjects[k].object;if(j==i){n.__webglObjects.splice(k,1);break}}else if(j instanceof THREE.Sprite)for(k=n.__webglSprites.length-1;k>=0;k--){i=n.__webglSprites[k];if(j==i){n.__webglSprites.splice(k,1);break}}e.__objectsRemoved.splice(0,1)}j=0;for(n=e.__webglObjects.length;j<n;j++)za(e.__webglObjects[j].object,e);j=0;for(n=e.__webglShadowVolumes.length;j<n;j++)za(e.__webglShadowVolumes[j].object,e);j=0;for(n=e.__webglLensFlares.length;j<n;j++)za(e.__webglLensFlares[j].object,e)};
this.setFaceCulling=function(e,j){if(e){!j||j=="ccw"?c.frontFace(c.CCW):c.frontFace(c.CW);if(e=="back")c.cullFace(c.BACK);else e=="front"?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK);c.enable(c.CULL_FACE)}else c.disable(c.CULL_FACE)};this.supportsVertexTextures=function(){return ja}};
THREE.WebGLRenderer=function(b){function f(h,F,w){var e,j,n,i=h.vertices,k=i.length,u=h.colors,t=u.length,m=h.__vertexArray,v=h.__colorArray,z=h.__sortArray,p=h.__dirtyVertices,A=h.__dirtyColors;if(w.sortParticles){Ga.multiplySelf(w.matrixWorld);for(e=0;e<k;e++){j=i[e].position;eb.copy(j);Ga.multiplyVector3(eb);z[e]=[eb.z,e]}z.sort(function(H,J){return J[0]-H[0]});for(e=0;e<k;e++){j=i[z[e][1]].position;n=e*3;m[n]=j.x;m[n+1]=j.y;m[n+2]=j.z}for(e=0;e<t;e++){n=e*3;color=u[z[e][1]];v[n]=color.r;v[n+1]=
color.g;v[n+2]=color.b}}else{if(p)for(e=0;e<k;e++){j=i[e].position;n=e*3;m[n]=j.x;m[n+1]=j.y;m[n+2]=j.z}if(A)for(e=0;e<t;e++){color=u[e];n=e*3;v[n]=color.r;v[n+1]=color.g;v[n+2]=color.b}}if(p||w.sortParticles){d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,m,F)}if(A||w.sortParticles){d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,v,F)}}function g(h,F,w,e,j){e.program||ga.initMaterial(e,F,w,j);var n=e.program,i=n.uniforms,k=e.uniforms;
if(n!=Ma){d.useProgram(n);Ma=n}d.uniformMatrix4fv(i.projectionMatrix,!1,$a);if(w&&(e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial||e instanceof THREE.LineBasicMaterial||e instanceof THREE.ParticleBasicMaterial||e.fog)){k.fogColor.value=w.color;if(w instanceof THREE.Fog){k.fogNear.value=w.near;k.fogFar.value=w.far}else if(w instanceof THREE.FogExp2)k.fogDensity.value=w.density}if(e instanceof THREE.MeshPhongMaterial||e instanceof THREE.MeshLambertMaterial||
e.lights){var u,t,m=0,v=0,z=0,p,A,H,J,N=sb,ha=N.directional.colors,$=N.directional.positions,U=N.point.colors,Z=N.point.positions,fa=N.point.distances,W=0,x=0;w=t=J=0;for(u=F.length;w<u;w++){t=F[w];p=t.color;A=t.position;H=t.intensity;J=t.distance;if(t instanceof THREE.AmbientLight){m+=p.r;v+=p.g;z+=p.b}else if(t instanceof THREE.DirectionalLight){J=W*3;ha[J]=p.r*H;ha[J+1]=p.g*H;ha[J+2]=p.b*H;$[J]=A.x;$[J+1]=A.y;$[J+2]=A.z;W+=1}else if(t instanceof THREE.PointLight){t=x*3;U[t]=p.r*H;U[t+1]=p.g*H;
U[t+2]=p.b*H;Z[t]=A.x;Z[t+1]=A.y;Z[t+2]=A.z;fa[x]=J;x+=1}}for(w=W*3;w<ha.length;w++)ha[w]=0;for(w=x*3;w<U.length;w++)U[w]=0;N.point.length=x;N.directional.length=W;N.ambient[0]=m;N.ambient[1]=v;N.ambient[2]=z;w=sb;k.enableLighting.value=w.directional.length+w.point.length;k.ambientLightColor.value=w.ambient;k.directionalLightColor.value=w.directional.colors;k.directionalLightDirection.value=w.directional.positions;k.pointLightColor.value=w.point.colors;k.pointLightPosition.value=w.point.positions;
k.pointLightDistance.value=w.point.distances}if(e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial){k.diffuse.value=e.color;k.opacity.value=e.opacity;k.map.texture=e.map;k.lightMap.texture=e.lightMap;k.envMap.texture=e.envMap;k.reflectivity.value=e.reflectivity;k.refractionRatio.value=e.refractionRatio;k.combine.value=e.combine;k.useRefract.value=e.envMap&&e.envMap.mapping instanceof THREE.CubeRefractionMapping}if(e instanceof THREE.LineBasicMaterial){k.diffuse.value=
e.color;k.opacity.value=e.opacity}else if(e instanceof THREE.ParticleBasicMaterial){k.psColor.value=e.color;k.opacity.value=e.opacity;k.size.value=e.size;k.scale.value=Va.height/2;k.map.texture=e.map}else if(e instanceof THREE.MeshPhongMaterial){k.ambient.value=e.ambient;k.specular.value=e.specular;k.shininess.value=e.shininess}else if(e instanceof THREE.MeshDepthMaterial){k.mNear.value=h.near;k.mFar.value=h.far;k.opacity.value=e.opacity}else if(e instanceof THREE.MeshNormalMaterial)k.opacity.value=
e.opacity;for(var K in k)if(v=n.uniforms[K]){u=k[K];m=u.type;w=u.value;if(m=="i")d.uniform1i(v,w);else if(m=="f")d.uniform1f(v,w);else if(m=="fv1")d.uniform1fv(v,w);else if(m=="fv")d.uniform3fv(v,w);else if(m=="v2")d.uniform2f(v,w.x,w.y);else if(m=="v3")d.uniform3f(v,w.x,w.y,w.z);else if(m=="v4")d.uniform4f(v,w.x,w.y,w.z,w.w);else if(m=="c")d.uniform3f(v,w.r,w.g,w.b);else if(m=="t"){d.uniform1i(v,w);if(u=u.texture)if(u.image instanceof Array&&u.image.length==6){if(u.image.length==6){if(u.needsUpdate){if(u.__webglInit){d.bindTexture(d.TEXTURE_CUBE_MAP,
u.image.__webglTextureCube);for(m=0;m<6;++m)d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,d.RGBA,d.UNSIGNED_BYTE,u.image[m])}else{u.image.__webglTextureCube=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,u.image.__webglTextureCube);for(m=0;m<6;++m)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,u.image[m]);u.__webglInit=!0}ma(d.TEXTURE_CUBE_MAP,u,u.image[0]);d.bindTexture(d.TEXTURE_CUBE_MAP,null);u.needsUpdate=!1}d.activeTexture(d.TEXTURE0+w);d.bindTexture(d.TEXTURE_CUBE_MAP,
u.image.__webglTextureCube)}}else X(u,w)}}d.uniformMatrix4fv(i.modelViewMatrix,!1,j._modelViewMatrixArray);d.uniformMatrix3fv(i.normalMatrix,!1,j._normalMatrixArray);(e instanceof THREE.MeshShaderMaterial||e instanceof THREE.MeshPhongMaterial||e.envMap)&&i.cameraPosition!==null&&d.uniform3f(i.cameraPosition,h.position.x,h.position.y,h.position.z);(e instanceof THREE.MeshShaderMaterial||e.envMap||e.skinning)&&i.objectMatrix!==null&&d.uniformMatrix4fv(i.objectMatrix,!1,j._objectMatrixArray);(e instanceof
THREE.MeshPhongMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshShaderMaterial||e.skinning)&&i.viewMatrix!==null&&d.uniformMatrix4fv(i.viewMatrix,!1,hb);if(e instanceof THREE.ShadowVolumeDynamicMaterial){h=k.directionalLightDirection.value;h[0]=-F[1].position.x;h[1]=-F[1].position.y;h[2]=-F[1].position.z;d.uniform3fv(i.directionalLightDirection,h);d.uniformMatrix4fv(i.objectMatrix,!1,j._objectMatrixArray);d.uniformMatrix4fv(i.viewMatrix,!1,hb)}if(e.skinning){d.uniformMatrix4fv(i.cameraInverseMatrix,
!1,hb);d.uniformMatrix4fv(i.boneGlobalMatrices,!1,j.boneMatrices)}return n}function o(h,F,w,e,j,n){if(e.opacity!=0){var i;h=g(h,F,w,e,n).attributes;if(!e.morphTargets&&h.position>=0){d.bindBuffer(d.ARRAY_BUFFER,j.__webglVertexBuffer);d.vertexAttribPointer(h.position,3,d.FLOAT,!1,0,0)}else{F=e.program.attributes;if(n.morphTargetBase!==-1){d.bindBuffer(d.ARRAY_BUFFER,j.__webglMorphTargetsBuffers[n.morphTargetBase]);d.vertexAttribPointer(F.position,3,d.FLOAT,!1,0,0)}else if(F.position>=0){d.bindBuffer(d.ARRAY_BUFFER,
j.__webglVertexBuffer);d.vertexAttribPointer(F.position,3,d.FLOAT,!1,0,0)}if(n.morphTargetForcedOrder.length){w=0;for(var k=n.morphTargetForcedOrder,u=n.morphTargetInfluences;w<e.numSupportedMorphTargets&&w<k.length;){d.bindBuffer(d.ARRAY_BUFFER,j.__webglMorphTargetsBuffers[k[w]]);d.vertexAttribPointer(F["morphTarget"+w],3,d.FLOAT,!1,0,0);n.__webglMorphTargetInfluences[w]=u[k[w]];w++}}else{k=[];var t=-1,m=0;u=n.morphTargetInfluences;var v,z=u.length;w=0;for(n.morphTargetBase!==-1&&(k[n.morphTargetBase]=
!0);w<e.numSupportedMorphTargets;){for(v=0;v<z;v++)if(!k[v]&&u[v]>t){m=v;t=u[m]}d.bindBuffer(d.ARRAY_BUFFER,j.__webglMorphTargetsBuffers[m]);d.vertexAttribPointer(F["morphTarget"+w],3,d.FLOAT,!1,0,0);n.__webglMorphTargetInfluences[w]=t;k[m]=1;t=-1;w++}}e.program.uniforms.morphTargetInfluences!==null&&d.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}if(e.attributes)for(i in e.attributes)if(h[i]!==undefined&&h[i]>=0){F=e.attributes[i];if(F.buffer){d.bindBuffer(d.ARRAY_BUFFER,
F.buffer);d.vertexAttribPointer(h[i],F.size,d.FLOAT,!1,0,0)}}if(h.color>=0){d.bindBuffer(d.ARRAY_BUFFER,j.__webglColorBuffer);d.vertexAttribPointer(h.color,3,d.FLOAT,!1,0,0)}if(h.normal>=0){d.bindBuffer(d.ARRAY_BUFFER,j.__webglNormalBuffer);d.vertexAttribPointer(h.normal,3,d.FLOAT,!1,0,0)}if(h.tangent>=0){d.bindBuffer(d.ARRAY_BUFFER,j.__webglTangentBuffer);d.vertexAttribPointer(h.tangent,4,d.FLOAT,!1,0,0)}if(h.uv>=0)if(j.__webglUVBuffer){d.bindBuffer(d.ARRAY_BUFFER,j.__webglUVBuffer);d.vertexAttribPointer(h.uv,
2,d.FLOAT,!1,0,0);d.enableVertexAttribArray(h.uv)}else d.disableVertexAttribArray(h.uv);if(h.uv2>=0)if(j.__webglUV2Buffer){d.bindBuffer(d.ARRAY_BUFFER,j.__webglUV2Buffer);d.vertexAttribPointer(h.uv2,2,d.FLOAT,!1,0,0);d.enableVertexAttribArray(h.uv2)}else d.disableVertexAttribArray(h.uv2);if(e.skinning&&h.skinVertexA>=0&&h.skinVertexB>=0&&h.skinIndex>=0&&h.skinWeight>=0){d.bindBuffer(d.ARRAY_BUFFER,j.__webglSkinVertexABuffer);d.vertexAttribPointer(h.skinVertexA,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
j.__webglSkinVertexBBuffer);d.vertexAttribPointer(h.skinVertexB,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,j.__webglSkinIndicesBuffer);d.vertexAttribPointer(h.skinIndex,4,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,j.__webglSkinWeightsBuffer);d.vertexAttribPointer(h.skinWeight,4,d.FLOAT,!1,0,0)}if(n instanceof THREE.Mesh){if(e.wireframe){d.lineWidth(e.wireframeLinewidth);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,j.__webglLineBuffer);d.drawElements(d.LINES,j.__webglLineCount,d.UNSIGNED_SHORT,0)}else{d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
j.__webglFaceBuffer);d.drawElements(d.TRIANGLES,j.__webglFaceCount,d.UNSIGNED_SHORT,0)}ga.data.vertices+=j.__webglFaceCount;ga.data.faces+=j.__webglFaceCount/3;ga.data.drawCalls++}else if(n instanceof THREE.Line){n=n.type==THREE.LineStrip?d.LINE_STRIP:d.LINES;d.lineWidth(e.linewidth);d.drawArrays(n,0,j.__webglLineCount);ga.data.drawCalls++}else if(n instanceof THREE.ParticleSystem){d.drawArrays(d.POINTS,0,j.__webglParticleCount);ga.data.drawCalls++}else if(n instanceof THREE.Ribbon){d.drawArrays(d.TRIANGLE_STRIP,
0,j.__webglVertexCount);ga.data.drawCalls++}}}function q(h,F,w){if(!h.__webglVertexBuffer)h.__webglVertexBuffer=d.createBuffer();if(!h.__webglNormalBuffer)h.__webglNormalBuffer=d.createBuffer();if(h.hasPos){d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,h.positionArray,d.DYNAMIC_DRAW);d.enableVertexAttribArray(F.attributes.position);d.vertexAttribPointer(F.attributes.position,3,d.FLOAT,!1,0,0)}if(h.hasNormal){d.bindBuffer(d.ARRAY_BUFFER,h.__webglNormalBuffer);if(w==
THREE.FlatShading){var e,j,n,i,k,u,t,m,v,z,p=h.count*3;for(z=0;z<p;z+=9){w=h.normalArray;e=w[z];j=w[z+1];n=w[z+2];i=w[z+3];u=w[z+4];m=w[z+5];k=w[z+6];t=w[z+7];v=w[z+8];e=(e+i+k)/3;j=(j+u+t)/3;n=(n+m+v)/3;w[z]=e;w[z+1]=j;w[z+2]=n;w[z+3]=e;w[z+4]=j;w[z+5]=n;w[z+6]=e;w[z+7]=j;w[z+8]=n}}d.bufferData(d.ARRAY_BUFFER,h.normalArray,d.DYNAMIC_DRAW);d.enableVertexAttribArray(F.attributes.normal);d.vertexAttribPointer(F.attributes.normal,3,d.FLOAT,!1,0,0)}d.drawArrays(d.TRIANGLES,0,h.count);h.count=0}function B(h){if(Aa!=
h.doubleSided){h.doubleSided?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE);Aa=h.doubleSided}if(Oa!=h.flipSided){h.flipSided?d.frontFace(d.CW):d.frontFace(d.CCW);Oa=h.flipSided}}function y(h){if(Pa!=h){h?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);Pa=h}}function D(h){Fa[0].set(h.n41-h.n11,h.n42-h.n12,h.n43-h.n13,h.n44-h.n14);Fa[1].set(h.n41+h.n11,h.n42+h.n12,h.n43+h.n13,h.n44+h.n14);Fa[2].set(h.n41+h.n21,h.n42+h.n22,h.n43+h.n23,h.n44+h.n24);Fa[3].set(h.n41-h.n21,h.n42-h.n22,h.n43-h.n23,h.n44-h.n24);
Fa[4].set(h.n41-h.n31,h.n42-h.n32,h.n43-h.n33,h.n44-h.n34);Fa[5].set(h.n41+h.n31,h.n42+h.n32,h.n43+h.n33,h.n44+h.n34);var F;for(h=0;h<6;h++){F=Fa[h];F.divideScalar(Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z))}}function E(h){for(var F=h.matrixWorld,w=-h.geometry.boundingSphere.radius*Math.max(h.scale.x,Math.max(h.scale.y,h.scale.z)),e=0;e<6;e++){h=Fa[e].x*F.n14+Fa[e].y*F.n24+Fa[e].z*F.n34+Fa[e].w;if(h<=w)return!1}return!0}function G(h,F){h.list[h.count]=F;h.count+=1}function P(h){var F,w,e=h.object,j=h.opaque,
n=h.transparent;n.count=0;h=j.count=0;for(F=e.materials.length;h<F;h++){w=e.materials[h];w.transparent?G(n,w):G(j,w)}}function R(h){var F,w,e,j,n=h.object,i=h.buffer,k=h.opaque,u=h.transparent;u.count=0;h=k.count=0;for(e=n.materials.length;h<e;h++){F=n.materials[h];if(F instanceof THREE.MeshFaceMaterial){F=0;for(w=i.materials.length;F<w;F++)(j=i.materials[F])&&(j.transparent?G(u,j):G(k,j))}else(j=F)&&(j.transparent?G(u,j):G(k,j))}}function T(h,F){return F.z-h.z}function O(h){d.enable(d.POLYGON_OFFSET_FILL);
d.polygonOffset(0.1,1);d.enable(d.STENCIL_TEST);d.enable(d.DEPTH_TEST);d.depthMask(!1);d.colorMask(!1,!1,!1,!1);d.stencilFunc(d.ALWAYS,1,255);d.stencilOpSeparate(d.BACK,d.KEEP,d.INCR,d.KEEP);d.stencilOpSeparate(d.FRONT,d.KEEP,d.DECR,d.KEEP);var F,w=h.lights.length,e,j=h.lights,n=[],i,k,u,t,m,v=h.__webglShadowVolumes.length;for(F=0;F<w;F++){e=h.lights[F];if(e instanceof THREE.DirectionalLight&&e.castShadow){n[0]=-e.position.x;n[1]=-e.position.y;n[2]=-e.position.z;for(m=0;m<v;m++){e=h.__webglShadowVolumes[m].object;
i=h.__webglShadowVolumes[m].buffer;k=e.materials[0];k.program||ga.initMaterial(k,j,undefined,e);k=k.program;u=k.uniforms;t=k.attributes;if(Ma!==k){d.useProgram(k);Ma=k;d.uniformMatrix4fv(u.projectionMatrix,!1,$a);d.uniformMatrix4fv(u.viewMatrix,!1,hb);d.uniform3fv(u.directionalLightDirection,n)}e.matrixWorld.flattenToArray(e._objectMatrixArray);d.uniformMatrix4fv(u.objectMatrix,!1,e._objectMatrixArray);d.bindBuffer(d.ARRAY_BUFFER,i.__webglVertexBuffer);d.vertexAttribPointer(t.position,3,d.FLOAT,!1,
0,0);d.bindBuffer(d.ARRAY_BUFFER,i.__webglNormalBuffer);d.vertexAttribPointer(t.normal,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer);d.cullFace(d.FRONT);d.drawElements(d.TRIANGLES,i.__webglFaceCount,d.UNSIGNED_SHORT,0);d.cullFace(d.BACK);d.drawElements(d.TRIANGLES,i.__webglFaceCount,d.UNSIGNED_SHORT,0)}}}d.disable(d.POLYGON_OFFSET_FILL);d.colorMask(!0,!0,!0,!0);d.stencilFunc(d.NOTEQUAL,0,255);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);d.disable(d.DEPTH_TEST);Ba=-1;Ma=ja.program;
d.useProgram(ja.program);d.uniformMatrix4fv(ja.projectionLocation,!1,$a);d.uniform1f(ja.darknessLocation,ja.darkness);d.bindBuffer(d.ARRAY_BUFFER,ja.vertexBuffer);d.vertexAttribPointer(ja.vertexLocation,3,d.FLOAT,!1,0,0);d.enableVertexAttribArray(ja.vertexLocation);d.blendFunc(d.ONE,d.ONE_MINUS_SRC_ALPHA);d.blendEquation(d.FUNC_ADD);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,ja.elementBuffer);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);d.disable(d.STENCIL_TEST);d.enable(d.DEPTH_TEST);d.depthMask(Na)}
function Q(h,F){var w,e,j;w=_sprite.attributes;var n=_sprite.uniforms,i=Ca/xa,k,u=[],t=xa*0.5,m=Ca*0.5,v=!0;d.useProgram(_sprite.program);Ma=_sprite.program;Ba=-1;if(!Bb){d.enableVertexAttribArray(_sprite.attributes.position);d.enableVertexAttribArray(_sprite.attributes.uv);Bb=!0}d.disable(d.CULL_FACE);d.enable(d.BLEND);d.depthMask(!0);d.bindBuffer(d.ARRAY_BUFFER,_sprite.vertexBuffer);d.vertexAttribPointer(w.position,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(w.uv,2,d.FLOAT,!1,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
_sprite.elementBuffer);d.uniformMatrix4fv(n.projectionMatrix,!1,$a);d.activeTexture(d.TEXTURE0);d.uniform1i(n.map,0);w=0;for(e=h.__webglSprites.length;w<e;w++){j=h.__webglSprites[w];if(j.useScreenCoordinates)j.z=-j.position.z;else{j._modelViewMatrix.multiplyToArray(F.matrixWorldInverse,j.matrixWorld,j._modelViewMatrixArray);j.z=-j._modelViewMatrix.n34}}h.__webglSprites.sort(T);w=0;for(e=h.__webglSprites.length;w<e;w++){j=h.__webglSprites[w];if(j.material===undefined&&j.map&&j.map.image&&j.map.image.width){if(j.useScreenCoordinates){d.uniform1i(n.useScreenCoordinates,
1);d.uniform3f(n.screenPosition,(j.position.x-t)/t,(m-j.position.y)/m,Math.max(0,Math.min(1,j.position.z)))}else{d.uniform1i(n.useScreenCoordinates,0);d.uniform1i(n.affectedByDistance,j.affectedByDistance?1:0);d.uniformMatrix4fv(n.modelViewMatrix,!1,j._modelViewMatrixArray)}k=j.map.image.width/(j.affectedByDistance?1:Ca);u[0]=k*i*j.scale.x;u[1]=k*j.scale.y;d.uniform2f(n.uvScale,j.uvScale.x,j.uvScale.y);d.uniform2f(n.uvOffset,j.uvOffset.x,j.uvOffset.y);d.uniform2f(n.alignment,j.alignment.x,j.alignment.y);
d.uniform1f(n.opacity,j.opacity);d.uniform1f(n.rotation,j.rotation);d.uniform2fv(n.scale,u);if(j.mergeWith3D&&!v){d.enable(d.DEPTH_TEST);v=!0}else if(!j.mergeWith3D&&v){d.disable(d.DEPTH_TEST);v=!1}pa(j.blending);X(j.map,0);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(Na)}function Y(h,F){var w,e,j=h.__webglLensFlares.length,n,i,k,u=new THREE.Vector3,t=Ca/xa,m=xa*0.5,v=Ca*0.5,z=16/Ca,p=[z*t,z],A=[1,1,0],H=[1,1],J=L.uniforms;w=L.attributes;
d.useProgram(L.program);Ma=L.program;Ba=-1;if(!aa){d.enableVertexAttribArray(L.attributes.vertex);d.enableVertexAttribArray(L.attributes.uv);aa=!0}d.uniform1i(J.occlusionMap,0);d.uniform1i(J.map,1);d.bindBuffer(d.ARRAY_BUFFER,L.vertexBuffer);d.vertexAttribPointer(w.vertex,2,d.FLOAT,!1,16,0);d.vertexAttribPointer(w.uv,2,d.FLOAT,!1,16,8);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,L.elementBuffer);d.disable(d.CULL_FACE);d.depthMask(!1);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,L.occlusionTexture);
d.activeTexture(d.TEXTURE1);for(e=0;e<j;e++){w=h.__webglLensFlares[e].object;u.set(w.matrixWorld.n14,w.matrixWorld.n24,w.matrixWorld.n34);F.matrixWorldInverse.multiplyVector3(u);F.projectionMatrix.multiplyVector3(u);A[0]=u.x;A[1]=u.y;A[2]=u.z;H[0]=A[0]*m+m;H[1]=A[1]*v+v;if(L.hasVertexTexture||H[0]>0&&H[0]<xa&&H[1]>0&&H[1]<Ca){d.bindTexture(d.TEXTURE_2D,L.tempTexture);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,H[0]-8,H[1]-8,16,16,0);d.uniform1i(J.renderType,0);d.uniform2fv(J.scale,p);d.uniform3fv(J.screenPosition,
A);d.disable(d.BLEND);d.enable(d.DEPTH_TEST);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);d.bindTexture(d.TEXTURE_2D,L.occlusionTexture);d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,H[0]-8,H[1]-8,16,16,0);d.uniform1i(J.renderType,1);d.disable(d.DEPTH_TEST);d.bindTexture(d.TEXTURE_2D,L.tempTexture);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0);w.positionScreen.x=A[0];w.positionScreen.y=A[1];w.positionScreen.z=A[2];w.customUpdateCallback?w.customUpdateCallback(w):w.updateLensFlares();d.uniform1i(J.renderType,
2);d.enable(d.BLEND);n=0;for(i=w.lensFlares.length;n<i;n++){k=w.lensFlares[n];if(k.opacity>0.0010&&k.scale>0.0010){A[0]=k.x;A[1]=k.y;A[2]=k.z;z=k.size*k.scale/Ca;p[0]=z*t;p[1]=z;d.uniform3fv(J.screenPosition,A);d.uniform2fv(J.scale,p);d.uniform1f(J.rotation,k.rotation);d.uniform1f(J.opacity,k.opacity);pa(k.blending);X(k.texture,1);d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}}}d.enable(d.CULL_FACE);d.enable(d.DEPTH_TEST);d.depthMask(Na)}function ca(h,F){h._modelViewMatrix.multiplyToArray(F.matrixWorldInverse,
h.matrixWorld,h._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(h._modelViewMatrix).transposeIntoArray(h._normalMatrixArray)}function V(h){var F,w,e,j,n;if(h instanceof THREE.Mesh){w=h.geometry;for(F in w.geometryGroups){e=w.geometryGroups[F];n=!1;for(j in e.__webglCustomAttributes)if(e.__webglCustomAttributes[j].needsUpdate){n=!0;break}if(w.__dirtyVertices||w.__dirtyMorphTargets||w.__dirtyElements||w.__dirtyUvs||w.__dirtyNormals||w.__dirtyColors||w.__dirtyTangents||n){n=h;var i=d.DYNAMIC_DRAW;
if(e.__inittedArrays){var k=void 0,u=void 0,t=void 0,m=void 0;t=void 0;var v=void 0,z=void 0,p=void 0,A=void 0,H=void 0,J=void 0,N=void 0,ha=void 0,$=void 0,U=void 0,Z=void 0,fa=void 0,W=void 0;z=void 0;p=void 0;m=void 0;A=void 0;m=void 0;var x=void 0,K=void 0;z=void 0;x=void 0;K=void 0;var r=void 0,C=void 0;x=void 0;K=void 0;r=void 0;C=void 0;x=void 0;K=void 0;r=void 0;C=void 0;x=void 0;K=void 0;r=void 0;m=void 0;A=void 0;v=void 0;t=void 0;t=void 0;x=void 0;K=void 0;r=void 0;var S=void 0,s=0,va=
0,cb=0,Ka=0,sa=0,Wa=0,ya=0,Ha=0,ta=0,I=0,wa=0;K=x=0;var ka=e.__vertexArray,M=e.__uvArray,Ra=e.__uv2Array,Ea=e.__normalArray,Ia=e.__tangentArray,Sa=e.__colorArray,qa=e.__skinVertexAArray,da=e.__skinVertexBArray,ia=e.__skinIndexArray,ea=e.__skinWeightArray,La=e.__morphTargetsArrays,ra=e.__webglCustomAttributes;r=void 0;var la=e.__faceArray,ab=e.__lineArray,fb=e.__needsSmoothNormals;J=e.__vertexColorType;H=e.__uvType;N=e.__normalType;var Da=n.geometry,bb=Da.__dirtyVertices,yb=Da.__dirtyElements,Ua=Da.__dirtyUvs,
ub=Da.__dirtyNormals,vb=Da.__dirtyTangents,lb=Da.__dirtyColors,wb=Da.__dirtyMorphTargets,jb=Da.vertices,zb=e.faces,Cb=Da.faces,mb=Da.faceVertexUvs[0],Db=Da.faceVertexUvs[1],qb=Da.skinVerticesA,nb=Da.skinVerticesB,ob=Da.skinIndices,db=Da.skinWeights,gb=n instanceof THREE.ShadowVolume?Da.edgeFaces:undefined;morphTargets=Da.morphTargets;if(ra)for(S in ra){ra[S].offset=0;ra[S].offsetSrc=0}k=0;for(u=zb.length;k<u;k++){t=zb[k];m=Cb[t];mb&&(ha=mb[t]);Db&&($=Db[t]);t=m.vertexNormals;v=m.normal;z=m.vertexColors;
p=m.color;A=m.vertexTangents;if(m instanceof THREE.Face3){if(bb){U=jb[m.a].position;Z=jb[m.b].position;fa=jb[m.c].position;ka[va]=U.x;ka[va+1]=U.y;ka[va+2]=U.z;ka[va+3]=Z.x;ka[va+4]=Z.y;ka[va+5]=Z.z;ka[va+6]=fa.x;ka[va+7]=fa.y;ka[va+8]=fa.z;va+=9}if(ra)for(S in ra){r=ra[S];if(r.needsUpdate){x=r.offset;K=r.offsetSrc;if(r.size===1){if(r.boundTo===undefined||r.boundTo==="vertices"){r.array[x+0]=r.value[m.a];r.array[x+1]=r.value[m.b];r.array[x+2]=r.value[m.c]}else if(r.boundTo==="faces"){r.array[x+0]=
r.value[K];r.array[x+1]=r.value[K];r.array[x+2]=r.value[K];r.offsetSrc++}else if(r.boundTo==="faceVertices"){r.array[x+0]=r.value[K+0];r.array[x+1]=r.value[K+1];r.array[x+2]=r.value[K+2];r.offsetSrc+=3}r.offset+=3}else{if(r.boundTo===undefined||r.boundTo==="vertices"){U=r.value[m.a];Z=r.value[m.b];fa=r.value[m.c]}else if(r.boundTo==="faces"){U=r.value[K];Z=r.value[K];fa=r.value[K];r.offsetSrc++}else if(r.boundTo==="faceVertices"){U=r.value[K+0];Z=r.value[K+1];fa=r.value[K+2];r.offsetSrc+=3}if(r.size===
2){r.array[x+0]=U.x;r.array[x+1]=U.y;r.array[x+2]=Z.x;r.array[x+3]=Z.y;r.array[x+4]=fa.x;r.array[x+5]=fa.y;r.offset+=6}else if(r.size===3){if(r.type==="c"){r.array[x+0]=U.r;r.array[x+1]=U.g;r.array[x+2]=U.b;r.array[x+3]=Z.r;r.array[x+4]=Z.g;r.array[x+5]=Z.b;r.array[x+6]=fa.r;r.array[x+7]=fa.g;r.array[x+8]=fa.b}else{r.array[x+0]=U.x;r.array[x+1]=U.y;r.array[x+2]=U.z;r.array[x+3]=Z.x;r.array[x+4]=Z.y;r.array[x+5]=Z.z;r.array[x+6]=fa.x;r.array[x+7]=fa.y;r.array[x+8]=fa.z}r.offset+=9}else{r.array[x+0]=
U.x;r.array[x+1]=U.y;r.array[x+2]=U.z;r.array[x+3]=U.w;r.array[x+4]=Z.x;r.array[x+5]=Z.y;r.array[x+6]=Z.z;r.array[x+7]=Z.w;r.array[x+8]=fa.x;r.array[x+9]=fa.y;r.array[x+10]=fa.z;r.array[x+11]=fa.w;r.offset+=12}}}}if(wb){x=0;for(K=morphTargets.length;x<K;x++){U=morphTargets[x].vertices[m.a].position;Z=morphTargets[x].vertices[m.b].position;fa=morphTargets[x].vertices[m.c].position;r=La[x];r[wa+0]=U.x;r[wa+1]=U.y;r[wa+2]=U.z;r[wa+3]=Z.x;r[wa+4]=Z.y;r[wa+5]=Z.z;r[wa+6]=fa.x;r[wa+7]=fa.y;r[wa+8]=fa.z}wa+=
9}if(db.length){x=db[m.a];K=db[m.b];r=db[m.c];ea[I]=x.x;ea[I+1]=x.y;ea[I+2]=x.z;ea[I+3]=x.w;ea[I+4]=K.x;ea[I+5]=K.y;ea[I+6]=K.z;ea[I+7]=K.w;ea[I+8]=r.x;ea[I+9]=r.y;ea[I+10]=r.z;ea[I+11]=r.w;x=ob[m.a];K=ob[m.b];r=ob[m.c];ia[I]=x.x;ia[I+1]=x.y;ia[I+2]=x.z;ia[I+3]=x.w;ia[I+4]=K.x;ia[I+5]=K.y;ia[I+6]=K.z;ia[I+7]=K.w;ia[I+8]=r.x;ia[I+9]=r.y;ia[I+10]=r.z;ia[I+11]=r.w;x=qb[m.a];K=qb[m.b];r=qb[m.c];qa[I]=x.x;qa[I+1]=x.y;qa[I+2]=x.z;qa[I+3]=1;qa[I+4]=K.x;qa[I+5]=K.y;qa[I+6]=K.z;qa[I+7]=1;qa[I+8]=r.x;qa[I+
9]=r.y;qa[I+10]=r.z;qa[I+11]=1;x=nb[m.a];K=nb[m.b];r=nb[m.c];da[I]=x.x;da[I+1]=x.y;da[I+2]=x.z;da[I+3]=1;da[I+4]=K.x;da[I+5]=K.y;da[I+6]=K.z;da[I+7]=1;da[I+8]=r.x;da[I+9]=r.y;da[I+10]=r.z;da[I+11]=1;I+=12}if(lb&&J){if(z.length==3&&J==THREE.VertexColors){m=z[0];x=z[1];K=z[2]}else K=x=m=p;Sa[ta]=m.r;Sa[ta+1]=m.g;Sa[ta+2]=m.b;Sa[ta+3]=x.r;Sa[ta+4]=x.g;Sa[ta+5]=x.b;Sa[ta+6]=K.r;Sa[ta+7]=K.g;Sa[ta+8]=K.b;ta+=9}if(vb&&Da.hasTangents){z=A[0];p=A[1];m=A[2];Ia[ya]=z.x;Ia[ya+1]=z.y;Ia[ya+2]=z.z;Ia[ya+3]=z.w;
Ia[ya+4]=p.x;Ia[ya+5]=p.y;Ia[ya+6]=p.z;Ia[ya+7]=p.w;Ia[ya+8]=m.x;Ia[ya+9]=m.y;Ia[ya+10]=m.z;Ia[ya+11]=m.w;ya+=12}if(ub&&N)if(t.length==3&&fb)for(A=0;A<3;A++){v=t[A];Ea[Wa]=v.x;Ea[Wa+1]=v.y;Ea[Wa+2]=v.z;Wa+=3}else for(A=0;A<3;A++){Ea[Wa]=v.x;Ea[Wa+1]=v.y;Ea[Wa+2]=v.z;Wa+=3}if(Ua&&ha!==undefined&&H)for(A=0;A<3;A++){t=ha[A];M[cb]=t.u;M[cb+1]=t.v;cb+=2}if(Ua&&$!==undefined&&H)for(A=0;A<3;A++){t=$[A];Ra[Ka]=t.u;Ra[Ka+1]=t.v;Ka+=2}if(yb){la[sa]=s;la[sa+1]=s+1;la[sa+2]=s+2;sa+=3;ab[Ha]=s;ab[Ha+1]=s+1;ab[Ha+
2]=s;ab[Ha+3]=s+2;ab[Ha+4]=s+1;ab[Ha+5]=s+2;Ha+=6;s+=3}}else if(m instanceof THREE.Face4){if(bb){U=jb[m.a].position;Z=jb[m.b].position;fa=jb[m.c].position;W=jb[m.d].position;ka[va]=U.x;ka[va+1]=U.y;ka[va+2]=U.z;ka[va+3]=Z.x;ka[va+4]=Z.y;ka[va+5]=Z.z;ka[va+6]=fa.x;ka[va+7]=fa.y;ka[va+8]=fa.z;ka[va+9]=W.x;ka[va+10]=W.y;ka[va+11]=W.z;va+=12}if(ra)for(S in ra){r=ra[S];if(r.needsUpdate){x=r.offset;K=r.offsetSrc;if(r.size===1){if(r.boundTo===undefined||r.boundTo==="vertices"){r.array[x+0]=r.value[m.a];
r.array[x+1]=r.value[m.b];r.array[x+2]=r.value[m.c];r.array[x+3]=r.value[m.d]}else if(r.boundTo==="faces"){r.array[x+0]=r.value[K];r.array[x+1]=r.value[K];r.array[x+2]=r.value[K];r.array[x+3]=r.value[K];r.offsetSrc++}else if(r.boundTo==="faceVertices"){r.array[x+0]=r.value[K+0];r.array[x+1]=r.value[K+1];r.array[x+2]=r.value[K+2];r.array[x+3]=r.value[K+3];r.offsetSrc+=4}r.offset+=4}else{if(r.boundTo===undefined||r.boundTo==="vertices"){U=r.value[m.a];Z=r.value[m.b];fa=r.value[m.c];W=r.value[m.d]}else if(r.boundTo===
"faces"){U=r.value[K];Z=r.value[K];fa=r.value[K];W=r.value[K];r.offsetSrc++}else if(r.boundTo==="faceVertices"){U=r.value[K+0];Z=r.value[K+1];fa=r.value[K+2];W=r.value[K+3];r.offsetSrc+=4}if(r.size===2){r.array[x+0]=U.x;r.array[x+1]=U.y;r.array[x+2]=Z.x;r.array[x+3]=Z.y;r.array[x+4]=fa.x;r.array[x+5]=fa.y;r.array[x+6]=W.x;r.array[x+7]=W.y;r.offset+=8}else if(r.size===3){if(r.type==="c"){r.array[x+0]=U.r;r.array[x+1]=U.g;r.array[x+2]=U.b;r.array[x+3]=Z.r;r.array[x+4]=Z.g;r.array[x+5]=Z.b;r.array[x+
6]=fa.r;r.array[x+7]=fa.g;r.array[x+8]=fa.b;r.array[x+9]=W.r;r.array[x+10]=W.g;r.array[x+11]=W.b}else{r.array[x+0]=U.x;r.array[x+1]=U.y;r.array[x+2]=U.z;r.array[x+3]=Z.x;r.array[x+4]=Z.y;r.array[x+5]=Z.z;r.array[x+6]=fa.x;r.array[x+7]=fa.y;r.array[x+8]=fa.z;r.array[x+9]=W.x;r.array[x+10]=W.y;r.array[x+11]=W.z}r.offset+=12}else{r.array[x+0]=U.x;r.array[x+1]=U.y;r.array[x+2]=U.z;r.array[x+3]=U.w;r.array[x+4]=Z.x;r.array[x+5]=Z.y;r.array[x+6]=Z.z;r.array[x+7]=Z.w;r.array[x+8]=fa.x;r.array[x+9]=fa.y;
r.array[x+10]=fa.z;r.array[x+11]=fa.w;r.array[x+12]=W.x;r.array[x+13]=W.y;r.array[x+14]=W.z;r.array[x+15]=W.w;r.offset+=16}}}}if(wb){x=0;for(K=morphTargets.length;x<K;x++){U=morphTargets[x].vertices[m.a].position;Z=morphTargets[x].vertices[m.b].position;fa=morphTargets[x].vertices[m.c].position;W=morphTargets[x].vertices[m.d].position;r=La[x];r[wa+0]=U.x;r[wa+1]=U.y;r[wa+2]=U.z;r[wa+3]=Z.x;r[wa+4]=Z.y;r[wa+5]=Z.z;r[wa+6]=fa.x;r[wa+7]=fa.y;r[wa+8]=fa.z;r[wa+9]=W.x;r[wa+10]=W.y;r[wa+11]=W.z}wa+=12}if(db.length){x=
db[m.a];K=db[m.b];r=db[m.c];C=db[m.d];ea[I]=x.x;ea[I+1]=x.y;ea[I+2]=x.z;ea[I+3]=x.w;ea[I+4]=K.x;ea[I+5]=K.y;ea[I+6]=K.z;ea[I+7]=K.w;ea[I+8]=r.x;ea[I+9]=r.y;ea[I+10]=r.z;ea[I+11]=r.w;ea[I+12]=C.x;ea[I+13]=C.y;ea[I+14]=C.z;ea[I+15]=C.w;x=ob[m.a];K=ob[m.b];r=ob[m.c];C=ob[m.d];ia[I]=x.x;ia[I+1]=x.y;ia[I+2]=x.z;ia[I+3]=x.w;ia[I+4]=K.x;ia[I+5]=K.y;ia[I+6]=K.z;ia[I+7]=K.w;ia[I+8]=r.x;ia[I+9]=r.y;ia[I+10]=r.z;ia[I+11]=r.w;ia[I+12]=C.x;ia[I+13]=C.y;ia[I+14]=C.z;ia[I+15]=C.w;x=qb[m.a];K=qb[m.b];r=qb[m.c];C=
qb[m.d];qa[I]=x.x;qa[I+1]=x.y;qa[I+2]=x.z;qa[I+3]=1;qa[I+4]=K.x;qa[I+5]=K.y;qa[I+6]=K.z;qa[I+7]=1;qa[I+8]=r.x;qa[I+9]=r.y;qa[I+10]=r.z;qa[I+11]=1;qa[I+12]=C.x;qa[I+13]=C.y;qa[I+14]=C.z;qa[I+15]=1;x=nb[m.a];K=nb[m.b];r=nb[m.c];m=nb[m.d];da[I]=x.x;da[I+1]=x.y;da[I+2]=x.z;da[I+3]=1;da[I+4]=K.x;da[I+5]=K.y;da[I+6]=K.z;da[I+7]=1;da[I+8]=r.x;da[I+9]=r.y;da[I+10]=r.z;da[I+11]=1;da[I+12]=m.x;da[I+13]=m.y;da[I+14]=m.z;da[I+15]=1;I+=16}if(lb&&J){if(z.length==4&&J==THREE.VertexColors){m=z[0];x=z[1];K=z[2];z=
z[3]}else z=K=x=m=p;Sa[ta]=m.r;Sa[ta+1]=m.g;Sa[ta+2]=m.b;Sa[ta+3]=x.r;Sa[ta+4]=x.g;Sa[ta+5]=x.b;Sa[ta+6]=K.r;Sa[ta+7]=K.g;Sa[ta+8]=K.b;Sa[ta+9]=z.r;Sa[ta+10]=z.g;Sa[ta+11]=z.b;ta+=12}if(vb&&Da.hasTangents){z=A[0];p=A[1];m=A[2];A=A[3];Ia[ya]=z.x;Ia[ya+1]=z.y;Ia[ya+2]=z.z;Ia[ya+3]=z.w;Ia[ya+4]=p.x;Ia[ya+5]=p.y;Ia[ya+6]=p.z;Ia[ya+7]=p.w;Ia[ya+8]=m.x;Ia[ya+9]=m.y;Ia[ya+10]=m.z;Ia[ya+11]=m.w;Ia[ya+12]=A.x;Ia[ya+13]=A.y;Ia[ya+14]=A.z;Ia[ya+15]=A.w;ya+=16}if(ub&&N)if(t.length==4&&fb)for(A=0;A<4;A++){v=t[A];
Ea[Wa]=v.x;Ea[Wa+1]=v.y;Ea[Wa+2]=v.z;Wa+=3}else for(A=0;A<4;A++){Ea[Wa]=v.x;Ea[Wa+1]=v.y;Ea[Wa+2]=v.z;Wa+=3}if(Ua&&ha!==undefined&&H)for(A=0;A<4;A++){t=ha[A];M[cb]=t.u;M[cb+1]=t.v;cb+=2}if(Ua&&$!==undefined&&H)for(A=0;A<4;A++){t=$[A];Ra[Ka]=t.u;Ra[Ka+1]=t.v;Ka+=2}if(yb){la[sa]=s;la[sa+1]=s+1;la[sa+2]=s+3;la[sa+3]=s+1;la[sa+4]=s+2;la[sa+5]=s+3;sa+=6;ab[Ha]=s;ab[Ha+1]=s+1;ab[Ha+2]=s;ab[Ha+3]=s+3;ab[Ha+4]=s+1;ab[Ha+5]=s+2;ab[Ha+6]=s+2;ab[Ha+7]=s+3;Ha+=8;s+=4}}}if(gb){k=0;for(u=gb.length;k<u;k++){la[sa]=
gb[k].a;la[sa+1]=gb[k].b;la[sa+2]=gb[k].c;la[sa+3]=gb[k].a;la[sa+4]=gb[k].c;la[sa+5]=gb[k].d;sa+=6}}if(bb){d.bindBuffer(d.ARRAY_BUFFER,e.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,ka,i)}if(ra)for(S in ra){r=ra[S];if(r.needsUpdate){d.bindBuffer(d.ARRAY_BUFFER,r.buffer);d.bufferData(d.ARRAY_BUFFER,r.array,i);r.needsUpdate=!1}}if(wb){x=0;for(K=morphTargets.length;x<K;x++){d.bindBuffer(d.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[x]);d.bufferData(d.ARRAY_BUFFER,La[x],i)}}if(lb&&ta>0){d.bindBuffer(d.ARRAY_BUFFER,
e.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,Sa,i)}if(ub){d.bindBuffer(d.ARRAY_BUFFER,e.__webglNormalBuffer);d.bufferData(d.ARRAY_BUFFER,Ea,i)}if(vb&&Da.hasTangents){d.bindBuffer(d.ARRAY_BUFFER,e.__webglTangentBuffer);d.bufferData(d.ARRAY_BUFFER,Ia,i)}if(Ua&&cb>0){d.bindBuffer(d.ARRAY_BUFFER,e.__webglUVBuffer);d.bufferData(d.ARRAY_BUFFER,M,i)}if(Ua&&Ka>0){d.bindBuffer(d.ARRAY_BUFFER,e.__webglUV2Buffer);d.bufferData(d.ARRAY_BUFFER,Ra,i)}if(yb){d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);
d.bufferData(d.ELEMENT_ARRAY_BUFFER,la,i);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,ab,i)}if(I>0){d.bindBuffer(d.ARRAY_BUFFER,e.__webglSkinVertexABuffer);d.bufferData(d.ARRAY_BUFFER,qa,i);d.bindBuffer(d.ARRAY_BUFFER,e.__webglSkinVertexBBuffer);d.bufferData(d.ARRAY_BUFFER,da,i);d.bindBuffer(d.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);d.bufferData(d.ARRAY_BUFFER,ia,i);d.bindBuffer(d.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);d.bufferData(d.ARRAY_BUFFER,
ea,i)}if(!n.dynamic){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinVertexAArray;delete e.__skinVertexBArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}}}w.__dirtyVertices=!1;w.__dirtyMorphTargets=!1;w.__dirtyElements=!1;w.__dirtyUvs=!1;w.__dirtyNormals=!1;w.__dirtyTangents=!1;w.__dirtyColors=!1}else if(h instanceof THREE.Ribbon){w=
h.geometry;if(w.__dirtyVertices||w.__dirtyColors){h=w;F=d.DYNAMIC_DRAW;H=h.vertices;e=h.colors;J=H.length;n=e.length;N=h.__vertexArray;i=h.__colorArray;ha=h.__dirtyColors;if(h.__dirtyVertices){for(k=0;k<J;k++){u=H[k].position;j=k*3;N[j]=u.x;N[j+1]=u.y;N[j+2]=u.z}d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,N,F)}if(ha){for(k=0;k<n;k++){color=e[k];j=k*3;i[j]=color.r;i[j+1]=color.g;i[j+2]=color.b}d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,
i,F)}}w.__dirtyVertices=!1;w.__dirtyColors=!1}else if(h instanceof THREE.Line){w=h.geometry;if(w.__dirtyVertices||w.__dirtyColors){h=w;F=d.DYNAMIC_DRAW;H=h.vertices;e=h.colors;J=H.length;n=e.length;N=h.__vertexArray;i=h.__colorArray;ha=h.__dirtyColors;if(h.__dirtyVertices){for(k=0;k<J;k++){u=H[k].position;j=k*3;N[j]=u.x;N[j+1]=u.y;N[j+2]=u.z}d.bindBuffer(d.ARRAY_BUFFER,h.__webglVertexBuffer);d.bufferData(d.ARRAY_BUFFER,N,F)}if(ha){for(k=0;k<n;k++){color=e[k];j=k*3;i[j]=color.r;i[j+1]=color.g;i[j+
2]=color.b}d.bindBuffer(d.ARRAY_BUFFER,h.__webglColorBuffer);d.bufferData(d.ARRAY_BUFFER,i,F)}}w.__dirtyVertices=!1;w.__dirtyColors=!1}else if(h instanceof THREE.ParticleSystem){w=h.geometry;(w.__dirtyVertices||w.__dirtyColors||h.sortParticles)&&f(w,d.DYNAMIC_DRAW,h);w.__dirtyVertices=!1;w.__dirtyColors=!1}}function za(h){function F(z){var p=[];w=0;for(e=z.length;w<e;w++)z[w]==undefined?p.push("undefined"):p.push(z[w].id);return p.join("_")}var w,e,j,n,i,k,u,t,m={},v=h.morphTargets!==undefined?h.morphTargets.length:
0;h.geometryGroups={};j=0;for(n=h.faces.length;j<n;j++){i=h.faces[j];k=i.materials;u=F(k);m[u]==undefined&&(m[u]={hash:u,counter:0});t=m[u].hash+"_"+m[u].counter;h.geometryGroups[t]==undefined&&(h.geometryGroups[t]={faces:[],materials:k,vertices:0,numMorphTargets:v});i=i instanceof THREE.Face3?3:4;if(h.geometryGroups[t].vertices+i>65535){m[u].counter+=1;t=m[u].hash+"_"+m[u].counter;h.geometryGroups[t]==undefined&&(h.geometryGroups[t]={faces:[],materials:k,vertices:0,numMorphTargets:v})}h.geometryGroups[t].faces.push(j);
h.geometryGroups[t].vertices+=i}}function oa(h,F,w){h.push({buffer:F,object:w,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function pa(h){if(h!=Ba){switch(h){case THREE.AdditiveBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE);break;case THREE.SubtractiveBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.ZERO,d.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:d.blendEquation(d.FUNC_ADD);d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:d.blendEquationSeparate(d.FUNC_ADD,
d.FUNC_ADD);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)}Ba=h}}function ma(h,F,w){if((w.width&w.width-1)==0&&(w.height&w.height-1)==0){d.texParameteri(h,d.TEXTURE_WRAP_S,Ja(F.wrapS));d.texParameteri(h,d.TEXTURE_WRAP_T,Ja(F.wrapT));d.texParameteri(h,d.TEXTURE_MAG_FILTER,Ja(F.magFilter));d.texParameteri(h,d.TEXTURE_MIN_FILTER,Ja(F.minFilter));d.generateMipmap(h)}else{d.texParameteri(h,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(h,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);
d.texParameteri(h,d.TEXTURE_MAG_FILTER,Xa(F.magFilter));d.texParameteri(h,d.TEXTURE_MIN_FILTER,Xa(F.minFilter))}}function X(h,F){if(h.needsUpdate){if(h.__webglTexture)h.__webglTexture=d.deleteTexture(h.__webglTexture);h.__webglTexture=d.createTexture();d.bindTexture(d.TEXTURE_2D,h.__webglTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,h.image);ma(d.TEXTURE_2D,h,h.image);d.bindTexture(d.TEXTURE_2D,null);h.needsUpdate=!1}d.activeTexture(d.TEXTURE0+F);d.bindTexture(d.TEXTURE_2D,h.__webglTexture)}
function Za(h){if(h&&!h.__webglFramebuffer){alert("in first one");if(h.depthBuffer===undefined)h.depthBuffer=!0;if(h.stencilBuffer===undefined)h.stencilBuffer=!0;h.__webglFramebuffer=d.createFramebuffer();h.__webglRenderbuffer=d.createRenderbuffer();h.__webglTexture=d.createTexture();d.bindTexture(d.TEXTURE_2D,h.__webglTexture);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,Ja(h.wrapS));d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,Ja(h.wrapT));d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,Ja(h.magFilter));
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,Ja(h.minFilter));d.texImage2D(d.TEXTURE_2D,0,Ja(h.format),h.width,h.height,0,Ja(h.format),Ja(h.type),null);d.bindRenderbuffer(d.RENDERBUFFER,h.__webglRenderbuffer);d.bindFramebuffer(d.FRAMEBUFFER,h.__webglFramebuffer);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,h.__webglTexture,0);if(h.depthBuffer&&!h.stencilBuffer){d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,h.width,h.height);d.framebufferRenderbuffer(d.FRAMEBUFFER,
d.DEPTH_ATTACHMENT,d.RENDERBUFFER,h.__webglRenderbuffer)}else if(h.depthBuffer&&h.stencilBuffer){d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,h.width,h.height);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,h.__webglRenderbuffer)}else d.renderbufferStorage(d.RENDERBUFFER,d.RGBA4,h.width,h.height);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)}var F,w;if(h){alert("in 2nd one");F=h.__webglFramebuffer;
w=h.width;h=h.height}else{F=null;w=xa;h=Ca}if(F!=Qa){alert("in 4 one");d.bindFramebuffer(d.FRAMEBUFFER,F);d.viewport(ua,Ta,w,h);Qa=F}}function na(h,F){var w;if(h=="fragment")w=d.createShader(d.FRAGMENT_SHADER);else h=="vertex"&&(w=d.createShader(d.VERTEX_SHADER));d.shaderSource(w,F);d.compileShader(w);if(!d.getShaderParameter(w,d.COMPILE_STATUS)){console.error(d.getShaderInfoLog(w));console.error(F);return null}return w}function Xa(h){switch(h){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return d.NEAREST;
default:return d.LINEAR}}function Ja(h){switch(h){case THREE.RepeatWrapping:return d.REPEAT;case THREE.ClampToEdgeWrapping:return d.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return d.MIRRORED_REPEAT;case THREE.NearestFilter:return d.NEAREST;case THREE.NearestMipMapNearestFilter:return d.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return d.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return d.LINEAR;case THREE.LinearMipMapNearestFilter:return d.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return d.LINEAR_MIPMAP_LINEAR;
case THREE.ByteType:return d.BYTE;case THREE.UnsignedByteType:return d.UNSIGNED_BYTE;case THREE.ShortType:return d.SHORT;case THREE.UnsignedShortType:return d.UNSIGNED_SHORT;case THREE.IntType:return d.INT;case THREE.UnsignedShortType:return d.UNSIGNED_INT;case THREE.FloatType:return d.FLOAT;case THREE.AlphaFormat:return d.ALPHA;case THREE.RGBFormat:return d.RGB;case THREE.RGBAFormat:return d.RGBA;case THREE.LuminanceFormat:return d.LUMINANCE;case THREE.LuminanceAlphaFormat:return d.LUMINANCE_ALPHA}return 0}
var ga=this,d,c=[],Ma=null,Qa=null,Na=!0,Aa=null,Oa=null,Ba=null,Pa=null,ua=0,Ta=0,xa=0,Ca=0,Fa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Ga=new THREE.Matrix4,$a=new Float32Array(16),hb=new Float32Array(16),eb=new THREE.Vector4,sb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};var Va=b.canvas!==undefined?b.canvas:document.createElement("canvas"),ib=b.stencil!==
undefined?b.stencil:!0,pb=b.antialias!==undefined?b.antialias:!1,Ya=b.clearColor!==undefined?new THREE.Color(b.clearColor):new THREE.Color(0),kb=b.clearAlpha!==undefined?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=Va;this.autoClear=!0;this.sortObjects=!0;try{if(!(d=Va.getContext("experimental-webgl",{antialias:pb,stencil:ib})))throw"Error creating WebGL context.";}catch(Ab){console.error(Ab)}console.log(navigator.userAgent+" | "+d.getParameter(d.VERSION)+
" | "+d.getParameter(d.VENDOR)+" | "+d.getParameter(d.RENDERER)+" | "+d.getParameter(d.SHADING_LANGUAGE_VERSION));d.clearColor(0,0,0,1);d.clearDepth(1);d.enable(d.DEPTH_TEST);d.depthFunc(d.LEQUAL);d.frontFace(d.CCW);d.cullFace(d.BACK);d.enable(d.CULL_FACE);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.clearColor(Ya.r,Ya.g,Ya.b,kb);this.context=d;var Eb=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(ib){var ja={};ja.vertices=new Float32Array(12);
ja.faces=new Uint16Array(6);ja.darkness=0.5;ja.vertices[0]=-20;ja.vertices[1]=-20;ja.vertices[2]=-1;ja.vertices[3]=20;ja.vertices[4]=-20;ja.vertices[5]=-1;ja.vertices[6]=20;ja.vertices[7]=20;ja.vertices[8]=-1;ja.vertices[9]=-20;ja.vertices[10]=20;ja.vertices[11]=-1;ja.faces[0]=0;ja.faces[1]=1;ja.faces[2]=2;ja.faces[3]=0;ja.faces[4]=2;ja.faces[5]=3;ja.vertexBuffer=d.createBuffer();ja.elementBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,ja.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,ja.vertices,
d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,ja.elementBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,ja.faces,d.STATIC_DRAW);ja.program=d.createProgram();d.attachShader(ja.program,na("fragment",THREE.ShaderLib.shadowPost.fragmentShader));d.attachShader(ja.program,na("vertex",THREE.ShaderLib.shadowPost.vertexShader));d.linkProgram(ja.program);ja.vertexLocation=d.getAttribLocation(ja.program,"position");ja.projectionLocation=d.getUniformLocation(ja.program,"projectionMatrix");ja.darknessLocation=
d.getUniformLocation(ja.program,"darkness")}var L={};L.vertices=new Float32Array(16);L.faces=new Uint16Array(6);b=0;L.vertices[b++]=-1;L.vertices[b++]=-1;L.vertices[b++]=0;L.vertices[b++]=0;L.vertices[b++]=1;L.vertices[b++]=-1;L.vertices[b++]=1;L.vertices[b++]=0;L.vertices[b++]=1;L.vertices[b++]=1;L.vertices[b++]=1;L.vertices[b++]=1;L.vertices[b++]=-1;L.vertices[b++]=1;L.vertices[b++]=0;L.vertices[b++]=1;b=0;L.faces[b++]=0;L.faces[b++]=1;L.faces[b++]=2;L.faces[b++]=0;L.faces[b++]=2;L.faces[b++]=3;
L.vertexBuffer=d.createBuffer();L.elementBuffer=d.createBuffer();L.tempTexture=d.createTexture();L.occlusionTexture=d.createTexture();d.bindBuffer(d.ARRAY_BUFFER,L.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,L.vertices,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,L.elementBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,L.faces,d.STATIC_DRAW);d.bindTexture(d.TEXTURE_2D,L.tempTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,
d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.bindTexture(d.TEXTURE_2D,L.occlusionTexture);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);if(d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){L.hasVertexTexture=!1;L.program=d.createProgram();d.attachShader(L.program,na("fragment",THREE.ShaderLib.lensFlare.fragmentShader));d.attachShader(L.program,na("vertex",THREE.ShaderLib.lensFlare.vertexShader))}else{L.hasVertexTexture=!0;L.program=d.createProgram();d.attachShader(L.program,na("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader));d.attachShader(L.program,
na("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))}d.linkProgram(L.program);L.attributes={};L.uniforms={};L.attributes.vertex=d.getAttribLocation(L.program,"position");L.attributes.uv=d.getAttribLocation(L.program,"UV");L.uniforms.renderType=d.getUniformLocation(L.program,"renderType");L.uniforms.map=d.getUniformLocation(L.program,"map");L.uniforms.occlusionMap=d.getUniformLocation(L.program,"occlusionMap");L.uniforms.opacity=d.getUniformLocation(L.program,"opacity");L.uniforms.scale=
d.getUniformLocation(L.program,"scale");L.uniforms.rotation=d.getUniformLocation(L.program,"rotation");L.uniforms.screenPosition=d.getUniformLocation(L.program,"screenPosition");var aa=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=
1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=d.createBuffer();_sprite.elementBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,_sprite.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,_sprite.vertices,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);
d.bufferData(d.ELEMENT_ARRAY_BUFFER,_sprite.faces,d.STATIC_DRAW);_sprite.program=d.createProgram();d.attachShader(_sprite.program,na("fragment",THREE.ShaderLib.sprite.fragmentShader));d.attachShader(_sprite.program,na("vertex",THREE.ShaderLib.sprite.vertexShader));d.linkProgram(_sprite.program);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=d.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=d.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=
d.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=d.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=d.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=d.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=d.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.map=d.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=d.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=
d.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=d.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=d.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=d.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=d.getUniformLocation(_sprite.program,"projectionMatrix");var Bb=!1;this.setSize=function(h,F){Va.width=h;Va.height=F;this.setViewport(0,
0,Va.width,Va.height)};this.setViewport=function(h,F,w,e){ua=h;Ta=F;xa=w;Ca=e;d.viewport(ua,Ta,xa,Ca)};this.setScissor=function(h,F,w,e){d.scissor(h,F,w,e)};this.enableScissorTest=function(h){h?d.enable(d.SCISSOR_TEST):d.disable(d.SCISSOR_TEST)};this.enableDepthBufferWrite=function(h){Na=h;d.depthMask(h)};this.setClearColorHex=function(h,F){Ya.setHex(h);kb=F;d.clearColor(Ya.r,Ya.g,Ya.b,kb)};this.setClearColor=function(h,F){Ya.copy(h);kb=F;d.clearColor(Ya.r,Ya.g,Ya.b,kb)};this.clear=function(){d.clear(d.COLOR_BUFFER_BIT|
d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(h){ja.darkness=h};this.getContext=function(){return d};this.initMaterial=function(h,F,w,e){var j,n,i;if(h instanceof THREE.MeshDepthMaterial)i="depth";else if(h instanceof THREE.ShadowVolumeDynamicMaterial)i="shadowVolumeDynamic";else if(h instanceof THREE.MeshNormalMaterial)i="normal";else if(h instanceof THREE.MeshBasicMaterial)i="basic";else if(h instanceof THREE.MeshLambertMaterial)i="lambert";else if(h instanceof
THREE.MeshPhongMaterial)i="phong";else if(h instanceof THREE.LineBasicMaterial)i="basic";else h instanceof THREE.ParticleBasicMaterial&&(i="particle_basic");if(i){var k=THREE.ShaderLib[i];h.uniforms=THREE.UniformsUtils.clone(k.uniforms);h.vertexShader=k.vertexShader;h.fragmentShader=k.fragmentShader}var u,t,m;u=m=k=0;for(t=F.length;u<t;u++){n=F[u];n instanceof THREE.DirectionalLight&&m++;n instanceof THREE.PointLight&&k++}if(k+m<=4)F=m;else{F=Math.ceil(4*m/(k+m));k=4-F}n={directional:F,point:k};m=
50;if(e!==undefined&&e instanceof THREE.SkinnedMesh)m=e.bones.length;var v;a:{u=h.fragmentShader;t=h.vertexShader;k=h.uniforms;F=h.attributes;w={map:!!h.map,envMap:!!h.envMap,lightMap:!!h.lightMap,vertexColors:h.vertexColors,fog:w,sizeAttenuation:h.sizeAttenuation,skinning:h.skinning,morphTargets:h.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:n.directional,maxPointLights:n.point,maxBones:m};var z;n=[];if(i)n.push(i);else{n.push(u);n.push(t)}for(z in w){n.push(z);n.push(w[z])}i=n.join();
z=0;for(n=c.length;z<n;z++)if(c[z].code==i){v=c[z].program;break a}z=d.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+w.maxDirLights,"#define MAX_POINT_LIGHTS "+w.maxPointLights,w.fog?"#define USE_FOG":"",w.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",w.map?"#define USE_MAP":"",w.envMap?"#define USE_ENVMAP":"",w.lightMap?"#define USE_LIGHTMAP":"",w.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");
prefix_vertex=[Eb?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+w.maxDirLights,"#define MAX_POINT_LIGHTS "+w.maxPointLights,"#define MAX_BONES "+w.maxBones,w.map?"#define USE_MAP":"",w.envMap?"#define USE_ENVMAP":"",w.lightMap?"#define USE_LIGHTMAP":"",w.vertexColors?"#define USE_COLOR":"",w.skinning?"#define USE_SKINNING":"",w.morphTargets?"#define USE_MORPHTARGETS":"",w.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
d.attachShader(z,na("fragment",prefix_fragment+u));d.attachShader(z,na("vertex",prefix_vertex+t));d.linkProgram(z);d.getProgramParameter(z,d.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+d.getProgramParameter(z,d.VALIDATE_STATUS)+", gl error ["+d.getError()+"]");z.uniforms={};z.attributes={};var p;u=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(p in k)u.push(p);
p=u;k=0;for(u=p.length;k<u;k++){t=p[k];z.uniforms[t]=d.getUniformLocation(z,t)}u=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(p=0;p<w.maxMorphTargets;p++)u.push("morphTarget"+p);for(v in F)u.push(v);v=u;p=0;for(F=v.length;p<F;p++){w=v[p];z.attributes[w]=d.getAttribLocation(z,w)}c.push({program:z,code:i});v=z}h.program=v;v=h.program.attributes;v.position>=0&&d.enableVertexAttribArray(v.position);v.color>=0&&d.enableVertexAttribArray(v.color);
v.normal>=0&&d.enableVertexAttribArray(v.normal);v.tangent>=0&&d.enableVertexAttribArray(v.tangent);if(h.skinning&&v.skinVertexA>=0&&v.skinVertexB>=0&&v.skinIndex>=0&&v.skinWeight>=0){d.enableVertexAttribArray(v.skinVertexA);d.enableVertexAttribArray(v.skinVertexB);d.enableVertexAttribArray(v.skinIndex);d.enableVertexAttribArray(v.skinWeight)}if(h.attributes)for(j in h.attributes)v[j]!==undefined&&v[j]>=0&&d.enableVertexAttribArray(v[j]);if(h.morphTargets){h.numSupportedMorphTargets=0;if(v.morphTarget0>=
0){d.enableVertexAttribArray(v.morphTarget0);h.numSupportedMorphTargets++}if(v.morphTarget1>=0){d.enableVertexAttribArray(v.morphTarget1);h.numSupportedMorphTargets++}if(v.morphTarget2>=0){d.enableVertexAttribArray(v.morphTarget2);h.numSupportedMorphTargets++}if(v.morphTarget3>=0){d.enableVertexAttribArray(v.morphTarget3);h.numSupportedMorphTargets++}if(v.morphTarget4>=0){d.enableVertexAttribArray(v.morphTarget4);h.numSupportedMorphTargets++}if(v.morphTarget5>=0){d.enableVertexAttribArray(v.morphTarget5);
h.numSupportedMorphTargets++}if(v.morphTarget6>=0){d.enableVertexAttribArray(v.morphTarget6);h.numSupportedMorphTargets++}if(v.morphTarget7>=0){d.enableVertexAttribArray(v.morphTarget7);h.numSupportedMorphTargets++}e.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);h=0;for(j=this.maxMorphTargets;h<j;h++)e.__webglMorphTargetInfluences[h]=0}};this.render=function(h,F,w,e){var j,n,i,k,u,t,m,v,z=h.lights,p=h.fog;ga.data.vertices=0;ga.data.faces=0;ga.data.drawCalls=0;F.matrixAutoUpdate&&
F.update(undefined,!0);h.update(undefined,!1,F);F.matrixWorldInverse.flattenToArray(hb);F.projectionMatrix.flattenToArray($a);Ga.multiply(F.projectionMatrix,F.matrixWorldInverse);D(Ga);this.initWebGLObjects(h);Za(w);(this.autoClear||e)&&this.clear();u=h.__webglObjects.length;for(e=0;e<u;e++){j=h.__webglObjects[e];m=j.object;if(m.visible)if(!(m instanceof THREE.Mesh)||E(m)){m.matrixWorld.flattenToArray(m._objectMatrixArray);ca(m,F);R(j);j.render=!0;if(this.sortObjects){eb.copy(m.position);Ga.multiplyVector3(eb);
j.z=eb.z}}else j.render=!1;else j.render=!1}this.sortObjects&&h.__webglObjects.sort(T);t=h.__webglObjectsImmediate.length;for(e=0;e<t;e++){j=h.__webglObjectsImmediate[e];m=j.object;if(m.visible){m.matrixAutoUpdate&&m.matrixWorld.flattenToArray(m._objectMatrixArray);ca(m,F);P(j)}}pa(THREE.NormalBlending);for(e=0;e<u;e++){j=h.__webglObjects[e];if(j.render){m=j.object;v=j.buffer;i=j.opaque;B(m);for(j=0;j<i.count;j++){k=i.list[j];y(k.depthTest);o(F,z,p,k,v,m)}}}for(e=0;e<t;e++){j=h.__webglObjectsImmediate[e];
m=j.object;if(m.visible){i=j.opaque;B(m);for(j=0;j<i.count;j++){k=i.list[j];y(k.depthTest);n=g(F,z,p,k,m);m.render(function(A){q(A,n,k.shading)})}}}for(e=0;e<u;e++){j=h.__webglObjects[e];if(j.render){m=j.object;v=j.buffer;i=j.transparent;B(m);for(j=0;j<i.count;j++){k=i.list[j];pa(k.blending);y(k.depthTest);o(F,z,p,k,v,m)}}}for(e=0;e<t;e++){j=h.__webglObjectsImmediate[e];m=j.object;if(m.visible){i=j.transparent;B(m);for(j=0;j<i.count;j++){k=i.list[j];pa(k.blending);y(k.depthTest);n=g(F,z,p,k,m);m.render(function(A){q(A,
n,k.shading)})}}}h.__webglSprites.length&&Q(h,F);ib&&h.__webglShadowVolumes.length&&h.lights.length&&O(h);h.__webglLensFlares.length&&Y(h,F);if(w&&w.minFilter!==THREE.NearestFilter&&w.minFilter!==THREE.LinearFilter){d.bindTexture(d.TEXTURE_2D,w.__webglTexture);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null)}d.finish()};this.initWebGLObjects=function(h){if(!h.__webglObjects){h.__webglObjects=[];h.__webglObjectsImmediate=[];h.__webglShadowVolumes=[];h.__webglLensFlares=[];h.__webglSprites=
[]}for(;h.__objectsAdded.length;){var F=h.__objectsAdded[0],w=h,e=void 0,j=void 0,n=void 0;if(F._modelViewMatrix==undefined){F._modelViewMatrix=new THREE.Matrix4;F._normalMatrixArray=new Float32Array(9);F._modelViewMatrixArray=new Float32Array(16);F._objectMatrixArray=new Float32Array(16);F.matrixWorld.flattenToArray(F._objectMatrixArray)}if(F instanceof THREE.Mesh){j=F.geometry;j.geometryGroups==undefined&&za(j);for(e in j.geometryGroups){n=j.geometryGroups[e];if(!n.__webglVertexBuffer){var i=n;
i.__webglVertexBuffer=d.createBuffer();i.__webglNormalBuffer=d.createBuffer();i.__webglTangentBuffer=d.createBuffer();i.__webglColorBuffer=d.createBuffer();i.__webglUVBuffer=d.createBuffer();i.__webglUV2Buffer=d.createBuffer();i.__webglSkinVertexABuffer=d.createBuffer();i.__webglSkinVertexBBuffer=d.createBuffer();i.__webglSkinIndicesBuffer=d.createBuffer();i.__webglSkinWeightsBuffer=d.createBuffer();i.__webglFaceBuffer=d.createBuffer();i.__webglLineBuffer=d.createBuffer();if(i.numMorphTargets){var k=
void 0,u=void 0;i.__webglMorphTargetsBuffers=[];k=0;for(u=i.numMorphTargets;k<u;k++)i.__webglMorphTargetsBuffers.push(d.createBuffer())}i=n;k=F;var t=void 0,m=void 0,v=void 0;v=void 0;var z=void 0,p=void 0,A=void 0,H=A=u=0;m=void 0;v=void 0;var J=void 0;t=void 0;m=void 0;z=k.geometry;J=z.faces;p=i.faces;t=0;for(m=p.length;t<m;t++){v=p[t];v=J[v];if(v instanceof THREE.Face3){u+=3;A+=1;H+=3}else if(v instanceof THREE.Face4){u+=4;A+=2;H+=4}}t=void 0;m=void 0;p=void 0;v=void 0;p=void 0;J=[];t=0;for(m=
k.materials.length;t<m;t++){p=k.materials[t];if(p instanceof THREE.MeshFaceMaterial){p=0;for(l=i.materials.length;p<l;p++)(v=i.materials[p])&&J.push(v)}else(v=p)&&J.push(v)}t=J;a:{m=void 0;J=void 0;p=t.length;for(m=0;m<p;m++){J=t[m];if(J.map||J.lightMap||J instanceof THREE.MeshShaderMaterial){m=!0;break a}}m=!1}a:{J=void 0;p=void 0;v=t.length;for(J=0;J<v;J++){p=t[J];if(!(p instanceof THREE.MeshBasicMaterial&&!p.envMap||p instanceof THREE.MeshDepthMaterial)){J=p&&p.shading!=undefined&&p.shading==THREE.SmoothShading?
THREE.SmoothShading:THREE.FlatShading;break a}}J=!1}a:{p=void 0;v=void 0;var N=t.length;for(p=0;p<N;p++){v=t[p];if(v.vertexColors){v=v.vertexColors;break a}}v=!1}i.__vertexArray=new Float32Array(u*3);if(J)i.__normalArray=new Float32Array(u*3);if(z.hasTangents)i.__tangentArray=new Float32Array(u*4);if(v)i.__colorArray=new Float32Array(u*3);if(m){if(z.faceUvs.length>0||z.faceVertexUvs.length>0)i.__uvArray=new Float32Array(u*2);if(z.faceUvs.length>1||z.faceVertexUvs.length>1)i.__uv2Array=new Float32Array(u*
2)}if(k.geometry.skinWeights.length&&k.geometry.skinIndices.length){i.__skinVertexAArray=new Float32Array(u*4);i.__skinVertexBArray=new Float32Array(u*4);i.__skinIndexArray=new Float32Array(u*4);i.__skinWeightArray=new Float32Array(u*4)}i.__faceArray=new Uint16Array(A*3+(k.geometry.edgeFaces?k.geometry.edgeFaces.length*6:0));i.__lineArray=new Uint16Array(H*2);if(i.numMorphTargets){i.__morphTargetsArrays=[];z=0;for(p=i.numMorphTargets;z<p;z++)i.__morphTargetsArrays.push(new Float32Array(u*3))}i.__needsSmoothNormals=
J==THREE.SmoothShading;i.__uvType=m;i.__vertexColorType=v;i.__normalType=J;i.__webglFaceCount=A*3+(k.geometry.edgeFaces?k.geometry.edgeFaces.length*6:0);i.__webglLineCount=H*2;z=0;for(p=t.length;z<p;z++)if(t[z].attributes){i.__webglCustomAttributes={};for(a in t[z].attributes){m=t[z].attributes[a];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;A=1;if(m.type==="v2")A=2;else if(m.type==="v3")A=3;else if(m.type==="v4")A=4;else m.type==="c"&&(A=3);m.size=A;m.needsUpdate=!0;m.array=
new Float32Array(u*A);m.buffer=d.createBuffer();m.buffer.belongsToAttribute=a}i.__webglCustomAttributes[a]=m}}i.__inittedArrays=!0;j.__dirtyVertices=!0;j.__dirtyMorphTargets=!0;j.__dirtyElements=!0;j.__dirtyUvs=!0;j.__dirtyNormals=!0;j.__dirtyTangents=!0;j.__dirtyColors=!0}F instanceof THREE.ShadowVolume?oa(w.__webglShadowVolumes,n,F):oa(w.__webglObjects,n,F)}}else if(F instanceof THREE.LensFlare)oa(w.__webglLensFlares,undefined,F);else if(F instanceof THREE.Ribbon){j=F.geometry;if(!j.__webglVertexBuffer){e=
j;e.__webglVertexBuffer=d.createBuffer();e.__webglColorBuffer=d.createBuffer();e=j;n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__webglVertexCount=n;j.__dirtyVertices=!0;j.__dirtyColors=!0}oa(w.__webglObjects,j,F)}else if(F instanceof THREE.Line){j=F.geometry;if(!j.__webglVertexBuffer){e=j;e.__webglVertexBuffer=d.createBuffer();e.__webglColorBuffer=d.createBuffer();e=j;n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*
3);e.__webglLineCount=n;j.__dirtyVertices=!0;j.__dirtyColors=!0}oa(w.__webglObjects,j,F)}else if(F instanceof THREE.ParticleSystem){j=F.geometry;if(!j.__webglVertexBuffer){e=j;e.__webglVertexBuffer=d.createBuffer();e.__webglColorBuffer=d.createBuffer();e=j;n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__sortArray=[];e.__webglParticleCount=n;j.__dirtyVertices=!0;j.__dirtyColors=!0}oa(w.__webglObjects,j,F)}else if(THREE.MarchingCubes!==undefined&&F instanceof
THREE.MarchingCubes)w.__webglObjectsImmediate.push({object:F,opaque:{list:[],count:0},transparent:{list:[],count:0}});else F instanceof THREE.Sprite&&w.__webglSprites.push(F);h.__objectsAdded.splice(0,1)}for(;h.__objectsRemoved.length;){F=h.__objectsRemoved[0];w=h;j=void 0;e=void 0;if(F instanceof THREE.Mesh)for(j=w.__webglObjects.length-1;j>=0;j--){e=w.__webglObjects[j].object;if(F==e){w.__webglObjects.splice(j,1);break}}else if(F instanceof THREE.Sprite)for(j=w.__webglSprites.length-1;j>=0;j--){e=
w.__webglSprites[j];if(F==e){w.__webglSprites.splice(j,1);break}}h.__objectsRemoved.splice(0,1)}F=0;for(w=h.__webglObjects.length;F<w;F++)V(h.__webglObjects[F].object,h);F=0;for(w=h.__webglShadowVolumes.length;F<w;F++)V(h.__webglShadowVolumes[F].object,h);F=0;for(w=h.__webglLensFlares.length;F<w;F++)V(h.__webglLensFlares[F].object,h)};this.setFaceCulling=function(h,F){if(h){!F||F=="ccw"?d.frontFace(d.CCW):d.frontFace(d.CW);if(h=="back")d.cullFace(d.BACK);else h=="front"?d.cullFace(d.FRONT):d.cullFace(d.FRONT_AND_BACK);
d.enable(d.CULL_FACE)}else d.disable(d.CULL_FACE)};this.supportsVertexTextures=function(){return Eb}};
THREE.WebGLRenderTarget=function(b,f,g){this.width=b;this.height=f;g=g||{};this.wrapS=g.wrapS!==undefined?g.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=g.wrapT!==undefined?g.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=g.magFilter!==undefined?g.magFilter:THREE.LinearFilter;this.minFilter=g.minFilter!==undefined?g.minFilter:THREE.LinearMipMapLinearFilter;this.format=g.format!==undefined?g.format:THREE.RGBAFormat;this.type=g.type!==undefined?g.type:THREE.UnsignedByteType;this.depthBuffer=g.depthBuffer!==
undefined?g.depthBuffer:!0;this.stencilBuffer=g.stencilBuffer!==undefined?g.stencilBuffer:!0};
